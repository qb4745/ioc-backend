# Direct DB connection (port 5432) for local development
# Use this profile only locally when you want to connect directly to the database (not the pooler).
# Prefer Direct Connection when your environment supports IPv6 or you need stable, long-lived connections
# (VMs, long-running containers). For IPv4-only networks you can use the Session Pooler (pooler.supabase.com:5432).
#
# IMPORTANT: Put real secrets in environment variables (do NOT commit passwords)
# Usage (example):
#   export SUPABASE_DIRECT_HOST=db.bdyvzjpkycnekjrlqlfp.supabase.co
#   export SUPABASE_DB_NAME=postgres
#   export SUPABASE_DB_USER=postgres
#   export SUPABASE_DB_PASSWORD=YOUR_PASSWORD
#   ./mvnw spring-boot:run -Dspring-boot.run.profiles=dev-5432

# -------------------------------------------------------------------
# JDBC URL - direct connection (port 5432) - default points to the project direct host
# -------------------------------------------------------------------
# Use the direct host (db.<project-ref>.supabase.co). If your machine has no IPv6
# route and DNS returns AAAA records, libpq/JDBC may prefer IPv6 and fail.
# To force an IPv4 connection while still keeping the hostname for TLS/SNI/cert
# verification, resolve the host to an IPv4 address and set SUPABASE_DIRECT_HOSTADDR
# (example: export SUPABASE_DIRECT_HOSTADDR=3.122.45.67). The driver will connect
# to hostaddr but still use the hostname for TLS checks.
# The hostaddr parameter is optional and safe when empty.
spring.datasource.url=jdbc:postgresql://${SUPABASE_DIRECT_HOST:db.bdyvzjpkycnekjrlqlfp.supabase.co}:5432/${SUPABASE_DB_NAME:postgres}?sslmode=require&hostaddr=${SUPABASE_DIRECT_HOSTADDR:}
spring.datasource.username=${SUPABASE_DB_USER:postgres}
spring.datasource.password=${SUPABASE_DB_PASSWORD}

# Keep pool small for safety in shared environments
spring.datasource.hikari.maximum-pool-size=1
spring.datasource.hikari.minimum-idle=0
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=300000
spring.datasource.hikari.keepalive-time=120000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.data-source-properties.applicationName=iocbackend-dev-5432
spring.datasource.hikari.pool-name=iocbackend-dev-5432

# JPA/Hibernate
# Use validate to avoid schema changes on a shared DB
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.open-in-view=false

# DevTools - disable restart to avoid multiple connection attempts against a shared DB
spring.devtools.restart.enabled=false

# Metabase placeholder (keep using env var)
metabase.secret-key=${METABASE_SECRET_KEY}
metabase.site-url=${METABASE_SITE_URL:http://localhost:3000}

server.port=8080
