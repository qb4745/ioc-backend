# Development-specific properties
# This file is ignored by .gitignore and should NOT be committed.
# It overrides properties from application.properties for the 'dev' profile.

# ===================================================================
# CONFIGURACION LOCAL DE LA BASE DE DATOS (SUPABASE) - CORREGIDA
# ===================================================================
# CRITICO: Usar puerto 6543 (Transaction Mode) para evitar conexiones idle
#spring.datasource.url=jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:6543/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require}
spring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp
# Use an environment variable for the password (do NOT commit secrets)
spring.datasource.password=${SUPABASE_DB_PASSWORD}

# Disable DevTools restart for shared DBs to avoid multiple connections from restarts
spring.devtools.restart.enabled=false

# ===================================================================
# CONFIGURACION DE HIKARICP POOL - OPTIMIZADO PARA SUPABASE FREE TIER
# ===================================================================
# Limite de conexiones recomendado para desarrollo local contra DB compartida
spring.datasource.hikari.maximum-pool-size=1
spring.datasource.hikari.minimum-idle=0
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=300000
spring.datasource.hikari.keepalive-time=0
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.leak-detection-threshold=60000
# Identificar tus conexiones en pg_stat_activity
spring.datasource.hikari.data-source-properties.applicationName=iocbackend-dev

# ===================================================================
# CONFIGURACION DE JPA & HIBERNATE - CRITICO PARA EVITAR METADATA QUERIES
# ===================================================================
# Dialecto expl\u00EDcito para evitar query de metadata al inicio
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
# NO generar/modificar esquema en dev (usar ddl-auto=validate o none)
spring.jpa.hibernate.ddl-auto=validate
# No mostrar SQL en dev para reducir logs
spring.jpa.show-sql=false
# Desactivar Open-In-View
spring.jpa.open-in-view=false

# ===================================================================
# CONFIGURACION DE SEGURIDAD (SUPABASE AUTH)
# ===================================================================
spring.security.oauth2.resourceserver.jwt.issuer-uri=https://bdyvzjpkycnekjrlqlfp.supabase.co/auth/v1

# ===================================================================
# CONFIGURACION DE METABASE EMBEDDING
# ===================================================================
metabase.secret-key=${METABASE_SECRET_KEY}

# Diagnostic: Change server port to verify profile is active
server.port=8080
