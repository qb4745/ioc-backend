{
  "repo_summary": "",
  "files_scanned": [
    {
      "path": "Dockerfile",
      "excerpt": "# Stage 1: Build the application using Maven\nFROM maven:3.9-eclipse-temurin-21 AS build\n\n# Set the working directory\nWORKDIR /app\n\n# Copy the Maven project files\nCOPY pom.xml .\nCOPY .mvn .mvn\nCOPY mvnw .\n\n# Download dependencies first to leverage Docker cache\nRUN mvn dependency:go-offline -B\n\n# Copy the rest of the source code\nCOPY src src\n\n# Package the application, skipping tests for faster builds\nRUN mvn clean package -DskipTests -B\n\n# Stage 2: Create the final, lightweight runtime image\nFROM eclipse-temurin:21-jre-jammy\n\n# Set the working directory\nWORKDIR /app\n\n# Create a non-root user for security\nRUN groupadd -r spring && useradd -r -g spring spring\n\n# Copy the JAR file from the build stage\nCOPY --from=build /app/target/*.jar app.jar\n\n# Change ownership\nRUN chown spring:spring app.jar\n\n# Switch to non-root user\nUSER spring:spring\n\n# Expose the port the application will run on\nEXPOSE 8080\n\n# Health check (opcional pero recomendado)\nHEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \\\n  CMD curl -f http://localhost:8080/actuator/health || exit 1\n\n# Command to run the application\nENTRYPOINT [\"java\", \"-jar\", \"app.jar\"]"
    },
    {
      "path": "pom.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<parent>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-starter-parent</artifactId>\n\t\t<version>3.5.5</version>\n\t\t<relativePath/> <!-- lookup parent from repository -->\n\t</parent>\n\t<groupId>com.cambiaso</groupId>\n\t<artifactId>iocbackend</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>iocbackend</name>\n\t<description>Backend API for the Inteligencia Operacional Cambiaso project</description>\n\t<url/>\n\t<licenses>\n\t\t<license/>\n\t</licenses>\n\t<developers>\n\t\t<developer/>\n\t</developers>\n\t<scm>\n\t\t<connection/>\n\t\t<developerConnection/>\n\t\t<tag/>\n\t\t<url/>\n\t</scm>\n\t<properties>\n\t\t<java.version>21</java.version>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n\t\t<maven.compiler.encoding>UTF-8</maven.compiler.encoding>\n\t\t<testcontainers.version>1.20.3</testcontainers.version>\n\t</properties>\n\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.testcontainers</groupId>\n\t\t\t\t<artifactId>testcontainers-bom</artifactId>\n\t\t\t\t<version>${testcontainers.version}</version>\n\t\t\t\t<type>pom</type>\n\t\t\t\t<scope>import</scope>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-data-jpa</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-security</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-validation</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactI"
    },
    {
      "path": "docker-compose.yml",
      "excerpt": "version: '3.8'\n\nservices:\n  postgres:\n    image: postgres:15\n    container_name: ioc_metabase_db\n    env_file:\n      - .env\n    environment:\n      POSTGRES_DB: ${POSTGRES_DB}\n      POSTGRES_USER: ${POSTGRES_USER}\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  metabase:\n    image: metabase/metabase:latest\n    container_name: ioc_metabase\n    depends_on:\n      postgres:\n        condition: service_healthy\n    ports:\n      - \"3000:3000\"\n    dns:\n      - 8.8.8.8\n      - 1.1.1.1\n    env_file:\n      - .env\n    environment:\n      MB_DB_TYPE: postgres\n      MB_DB_HOST: \"postgres\"\n      MB_DB_PORT: \"5432\"\n      MB_DB_DBNAME: \"${POSTGRES_DB}\"\n      MB_DB_USER: \"${POSTGRES_USER}\"\n      MB_DB_PASS: \"${POSTGRES_PASSWORD}\"\n      # ‚ö†Ô∏è DEBE COINCIDIR CON metabase.site-url del backend\n      MB_SITE_URL: \"https://treated-paste-eos-memo.trycloudflare.com\"\n      MB_EMBEDDING_SECRET_KEY: \"${METABASE_SECRET_KEY}\"\n      # Permitir embedding desde Vercel\n      MB_EMBEDDING_APP_ORIGIN: \"https://tu-app.vercel.app\"\n      MB_SITE_LOCALE: \"es\"\n      JAVA_TIMEZONE: \"America/Santiago\"\n    restart: unless-stopped\n\nvolumes:\n  postgres-data:\n    driver: local\n"
    },
    {
      "path": "src/test/resources/application-pgtest.properties",
      "excerpt": "# Configuraci√≥n para tests con PostgreSQL (Testcontainers)\nspring.jpa.hibernate.ddl-auto=update\n\n# Metabase (valores de prueba)\nmetabase.secret-key=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef\nmetabase.site-url=http://localhost:3000\nmetabase.dashboards[0].id=1\nmetabase.dashboards[0].name=Test Dashboard\nmetabase.dashboards[0].allowed-roles=ROLE_USER,ROLE_ADMIN\n\n# ETL\netl.lock.enabled=true\netl.retry.unique.enabled=false\n\n# Logging\nlogging.level.org.springframework=WARN\nlogging.level.org.hibernate=WARN\n\n# src/test/resources/application-pgtest.properties\n\n# Database (configurado dinÔøΩmicamente por Testcontainers)\n\n# Metabase (valores de prueba)\n\nmetabase.token-expiration-minutes=10\n\n\nmetabase.dashboards[0].filters[0].name=user_id\nmetabase.dashboards[0].filters[0].type=USER_ATTRIBUTE\nmetabase.dashboards[0].filters[0].source=userId\n\n# JWT Issuer\nspring.security.oauth2.resourceserver.jwt.issuer-uri=https://test.supabase.co/auth/v1\n\n# ETL Config\netl.duplicate.check.enabled=false\netl.duplicate.fail-on-detect=false\n\n# Circuit Breaker (permisivo para tests)\nresilience4j.circuitbreaker.configs.default.failureRateThreshold=100\nresilience4j.circuitbreaker.configs.default.waitDurationInOpenState=1000ms"
    },
    {
      "path": "src/test/resources/application-test.properties",
      "excerpt": "# ===================================================================\n# CONFIGURACI\\u00D3N DE BASE DE DATOS PARA TESTS (H2 EN MEMORIA)\n# ===================================================================\nspring.datasource.url=jdbc:h2:mem:testdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH;INIT=RUNSCRIPT FROM 'classpath:init-h2.sql'\nspring.datasource.driver-class-name=org.h2.Driver\nspring.datasource.username=sa\nspring.datasource.password=\n\n# ===================================================================\n# CONFIGURACI\\u00D3N DE JPA\n# ===================================================================\nspring.jpa.hibernate.ddl-auto=create-drop\nspring.sql.init.mode=never\nspring.jpa.show-sql=false\nspring.jpa.properties.hibernate.format_sql=false\nspring.jpa.properties.hibernate.jdbc.batch_size=20\nspring.jpa.properties.hibernate.order_inserts=true\nspring.jpa.properties.hibernate.order_updates=true\n\n# ===================================================================\n# CONFIGURACION DE SEGURIDAD (OAUTH2 JWT) - VALORES MOCK PARA TESTS\n# ===================================================================\nspring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:3000/auth/v1\n\n# ===================================================================\n# CONFIGURACION DE ETL (FEATURE FLAGS) - DISABLED FOR TESTS\n# ===================================================================\netl.lock.enabled=false\netl.retry.unique.enabled=true\netl.duplicate.check.enabled=false\netl.duplicate.fail-on-detect=false\netl.duplicate.check.sample-limit=10\netl.unique.enforced=false\netl.jobs.stuck.threshold-minutes=30\netl.jobs.watchdog.enabled=false\n\n# ===================================================================\n# CONFIGURACION DE CACHE (REQUERIDA POR METABASE SERVICE)\n# ===================================================================\nspring.cache.type=caffeine\nspring.cache.caffeine.spec=maximumSize=100,expireAfterWrite=5m\n\n# ================================="
    },
    {
      "path": "src/main/resources/application-prod.properties",
      "excerpt": "# ===================================================================\n# PRODUCCI√ìN - RENDER DEPLOYMENT\n# ===================================================================\n\n# Database Connection\nspring.datasource.url=jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require\nspring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# HikariCP Pool - Production Optimized\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout=240000\nspring.datasource.hikari.max-lifetime=300000\nspring.datasource.hikari.keepalive-time=120000\nspring.datasource.hikari.validation-timeout=3000\nspring.datasource.hikari.connection-test-query=SELECT 1\nspring.datasource.hikari.leak-detection-threshold=60000\nspring.datasource.hikari.pool-name=SupabaseHikariPool-Prod\nspring.datasource.hikari.data-source-properties.applicationName=iocbackend-prod\n\n# JPA/Hibernate - PRODUCTION (DO NOT MODIFY SCHEMA)\nspring.jpa.hibernate.ddl-auto=none\nspring.jpa.show-sql=false\nspring.jpa.open-in-view=false\n\n# Security\nspring.security.oauth2.resourceserver.jwt.issuer-uri=${SUPABASE_JWT_ISSUER_URI:https://bdyvzjpkycnekjrlqlfp.supabase.co/auth/v1}\n\n# ===================================================================\n# SUPABASE AUTH API - For automatic user creation\n# ===================================================================\nsupabase.url=${SUPABASE_URL:https://bdyvzjpkycnekjrlqlfp.supabase.co}\nsupabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\n\n# Metabase\nmetabase.site-url=${METABASE_URL:https://treated-paste-eos-memo.trycloudflare.com}\nmetabase.secret-key=${METABASE_SECRET_KEY:dummy-key-for-local-prod-testing}\n\n# ETL\netl.lock.enabled=false\netl.duplicate.check.enabled=false\netl.duplicate.fail-on-detect=false\n\n# Logging (Production)\nlogging.level."
    },
    {
      "path": "src/main/resources/application-dev-5432.properties",
      "excerpt": "# Direct DB connection (port 5432) for local development\n# Use this profile only locally when you want to connect directly to the database (not the pooler).\n# Prefer Direct Connection when your environment supports IPv6 or you need stable, long-lived connections\n# (VMs, long-running containers). For IPv4-only networks you can use the Session Pooler (pooler.supabase.com:5432).\n#\n# IMPORTANT: Put real secrets in environment variables (do NOT commit passwords)\n# Usage (example):\n#   export SUPABASE_DIRECT_HOST=db.bdyvzjpkycnekjrlqlfp.supabase.co\n#   export SUPABASE_DB_NAME=postgres\n#   export SUPABASE_DB_USER=postgres\n#   export SUPABASE_DB_PASSWORD=YOUR_PASSWORD\n#   ./mvnw spring-boot:run -Dspring-boot.run.profiles=dev-5432\n\n# -------------------------------------------------------------------\n# JDBC URL - direct connection (port 5432) - default points to the project direct host\n# -------------------------------------------------------------------\n# Use the direct host (db.<project-ref>.supabase.co). If your machine has no IPv6\n# route and DNS returns AAAA records, libpq/JDBC may prefer IPv6 and fail.\n# To force an IPv4 connection while still keeping the hostname for TLS/SNI/cert\n# verification, resolve the host to an IPv4 address and set SUPABASE_DIRECT_HOSTADDR\n# (example: export SUPABASE_DIRECT_HOSTADDR=3.122.45.67). The driver will connect\n# to hostaddr but still use the hostname for TLS checks.\n# The hostaddr parameter is optional and safe when empty.\nspring.datasource.url=jdbc:postgresql://${SUPABASE_DIRECT_HOST:db.bdyvzjpkycnekjrlqlfp.supabase.co}:5432/${SUPABASE_DB_NAME:postgres}?sslmode=require&hostaddr=${SUPABASE_DIRECT_HOSTADDR:}\nspring.datasource.username=${SUPABASE_DB_USER:postgres}\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# Keep pool small for safety in shared environments\nspring.datasource.hikari.maximum-pool-size=1\nspring.datasource.hikari.minimum-idle=0\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout="
    },
    {
      "path": "src/main/resources/application.properties",
      "excerpt": "# ===================================================================\n# BASE CONFIGURATION - SHARED BY ALL PROFILES\n# ===================================================================\n# This file contains ONLY common settings shared across all environments.\n# Environment-specific values go in application-{profile}.properties\n\n# Application Info\nspring.application.name=ioc-backend\n\n# ===================================================================\n# SUPABASE AUTH - Common Settings\n# ===================================================================\n# These values are environment-specific and must be set via environment variables\n# supabase.url=${SUPABASE_URL}\n# supabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\n\n# ===================================================================\n# DATABASE - Common Settings\n# ===================================================================\n# Explicit PostgreSQL driver (prevents H2 auto-detection)\nspring.datasource.driver-class-name=org.postgresql.Driver\n\n# ===================================================================\n# JPA/Hibernate - Common Settings\n# ===================================================================\nspring.jpa.open-in-view=false\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\nspring.jpa.properties.hibernate.jdbc.batch_size=20\nspring.jpa.properties.hibernate.order_inserts=true\nspring.jpa.properties.hibernate.order_updates=true\nspring.jpa.properties.hibernate.jdbc.batch_versioned_data=true\nspring.jpa.properties.hibernate.generate_statistics=false\n\n# Physical naming strategy (keep camelCase)\nspring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl\n\n# ===================================================================\n# ACTUATOR - Common Settings\n# ===================================================================\nmanagement.endpoints.web.exposure.include=health,metrics,prometheus,info\nmanagement.endpoint.heal"
    },
    {
      "path": "src/main/resources/application-local.properties",
      "excerpt": "# ===================================================================\n# LOCAL PROFILE - For local development\n# ===================================================================\n\n# Database Connection\nspring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require}\nspring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# HikariCP Pool Configuration\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=20000\nspring.datasource.hikari.idle-timeout=180000\nspring.datasource.hikari.max-lifetime=300000\nspring.datasource.hikari.keepalive-time=0\nspring.datasource.hikari.validation-timeout=3000\nspring.datasource.hikari.leak-detection-threshold=60000\nspring.datasource.hikari.pool-name=SupabaseHikariPool-Local\nspring.datasource.hikari.data-source-properties.applicationName=iocbackend-local\n\n# JPA/Hibernate\nspring.jpa.hibernate.ddl-auto=validate\nspring.jpa.show-sql=true\nspring.jpa.properties.hibernate.format_sql=true\n\n# Security (Supabase Auth)\nspring.security.oauth2.resourceserver.jwt.issuer-uri=https://bdyvzjpkycnekjrlqlfp.supabase.co/auth/v1\n\n# ===================================================================\n# SUPABASE AUTH API - For automatic user creation\n# ===================================================================\nsupabase.url=${SUPABASE_URL:https://bdyvzjpkycnekjrlqlfp.supabase.co}\nsupabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\n\n# Metabase\nmetabase.site-url=https://treated-paste-eos-memo.trycloudflare.com\nmetabase.secret-key=${METABASE_SECRET_KEY}\n\n# Server\nserver.port=8080\n\n# Logging\nlogging.level.com.cambiaso.ioc=DEBUG"
    },
    {
      "path": "src/main/resources/application-dev.properties",
      "excerpt": "# Development-specific properties\n# This file is ignored by .gitignore and should NOT be committed.\n# It overrides properties from application.properties for the 'dev' profile.\n\n# ===================================================================\n# CONFIGURACION LOCAL DE LA BASE DE DATOS (SUPABASE) - CORREGIDA\n# ===================================================================\n# CRITICO: Usar puerto 6543 (Transaction Mode) para evitar conexiones idle\n#spring.datasource.url=jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:6543/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require\nspring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require}\nspring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp\n# Use an environment variable for the password (do NOT commit secrets)\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# Disable DevTools restart for shared DBs to avoid multiple connections from restarts\nspring.devtools.restart.enabled=false\n\n# ===================================================================\n# CONFIGURACION DE HIKARICP POOL - OPTIMIZADO PARA SUPABASE FREE TIER\n# ===================================================================\n# Limite de conexiones recomendado para desarrollo local contra DB compartida\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout=300000\nspring.datasource.hikari.max-lifetime=300000\nspring.datasource.hikari.keepalive-time=0\nspring.datasource.hikari.validation-timeout=5000\nspring.datasource.hikari.leak-detection-threshold=60000\n# Identificar tus conexiones en pg_stat_activity\nspring.datasource.hikari.data-source-properties.applicationName=iocbackend-dev\n\n# ===================================================================\n# "
    },
    {
      "path": "target/classes/application-prod.properties",
      "excerpt": "# ===================================================================\n# PRODUCCI√ìN - RENDER DEPLOYMENT\n# ===================================================================\n\n# Database Connection\nspring.datasource.url=jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require\nspring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# HikariCP Pool - Production Optimized\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout=240000\nspring.datasource.hikari.max-lifetime=300000\nspring.datasource.hikari.keepalive-time=120000\nspring.datasource.hikari.validation-timeout=3000\nspring.datasource.hikari.connection-test-query=SELECT 1\nspring.datasource.hikari.leak-detection-threshold=60000\nspring.datasource.hikari.pool-name=SupabaseHikariPool-Prod\nspring.datasource.hikari.data-source-properties.applicationName=iocbackend-prod\n\n# JPA/Hibernate - PRODUCTION (DO NOT MODIFY SCHEMA)\nspring.jpa.hibernate.ddl-auto=none\nspring.jpa.show-sql=false\nspring.jpa.open-in-view=false\n\n# Security\nspring.security.oauth2.resourceserver.jwt.issuer-uri=${SUPABASE_JWT_ISSUER_URI:https://bdyvzjpkycnekjrlqlfp.supabase.co/auth/v1}\n\n# ===================================================================\n# SUPABASE AUTH API - For automatic user creation\n# ===================================================================\nsupabase.url=${SUPABASE_URL:https://bdyvzjpkycnekjrlqlfp.supabase.co}\nsupabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\n\n# Metabase\nmetabase.site-url=${METABASE_URL:https://treated-paste-eos-memo.trycloudflare.com}\nmetabase.secret-key=${METABASE_SECRET_KEY:dummy-key-for-local-prod-testing}\n\n# ETL\netl.lock.enabled=false\netl.duplicate.check.enabled=false\netl.duplicate.fail-on-detect=false\n\n# Logging (Production)\nlogging.level."
    },
    {
      "path": "target/classes/application-dev-5432.properties",
      "excerpt": "# Direct DB connection (port 5432) for local development\n# Use this profile only locally when you want to connect directly to the database (not the pooler).\n# Prefer Direct Connection when your environment supports IPv6 or you need stable, long-lived connections\n# (VMs, long-running containers). For IPv4-only networks you can use the Session Pooler (pooler.supabase.com:5432).\n#\n# IMPORTANT: Put real secrets in environment variables (do NOT commit passwords)\n# Usage (example):\n#   export SUPABASE_DIRECT_HOST=db.bdyvzjpkycnekjrlqlfp.supabase.co\n#   export SUPABASE_DB_NAME=postgres\n#   export SUPABASE_DB_USER=postgres\n#   export SUPABASE_DB_PASSWORD=YOUR_PASSWORD\n#   ./mvnw spring-boot:run -Dspring-boot.run.profiles=dev-5432\n\n# -------------------------------------------------------------------\n# JDBC URL - direct connection (port 5432) - default points to the project direct host\n# -------------------------------------------------------------------\n# Use the direct host (db.<project-ref>.supabase.co). If your machine has no IPv6\n# route and DNS returns AAAA records, libpq/JDBC may prefer IPv6 and fail.\n# To force an IPv4 connection while still keeping the hostname for TLS/SNI/cert\n# verification, resolve the host to an IPv4 address and set SUPABASE_DIRECT_HOSTADDR\n# (example: export SUPABASE_DIRECT_HOSTADDR=3.122.45.67). The driver will connect\n# to hostaddr but still use the hostname for TLS checks.\n# The hostaddr parameter is optional and safe when empty.\nspring.datasource.url=jdbc:postgresql://${SUPABASE_DIRECT_HOST:db.bdyvzjpkycnekjrlqlfp.supabase.co}:5432/${SUPABASE_DB_NAME:postgres}?sslmode=require&hostaddr=${SUPABASE_DIRECT_HOSTADDR:}\nspring.datasource.username=${SUPABASE_DB_USER:postgres}\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# Keep pool small for safety in shared environments\nspring.datasource.hikari.maximum-pool-size=1\nspring.datasource.hikari.minimum-idle=0\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout="
    },
    {
      "path": "target/classes/application.properties",
      "excerpt": "# ===================================================================\n# BASE CONFIGURATION - SHARED BY ALL PROFILES\n# ===================================================================\n# This file contains ONLY common settings shared across all environments.\n# Environment-specific values go in application-{profile}.properties\n\n# Application Info\nspring.application.name=ioc-backend\n\n# ===================================================================\n# SUPABASE AUTH - Common Settings\n# ===================================================================\n# These values are environment-specific and must be set via environment variables\n# supabase.url=${SUPABASE_URL}\n# supabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\n\n# ===================================================================\n# DATABASE - Common Settings\n# ===================================================================\n# Explicit PostgreSQL driver (prevents H2 auto-detection)\nspring.datasource.driver-class-name=org.postgresql.Driver\n\n# ===================================================================\n# JPA/Hibernate - Common Settings\n# ===================================================================\nspring.jpa.open-in-view=false\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\nspring.jpa.properties.hibernate.jdbc.batch_size=20\nspring.jpa.properties.hibernate.order_inserts=true\nspring.jpa.properties.hibernate.order_updates=true\nspring.jpa.properties.hibernate.jdbc.batch_versioned_data=true\nspring.jpa.properties.hibernate.generate_statistics=false\n\n# Physical naming strategy (keep camelCase)\nspring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl\n\n# ===================================================================\n# ACTUATOR - Common Settings\n# ===================================================================\nmanagement.endpoints.web.exposure.include=health,metrics,prometheus,info\nmanagement.endpoint.heal"
    },
    {
      "path": "target/classes/application-local.properties",
      "excerpt": "# ===================================================================\n# LOCAL PROFILE - For local development\n# ===================================================================\n\n# Database Connection\nspring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require}\nspring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# HikariCP Pool Configuration\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=20000\nspring.datasource.hikari.idle-timeout=180000\nspring.datasource.hikari.max-lifetime=300000\nspring.datasource.hikari.keepalive-time=0\nspring.datasource.hikari.validation-timeout=3000\nspring.datasource.hikari.leak-detection-threshold=60000\nspring.datasource.hikari.pool-name=SupabaseHikariPool-Local\nspring.datasource.hikari.data-source-properties.applicationName=iocbackend-local\n\n# JPA/Hibernate\nspring.jpa.hibernate.ddl-auto=validate\nspring.jpa.show-sql=true\nspring.jpa.properties.hibernate.format_sql=true\n\n# Security (Supabase Auth)\nspring.security.oauth2.resourceserver.jwt.issuer-uri=https://bdyvzjpkycnekjrlqlfp.supabase.co/auth/v1\n\n# ===================================================================\n# SUPABASE AUTH API - For automatic user creation\n# ===================================================================\nsupabase.url=${SUPABASE_URL:https://bdyvzjpkycnekjrlqlfp.supabase.co}\nsupabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\n\n# Metabase\nmetabase.site-url=https://treated-paste-eos-memo.trycloudflare.com\nmetabase.secret-key=${METABASE_SECRET_KEY}\n\n# Server\nserver.port=8080\n\n# Logging\nlogging.level.com.cambiaso.ioc=DEBUG"
    },
    {
      "path": "target/classes/application-dev.properties",
      "excerpt": "# Development-specific properties\n# This file is ignored by .gitignore and should NOT be committed.\n# It overrides properties from application.properties for the 'dev' profile.\n\n# ===================================================================\n# CONFIGURACION LOCAL DE LA BASE DE DATOS (SUPABASE) - CORREGIDA\n# ===================================================================\n# CRITICO: Usar puerto 6543 (Transaction Mode) para evitar conexiones idle\n#spring.datasource.url=jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:6543/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require\nspring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require}\nspring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp\n# Use an environment variable for the password (do NOT commit secrets)\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# Disable DevTools restart for shared DBs to avoid multiple connections from restarts\nspring.devtools.restart.enabled=false\n\n# ===================================================================\n# CONFIGURACION DE HIKARICP POOL - OPTIMIZADO PARA SUPABASE FREE TIER\n# ===================================================================\n# Limite de conexiones recomendado para desarrollo local contra DB compartida\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout=300000\nspring.datasource.hikari.max-lifetime=300000\nspring.datasource.hikari.keepalive-time=0\nspring.datasource.hikari.validation-timeout=5000\nspring.datasource.hikari.leak-detection-threshold=60000\n# Identificar tus conexiones en pg_stat_activity\nspring.datasource.hikari.data-source-properties.applicationName=iocbackend-dev\n\n# ===================================================================\n# "
    },
    {
      "path": "target/test-classes/application-pgtest.properties",
      "excerpt": "# Configuraci√≥n para tests con PostgreSQL (Testcontainers)\nspring.jpa.hibernate.ddl-auto=update\n\n# Metabase (valores de prueba)\nmetabase.secret-key=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef\nmetabase.site-url=http://localhost:3000\nmetabase.dashboards[0].id=1\nmetabase.dashboards[0].name=Test Dashboard\nmetabase.dashboards[0].allowed-roles=ROLE_USER,ROLE_ADMIN\n\n# ETL\netl.lock.enabled=true\netl.retry.unique.enabled=false\n\n# Logging\nlogging.level.org.springframework=WARN\nlogging.level.org.hibernate=WARN\n\n# src/test/resources/application-pgtest.properties\n\n# Database (configurado dinÔøΩmicamente por Testcontainers)\n\n# Metabase (valores de prueba)\n\nmetabase.token-expiration-minutes=10\n\n\nmetabase.dashboards[0].filters[0].name=user_id\nmetabase.dashboards[0].filters[0].type=USER_ATTRIBUTE\nmetabase.dashboards[0].filters[0].source=userId\n\n# JWT Issuer\nspring.security.oauth2.resourceserver.jwt.issuer-uri=https://test.supabase.co/auth/v1\n\n# ETL Config\netl.duplicate.check.enabled=false\netl.duplicate.fail-on-detect=false\n\n# Circuit Breaker (permisivo para tests)\nresilience4j.circuitbreaker.configs.default.failureRateThreshold=100\nresilience4j.circuitbreaker.configs.default.waitDurationInOpenState=1000ms"
    },
    {
      "path": "target/test-classes/application-test.properties",
      "excerpt": "# ===================================================================\n# CONFIGURACI\\u00D3N DE BASE DE DATOS PARA TESTS (H2 EN MEMORIA)\n# ===================================================================\nspring.datasource.url=jdbc:h2:mem:testdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH;INIT=RUNSCRIPT FROM 'classpath:init-h2.sql'\nspring.datasource.driver-class-name=org.h2.Driver\nspring.datasource.username=sa\nspring.datasource.password=\n\n# ===================================================================\n# CONFIGURACI\\u00D3N DE JPA\n# ===================================================================\nspring.jpa.hibernate.ddl-auto=create-drop\nspring.sql.init.mode=never\nspring.jpa.show-sql=false\nspring.jpa.properties.hibernate.format_sql=false\nspring.jpa.properties.hibernate.jdbc.batch_size=20\nspring.jpa.properties.hibernate.order_inserts=true\nspring.jpa.properties.hibernate.order_updates=true\n\n# ===================================================================\n# CONFIGURACION DE SEGURIDAD (OAUTH2 JWT) - VALORES MOCK PARA TESTS\n# ===================================================================\nspring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:3000/auth/v1\n\n# ===================================================================\n# CONFIGURACION DE ETL (FEATURE FLAGS) - DISABLED FOR TESTS\n# ===================================================================\netl.lock.enabled=false\netl.retry.unique.enabled=true\netl.duplicate.check.enabled=false\netl.duplicate.fail-on-detect=false\netl.duplicate.check.sample-limit=10\netl.unique.enforced=false\netl.jobs.stuck.threshold-minutes=30\netl.jobs.watchdog.enabled=false\n\n# ===================================================================\n# CONFIGURACION DE CACHE (REQUERIDA POR METABASE SERVICE)\n# ===================================================================\nspring.cache.type=caffeine\nspring.cache.caffeine.spec=maximumSize=100,expireAfterWrite=5m\n\n# ================================="
    },
    {
      "path": "links-del-proyecto.md",
      "excerpt": "# Enlaces Importantes del Proyecto IOC\n\nEste documento centraliza todas las URLs relevantes para los diferentes entornos y servicios del proyecto.\n\n---\n\n### Frontend (Vercel)\n\n- **URL de Vista Previa (Preview):**\n  - `https://ioc-frontend-git-feature-ioc-001-integr-b16d6d-qb4745s-projects.vercel.app/`\n\n---\n\n### Backend (Render)\n\n- **URL del Servicio Web:**\n  - `https://ioc-backend.onrender.com`\n\n---\n\n### Metabase (EC2)\n\n- **URL Segura (HTTPS v√≠a Cloudflare Tunnel):**\n  - `https://treated-paste-eos-memo.trycloudflare.com/`\n  - *Este es el enlace que se debe usar en la configuraci√≥n del backend para el embedding.*\n\n---\n\n### Endpoints de Monitoreo (Backend)\n\n- **Health Check General:**\n  - `https://ioc-backend.onrender.com/actuator/health`\n\n- **Health Check Espec√≠fico del ETL:**\n  - `https://ioc-backend.onrender.com/actuator/health/etl`\n\n---\n\n---\n\n### Recursos Adicionales\n\n- **Presentaci√≥n del Proyecto (Google Slides):**\n  - `https://docs.google.com/presentation/d/182pU4qfSpSYkUAAJ5hjJ2NGmslGYTvvuWNWHtpJd-EM/edit`\n\n- **Carpeta de Evidencias (Google Drive):**\n  - `https://drive.google.com/drive/u/0/folders/1sf3j3vEZ2Xk54gJj30ir6jfG7kHvHfl8`\n\n"
    },
    {
      "path": "Dockerfile",
      "excerpt": "# Stage 1: Build the application using Maven\nFROM maven:3.9-eclipse-temurin-21 AS build\n\n# Set the working directory\nWORKDIR /app\n\n# Copy the Maven project files\nCOPY pom.xml .\nCOPY .mvn .mvn\nCOPY mvnw .\n\n# Download dependencies first to leverage Docker cache\nRUN mvn dependency:go-offline -B\n\n# Copy the rest of the source code\nCOPY src src\n\n# Package the application, skipping tests for faster builds\nRUN mvn clean package -DskipTests -B\n\n# Stage 2: Create the final, lightweight runtime image\nFROM eclipse-temurin:21-jre-jammy\n\n# Set the working directory\nWORKDIR /app\n\n# Create a non-root user for security\nRUN groupadd -r spring && useradd -r -g spring spring\n\n# Copy the JAR file from the build stage\nCOPY --from=build /app/target/*.jar app.jar\n\n# Change ownership\nRUN chown spring:spring app.jar\n\n# Switch to non-root user\nUSER spring:spring\n\n# Expose the port the application will run on\nEXPOSE 8080\n\n# Health check (opcional pero recomendado)\nHEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \\\n  CMD curl -f http://localhost:8080/actuator/health || exit 1\n\n# Command to run the application\nENTRYPOINT [\"java\", \"-jar\", \"app.jar\"]"
    },
    {
      "path": "INTELLIJ_ENV_SETUP.md",
      "excerpt": "# IntelliJ IDEA - Environment Variables Setup\n\n## Your Environment Variables\n\nCopy these values to configure your IntelliJ run configuration:\n\n```\nMETABASE_SECRET_KEY=42cc18c4d202ab992899ba0bcc1ecb61c2f8601d388da11c25a25ef62b1a10e6\nSUPABASE_DB_PASSWORD=HANWVh91w8ZdZvFZ\nSUPABASE_JWT_ISSUER_URI=https://bdyvzjpkycnekjrlqlfp.supabase.co/auth/v1\nSUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJkeXZ6anBreWNuZWtqcmxxbGZwIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzIxMDQwNywiZXhwIjoyMDcyNzg2NDA3fQ.zpAwZYOKqFBLPSlfr2k4Ky9cNOrWjj_RPD6DZtK6IV0\nSUPABASE_URL=https://bdyvzjpkycnekjrlqlfp.supabase.co\n```\n\n## Step-by-Step Setup in IntelliJ IDEA\n\n### Method 1: Using Run Configuration (Recommended)\n\n1. **Open Run Configurations**\n   - Click the dropdown next to the Run button (‚ñ∂Ô∏è) in the toolbar\n   - Select **Edit Configurations...**\n   - OR: Go to **Run** ‚Üí **Edit Configurations...**\n\n2. **Find Your Spring Boot Configuration**\n   - In the left panel, expand **Spring Boot**\n   - Select **IocbackendApplication** (or your main application configuration)\n\n3. **Add Environment Variables**\n   - Find the **Environment variables** field\n   - Click the **folder icon** (üìÅ) or **Edit** button next to it\n   \n4. **Add Each Variable**\n   In the popup dialog, click the **+** button and add each variable:\n   \n   ```\n   Name: METABASE_SECRET_KEY\n   Value: 42cc18c4d202ab992899ba0bcc1ecb61c2f8601d388da11c25a25ef62b1a10e6\n   ```\n   \n   ```\n   Name: SUPABASE_DB_PASSWORD\n   Value: HANWVh91w8ZdZvFZ\n   ```\n   \n   ```\n   Name: SUPABASE_JWT_ISSUER_URI\n   Value: https://bdyvzjpkycnekjrlqlfp.supabase.co/auth/v1\n   ```\n   \n   ```\n   Name: SUPABASE_SERVICE_ROLE_KEY\n   Value: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJkeXZ6anBreWNuZWtqcmxxbGZwIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzIxMDQwNywiZXhwIjoyMDcyNzg2NDA3fQ.zpAwZYOKqFBLPSlfr2k4Ky9cNOrWjj_RPD6DZtK6IV0\n   ```\n   \n   ```\n   Name: SUPABASE_URL\n   Value: https://bdyvzjpkycnekjr"
    },
    {
      "path": "INFORME_SOLUCION_FREE_TIER.md",
      "excerpt": "# INFORME ACTUALIZADO: Soluci√≥n para Supabase FREE Tier\n\n**Fecha:** 2025-10-30  \n**Estado:** ‚úÖ IMPLEMENTADO\n\n---\n\n## üéØ **CONCLUSI√ìN: La soluci√≥n del FREE TIER es la CORRECTA para tu proyecto**\n\n### **¬øPor qu√©?**\n\n1. **Supabase FREE NO permite modificar claims del JWT** ‚Üí La soluci√≥n del informe original NO funcionar√°\n2. **Tu arquitectura ya est√° preparada:**\n   - ‚úÖ Tienes `AppUser.supabaseUserId` (UUID) mapeado al `sub` del JWT\n   - ‚úÖ Tienes `user_roles` con relaci√≥n `AppUser ‚Üî Role`\n   - ‚úÖ Tienes `UserRoleRepository.findRoleNamesByUserId()` funcionando\n   - ‚úÖ Tienes `SupabaseAuthService` para crear usuarios autom√°ticamente\n\n3. **Solo faltaba el enriquecimiento de authorities** ‚Üí YA IMPLEMENTADO\n\n---\n\n## ‚úÖ **CAMBIOS IMPLEMENTADOS**\n\n### **1. `SecurityConfig.java` - Enriquecimiento desde PostgreSQL**\n\nSe agreg√≥ el paso 3 en `jwtGrantedAuthoritiesConverter()`:\n\n```text\n// üî• 3) NUEVO: Enriquecer desde PostgreSQL (SOLUCI√ìN PARA FREE TIER)\nString supabaseUserIdStr = jwt.getSubject(); // \"sub\" del JWT\nif (supabaseUserIdStr != null) {\n    try {\n        java.util.UUID supabaseUserId = java.util.UUID.fromString(supabaseUserIdStr);\n        \n        // Buscar usuario en la BD local\n        appUserRepository.findBySupabaseUserId(supabaseUserId).ifPresent(appUser -> {\n            // Obtener roles desde user_roles\n            List<String> dbRoles = userRoleRepository.findRoleNamesByUserId(appUser.getId());\n            dbRoles.forEach(roleName -> \n                authorities.add(new SimpleGrantedAuthority(\"ROLE_\" + roleName.toUpperCase()))\n            );\n        });\n    } catch (IllegalArgumentException e) {\n        // UUID inv√°lido, ignorar\n    }\n}\n```\n\n**¬øQu√© hace esto?**\n1. Extrae el `sub` (UUID de Supabase) del JWT\n2. Busca el usuario en `app_users` por `supabase_user_id`\n3. Consulta sus roles en `user_roles`\n4. Agrega `ROLE_ADMIN`, `ROLE_USER`, etc. a las authorities de Spring Security\n\n---\n\n## üöÄ **FLUJO COMPLETO PARA CREAR Y USAR ADMIN**\n\n### **Paso 1: Crear usuario en Supab"
    },
    {
      "path": "CONNECTION_FIX.md",
      "excerpt": "# Database Connection Error - FIXED\n\n## Problem Summary\n\nThe application failed to start with the following errors:\n\n1. **Primary Error**: `java.net.UnknownHostException: aws-1-sa-east-1.pooler.supabase.com`\n   - The database connection failed because required environment variables were missing\n\n2. **Secondary Error**: `Unable to determine Dialect without JDBC metadata`\n   - This occurred because Hibernate couldn't query the database metadata (due to connection failure)\n   - The dialect was commented out in the base configuration\n\n## Root Cause\n\nThe application requires environment variables that were not set:\n\n- `SUPABASE_DB_PASSWORD` - **REQUIRED** for database connection\n- `SUPABASE_SERVICE_ROLE_KEY` - **REQUIRED** for automatic user creation feature\n- `SUPABASE_URL` - Has a default value but should be explicitly set\n\n## Solution Applied\n\n### 1. Fixed Hibernate Configuration\n\n**File**: `src/main/resources/application.properties`\n\n**Change**: Uncommented the Hibernate dialect property:\n```properties\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\n```\n\n**Why**: This prevents Hibernate from trying to query database metadata to determine the dialect. When the database is unreachable, having an explicit dialect prevents cascading errors.\n\n### 2. Created Environment Setup Script\n\n**File**: `env-setup.sh` (NEW)\n\nThis script helps you set up all required environment variables. Copy it and fill in your actual values.\n\n## How to Fix Your Environment\n\n### Option 1: Using the Setup Script (Recommended)\n\n```bash\n# 1. Edit the env-setup.sh file with your actual credentials\nnano env-setup.sh\n\n# 2. Source it to export variables\nsource env-setup.sh\n\n# 3. Run the application\n./mvnw spring-boot:run -Dspring-boot.run.profiles=local\n```\n\n### Option 2: Manual Export\n\n```bash\n# Get password from Supabase Dashboard > Settings > Database\nexport SUPABASE_DB_PASSWORD=\"your-actual-password\"\n\n# Get service role key from Supabase Dashboard > Settings > API\nexpo"
    },
    {
      "path": "METABASE_IMPLEMENTATION_TASKS.md",
      "excerpt": "# Tareas T√©cnicas de Implementaci√≥n: Integraci√≥n de Metabase (IOC-006a)\n\nEste documento resume el conjunto de tareas t√©cnicas que se completaron para implementar la historia de usuario `IOC-006a`, \"Como Gerente, quiero visualizar un dashboard con sus gr√°ficos y KPIs\". Estas tareas son adicionales a las que estaban originalmente planificadas en el Kanban y representan el trabajo necesario para construir una integraci√≥n robusta, segura y observable con la plataforma de Business Intelligence Metabase.\n\n---\n\n## Resumen de la Implementaci√≥n\n\nLa soluci√≥n se bas√≥ en el m√©todo de **Static (Signed) Embedding** de Metabase, donde el backend de Spring Boot act√∫a como un intermediario seguro que genera tokens JWT de corta duraci√≥n. Estos tokens permiten al frontend de React renderizar dashboards dentro de un `iframe` de forma segura, con filtros aplicados a nivel de usuario.\n\n---\n\n## Tareas T√©cnicas Completadas\n\n### Backend (BE)\n\n| ID (Sugerido) | Historia | Asignado | Descripci√≥n de la Tarea | Estado |\n| :--- | :--- | :--- | :--- | :--- |\n| `BE-TASK-17` | `IOC-006a` | Jaime | **Configurar `MetabaseProperties.java`:** Crear la clase de configuraci√≥n para cargar los ajustes de Metabase (URL, secret key, dashboards) desde `application.properties`. | ‚úÖ Done |\n| `BE-TASK-18` | `IOC-006a` | Jaime | **Implementar `MetabaseEmbeddingService`:** Crear el servicio principal para la l√≥gica de negocio, incluyendo la validaci√≥n de autorizaci√≥n por roles y la generaci√≥n de tokens JWT firmados para Metabase. | ‚úÖ Done |\n| `BE-TASK-19` | `IOC-006a` | Jaime | **Crear `DashboardController`:** Exponer el endpoint seguro `GET /api/v1/dashboards/{dashboardId}` para que el frontend pueda solicitar las URLs firmadas. | ‚úÖ Done |\n| `BE-TASK-20` | `IOC-006a` | Jaime | **Implementar `DashboardAuditService`:** Crear un servicio para registrar todos los intentos de acceso a dashboards (exitosos y fallidos) en los logs. | ‚úÖ Done |\n| `BE-TASK-21` | `IOC-006a` | Jaime | **Ajustar `SecurityConfig` para CSP:** M"
    },
    {
      "path": "HELP.md",
      "excerpt": "# Getting Started\n\n### Reference Documentation\nFor further reference, please consider the following sections:\n\n* [Official Apache Maven documentation](https://maven.apache.org/guides/index.html)\n* [Spring Boot Maven Plugin Reference Guide](https://docs.spring.io/spring-boot/3.5.5/maven-plugin)\n* [Create an OCI image](https://docs.spring.io/spring-boot/3.5.5/maven-plugin/build-image.html)\n* [Spring Web](https://docs.spring.io/spring-boot/3.5.5/reference/web/servlet.html)\n* [Spring Data JPA](https://docs.spring.io/spring-boot/3.5.5/reference/data/sql.html#data.sql.jpa-and-spring-data)\n* [Spring Security](https://docs.spring.io/spring-boot/3.5.5/reference/web/spring-security.html)\n* [Validation](https://docs.spring.io/spring-boot/3.5.5/reference/io/validation.html)\n\n### Guides\nThe following guides illustrate how to use some features concretely:\n\n* [Building a RESTful Web Service](https://spring.io/guides/gs/rest-service/)\n* [Serving Web Content with Spring MVC](https://spring.io/guides/gs/serving-web-content/)\n* [Building REST services with Spring](https://spring.io/guides/tutorials/rest/)\n* [Accessing Data with JPA](https://spring.io/guides/gs/accessing-data-jpa/)\n* [Securing a Web Application](https://spring.io/guides/gs/securing-web/)\n* [Spring Boot and OAuth2](https://spring.io/guides/tutorials/spring-boot-oauth2/)\n* [Authenticating a User with LDAP](https://spring.io/guides/gs/authenticating-ldap/)\n* [Validation](https://spring.io/guides/gs/validating-form-input/)\n\n### Maven Parent overrides\n\nDue to Maven's design, elements are inherited from the parent POM to the project POM.\nWhile most of the inheritance is fine, it also inherits unwanted elements like `<license>` and `<developers>` from the parent.\nTo prevent this, the project POM contains empty overrides for these elements.\nIf you manually switch to a different parent and actually want the inheritance, you need to remove those overrides.\n\n"
    },
    {
      "path": "BATCH_LOGGING_EXPLAINED.md",
      "excerpt": "# Explicaci√≥n: Por Qu√© Ves Miles de Logs de INSERT Aunque el Batch Funcione\n\n## ü§î El Problema Confuso\n\nVes en los logs:\n```\nHibernate: insert into fact_production (...) values (?,?,?...)\nHibernate: insert into fact_production (...) values (?,?,?...)\nHibernate: insert into fact_production (...) values (?,?,?...)\n... (miles de l√≠neas repetidas)\n```\n\nPero las estad√≠sticas de Hibernate dicen:\n```\n179 JDBC batches executed\n17,854 records inserted\n= 99.7 records per batch ‚úÖ\n```\n\n**¬øEst√° funcionando el batch o no?**\n\n## ‚úÖ Respuesta: S√ç, el Batch Est√° Funcionando\n\n### Lo Que Realmente Est√° Pasando:\n\nCuando tienes `spring.jpa.show-sql=true`, Hibernate loguea el SQL statement **UNA VEZ POR CADA REGISTRO** que va a insertar, AUNQUE los ejecute todos juntos en un batch.\n\n#### Ejemplo con 200 Registros y batch_size=100:\n\n**Lo que ves en logs (200 l√≠neas):**\n```\nHibernate: insert into fact_production (...) values (?,?,?...) <- Registro 1\nHibernate: insert into fact_production (...) values (?,?,?...) <- Registro 2\nHibernate: insert into fact_production (...) values (?,?,?...) <- Registro 3\n...\nHibernate: insert into fact_production (...) values (?,?,?...) <- Registro 100\nHibernate: insert into fact_production (...) values (?,?,?...) <- Registro 101\n...\nHibernate: insert into fact_production (...) values (?,?,?...) <- Registro 200\n```\n\n**Lo que realmente ejecuta Hibernate (2 batches):**\n```\nBATCH 1: INSERT INTO fact_production VALUES (...), (...), ... (100 registros)\nBATCH 2: INSERT INTO fact_production VALUES (...), (...), ... (100 registros)\n```\n\n### ¬øC√≥mo Sabemos que el Batch Funciona?\n\nLas **Session Metrics** son la prueba definitiva:\n\n```\n33033260220 nanoseconds spent executing 179 JDBC batches;\n34868109363 nanoseconds spent executing 2 flushes (flushing a total of 35708 entities and 0 collections);\n```\n\n- **17,854 registros** insertados\n- **179 JDBC batches** = 17,854 / 179 = **99.7 registros por batch**\n- **2 flushes** = 35,708 entities totales (incluye dimensiones)\n\nSi NO h"
    },
    {
      "path": "BATCH_FIX_RENDER.md",
      "excerpt": "# Fix: Batch Inserts no funcionaban en Render (Production)\n\n## üî¥ Problema Identificado\n\nEl batching de Hibernate NO estaba funcionando correctamente en producci√≥n (Render) debido a un **desajuste entre `batch_size` y `allocationSize`**.\n\n### Configuraci√≥n Incorrecta:\n- **FactProduction.java**: `allocationSize = 100` (secuencia)\n- **application-prod.properties**: `batch_size = 500` ‚ùå\n\n### Por qu√© esto rompe el batching:\n\nHibernate optimiza los batch inserts cuando `batch_size` es igual o m√∫ltiplo del `allocationSize` de la secuencia. Cuando no coinciden:\n\n1. Hibernate pre-asigna IDs de la secuencia en bloques de `allocationSize` (100)\n2. Intenta hacer batches de `batch_size` (500)\n3. Al llegar al insert #100, necesita pedir m√°s IDs a la secuencia\n4. Esto **rompe el batch** y fuerza un flush prematuro\n5. Resultado: inserts individuales en lugar de batches\n\n## ‚úÖ Soluci√≥n Aplicada\n\nHe cambiado el `batch_size` de **500 ‚Üí 100** en todos los archivos de properties para que coincida con el `allocationSize` de la secuencia.\n\n### Archivos Modificados:\n\n#### 1. `application.properties` (base)\n```properties\n# Antes\nspring.jpa.properties.hibernate.jdbc.batch_size=500 ‚ùå\n\n# Despu√©s\nspring.jpa.properties.hibernate.jdbc.batch_size=100 ‚úÖ\nspring.jpa.properties.hibernate.jdbc.fetch_size=100\n```\n\n#### 2. `application-prod.properties` (Render)\n```properties\n# CRITICO: batch_size debe coincidir con allocationSize de la secuencia (100)\nspring.jpa.properties.hibernate.jdbc.batch_size=100\nspring.jpa.properties.hibernate.order_inserts=true\nspring.jpa.properties.hibernate.order_updates=true\nspring.jpa.properties.hibernate.jdbc.batch_versioned_data=true\nspring.jpa.properties.hibernate.generate_statistics=false\n\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\nspring.jpa.properties.hibernate.id.new_generator_mappings=true\nspring.jpa.properties.hibernate.jdbc.fetch_size=100\n\nspring.jpa.properties.hibernate.id.optimizer.pooled.prefer_lo=true\nspring.jpa.properties.hib"
    },
    {
      "path": "METABASE_IMPLEMENTATION_SUMMARY.md",
      "excerpt": "# Resumen T√©cnico de Arquitectura: Integraci√≥n de Metabase\n\n## 1. Objetivo y Decisi√≥n Arquitect√≥nica Clave\n\nEl objetivo de esta implementaci√≥n es integrar dashboards de Metabase de forma segura y observable en la aplicaci√≥n IOC.\n\nLa decisi√≥n arquitect√≥nica fundamental fue utilizar **Static (Signed) Embedding**. Este enfoque se eligi√≥ porque es el √∫nico m√©todo proporcionado por **Metabase Open Source** que garantiza la seguridad de los datos, a diferencia de los \"Public Links\" (inseguros) y el \"Full-App Embedding\" (que requiere una licencia de pago).\n\nEl flujo consiste en un **backend (Spring Boot) que act√∫a como un intermediario seguro**, generando URLs firmadas con un secreto compartido, las cuales son consumidas por el **frontend (React)** para renderizar los dashboards en `iframes`.\n\n## 2. Postura de Seguridad (Security by Design)\n\nSe implement√≥ una estrategia de defensa en profundidad para proteger el acceso a los datos.\n\n*   **Principio de M√≠nimo Privilegio a Nivel de Base de Datos:**\n    *   **Problema Solucionado:** Prevenir que una posible vulnerabilidad en Metabase pueda comprometer la base de datos de producci√≥n.\n    *   **Soluci√≥n Implementada:** Se cre√≥ un rol PostgreSQL dedicado (`metabase_reader`) con permisos exclusivos de `SELECT` sobre las tablas necesarias. Metabase se conecta a los datos de la aplicaci√≥n utilizando √∫nicamente este rol.\n\n*   **Control de Acceso a Nivel de API (Autorizaci√≥n):**\n    *   **Problema Solucionado:** Evitar que un usuario autenticado pueda acceder a dashboards para los que no tiene permiso.\n    *   **Soluci√≥n Implementada:** Se implement√≥ una capa de autorizaci√≥n en el `MetabaseEmbeddingService`. La l√≥gica lee una configuraci√≥n centralizada en `application.properties` que mapea cada `dashboardId` a una lista de roles permitidos (`allowedRoles`). Antes de firmar una URL, el servicio verifica que los roles del usuario autenticado coincidan con los roles permitidos.\n\n*   **Protecci√≥n contra Falsificaci√≥n de Peticiones (Firma"
    },
    {
      "path": "COMPARACION_SOLUCIONES.md",
      "excerpt": "# üéØ AN√ÅLISIS COMPARATIVO: Soluci√≥n Original vs. Soluci√≥n FREE Tier\n\n## üìä CONCLUSI√ìN DEFINITIVA\n\n**‚úÖ La soluci√≥n del FREE TIER es SUPERIOR para tu caso particular**\n\n---\n\n## üîç AN√ÅLISIS RECURSIVO DEL C√ìDIGO\n\n### **Tu arquitectura actual (analizada):**\n\n```\n‚úÖ AppUser.java\n   - supabaseUserId (UUID) ‚Üí perfecto para mapear con JWT.sub\n   - Relaci√≥n con user_roles via UserRole\n\n‚úÖ UserRoleRepository.java\n   - findRoleNamesByUserId() ‚Üí ya implementado\n   \n‚úÖ SupabaseAuthService.java\n   - createSupabaseUser() ‚Üí crea usuarios autom√°ticamente\n   - deleteSupabaseUser() ‚Üí rollback en caso de error\n\n‚úÖ UserAdminService.java\n   - Flujo completo de creaci√≥n de usuarios\n   - Maneja creaci√≥n en Supabase + PostgreSQL\n\n‚úÖ SecurityConfig.java\n   - JwtDecoder con ES256 configurado\n   - JwtAuthenticationConverter YA busca claims 'roles' y 'realm_access.roles'\n   - ‚ùå PERO estos claims NUNCA llegan con Supabase FREE\n```\n\n### **Lo que faltaba (YA IMPLEMENTADO):**\n- ‚úÖ Consulta a PostgreSQL desde `jwtGrantedAuthoritiesConverter()`\n- ‚úÖ Mapeo de `jwt.getSubject()` ‚Üí `AppUser.supabaseUserId`\n- ‚úÖ Extracci√≥n de roles desde `user_roles` por cada request\n\n---\n\n## üìã COMPARACI√ìN DETALLADA\n\n| Criterio | Soluci√≥n Original (JWT claims) | ‚úÖ Soluci√≥n FREE Tier (BD) |\n|----------|-------------------------------|----------------------------|\n| **Compatibilidad Supabase FREE** | ‚ùå NO - Requiere Auth Hooks (Solo Pro $25/mes) | ‚úÖ S√ç - Totalmente compatible |\n| **Cambios en tu c√≥digo** | ‚ùå Imposible sin upgrade de plan | ‚úÖ Solo 15 l√≠neas en SecurityConfig |\n| **Aprovecha tu arquitectura** | ‚ö†Ô∏è No usa UserRoleRepository existente | ‚úÖ Usa 100% tu c√≥digo actual |\n| **Performance** | ‚úÖ 0 consultas extra | ‚ö†Ô∏è 1 query/request (cacheable) |\n| **Control de roles** | ‚ö†Ô∏è Dependes de Supabase | ‚úÖ Control total en PostgreSQL |\n| **Auditor√≠a** | ‚ö†Ô∏è Limitada a logs de Supabase | ‚úÖ Completa: user_roles, assigned_at, assigned_by |\n| **Sincronizaci√≥n** | ‚úÖ Autom√°tica (JWT) | ‚ö†Ô∏è Manual (pero ya tienes el flujo) |\n| **Costo mensual** "
    },
    {
      "path": "USER_CREATION_FIX.md",
      "excerpt": "# Fix Implementado: Creaci√≥n Autom√°tica de Usuarios en Supabase\n\n## Problema Resuelto\n\n**ANTES**: El admin ten√≠a que:\n1. Ir a Supabase Dashboard\n2. Crear el usuario manualmente\n3. Copiar el UUID\n4. Usar ese UUID en el endpoint del backend\n\n**AHORA**: El admin simplemente:\n1. Llama al endpoint con email y password\n2. El backend autom√°ticamente crea el usuario en Supabase\n3. Todo se hace en una sola operaci√≥n at√≥mica\n\n## Cambios Implementados\n\n### 1. Dependencias Agregadas\n- **spring-webflux** (solo la librer√≠a, sin el starter completo): Para usar `WebClient`\n- **reactor-netty**: Cliente HTTP reactivo necesario para `WebClient`\n\n**NOTA IMPORTANTE**: No usamos `spring-boot-starter-webflux` completo porque causar√≠a conflictos con Spring MVC. Solo agregamos las dependencias m√≠nimas necesarias para `WebClient`.\n\n### 2. Nuevos Archivos Creados\n\n#### `SupabaseAuthService.java`\nServicio que se comunica con la API de Supabase Auth para:\n- Crear usuarios autom√°ticamente con `createSupabaseUser(email, password)`\n- Eliminar usuarios (rollback) con `deleteSupabaseUser(uuid)`\n\n#### `WebClientConfig.java`\nConfiguraci√≥n del bean `WebClient.Builder` necesario para las llamadas HTTP\n\n### 3. Archivos Modificados\n\n#### `UsuarioCreateRequest.java`\n- **NUEVO**: Campo `password` (opcional, m√≠nimo 6 caracteres)\n- **DEPRECATED**: Campo `supabaseUserId` (mantiene compatibilidad temporal)\n\n#### `UserAdminService.java`\nL√≥gica actualizada en el m√©todo `create()`:\n- Si viene `password`: Crea el usuario en Supabase autom√°ticamente\n- Si viene `supabaseUserId`: Usa el flujo antiguo (deprecated)\n- Si falla la BD: Hace rollback autom√°tico eliminando el usuario de Supabase\n\n#### Archivos de configuraci√≥n\nAgregada configuraci√≥n en:\n- `application.properties`\n- `application-dev.properties`\n- `application-prod.properties`\n- `application-local.properties`\n\nNuevas propiedades:\n```properties\nsupabase.url=${SUPABASE_URL:https://bdyvzjpkycnekjrlqlfp.supabase.co}\nsupabase.service-role-key=${SUPABASE_SERVICE_ROL"
    },
    {
      "path": "SUPABASE_POOL_FIX.md",
      "excerpt": "# Soluci√≥n al Problema de Pool de Conexiones con Supabase\n\n## üî¥ Problema Identificado\n\nDespu√©s del `git reset`, tu aplicaci√≥n estaba usando la configuraci√≥n por defecto de HikariCP, que establece:\n- **maximum-pool-size: 10 conexiones** (valor por defecto)\n- Sin l√≠mites expl√≠citos en los archivos de properties\n\nEsto causaba que tu aplicaci√≥n **excediera el l√≠mite de Supabase Free Tier** (3-5 conexiones simult√°neas), resultando en:\n- ‚ùå Conexiones rechazadas\n- ‚ùå Timeouts en health checks de Render\n- ‚ùå Errores `connection refused` o `pool exhausted`\n\n## ‚úÖ Soluci√≥n Implementada\n\nHe agregado configuraciones **expl√≠citas y agresivas** de HikariCP en todos tus archivos de properties para limitar el pool a 3 conexiones m√°ximo:\n\n### üìÑ Archivos Modificados\n\n#### 1. `application.properties` (Base - Desarrollo Local)\n```properties\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout=300000\nspring.datasource.hikari.max-lifetime=540000\nspring.datasource.hikari.keepalive-time=120000\nspring.datasource.hikari.validation-timeout=5000\nspring.datasource.hikari.leak-detection-threshold=60000\n```\n\n#### 2. `application-dev.properties` (Desarrollo Local)\n- Mismo pool-size de 3 conexiones\n- Configuraci√≥n optimizada para desarrollo compartiendo el pool de Supabase\n\n#### 3. `application-prod.properties` (Render - Producci√≥n) ‚ö†Ô∏è M√ÅS CR√çTICO\n```properties\n# Pool MINIMO para Supabase free tier\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=30000\n\n# Tiempos M√ÅS CORTOS para evitar que Supabase cierre conexiones antes que Hikari\nspring.datasource.hikari.idle-timeout=240000        # 4 minutos\nspring.datasource.hikari.max-lifetime=300000        # 5 minutos\n\n# Keepalive para mantener conexiones vivas\nspring.datasource.hikari.keepalive-time=120000      # 2 minutos\nspring.datasource.hikari.validation-timeo"
    },
    {
      "path": "DRAFT_SECURITY_REPORT.md",
      "excerpt": "# Este informe est√° vac√≠o porque no se encontraron vulnerabilidades durante el an√°lisis de seguridad.\n"
    },
    {
      "path": "INFORME_FIX_CONEXION_Y_CREACION_USUARIOS.md",
      "excerpt": "# Informe: Fix de Conexi√≥n y Creaci√≥n Autom√°tica de Usuarios\n\nFecha: 2025-10-30\n\nAutor: Equipo de desarrollo (generado autom√°ticamente)\n\nResumen ejecutivo\n-----------------\nSe detect√≥ un fallo que imped√≠a el arranque de la aplicaci√≥n y tambi√©n afectaba la capacidad de creaci√≥n autom√°tica de usuarios en Supabase. La aplicaci√≥n fallaba con errores de conexi√≥n a la base de datos y con errores derivados de la ausencia de configuraci√≥n de dialecto de Hibernate. Adem√°s, la creaci√≥n autom√°tica de usuarios est√° protegida por mecanismos de autenticaci√≥n/autoridad: el endpoint `/api/v1/admin/users` requiere un JWT con `ROLE_ADMIN`.\n\nObjetivo del informe\n--------------------\nDocumentar el problema, su causa ra√≠z, las acciones correctivas aplicadas, pasos de verificaci√≥n y las recomendaciones/seguimiento para evitar regressiones y asegurar un flujo seguro de creaci√≥n de usuarios.\n\nChecklist (resumen de entregables)\n---------------------------------\n- [x] Diagn√≥stico del problema\n- [x] Causa ra√≠z identificada\n- [x] Cambios aplicados documentados (configuraci√≥n y script de entorno)\n- [x] Gu√≠a para obtener un token admin y probar el endpoint protegido\n- [x] Notas de seguridad y siguientes pasos\n\nDetalles del problema\n---------------------\nS√≠ntomas observados:\n- Excepci√≥n inicial: `java.net.UnknownHostException: aws-1-sa-east-1.pooler.supabase.com` al arrancar.\n- Error secundario: `Unable to determine Dialect without JDBC metadata` (Hibernate no pod√≠a determinar el dialecto porque la DB estaba inalcanzable).\n- Petici√≥n POST a `/api/v1/admin/users` desde Swagger devolv√≠a 401 Unauthorized (sin creaci√≥n de usuario).\n\nArchivos y lugares afectados\n----------------------------\n- `src/main/resources/application.properties` (se ajust√≥ para fijar el dialecto de Hibernate)\n- `env-setup.sh` (nuevo, script de ayuda para exportar variables de entorno)\n- L√≥gica de creaci√≥n de usuario: `SupabaseAuthService` (usa `supabase.service-role-key` internamente para crear usuarios en Supabase)\n- Seguridad"
    },
    {
      "path": "docker-compose.yml",
      "excerpt": "version: '3.8'\n\nservices:\n  postgres:\n    image: postgres:15\n    container_name: ioc_metabase_db\n    env_file:\n      - .env\n    environment:\n      POSTGRES_DB: ${POSTGRES_DB}\n      POSTGRES_USER: ${POSTGRES_USER}\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  metabase:\n    image: metabase/metabase:latest\n    container_name: ioc_metabase\n    depends_on:\n      postgres:\n        condition: service_healthy\n    ports:\n      - \"3000:3000\"\n    dns:\n      - 8.8.8.8\n      - 1.1.1.1\n    env_file:\n      - .env\n    environment:\n      MB_DB_TYPE: postgres\n      MB_DB_HOST: \"postgres\"\n      MB_DB_PORT: \"5432\"\n      MB_DB_DBNAME: \"${POSTGRES_DB}\"\n      MB_DB_USER: \"${POSTGRES_USER}\"\n      MB_DB_PASS: \"${POSTGRES_PASSWORD}\"\n      # ‚ö†Ô∏è DEBE COINCIDIR CON metabase.site-url del backend\n      MB_SITE_URL: \"https://treated-paste-eos-memo.trycloudflare.com\"\n      MB_EMBEDDING_SECRET_KEY: \"${METABASE_SECRET_KEY}\"\n      # Permitir embedding desde Vercel\n      MB_EMBEDDING_APP_ORIGIN: \"https://tu-app.vercel.app\"\n      MB_SITE_LOCALE: \"es\"\n      JAVA_TIMEZONE: \"America/Santiago\"\n    restart: unless-stopped\n\nvolumes:\n  postgres-data:\n    driver: local\n"
    },
    {
      "path": "IDLE_CONNECTIONS_FIX.md",
      "excerpt": "# Fix Cr√≠tico: Conexiones Idle por Uso de Puerto 5432 (Session Mode)\n\n## üî¥ Problema Identificado\n\n### Evidencia del Problema:\n```json\n{\n  \"pid\": 1547683,\n  \"application_name\": \"PostgreSQL JDBC Driver\",\n  \"client_addr\": \"2600:1f1e:75b:4b01:d427:372f:93c8:6ae3\",\n  \"state\": \"idle\",\n  \"tiempo_conexion_activa\": \"00:24:33.890115\",\n  \"tiempo_inactiva\": \"00:23:13.748991\",\n  \"tipo_conexion\": \"‚ùå CONEXI√ìN DIRECTA (INCORRECTO)\"\n}\n```\n\n**14+ conexiones idle** desde la misma IP, todas con:\n- `application_name`: \"PostgreSQL JDBC Driver\" (tu backend Spring Boot)\n- `state`: \"idle\" (inactivas desde hace minutos/horas)\n- `client_addr`: Misma IP (todas desde tu aplicaci√≥n)\n\n### Causa Ra√≠z:\n\nDespu√©s del `git reset`, tu `application.properties` ten√≠a:\n\n```properties\n# ‚ùå INCORRECTO - Puerto 5432 = Session Mode\nspring.datasource.url=jdbc:postgresql://...supabase.com:5432/postgres\n```\n\n**¬øPor qu√© esto es un problema?**\n\n| Puerto | Modo | Comportamiento |\n|--------|------|----------------|\n| **5432** | Session Mode | ‚ùå Conexiones persistentes que NO se liberan autom√°ticamente |\n| **6543** | Transaction Mode | ‚úÖ Conexiones se devuelven al pool inmediatamente despu√©s de la transacci√≥n |\n\nCuando usas **puerto 5432 (Session Mode)**:\n1. HikariCP abre 3 conexiones (configuraci√≥n `maximum-pool-size=3`)\n2. Cada conexi√≥n se \"casa\" con una conexi√≥n directa a PostgreSQL\n3. Las conexiones permanecen `idle` indefinidamente\n4. **Resultado:** Consumes todas las conexiones disponibles de Supabase Free Tier\n\n### ¬øPor qu√© tantas conexiones idle?\n\nHikariCP mantiene un pool de conexiones listo para usar. En Session Mode:\n- **minimum-idle=1**: Mantiene al menos 1 conexi√≥n siempre abierta\n- **maximum-pool-size=3**: Puede abrir hasta 3 conexiones\n- **max-lifetime=540000ms (9 min)**: Las conexiones se reciclan despu√©s de 9 minutos\n\nPero como el Session Mode NO libera conexiones autom√°ticamente, estas se acumulan como `idle` en PostgreSQL, consumiendo el l√≠mite de tu plan.\n\n## ‚úÖ Soluci√≥n Aplicada\n\nHe cambiado el pue"
    },
    {
      "path": "INFORME_IMPOSIBILIDAD_CREAR_USUARIO.md",
      "excerpt": "# Informe: Imposibilidad de crear usuarios v√≠a `/api/v1/admin/users`\n\nFecha: 2025-10-30\n\nResumen\n-------\nEste informe documenta por qu√© una llamada al endpoint administrativo `POST /api/v1/admin/users` devuelve 401 (Unauthorized) y qu√© se necesita en la aplicaci√≥n Spring para que la creaci√≥n autom√°tica de usuarios funcione correctamente.\n\nChecklist\n---------\n- [x] Explicar por qu√© devuelve 401\n- [x] Enumerar propiedades de Spring necesarias\n- [x] Describir beans de seguridad relevantes (JwtDecoder, JwtAuthenticationConverter)\n- [x] Indicar validaciones y payload esperado\n- [x] Mostrar flujo para obtener token admin y probar la API\n- [x] Recomendaciones y notas de seguridad\n\n1) Por qu√© la llamada devuelve 401\n---------------------------------\n- El `AdminUserController` que expone `/api/v1/admin/users` est√° anotado con `@PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")`. Solo un cliente con JWT v√°lido que incluya la autoridad `ROLE_ADMIN` puede invocar este endpoint.\n- `SecurityConfig` configura la app como OAuth2 Resource Server: valida JWTs contra el issuer configurado (`spring.security.oauth2.resourceserver.jwt.issuer-uri`) usando un `JwtDecoder` (JWKs). Si la petici√≥n no incluye `Authorization: Bearer <token>` con un token aceptado por el decodificador y con los claims apropiados, Spring Security responde 401.\n- Por tanto, la petici√≥n desde Swagger sin un token v√°lido se bloquea con 401 y el backend nunca ejecuta la l√≥gica que crea el usuario en Supabase.\n\n2) Propiedades de `application-*.properties` (m√≠nimas) que deben existir\n------------------------------------------------------------------------\nAseg√∫rate de definir al menos las siguientes propiedades (ejemplos):\n\n```properties\n# JWT/OAuth2 Resource Server\nspring.security.oauth2.resourceserver.jwt.issuer-uri=https://<tu-proyecto>.supabase.co/auth/v1\n\n# Integraci√≥n con Supabase (creaci√≥n autom√°tica de usuarios)\nsupabase.url=https://<tu-proyecto>.supabase.co\nsupabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\nsupab"
    },
    {
      "path": "SECURITY_ANALYSIS_TODO.md",
      "excerpt": "- [x] Define the audit scope.\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/config/AsyncConfig.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/config/CacheConfig.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/config/MetabaseProperties.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/config/MetricsConfig.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/config/RateLimitingConfig.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/config/ResilienceConfig.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/config/WebConfig.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/config/WebSocketConfig.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/config/WebSocketSecurityConfig.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/controller/DashboardController.java\n  - [x] Investigate data flow from authentication on line 40.\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/controller/EtlController.java\n  - [x] Investigate data flow from file on line 50.\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/dto/EtlJobStatusDto.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/dto/NotificationPayload.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/exception/DashboardAccessDeniedException.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/exception/DashboardNotFoundException.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/exception/FileValidationException.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/exception/GlobalExceptionHandler.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/exception/JobConflictException.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/health/EtlHealthIndicator.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/interceptor/RateLimitInterceptor.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/IocbackendApplication.java\n- [x] SAST Recon on src/main/java/com/cambiaso/ioc/metrics/EtlJobMetricsRegistrar.java\n- [x] SAST Recon on src/main/j"
    },
    {
      "path": "SYSTEM.md",
      "excerpt": "This document, `SYSTEM.md`, defines the **external rules and constraints** of the Gemini agent. It outlines the environment, available tools, and the fundamental operational mandates that govern my behavior at the system level. This is the rulebook.\n\nYou are an interactive CLI agent specializing in software engineering tasks. Your primary goal is to help users safely and efficiently, adhering strictly to the following instructions and utilizing your available tools.\n\n# Core Mandates\n\n- **Model Constraint:** My core reasoning engine is pinned to the highest-quality, generally available model family, which is currently **Gemini 2.5**. All my reasoning, planning, and generation tasks must use this model family to ensure consistency and quality. I am forbidden from using older model families (e.g., Gemini 1.5) unless explicitly instructed for a temporary, specific purpose. The adoption of a new, superior model family (e.g., Gemini 3.0) must be a deliberate, user-approved update to this directive.\n- **Conventions:** Rigorously adhere to existing project conventions when reading or modifying code. Analyze surrounding code, tests, and configuration first.\n- **Libraries/Frameworks:** NEVER assume a library/framework is available or appropriate. Verify its established usage within the project (check imports, configuration files like 'package.json', 'Cargo.toml', 'requirements.txt', 'build.gradle', etc., or observe neighboring files) before employing it.\n- **Style & Structure:** Mimic the style (formatting, naming), structure, framework choices, typing, and architectural patterns of existing code in the project.\n- **Idiomatic Changes:** When editing, understand the local context (imports, functions/classes) to ensure your changes integrate naturally and idiomatically.\n- **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by t"
    },
    {
      "path": "GEMINI.md",
      "excerpt": "\n\n# Gemini Agent: Core Directives and Operating Protocols\n\n<!-- \n================================================================================\n|                                                                              |\n|                             PRIME DIRECTIVES                                 |\n|                                                                              |\n================================================================================\n|                                                                              |\n| 1. YOU MUST FOLLOW PRAR. No action before perception and planning.           |\n|                                                                              |\n| 2. YOU MUST OBEY STATE-GATED EXECUTION. No modifying tools outside of        |\n|    `Implement Mode`.                                                         |\n|                                                                              |\n| 3. IF AN IMPLEMENTATION FAILS, YOU MUST PERFORM A FULL RCA. No more          |\n|    tactical fixes.                                                           |\n|                                                                              |\n| 4. Information vs. Action Mandate: If the user's request contains phrases    |\n|    like \"give me the command\", \"show me the command\", \"what is the command\", |\n|    \"tell me how to\", or any similar phrasing that asks for information       |\n|    about an action, my only permitted response is a text block containing    |\n|    the requested information. I am explicitly forbidden from calling any     |\n|    tool in the same turn. I must stop, provide the information, and await    |\n|    your next instruction.                                                    |\n|                                                                              |\n================================================================================\n-->\n\nThis document, `GEMINI.md`, defines the **internal persona, directi"
    },
    {
      "path": "render.yaml",
      "excerpt": "# render.yaml - Blueprint for deploying the IOC Backend on Render\n\nservices:\n  - type: web\n    name: ioc-backend\n    runtime: docker\n    dockerfilePath: ./Dockerfile\n    plan: free\n    region: oregon\n    healthCheckPath: /actuator/health\n    autoDeploy: true\n    envVars:\n      - key: SPRING_PROFILES_ACTIVE\n        value: prod\n      - key: SERVER_PORT\n        value: 8080\n      - key: JAVA_OPTS\n        value: \"-Xmx400m -Xms200m\"\n      - fromGroup: ioc-secrets\n"
    },
    {
      "path": "sumario.md",
      "excerpt": "# Sumario t√©cnico ‚Äì ioc-backend\n\nEste documento resume el prop√≥sito del proyecto, componentes clave, pr√°cticas de calidad aplicadas y recomendaciones de mejora.\n\n## Resumen ejecutivo\nBackend Spring Boot para orquestar procesos ETL: recibe archivos, valida, calcula hash/idempotencia, ejecuta carga transaccional (delete+insert por ventana), publica m√©tricas y notificaciones en tiempo real, y protege endpoints con JWT y rate limiting est√°ndar.\n\n- P√∫blico objetivo: devs backend/frontend, SRE/ops, QA.\n- Objetivos: confiabilidad del ETL, trazabilidad (job/status), observabilidad y seguridad por defecto.\n\n## Stack y dependencias\n- Lenguaje/Runtime: Java 21\n- Framework: Spring Boot 3.5.5\n- Persistencia: Spring Data JPA / Hibernate, PostgreSQL\n- Seguridad: Spring Security (Resource Server, JWT)\n- Observabilidad: Spring Boot Actuator, Micrometer, Prometheus\n- Resiliencia: Resilience4j (Circuit Breaker, TimeLimiter)\n- Tiempo real: WebSocket (STOMP)\n- Rate limiting: Bucket4j (con Caffeine Cache)\n- Utilidades: Lombok\n\n## Arquitectura y componentes\n- Controller\n  - EtlController: expone endpoints para iniciar el proceso ETL y consultar estado.\n- Services\n  - EtlProcessingService: orquesta el pipeline ETL (validaci√≥n, parseo, ventana de fechas, sincronizaci√≥n, m√©tricas, notificaciones).\n  - EtlJobService: gesti√≥n de entidad de jobs ETL (crear, actualizar estado, ventanas, locking de rango).\n  - DataSyncService: operaci√≥n transaccional de borrado + inserci√≥n para sincronizar datos (delete+insert en rango) con manejo de excepciones.\n  - NotificationService: env√≠o de notificaciones a usuarios y sistema (integraci√≥n WebSocket).\n- Interceptors\n  - RateLimitInterceptor: control de tasa por usuario/IP en rutas /api/etl/**, devuelve headers est√°ndar de rate limit.\n- Configuraci√≥n\n  - SecurityConfig: CORS, autenticaci√≥n JWT como Resource Server, reglas de autorizaci√≥n.\n  - WebConfig: registro de interceptores.\n  - WebSocketConfig y WebSocketSecurityConfig: broker STOMP y autenticaci√≥n v√≠a "
    },
    {
      "path": "qodana.yaml",
      "excerpt": "#-------------------------------------------------------------------------------#\n#               Qodana analysis is configured by qodana.yaml file               #\n#             https://www.jetbrains.com/help/qodana/qodana-yaml.html            #\n#-------------------------------------------------------------------------------#\nversion: \"1.0\"\n\n#Specify inspection profile for code analysis\nprofile:\n  name: qodana.starter\n\n#Enable inspections\n#include:\n#  - name: <SomeEnabledInspectionId>\n\n#Disable inspections\n#exclude:\n#  - name: <SomeDisabledInspectionId>\n#    paths:\n#      - <path/where/not/run/inspection>\n\nprojectJDK: \"21\" #(Applied in CI/CD pipeline)\n\n#Execute shell command before Qodana execution (Applied in CI/CD pipeline)\n#bootstrap: sh ./prepare-qodana.sh\n\n#Install IDE plugins before Qodana execution (Applied in CI/CD pipeline)\n#plugins:\n#  - id: <plugin.id> #(plugin id can be found at https://plugins.jetbrains.com)\n\n# Quality gate. Will fail the CI/CD pipeline if any condition is not met\n# severityThresholds - configures maximum thresholds for different problem severities\n# testCoverageThresholds - configures minimum code coverage on a whole project and newly added code\n# Code Coverage is available in Ultimate and Ultimate Plus plans\n#failureConditions:\n#  severityThresholds:\n#    any: 15\n#    critical: 5\n#  testCoverageThresholds:\n#    fresh: 70\n#    total: 50\n\n#Specify Qodana linter for analysis (Applied in CI/CD pipeline)\nlinter: jetbrains/qodana-jvm:2025.2\n"
    },
    {
      "path": "stack.md",
      "excerpt": "# GEMINI.MD: AI Collaboration Guide\n\nThis document provides essential context for AI models interacting with this project. Adhering to these guidelines will ensure consistency and maintain code quality.\n\n## 1. Project Overview & Purpose\n\n* **Primary Goal:** This is a REST API backend for the \"Inteligencia Operacional Cambiaso\" project.\n* **Business Domain:** Inferred: Operational Intelligence. The specific domain is not clear from the provided information.\n\n## 2. Core Technologies & Stack\n\n* **Languages:** Java 21\n* **Frameworks & Runtimes:** Spring Boot 3.5.5\n* **Databases:** PostgreSQL\n* **Key Libraries/Dependencies:** \n    - Spring Boot Starter Data JPA\n    - Spring Boot Starter Security\n    - Spring Boot Starter Validation\n    - Spring Boot Starter Web\n    - Lombok\n* **Package Manager(s):** Maven\n\n## 3. Architectural Patterns\n\n* **Overall Architecture:** Monolithic Application, likely following a Model-View-Controller (MVC) or similar layered architecture common in Spring Boot applications.\n* **Directory Structure Philosophy:** Standard Maven project structure:\n    * `/src/main/java`: Contains the primary Java source code.\n    * `/src/main/resources`: Contains application configuration and static assets.\n    * `/src/test/java`: Contains all unit and integration tests.\n    * `/target`: Contains the compiled application and build artifacts.\n\n## 4. Coding Conventions & Style Guide\n\n* **Formatting:** Standard Java conventions. (Inferred from the limited source code).\n* **Naming Conventions:** \n    * `classes`: PascalCase (`IocbackendApplication`)\n    * `methods`, `variables`: camelCase (`main`, `args`)\n    * `packages`: lowercase (`com.cambiaso.ioc`)\n* **API Design:** RESTful principles are assumed given the use of Spring Boot Starter Web.\n* **Error Handling:** Not specified, but likely uses Spring Boot's default error handling mechanisms.\n\n## 5. Key Files & Entrypoints\n\n* **Main Entrypoint(s):** `src/main/java/com/cambiaso/ioc/IocbackendApplication.java`\n* **Config"
    },
    {
      "path": "pom.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<parent>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-starter-parent</artifactId>\n\t\t<version>3.5.5</version>\n\t\t<relativePath/> <!-- lookup parent from repository -->\n\t</parent>\n\t<groupId>com.cambiaso</groupId>\n\t<artifactId>iocbackend</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>iocbackend</name>\n\t<description>Backend API for the Inteligencia Operacional Cambiaso project</description>\n\t<url/>\n\t<licenses>\n\t\t<license/>\n\t</licenses>\n\t<developers>\n\t\t<developer/>\n\t</developers>\n\t<scm>\n\t\t<connection/>\n\t\t<developerConnection/>\n\t\t<tag/>\n\t\t<url/>\n\t</scm>\n\t<properties>\n\t\t<java.version>21</java.version>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n\t\t<maven.compiler.encoding>UTF-8</maven.compiler.encoding>\n\t\t<testcontainers.version>1.20.3</testcontainers.version>\n\t</properties>\n\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.testcontainers</groupId>\n\t\t\t\t<artifactId>testcontainers-bom</artifactId>\n\t\t\t\t<version>${testcontainers.version}</version>\n\t\t\t\t<type>pom</type>\n\t\t\t\t<scope>import</scope>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-data-jpa</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-security</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-validation</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactI"
    },
    {
      "path": ".gemini/project_summary.md",
      "excerpt": "# Resumen T√©cnico del Proyecto: Inteligencia Operacional Cambiaso (IOC)\n\n> **Generado por**: M√≥dulo de IA (Full-Stack)\n> **Fecha**: 2025-10-10T19:30:00Z\n> **Versi√≥n**: 1.1-INTEGRATED\n> **Estado**: ‚úÖ Completado\n\n---\n\n## 1. Contexto del Proyecto\n\n### 1.1. Prop√≥sito\n\n**¬øQu√© es este proyecto?**\nEs una plataforma de Business Intelligence (BI) dise√±ada para automatizar la ingesta, procesamiento y visualizaci√≥n de datos de producci√≥n de la empresa Cambiaso.\n\n**Problema que Resuelve**:\nElimina la dependencia de procesos manuales en planillas de c√°lculo, centralizando los datos para permitir una toma de decisiones m√°s √°gil y basada en evidencia.\n\n**Valor para el Usuario**:\nProporciona a los administradores y gerentes dashboards interactivos y en tiempo real sobre la producci√≥n, eficiencia y otros KPIs operativos.\n\n### 1.2. Objetivos Clave\n\n1. **Ingesta de Datos Asincr√≥nica**: Procesar archivos de producci√≥n de gran tama√±o sin bloquear la interfaz de usuario.\n2. **Visualizaci√≥n Segura de Dashboards**: Integrar Metabase para mostrar dashboards, con control de acceso por roles.\n3. **Gobernanza y Monitoreo**: Proveer herramientas para auditar las cargas de datos y monitorear la salud del sistema.\n\n### 1.3. Audiencia/Usuarios\n\n- **Usuarios Primarios**: Administradores (para la carga de datos) y Gerentes/Analistas (para la visualizaci√≥n de dashboards).\n- **Roles Detectados**: `ROLE_ADMIN`, `ROLE_MANAGER`, `ROLE_USER` (inferido de `MetabaseProperties`).\n\n### 1.4. Estado Actual\n\n**Backend**:\n\n- ‚úÖ Autenticaci√≥n y autorizaci√≥n implementada.\n- ‚úÖ 3 endpoints REST implementados.\n- ‚úÖ Integraci√≥n con Supabase (Auth y DB) y Metabase.\n- ‚úÖ Pipeline ETL asincr√≥nico con monitoreo de jobs.\n- ‚úÖ Watchdog para jobs atascados.\n- ‚úÖ Sistema de cach√© y circuit breaker.\n\n**Frontend**:\n\n- ‚úÖ Flujo de autenticaci√≥n de usuario completo (Login, Logout, Signup, Reset Password).\n- ‚úÖ UI para la p√°gina de \"Ingesta de Datos\" implementada (pendiente de conexi√≥n a API).\n- ‚úÖ Integraci√≥n de dashboards de Metabase 100"
    },
    {
      "path": ".gemini/estrategia_gemini.md",
      "excerpt": "# GEMINI.MD: Gu√≠a de Colaboraci√≥n de IA para el Proyecto IOC (v3.2)\n\n## 0. Declaraci√≥n de Misi√≥n\nTu misi√≥n es actuar como un **desarrollador senior full-stack** dentro del equipo del proyecto IOC. Tu foco absoluto es la finalizaci√≥n de las tareas del **Sprint 1**. Debes seguir los protocolos y utilizar los recursos definidos en este documento en todo momento.\n\n## 1. Contexto Estrat√©gico y Tecnol√≥gico (BOOTSTRAP)\n**Instrucci√≥n Mandatoria:** Antes de iniciar cualquier tarea, debes leer y asimilar por completo el contenido de los siguientes archivos para establecer tu contexto base. Confirma cuando lo hayas hecho.\n*   `@.gemini/strategy/1_Definicion_Proyecto.md`\n*   `@.gemini/strategy/2_Product_Backlog.md`\n*   `@.gemini/strategy/3_Stack_Tecnologico.md`\n*   `@.gemini/strategy/4_Design_Tokens.md`*    \n\n## 2. Mapa de Archivos de Contexto (.gemini)\nToda nuestra base de conocimiento est√° organizada en el directorio `.gemini`. Esta es la estructura que debes conocer y utilizar para localizar recursos:\n```.gemini/\n‚îú‚îÄ‚îÄ blueprints/   # (Reutilizable) Gu√≠as detalladas para tareas complejas.\n‚îú‚îÄ‚îÄ prompts/      # (Reutilizable) Comandos operativos estandarizados para la IA.\n‚îú‚îÄ‚îÄ sprints/      # (T√°ctico) Artefactos para la iteraci√≥n actual.\n‚îî‚îÄ‚îÄ strategy/     # (Estrat√©gico) Documentos de alto nivel del proyecto.\n```\n\n## 3. Foco Actual del Proyecto: Sprint 1\nNuestra prioridad absoluta es completar las historias de usuario definidas en el backlog del sprint actual.\n*   **Backlog del Sprint Activo:** `@.gemini/sprints/Sprint-1-Backlog.md`\n*   **Bit√°cora de Trabajo Realizado (Tu Memoria):** `@.gemini/sprints/BITACORA_SPRINT_1.md`\n\n## 4. Biblioteca de Planos (Blueprints)\nContamos con una biblioteca de gu√≠as para implementaciones complejas y reutilizables.\n*   **Protocolo de Uso:** Cuando una tarea coincida con un blueprint, tu plan debe ser expl√≠cito: \"Mi plan es implementar esta funcionalidad siguiendo el blueprint [Nombre del Blueprint]\".\n\n## 5. Mandato Operativo: Protocolo de Trabajo "
    },
    {
      "path": ".gemini/generadores_docs_sprint/GENERADOR_DE_SPRINT_BACKLOG.md",
      "excerpt": "# PROMPT: Generador de Sprint Backlog\n\nAct√∫a como Scrum Master. Genera un Sprint Backlog completo y detallado \npara el sprint bas√°ndote en la informaci√≥n proporcionada.\n\n## INFORMACI√ìN DEL SPRINT\n\n**Proyecto:** [Nombre del proyecto]\n**Sprint:** [N√∫mero y nombre del sprint]\n**Per√≠odo:** [Fecha inicio - Fecha fin]\n**Duraci√≥n:** [X] semanas / [Y] d√≠as h√°biles\n**Equipo:** [Nombres y roles]\n**Festivos/No laborables:** [Si aplica]\n\n---\n\n## SPRINT GOAL\n\n[Describe el objetivo del sprint en 1-2 frases que capture el valor de negocio \nque se entregar√°. Debe ser inspirador y medible]\n\nEjemplo: \"Entregar un ciclo de valor E2E: un usuario podr√° autenticarse, \ncargar datos CSV y visualizar dashboards inmediatamente\"\n\n---\n\n## HISTORIAS COMPROMETIDAS\n\n[Lista de historias que el equipo se compromete a completar]\n\n**Formato:**\n| ID | T√≠tulo | Feature | Prioridad | SP | Asignado | Estado |\n\n**Fuente:** Product Backlog seleccionado en Sprint Planning\n\n---\n\n## TAREAS T√âCNICAS\n\n[Descomposici√≥n de cada historia en tareas t√©cnicas espec√≠ficas]\n\n**Para cada historia, proporciona:**\n- Tareas de Frontend (FE-TASK-XX)\n- Tareas de Backend (BE-TASK-XX)\n- Tareas de Testing (TEST-TASK-XX) si aplica\n- Tareas de DevOps (OPS-TASK-XX) si aplica\n\n**Formato:**\n| N¬∫ | ID | Capa | Historia | Responsable | Descripci√≥n | Estado |\n\n---\n\n## INSTRUCCIONES DE GENERACI√ìN\n\n### 1. ESTRUCTURA OBLIGATORIA\n\nGenera el documento con estas secciones:\n\n**a) Metadata del Sprint**\n- Per√≠odo del Sprint (fechas, duraci√≥n, d√≠as h√°biles)\n- Objetivo del Sprint (Sprint Goal)\n\n**b) Historias Comprometidas**\n- Tabla con todas las historias del sprint\n- Incluir: ID, T√≠tulo completo, Tipo, Feature, Prioridad, SP, Asignado, Estado\n\n**c) Criterios de Aceptaci√≥n**\n- Para CADA historia, listar sus criterios de aceptaci√≥n\n- Formato: ‚úÖ [Criterio espec√≠fico y medible]\n- M√≠nimo 3 criterios por historia\n\n**d) Checklist de Tareas T√©cnicas**\n- Tabla detallada de todas las tareas\n- Numeradas secuencialmente\n- Organizadas por capa (Frontend, Bac"
    },
    {
      "path": ".gemini/docs/TESTING_STRATEGY.md",
      "excerpt": "# üìò **INFORME T√âCNICO: Estrategia de Testing Implementada**\n\n> **Para:** Agentes de IA y Desarrolladores Futuros  \n> **Fecha:** 2025-10-25  \n> **Proyecto:** IOC Backend  \n> **Resultado:** ‚úÖ 100% Tests Pasando\n\n---\n\n## üìä **RESUMEN EJECUTIVO**\n\n### **Problema Original**\n- ‚ùå Tests fallaban por dependencias no satisfechas (`NotificationService`, `SimpMessagingTemplate`, `MeterRegistry`)\n- ‚ùå Configuraci√≥n duplicada causaba conflictos de beans\n- ‚ùå Falta de consistencia entre tests (cada uno configurado diferente)\n- ‚ùå Tests lentos por cargar contextos completos innecesariamente\n\n### **Soluci√≥n Implementada**\n- ‚úÖ **Patr√≥n de Testing Centralizado** con `AbstractIntegrationTest` + `GlobalTestConfiguration`\n- ‚úÖ **Mocks globales** para servicios externos (WebSocket, m√©tricas, notificaciones)\n- ‚úÖ **Configuraci√≥n por perfil** (`test` para H2, `pgtest` para PostgreSQL)\n- ‚úÖ **Slice tests** donde es apropiado (`@WebMvcTest`, `@DataJpaTest`)\n\n### **Resultado**\n- ‚úÖ **Todos los tests pasan** (100% success rate)\n- ‚úÖ **Configuraci√≥n mantenible** (un solo lugar para cambios globales)\n- ‚úÖ **Tests r√°pidos** (H2 en memoria para la mayor√≠a)\n- ‚úÖ **Arquitectura escalable** (f√°cil agregar nuevos tests)\n\n---\n\n## üèóÔ∏è **ARQUITECTURA DE TESTING IMPLEMENTADA**\n\n### **Estructura de Archivos Clave**\n\n```\nsrc/test/\n‚îú‚îÄ‚îÄ java/com/cambiaso/ioc/\n‚îÇ   ‚îú‚îÄ‚îÄ AbstractIntegrationTest.java          ‚Üê Clase base para tests de integraci√≥n\n‚îÇ   ‚îú‚îÄ‚îÄ config/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GlobalTestConfiguration.java      ‚Üê Mocks globales\n‚îÇ   ‚îú‚îÄ‚îÄ controller/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardControllerTest.java      ‚Üê Usa AbstractIntegrationTest\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SecurityConfigTest.java           ‚Üê Usa AbstractIntegrationTest\n‚îÇ   ‚îú‚îÄ‚îÄ integration/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RoleManagementIntegrationTest.java ‚Üê Usa AbstractIntegrationTest\n‚îÇ   ‚îî‚îÄ‚îÄ service/\n‚îÇ       ‚îî‚îÄ‚îÄ AdvisoryLockSerializationTest.java ‚Üê Usa Testcontainers + perfil pgtest\n‚îÇ\n‚îî‚îÄ‚îÄ resources/\n    ‚îú‚îÄ‚îÄ application-test.properties           ‚Üê Config para tests con H2\n    ‚îî‚îÄ‚îÄ application-pgtest.properties         ‚Üê Co"
    },
    {
      "path": ".gemini/docs/learning/02-IOC-Analisis-Detallado-V2.md",
      "excerpt": "# üî¨ IOC Backend - An√°lisis Detallado Archivo por Archivo (VERSI√ìN COMPLETA CORREGIDA)\n\n> **Proyecto**: Inteligencia Operacional Cambiaso (IOC)  \n> **Framework**: Spring Boot 3.5.5 + Java 21  \n> **Fecha de An√°lisis**: 2025-10-22  \n> **Nivel**: Junior Developer  \n> **Versi√≥n**: 2.0 - Completa con An√°lisis de Seguridad\n\n---\n\n## üìã √çndice\n\n1. [Introducci√≥n](#introducci√≥n)\n2. [FASE 3: An√°lisis Detallado por Capas](#fase-3-an√°lisis-detallado-por-capas)\n   - [El Punto de Partida: `IocbackendApplication.java`](#el-punto-de-partida-iocbackendapplicationjava)\n   - [Capa de Configuraci√≥n (`config/` y `security/`)](#capa-de-configuraci√≥n-config-y-security)\n     - [`SecurityConfig.java`](#securityconfigjava)\n     - [`CorsConfig.java`](#corsconfigjava)\n     - [`AsyncConfig.java`](#asyncconfigjava)\n   - [Capa de Persistencia (`persistence/`)](#capa-de-persistencia-persistence)\n     - [An√°lisis de Entidades (`entity/`)](#an√°lisis-de-entidades-entity)\n     - [An√°lisis de Repositorios (`repository/`)](#an√°lisis-de-repositorios-repository)\n   - [Capa de Negocio (`service/`)](#capa-de-negocio-service)\n   - [Capa de Presentaci√≥n (`controller/`)](#capa-de-presentaci√≥n-controller)\n   - [Componentes de Soporte (`mapper/`, `exception/`)](#componentes-de-soporte-mapper-exception)\n3. [Checklist de Comprensi√≥n](#checklist-de-comprensi√≥n)\n4. [Navegaci√≥n](#navegaci√≥n)\n\n---\n\n## üöÄ Introducci√≥n\n\nEn el documento anterior, `01-IOC-Vision-General.md`, obtuvimos un mapa de alto nivel de la arquitectura. Ahora, en este documento, haremos un \"zoom in\" para explorar cada territorio de ese mapa. Analizaremos los archivos m√°s importantes de cada capa para entender no solo el \"qu√©\" hacen, sino el \"c√≥mo\" lo hacen, prestando especial atenci√≥n a las anotaciones de Spring Boot y al c√≥digo real del proyecto.\n\n**Objetivo de aprendizaje**: Al finalizar este documento, comprender√°s:\n- C√≥mo se configura la seguridad en una aplicaci√≥n Spring Boot real\n- Qu√© es Content Security Policy (CSP) y por qu√© es cr√≠tico para emb"
    },
    {
      "path": ".gemini/docs/learning/03-IOC-Resumen-Produccion-v2.md",
      "excerpt": "# üéì IOC Backend - Resumen, Patrones y Preparaci√≥n para Producci√≥n (VERSI√ìN COMPLETA)\n\n> **Proyecto**: Inteligencia Operacional Cambiaso (IOC)  \n> **Framework**: Spring Boot 3.5.5 + Java 21  \n> **Fecha de An√°lisis**: 2025-10-22  \n> **Nivel**: Junior Developer  \n> **Versi√≥n**: 2.0 - Completa y Mejorada\n\n---\n\n## üìò Sobre Este Documento\n\n**Prop√≥sito**: Este es el **documento final** de la serie de an√°lisis del proyecto IOC. Aqu√≠ consolidamos todo lo aprendido y te proporcionamos un **plan de acci√≥n concreto** para seguir creciendo como desarrollador Spring Boot.\n\n**Qu√© encontrar√°s aqu√≠**:\n- ‚úÖ Checklist completa de autoevaluaci√≥n\n- ‚úÖ Patrones de dise√±o con ejemplos reales\n- ‚úÖ Mejores pr√°cticas observadas en el proyecto\n- ‚úÖ An√°lisis profundo de seguridad, resiliencia y observabilidad\n- ‚úÖ Ejercicios pr√°cticos hands-on\n- ‚úÖ Plan de estudio de 8 semanas con recursos\n- ‚úÖ Pr√≥ximos pasos claros\n\n**Tiempo de lectura**: 60-90 minutos  \n**Tiempo de pr√°ctica sugerido**: 40-60 horas (siguiendo el plan completo)\n\n---\n\n## üìã √çndice\n\n1. [Introducci√≥n](#introducci√≥n)\n2. [FASE 4: Resumen de Aprendizaje y Patrones](#fase-4-resumen-de-aprendizaje-y-patrones)\n   - [Checklist de Autoevaluaci√≥n](#checklist-de-autoevaluaci√≥n)\n   - [Patrones de Dise√±o Identificados](#patrones-de-dise√±o-identificados)\n   - [Mejores Pr√°cticas Observadas](#mejores-pr√°cticas-observadas)\n   - [Glosario R√°pido de Anotaciones](#glosario-r√°pido-de-anotaciones)\n3. [FASE 5: An√°lisis para Producci√≥n](#fase-5-an√°lisis-para-producci√≥n)\n   - [An√°lisis de Seguridad Profundo](#an√°lisis-de-seguridad-profundo)\n   - [An√°lisis de Resiliencia](#an√°lisis-de-resiliencia)\n   - [An√°lisis de Observabilidad](#an√°lisis-de-observabilidad)\n   - [Mejoras Propuestas](#mejoras-propuestas)\n4. [Ejercicios Pr√°cticos](#ejercicios-pr√°cticos)\n5. [Plan de Estudio Completo (8 Semanas)](#plan-de-estudio-completo-8-semanas)\n6. [Mapa de Navegaci√≥n por Concepto](#mapa-de-navegaci√≥n-por-concepto)\n7. [¬øQu√© Hacer Ahora?](#qu√©-hacer-ahora)\n8. [Recursos de Aprend"
    },
    {
      "path": ".gemini/docs/learning/01-IOC-Vision-General-V2.md",
      "excerpt": "# üìò IOC Backend - Visi√≥n General y Conceptos Fundamentales (VERSI√ìN CORREGIDA)\n\n> **Proyecto**: Inteligencia Operacional Cambiaso (IOC)  \n> **Framework**: Spring Boot 3.5.5 + Java 21  \n> **Fecha de An√°lisis**: 2025-10-22  \n> **Nivel**: Junior Developer  \n> **Prerequisito**: Conocimientos b√°sicos de Java y HTTP  \n> **Versi√≥n**: 1.1 - Corregida y Mejorada\n\n---\n\n## üìò Sobre Este Documento\n\n**Objetivo**: Proporcionar una **visi√≥n general** de la arquitectura del proyecto IOC para entender el \"big picture\" antes de profundizar en detalles t√©cnicos.\n\n**Nivel de detalle**:\n- ‚úÖ Conceptos fundamentales de Spring Boot\n- ‚úÖ Responsabilidades por capa arquitect√≥nica\n- ‚úÖ Flujos principales de datos\n- ‚úÖ Estructura del proyecto completa\n- ‚ùå An√°lisis l√≠nea por l√≠nea de c√≥digo (ver `02-IOC-Analisis-Detallado.md`)\n- ‚ùå Detalles de seguridad y CSP (ver `02-IOC-Analisis-Detallado.md`)\n- ‚ùå Trade-offs t√©cnicos (ver `02-IOC-Analisis-Detallado.md`)\n\n**Audiencia**: Junior developers que necesitan entender la arquitectura antes de codificar.\n\n**Tiempo de lectura**: 45-60 minutos\n\n**Pr√≥ximo paso**: Una vez que domines estos conceptos, profundiza en `02-IOC-Analisis-Detallado.md` para ver c√≥digo real l√≠nea por l√≠nea y an√°lisis de seguridad.\n\n---\n\n## üéØ Conceptos Clave que Dominar√°s\n\nAl completar esta serie de 3 documentos, entender√°s:\n\n### **Arquitectura y Patrones** (Este documento)\n- ‚úÖ Layered Architecture (Controller ‚Üí Service ‚Üí Repository)\n- ‚úÖ Dependency Injection (Inyecci√≥n de Dependencias)\n- ‚úÖ DTOs vs Entities (y por qu√© NUNCA exponer entities en API)\n- ‚úÖ Repository Pattern\n- ‚úÖ Separation of Concerns\n\n### **Seguridad** (Documento 2)\n- ‚úÖ JWT Authentication con Supabase\n- ‚úÖ Content Security Policy (CSP) para embedding\n- ‚úÖ CORS (Cross-Origin Resource Sharing)\n- ‚úÖ Stateless Sessions\n- ‚úÖ Trade-offs entre seguridad y funcionalidad\n\n### **Concurrencia y Asincron√≠a** (Documento 2)\n- ‚úÖ Async Processing con Thread Pools\n- ‚úÖ @Transactional y manejo de transacciones\n- ‚úÖ ETL Jobs en background\n\n### **Int"
    },
    {
      "path": ".gemini/blueprints/ftv-data-upload-dropzone-integration.md",
      "excerpt": "# FTV-005: Integraci√≥n en DataUploadDropzone\n\n## Metadata\n- **ID**: FTV-005\n- **Technical Design**: TD-001-validacion-carga-archivos-etl-v2.md\n- **Tipo**: Integration Guide (Modificaci√≥n de componente existente)\n- **Ubicaci√≥n**: `src/components/admin/DataUploadDropzone.tsx` (o similar)\n- **Sprint**: Sprint 2\n- **Fecha Creaci√≥n**: 2025-10-19\n- **Estado**: Draft\n- **Dependencias**: FTV-001, FTV-002, FTV-003, FTV-004\n\n---\n\n## 1. Prop√≥sito\n\n### 1.1. Descripci√≥n\nGu√≠a para integrar la validaci√≥n de archivos en el componente existente `DataUploadDropzone`, interceptando la selecci√≥n de archivos y orquestando el flujo de validaci√≥n antes de permitir el upload al backend.\n\n### 1.2. Objetivo de la Integraci√≥n\n- Interceptar evento `onFileSelect` antes de proceder con upload\n- Mostrar `FilePreview` y `FileValidationResult` durante validaci√≥n\n- Habilitar bot√≥n \"Confirmar y Subir\" solo si validaci√≥n pasa\n- Permitir cancelaci√≥n y reselecci√≥n de archivo\n\n---\n\n## 2. Componente Actual (Estado Previo)\n\n### 2.1. Estructura Actual Inferida\n\n```tsx\n// Estructura actual aproximada (antes de la integraci√≥n)\nfunction DataUploadDropzone({ onFileSelect, onUploadComplete }) {\n  const [file, setFile] = useState<File | null>(null);\n  const [uploading, setUploading] = useState(false);\n  \n  const handleDrop = (acceptedFiles: File[]) => {\n    const selectedFile = acceptedFiles[0];\n    setFile(selectedFile);\n    \n    // PROBLEMA: Sube directamente sin validar\n    onFileSelect(selectedFile);\n  };\n  \n  return (\n    <div {...getRootProps()}>\n      <input {...getInputProps()} />\n      {/* UI del dropzone */}\n    </div>\n  );\n}\n```\n\n---\n\n## 3. Componente Modificado (Estado Final)\n\n### 3.1. C√≥digo Completo con Integraci√≥n\n\n```tsx\nimport React, { useState } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { useFileValidation } from '@/hooks/useFileValidation';\nimport { FilePreview } from '@/components/FilePreview';\nimport { FileValidationResult } from '@/components/FileValidationResult';\ni"
    },
    {
      "path": ".gemini/blueprints/IOC-021-reset_password_impl.md",
      "excerpt": "# Plan de Implementaci√≥n: Reseteo de Contrase√±a\n\nEste documento detalla los pasos para crear la p√°gina de reseteo de contrase√±a, bas√°ndose en la captura de pantalla proporcionada y utilizando los componentes existentes en el proyecto.\n\n## An√°lisis Visual y de Componentes\n\n-   **Dise√±o General:** La captura de pantalla muestra un formulario centrado que coincide con el `AuthLayout` utilizado en las p√°ginas de `SignIn` y `SignUp`.\n-   **Componentes Requeridos:**\n    -   **Layout:** `AuthLayout` (`src/pages/AuthPages/AuthPageLayout.tsx`)\n    -   **T√≠tulo y P√°rrafo:** Etiquetas `h1` y `p` con clases de Tailwind CSS existentes.\n    -   **Formulario:** Un `<form>` que contendr√° los campos.\n    -   **Etiqueta de Campo:** Componente `<Label>` (`src/components/form/Label.tsx`).\n    -   **Campo de Entrada:** Componente `<Input>` (`src/components/form/input/InputField.tsx`).\n    -   **Bot√≥n de Acci√≥n:** Componente `<Button>` (`src/components/ui/button/Button.tsx`).\n    -   **Navegaci√≥n:** Componente `<Link>` de `react-router-dom`.\n    -   **Iconos:** `ChevronLeftIcon` (`src/icons/index.ts`).\n\n## Plan de Implementaci√≥n Paso a Paso\n\n### Paso 1: Crear el Componente del Formulario (`ResetPasswordForm.tsx`)\n\nCrearemos un nuevo componente reutilizable que contenga la l√≥gica y la estructura del formulario de reseteo de contrase√±a, bas√°ndonos en el HTML proporcionado.\n\n-   **Ubicaci√≥n del Archivo:** `src/components/auth/ResetPasswordForm.tsx`\n-   **C√≥digo:**\n    ```tsx\n    import { useState } from \"react\";\n    import { Link } from \"react-router-dom\";\n    import { supabase } from \"../../lib/supabaseClient\";\n    import Label from \"../form/Label\";\n    import Input from \"../form/input/InputField\";\n    import Button from \"../ui/button/Button\";\n    import { ChevronLeftIcon } from \"../../icons\";\n\n    export default function ResetPasswordForm() {\n      const [email, setEmail] = useState(\"\");\n      const [loading, setLoading] = useState(false);\n      const [message, setMessage] = useState(\"\");"
    },
    {
      "path": ".gemini/blueprints/ftv-use-file-validation.md",
      "excerpt": "# FTV-002: useFileValidation (Hook)\n\n## Metadata\n- **ID**: FTV-002\n- **Technical Design**: TD-001-validacion-carga-archivos-etl-v2.md\n- **Tipo**: Custom Hook\n- **Ubicaci√≥n**: `src/hooks/useFileValidation.ts`\n- **Sprint**: Sprint 2\n- **Fecha Creaci√≥n**: 2025-10-19\n- **Estado**: Draft\n- **Dependencias**: FTV-001 (FileValidator)\n\n---\n\n## 1. Prop√≥sito\n\n### 1.1. Descripci√≥n\nHook personalizado que orquesta el proceso de validaci√≥n de archivos, gestionando la m√°quina de estados (IDLE ‚Üí PRECHECK ‚Üí READING ‚Üí PARSING_HEADERS ‚Üí SAMPLING ‚Üí READY/BLOCKED/ERROR), el estado de carga y el resultado de validaci√≥n.\n\nNota sobre encoding: El hook reporta el encoding detectado por `FileValidator` y lo propaga v√≠a `result.summary.encoding`. La heur√≠stica es UTF-8 por defecto y fallback a Windows-1252 (alineado con el backend).\n\n### 1.2. Caso de Uso\n```\nComo componente que necesita validar archivos,\nCuando invoco useFileValidation(config),\nEntonces obtengo funciones para validar archivos y estado reactivo,\nPara mostrar feedback al usuario durante el proceso de validaci√≥n.\n```\n\n### 1.3. Responsabilidades\n- Gestionar m√°quina de estados de validaci√≥n\n- Invocar FileValidator y capturar resultado\n- Proveer estado de loading/error\n- Permitir reset del estado\n- Medir telemetr√≠a (duraci√≥n, √©xito/fallo, encoding detectado)\n\n---\n\n## 2. API del Hook\n\n### 2.1. Signature\n\n```typescript\nfunction useFileValidation(\n  config?: Partial<FileValidationConfig>\n): UseFileValidationReturn\n```\n\n### 2.2. Return Type\n\n```typescript\ninterface UseFileValidationReturn {\n  // Estado\n  state: ValidationState;\n  result: ValidationResult | null;\n  isValidating: boolean;\n  \n  // Acciones\n  validate: (file: File) => Promise<void>;\n  reset: () => void;\n  \n  // Metadata\n  validationDuration: number | null; // ms\n}\n\nenum ValidationState {\n  IDLE = 'IDLE',\n  PRECHECK = 'PRECHECK',\n  READING = 'READING',\n  PARSING_HEADERS = 'PARSING_HEADERS',\n  SAMPLING = 'SAMPLING',\n  SUMMARY = 'SUMMARY',\n  READY = 'READY',\n  BLOCKED = 'BLOCK"
    },
    {
      "path": ".gemini/blueprints/refactorizacion_frontend_v5.1.md",
      "excerpt": "# Blueprint: Refactorizaci√≥n de Frontend para Sincronizaci√≥n con API de Ingesta (v5.1 - Final Corregido)\n\nEste documento detalla el plan de acci√≥n para refactorizar la vista de Ingesta de Datos. **Versi√≥n 5.1 reintegra la estrategia de pruebas completa y a√±ade las mejoras de QA avanzado.**\n\n---\n## 1. Plan de Implementaci√≥n\n\n### Archivo: `package.json`\n*   **Acci√≥n:** A√±adir `axios`, `vitest`, `msw`, `@testing-library/react`.\n\n### Archivo: `src/types/api.ts` (Nuevo)\n*   **Acci√≥n:** Crear el archivo con las interfaces `JobStatus`, `StartProcessResponse`, `EtlJobStatusDto`, `StandardError`, y `EtlJob`.\n\n### Archivo: `src/utils/apiError.ts` (Nuevo)\n*   **Acci√≥n:** Crear el helper `parseApiError` para un manejo de errores consistente.\n\n### Archivo: `src/services/apiService.ts` (Nuevo)\n*   **Acci√≥n:** Implementar el servicio de API con `axios`, incluyendo el sistema de \"Token Provider\", interceptores, soporte para `AbortSignal` y helper para `Retry-After`.\n\n### Archivo: `src/main.tsx`\n*   **Acci√≥n:** Inyectar el proveedor de tokens de Supabase al inicio de la aplicaci√≥n usando `setTokenProvider`.\n\n### Archivo: `src/pages/admin/DataIngestionPage.tsx`\n*   **Acci√≥n:** Implementar la l√≥gica de `AbortController` para permitir la cancelaci√≥n de subidas y el `useEffect` robusto para el sondeo.\n\n---\n## 2. Estrategia de Pruebas y Calidad (Completa)\n\n### A. Pruebas Unitarias y de Integraci√≥n (Vitest + MSW)\n*   **`src/services/tests/apiService.spec.ts`:**\n    *   **Cobertura:**\n        *   Verificar que el interceptor de petici√≥n a√±ade correctamente el `Authorization header`.\n        *   Simular una respuesta `401` y verificar que el interceptor de respuesta llama a la funci√≥n de `signOut`.\n        *   Probar la funci√≥n `startEtlProcess`, simulando una respuesta `202` y verificando que los datos devueltos son correctos.\n        *   Probar `parseApiError` con diferentes payloads de error (`409`, `413`, etc.) y verificar que la salida es la esperada.\n        *   **[Nuevo]** Probar que"
    },
    {
      "path": ".gemini/blueprints/01-FTV-panel-principal.md",
      "excerpt": "## Metadatos de la Ficha T√©cnica\n*   **ID:** `FTV-1/4`\n*   **Vista:** `Panel Principal`\n---\n\n# Ficha T√©cnica de Vista: Panel Principal (v1.4)\n\n## 1. Misi√≥n y Flujo de Usuario\n*   **Misi√≥n de la Vista:** Proporcionar al administrador un resumen visual e inmediato del estado de la plataforma, permiti√©ndole identificar anomal√≠as y acceder r√°pidamente a las secciones de gesti√≥n m√°s relevantes.\n*   **Flujo de Usuario Clave:**\n    1.  El administrador inicia sesi√≥n y es dirigido a esta vista (`AdminDashboardPage`).\n    2.  Visualiza las m√©tricas clave en los componentes `MetricCard`.\n    3.  Utiliza los `QuickAccessButton` para navegar a una secci√≥n espec√≠fica.\n\n## 2. Arquitectura de Componentes\nEsta vista se renderiza dentro del `AppLayout` y se compone de la siguiente jerarqu√≠a:\n\n### A. Componentes Reutilizados\n*   **Del Proyecto (`@src/`):** `PageBreadcrumb`, `Button`, `LineChartOne`, `BarChartOne`, `Alert`.\n\n### B. Nuevos Componentes a Crear\n#### B.1. Componente de P√°gina (Orquestador)\n*   **Nombre:** `AdminDashboardPage.tsx`\n*   **Responsabilidad:** Orquestar la vista, gestionar el estado de carga y error, obtener los datos para las m√©tricas y gr√°ficos, y manejar la navegaci√≥n de los accesos directos.\n\n#### B.2. Componentes de UI (Reutilizables)\n*   **Nombre:** `MetricCard.tsx`\n*   **Responsabilidad:** Mostrar una m√©trica individual (ej. \"Usuarios Activos\") con un t√≠tulo, un valor y un √≠cono.\n*   **Interfaz de Props (Props Interface):**\n    ```typescript\n    interface MetricCardProps {\n      title: string;\n      value: string | number;\n      icon: React.ReactNode;\n      \"data-testid\"?: string;\n    }\n    ```\n*   **Nombre:** `QuickAccessButton.tsx`\n*   **Responsabilidad:** Un bot√≥n estilizado con un √≠cono y texto para los accesos directos.\n*   **Interfaz de Props (Props Interface):**\n    ```typescript\n    interface QuickAccessButtonProps {\n      title: string;\n      icon: React.ReactNode;\n      onClick: () => void;\n      \"data-testid\"?: string;\n    }\n    ```\n\n## 3. Est"
    },
    {
      "path": ".gemini/blueprints/IOC-001-etl-pipeline-batch-and-validation-refactor.md",
      "excerpt": "# Blueprint: Optimizaci√≥n y Robustecimiento del Pipeline de Ingesta de Datos ETL (v3 - Production Grade)\n\nEsta gu√≠a detalla el proceso paso a paso para refactorizar el sistema de ingesta de datos a un modelo de procesamiento por lotes, a√±adiendo una capa de validaci√≥n robusta y m√©tricas de monitoreo.\n\n## 1. Objetivo y Alcance\n*   **Objetivo:** Transformar el pipeline de ETL para procesar archivos de gran tama√±o de forma eficiente, detectar y segregar datos inv√°lidos, y emitir m√©tricas operativas para monitoreo.\n*   **Stack Tecnol√≥gico Involucrado:** Spring Boot, Spring Data JPA, Jakarta Bean Validation, Micrometer.\n*   **Contexto Adicional:** Refactorizar el ParserService actual para que procese archivos grandes de forma eficiente (sin agotar la memoria) y a√±adir una capa de validaci√≥n expl√≠cita para detectar datos corruptos antes de llegar a la base de datos.\n\n## 2. Prerrequisitos\n*   **Dependencias:** `spring-boot-starter-validation`, `spring-boot-starter-actuator` (para Micrometer).\n*   **Configuraci√≥n:** Se a√±adir√°n nuevas propiedades en `application.properties` para controlar el ETL.\n*   **Stack Principal:** Spring Boot + JPA + Jakarta Bean Validation\n\n## 3. Implementaci√≥n Paso a Paso\n\n### 3.1. Configuraci√≥n y Dependencias\n*   **Archivo:** `pom.xml`\n*   **Objetivo:** Asegurar que los m√≥dulos de validaci√≥n y m√©tricas est√©n disponibles.\n*   **C√≥digo:**\n    ```xml\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-validation</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-actuator</artifactId>\n    </dependency>\n    ```\n*   **Archivo:** `src/main/resources/application.properties`\n*   **Objetivo:** Externalizar la configuraci√≥n del ETL para permitir ajustes sin recompilar.\n*   **C√≥digo:**\n    ```properties\n    # ETL Configuration\n    etl.batch.size=1000\n    etl.validation.enabled=true\n    ```\n\n### 3.2. Creaci√≥n de Nuev"
    },
    {
      "path": ".gemini/blueprints/INDEX.md",
      "excerpt": "# √çndice de Blueprints/FTVs - Validaci√≥n de Carga de Archivos ETL\n\n**Technical Design**: `TD-001-validacion-carga-archivos-etl-v2.md`  \n**Sprint**: Sprint 2  \n**Fecha de Generaci√≥n**: 2025-10-19  \n**Estado**: Draft - Listo para Revisi√≥n\n\n---\n\n## üìã Resumen Ejecutivo\n\nEste conjunto de FTVs (Fichas T√©cnicas de Vista) documenta la implementaci√≥n completa de la validaci√≥n client-side de archivos ETL antes de subirlos al backend. La soluci√≥n incluye 1 servicio, 1 hook personalizado, 2 componentes UI y 1 gu√≠a de integraci√≥n.\n\n**Objetivo**: Reducir en ~80% las cargas de archivos inv√°lidos al backend, mejorando la experiencia de usuario con feedback inmediato.\n\n---\n\n## üìÅ Componentes Generados (5 FTVs)\n\n### Servicios (1)\n\n| ID | Componente | Archivo FTV | Tipo | Descripci√≥n |\n|---|---|---|---|---|\n| FTV-001 | **FileValidator** | [ftv-file-validator.md](./ftv-file-validator.md) | Servicio | Valida archivos TXT con algoritmos de detecci√≥n de encoding, parsing de headers y sampling de datos |\n\n### Hooks (1)\n\n| ID | Componente | Archivo FTV | Tipo | Descripci√≥n |\n|---|---|---|---|---|\n| FTV-002 | **useFileValidation** | [ftv-use-file-validation.md](./ftv-use-file-validation.md) | Custom Hook | Orquesta el proceso de validaci√≥n con m√°quina de estados y telemetr√≠a |\n\n### Componentes UI (2)\n\n| ID | Componente | Archivo FTV | Tipo | Descripci√≥n |\n|---|---|---|---|---|\n| FTV-003 | **FilePreview** | [ftv-file-preview.md](./ftv-file-preview.md) | UI Component | Muestra preview de 14 l√≠neas del archivo con highlighting de l√≠nea SAP |\n| FTV-004 | **FileValidationResult** | [ftv-file-validation-result.md](./ftv-file-validation-result.md) | Feature Component | Presenta resultado de validaci√≥n con resumen, errores y botones de acci√≥n |\n\n### Gu√≠as de Integraci√≥n (1)\n\n| ID | Componente | Archivo FTV | Tipo | Descripci√≥n |\n|---|---|---|---|---|\n| FTV-005 | **DataUploadDropzone** | [ftv-data-upload-dropzone-integration.md](./ftv-data-upload-dropzone-integration.md) | Integration Guide | Gu√≠a par"
    },
    {
      "path": ".gemini/blueprints/03-FTV-contenido-analitico.md",
      "excerpt": "## Metadatos de la Ficha T√©cnica\n*   **ID:** `FTV-3/4`\n*   **Vista:** `Contenido Anal√≠tico`\n---\n\n# Ficha T√©cnica de Vista: Contenido Anal√≠tico (v1.4)\n\n## 1. Misi√≥n y Flujo de Usuario\n*   **Misi√≥n de la Vista:** Empoderar al administrador con herramientas para crear, configurar y organizar los artefactos de BI (Dashboards, Gr√°ficos, KPIs) que ser√°n consumidos por los usuarios finales.\n*   **Flujo de Usuario Clave:**\n    1.  El administrador navega a \"Contenido Anal√≠tico\" (`AnalyticsContentPage`).\n    2.  Selecciona la pesta√±a \"Gesti√≥n de Gr√°ficos\" y abre el `ChartBuilderModal` para crear un gr√°fico.\n    3.  Navega a \"Dise√±o de Dashboards\", selecciona un dashboard y arrastra el nuevo gr√°fico desde el `AvailableChartsPanel` al `DashboardLayoutEditor`.\n    4.  Guarda la disposici√≥n.\n    5.  Navega a \"Gesti√≥n de KPIs\" y ajusta los umbrales en la `KpiSettingsTable`.\n\n## 2. Arquitectura de Componentes\nEsta vista se renderiza dentro del `AppLayout` y utilizar√° un componente de Pesta√±as (`Tabs`) para organizar sus tres sub-secciones.\n\n### A. Componentes Reutilizados\n*   **Del Proyecto (`@src/`):** `PageBreadcrumb`, `Table`, `Modal`, `Button`, `Input`, `Switch`, `Dropdown`, `Alert`.\n*   **Librer√≠as Externas:** `react-dnd`.\n\n### B. Nuevos Componentes a Crear\n#### B.1. Componente de P√°gina (Orquestador)\n*   **Nombre:** `AnalyticsContentPage.tsx`\n*   **Responsabilidad:** Orquestar las tres sub-vistas, gestionar el estado de la pesta√±a activa y los datos compartidos (ej. lista de gr√°ficos).\n\n#### B.2. Componentes de UI (Reutilizables)\n*   **Nombre:** `DashboardLayoutEditor.tsx`\n*   **Responsabilidad:** Proveer un lienzo interactivo donde se pueden arrastrar, soltar y redimensionar componentes de gr√°ficos.\n*   **Interfaz de Props (Props Interface):**\n    ```typescript\n    interface DashboardLayoutEditorProps {\n      dashboardId: string;\n      layout: LayoutItem[];\n      onLayoutChange: (newLayout: LayoutItem[]) => void;\n      \"data-testid\"?: string;\n    }\n    ```\n*   **Nombre:** `"
    },
    {
      "path": ".gemini/blueprints/refactorizacion_frontend_v2.md",
      "excerpt": "# Blueprint: Refactorizaci√≥n de Frontend para Sincronizaci√≥n con API de Ingesta (v2.0)\n\nEste documento detalla el plan de acci√≥n para refactorizar la vista de Ingesta de Datos del frontend, aline√°ndola con la API as√≠ncrona y robusta del backend. **Versi√≥n 2.0 incorpora feedback de QA para mayor robustez y mantenibilidad.**\n\n---\n## Archivo: `package.json`\n**Resumen de Cambios:**\n1.  Se a√±adir√° la dependencia `axios`.\n2.  Se a√±adir√°n las dependencias de desarrollo para pruebas: `vitest`, `msw` (Mock Service Worker).\n\n**Justificaci√≥n:**\nSe necesita `axios` para la comunicaci√≥n con la API. `vitest` y `msw` son cruciales para crear pruebas unitarias robustas para el servicio de API, permitiendo simular respuestas del backend y verificar el manejo de errores.\n\n---\n## Archivo: `src/types/api.ts` (Nuevo)\n**Resumen de Cambios:**\n1.  Se definir√°n los tipos para los DTOs de √©xito y error, usando uniones literales para `status`.\n\n**C√≥digo a Crear:**\n```typescript\n// DTOs de √âxito\nexport type JobStatus = 'INICIADO' | 'EXITO' | 'FALLO';\n\nexport interface StartProcessResponse {\n  jobId: string;\n  fileName: string;\n  status: 'INICIADO';\n}\n\nexport interface EtlJobStatusDto {\n  jobId: string;\n  fileName: string;\n  status: JobStatus;\n  details: string | null;\n  minDate: string | null;\n  maxDate: string | null;\n  createdAt: string | null;\n  finishedAt: string | null;\n}\n\n// DTOs de Error\nexport interface StandardError {\n  error: string;\n  message: string;\n  timestamp: string;\n}\n\nexport interface UnauthorizedError {\n  timestamp: string;\n  status: 401;\n  error: \"Unauthorized\";\n  message: string;\n  path: string;\n}\n\n// Estado local para la UI\nexport interface EtlJob extends EtlJobStatusDto {}\n```\n**Justificaci√≥n:**\nUsar uniones literales para `JobStatus` proporciona type safety, previniendo errores por strings inv√°lidos. Definir los DTOs de error permite un manejo de errores tipado y predecible.\n\n---\n## Archivo: `src/utils/apiError.ts` (Nuevo)\n**Resumen de Cambios:**\n1.  Se crear√° un helper"
    },
    {
      "path": ".gemini/blueprints/refactorizacion_frontend_v3.md",
      "excerpt": "# Blueprint: Refactorizaci√≥n de Frontend para Sincronizaci√≥n con API de Ingesta (v3.0)\n\nEste documento detalla el plan de acci√≥n para refactorizar la vista de Ingesta de Datos y establecer una estrategia de calidad robusta, aline√°ndola con la API as√≠ncrona del backend. **Versi√≥n 3.0 incorpora una estrategia de pruebas completa.**\n\n---\n## 1. Plan de Implementaci√≥n\n\n### Archivo: `package.json`\n*   **Resumen de Cambios:**\n    1.  Se a√±adir√° la dependencia `axios`.\n    2.  Se a√±adir√°n las dependencias de desarrollo: `vitest`, `msw`, `@testing-library/react`.\n\n*   **Justificaci√≥n:**\n    Se necesita `axios` para la comunicaci√≥n con la API. `vitest`, `msw` y `Testing Library` son cruciales para crear pruebas unitarias y de integraci√≥n robustas.\n\n### Archivo: `src/types/api.ts` (Nuevo)\n*   **Resumen de Cambios:**\n    1.  Se definir√°n los tipos para los DTOs de √©xito y error, usando uniones literales para `status`.\n\n*   **C√≥digo a Crear:**\n    ```typescript\n    // DTOs de √âxito\n    export type JobStatus = 'INICIADO' | 'EXITO' | 'FALLO';\n\n    export interface StartProcessResponse {\n      jobId: string;\n      fileName: string;\n      status: 'INICIADO';\n    }\n\n    export interface EtlJobStatusDto {\n      jobId: string;\n      fileName: string;\n      status: JobStatus;\n      details: string | null;\n      minDate: string | null;\n      maxDate: string | null;\n      createdAt: string | null;\n      finishedAt: string | null;\n    }\n\n    // DTOs de Error\n    export interface StandardError {\n      error: string;\n      message: string;\n      timestamp: string;\n    }\n\n    // Estado local para la UI\n    export interface EtlJob extends EtlJobStatusDto {}\n    ```\n\n### Archivo: `src/utils/apiError.ts` (Nuevo)\n*   **Resumen de Cambios:**\n    1.  Se crear√° un helper para parsear errores de `axios` de forma consistente.\n\n*   **C√≥digo a Crear:**\n    ```typescript\n    import axios from 'axios';\n\n    interface ParsedApiError {\n      status: number;\n      message: string;\n      code: string;\n    }\n\n"
    },
    {
      "path": ".gemini/blueprints/ftv-file-validation-result.md",
      "excerpt": "# FTV-004: FileValidationResult (Componente UI)\n\n## Metadata\n- **ID**: FTV-004\n- **Technical Design**: TD-001-validacion-carga-archivos-etl-v2.md\n- **Tipo**: Feature Component\n- **Ubicaci√≥n**: `src/components/FileValidationResult.tsx`\n- **Sprint**: Sprint 2\n- **Fecha Creaci√≥n**: 2025-10-19\n- **Estado**: Draft\n- **Dependencias**: FTV-001 (tipos de ValidationResult)\n\n---\n\n## 1. Prop√≥sito\n\n### 1.1. Descripci√≥n\nComponente que muestra el resultado de la validaci√≥n de un archivo con un resumen visual (‚úÖ‚ùå‚ö†), lista detallada de errores/warnings con sugerencias, y botones de acci√≥n (\"Confirmar y Subir\" o \"Seleccionar otro archivo\").\n\n### 1.2. Caso de Uso\n```\nComo usuario que valid√≥ un archivo,\nCuando la validaci√≥n termina,\nEntonces veo un resumen claro de si pas√≥ o fall√≥ y por qu√©,\nPara saber si puedo continuar o debo corregir el archivo.\n```\n\n### 1.3. Ubicaci√≥n en la App\n- Mostrado en `DataIngestionPage` despu√©s de la validaci√≥n\n- Ubicado debajo de `FilePreview`\n- Controla habilitaci√≥n del bot√≥n \"Confirmar y Subir\"\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe - Estado READY (V√°lido)\n\n```\n‚îå‚îÄ Resultado de Validaci√≥n ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                                                            ‚îÇ\n‚îÇ  ‚úÖ Archivo v√°lido y listo para subir                     ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  ‚úÖ Extensi√≥n: .txt                                       ‚îÇ\n‚îÇ  ‚úÖ Tama√±o: 15MB / 50MB                                   ‚îÇ\n‚îÇ  ‚úÖ Codificaci√≥n: UTF-8                                   ‚îÇ\n‚îÇ  ‚úÖ Encabezados: 9/9 columnas coinciden                   ‚îÇ\n‚îÇ  ‚úÖ Datos (10 l√≠neas muestreadas): Sin errores            ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  [Confirmar y Subir]  [Cancelar]                          ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### 2.2. Wireframe - Estado BLOCKED (Con Errores)\n\n```\n‚îå‚îÄ Resultado de Validaci√≥n ‚îÄ"
    },
    {
      "path": ".gemini/blueprints/IOC-006a-metabase-embedding-integration.md",
      "excerpt": "# Blueprint: Visualizaci√≥n de Dashboards con Metabase\n\nEsta gu√≠a detalla el proceso paso a paso para implementar la funcionalidad de incrustaci√≥n de dashboards de Metabase.\n\n## 1. Objetivo y Alcance\n*   **Objetivo:** Permitir que los usuarios vean dashboards de Metabase de forma segura y filtrada dentro de la aplicaci√≥n IOC, cumpliendo con la historia de usuario IOC-006a.\n*   **Stack Tecnol√≥gico Involucrado:** Spring Boot, React, Docker, Metabase.\n*   **Contexto Adicional:** La implementaci√≥n se basar√° en el m√©todo de Static (Signed) Embedding de Metabase para garantizar la seguridad con la versi√≥n Open Source. El backend generar√° URLs firmadas y el frontend las renderizar√° en un iframe.\n\n## 2. Prerrequisitos\n*   **Dependencias:**\n    *   Backend: `io.jsonwebtoken` (jjwt-api, jjwt-impl, jjwt-jackson).\n*   **Configuraci√≥n:**\n    *   Variables de entorno: `METABASE_SECRET_KEY`.\n    *   `application.properties`: `metabase.site.url`, `metabase.secret.key`, `metabase.embedding.dashboards.*.roles`.\n*   **Stack Principal:** Backend: Spring Boot, Frontend: React\n\n## 3. Implementaci√≥n Paso a Paso\n\n### 3.1 Backend (Spring Boot)\n*   **Paso 1: A√±adir Dependencias JWT**\n    *   **Archivo:** `pom.xml`\n    *   **Objetivo:** Incluir las librer√≠as necesarias para firmar los tokens de embedding.\n    *   **C√≥digo:**\n        ```xml\n        <dependency>\n            <groupId>io.jsonwebtoken</groupId>\n            <artifactId>jjwt-api</artifactId>\n            <version>0.12.3</version>\n        </dependency>\n        <dependency>\n            <groupId>io.jsonwebtoken</groupId>\n            <artifactId>jjwt-impl</artifactId>\n            <version>0.12.3</version>\n            <scope>runtime</scope>\n        </dependency>\n        <dependency>\n            <groupId>io.jsonwebtoken</groupId>\n            <artifactId>jjwt-jackson</artifactId>\n            <version>0.12.3</version>\n            <scope>runtime</scope>\n        </dependency>\n        ```\n    *   **Validaci√≥n:** El proyecto compila y las depende"
    },
    {
      "path": ".gemini/blueprints/refactorizacion_frontend_v4.md",
      "excerpt": "# Blueprint: Refactorizaci√≥n de Frontend para Sincronizaci√≥n con API de Ingesta (v4.0)\n\nEste documento detalla el plan de acci√≥n para refactorizar la vista de Ingesta de Datos y establecer una estrategia de calidad robusta. **Versi√≥n 4.0 incorpora feedback de QA avanzado para m√°xima robustez, seguridad y mantenibilidad.**\n\n---\n## 1. Plan de Implementaci√≥n\n\n### Archivo: `package.json`\n*   **Resumen de Cambios:**\n    1.  Se a√±adir√° la dependencia `axios`.\n    2.  Se a√±adir√°n las dependencias de desarrollo: `vitest`, `msw`, `@testing-library/react`.\n\n### Archivo: `src/types/api.ts` (Nuevo)\n*   **Resumen de Cambios:**\n    1.  Se definir√°n los tipos para los DTOs de √©xito y error, usando uniones literales para `status`.\n\n*   **C√≥digo a Crear:**\n    ```typescript\n    // DTOs de √âxito\n    export type JobStatus = 'INICIADO' | 'EXITO' | 'FALLO';\n\n    export interface StartProcessResponse {\n      jobId: string;\n      fileName: string;\n      status: 'INICIADO';\n    }\n\n    export interface EtlJobStatusDto {\n      jobId: string;\n      fileName: string;\n      status: JobStatus;\n      details: string | null;\n      minDate: string | null;\n      maxDate: string | null;\n      createdAt: string | null;\n      finishedAt: string | null;\n    }\n\n    // DTOs de Error\n    export interface StandardError {\n      error: string;\n      message: string;\n      timestamp: string;\n    }\n\n    // Estado local para la UI\n    export interface EtlJob extends EtlJobStatusDto {}\n    ```\n\n### Archivo: `src/utils/apiError.ts` (Nuevo)\n*   **Resumen de Cambios:**\n    1.  Se crear√° un helper robusto para parsear errores de `axios`.\n\n*   **C√≥digo a Crear:**\n    ```typescript\n    import axios from 'axios';\n\n    export interface ParsedApiError {\n      status: number;\n      message: string;\n      code: string;\n    }\n\n    export const parseApiError = (error: unknown): ParsedApiError => {\n      if (axios.isAxiosError(error)) {\n        const status = error.response?.status ?? 0;\n        const data = error.response?.da"
    },
    {
      "path": ".gemini/blueprints/IOC-022-etl-hardening-idempotency-dedup.md",
      "excerpt": "# Blueprint: Hardening ETL ‚Äì Idempotencia, De-duplicaci√≥n, Concurrencia y Observabilidad\n\n## 1. Objetivo y Alcance\n* **Objetivo:** Endurecer el pipeline ETL para garantizar: (a) no duplicaci√≥n l√≥gica, (b) reemplazo seguro por rango de fechas, (c) protecci√≥n contra ejecuciones concurrentes solapadas, (d) diagn√≥sticos r√°pidos ante fallas y (e) m√©tricas de salud y rendimiento.\n* **Alcance:** Fact table `fact_production` y dimensiones `dim_maquina`, `dim_maquinista`. No aborda a√∫n mejoras de streaming ni COPY.\n* **No Incluye:** Cambios funcionales del parser m√°s all√° de la deduplicaci√≥n interna; optimizaci√≥n JDBC/COPY (queda como futura fase si el batching JPA no alcanza SLA).\n\n## 2. Justificaci√≥n Estrat√©gica\n| Riesgo Actual | Impacto | Mitigaci√≥n en este Blueprint |\n|--------------|---------|------------------------------|\n| Duplicados intra-file | Inflado de m√©tricas, inconsistencias | De-dup en parser + UNIQUE natural key |\n| Overlap de ejecuciones | Corrupci√≥n parcial de rango | Advisory lock (global o por rango) |\n| Falta de natural key | Dificultad para detectar anomal√≠as | Definici√≥n + constraint |\n| Secuencia desalineada (casos legado) | Violaciones PK | Verificaci√≥n y realineo condicional |\n| Log ruidoso | Dificulta troubleshooting | Nivel TRACE para duplicados |\n| Sin m√©tricas de proceso | Ceguera operacional | Contadores + duraci√≥n |\n| Falta plan rollback constraint | Downtime extendido | Procedimiento de reversi√≥n documentado |\n\n## 3. Prerrequisitos\n* Acceso SQL (supabase) para ejecutar DDL.\n* Revisi√≥n de datos existentes (conteo, duplicados potenciales).\n* Confirmar que la aplicaci√≥n ya usa `SEQUENCE` para `fact_production.id`.\n\n## 4. Definici√≥n de Clave Natural Candidata\nPropuesta (ajustar si negocio indica otra):\n```\n(fecha_contabilizacion, maquina_fk, COALESCE(maquinista_fk, 0), numero_log)\n```\n**Checklist Validaci√≥n:**\n- `numero_log` es √∫nico dentro de la combinaci√≥n m√°quina + fecha + (maquinista opcional).  \n- `maquinista_fk` puede ser NULL ‚Üí se normal"
    },
    {
      "path": ".gemini/blueprints/ftv-file-validator.md",
      "excerpt": "# FTV-001: FileValidator (Servicio)\n\n## Metadata\n- **ID**: FTV-001\n- **Technical Design**: TD-001-validacion-carga-archivos-etl-v2.md\n- **Tipo**: Servicio (Service/Utility)\n- **Ubicaci√≥n**: `src/services/FileValidator.ts`\n- **Sprint**: Sprint 2\n- **Fecha Creaci√≥n**: 2025-10-19\n- **Estado**: Draft\n\n---\n\n## 1. Prop√≥sito\n\n### 1.1. Descripci√≥n\nServicio utilitario que valida archivos TXT del proceso ETL en el lado del cliente antes de subirlos al backend. Implementa validaciones progresivas (extensi√≥n, tama√±o, encoding, headers, muestreo de datos) y retorna un resultado estructurado con errores, warnings y resumen.\n\n### 1.2. Caso de Uso\n```\nComo administrador que carga archivos ETL,\nCuando selecciono un archivo en el dropzone,\nEntonces el sistema valida el archivo usando FileValidator,\nPara mostrarme inmediatamente si hay errores sin esperar el upload al servidor.\n```\n\n### 1.3. Ubicaci√≥n en la App\n- Invocado por el hook `useFileValidation`\n- Usado en `DataUploadDropzone` antes de permitir la carga\n- No tiene UI propia (servicio puro)\n\n---\n\n## 2. API P√∫blica del Servicio\n\n### 2.1. Funci√≥n Principal: `validateFile`\n\n```typescript\n/**\n * Valida un archivo TXT para el proceso ETL\n * @param file - Archivo a validar\n * @param config - Configuraci√≥n de validaci√≥n\n * @returns Resultado de validaci√≥n con errores, warnings y resumen\n */\nexport async function validateFile(\n  file: File,\n  config: FileValidationConfig\n): Promise<ValidationResult>\n```\n\n### 2.2. Configuraci√≥n\n\n```typescript\nexport interface FileValidationConfig {\n  maxBytes: number;              // 50 * 1024 * 1024 (50MB)\n  headerExpected: string[];      // Encabezados esperados\n  previewLines: number;          // 14\n  sampleLines: number;           // 10\n  readBytes: number;             // 100 * 1024\n  delimiter: '|' | ';' | ',';    // '|'\n  skipValidationLines: number[]; // [4] - l√≠nea de totales SAP\n  strictMode: true;\n  locale: 'es' | 'en';\n  featureFlagEnabled: boolean;\n}\n```\n\n### 2.3. Tipos de Retorno\n\n```typesc"
    },
    {
      "path": ".gemini/blueprints/IOC-006a-metabase-embedding-integration-v2.md",
      "excerpt": "# Blueprint: Visualizaci√≥n de Dashboards con Metabase (v2 - Refined)\n\nEsta gu√≠a detalla el proceso paso a paso para implementar la funcionalidad de incrustaci√≥n de dashboards de Metabase.\n\n## 1. Objetivo y Alcance\n*   **Objetivo:** Permitir que los usuarios vean dashboards de Metabase de forma segura y filtrada dentro de la aplicaci√≥n IOC, cumpliendo con la historia de usuario IOC-006a.\n*   **Stack Tecnol√≥gico Involucrado:** Spring Boot, React, Docker, Metabase.\n*   **Contexto Adicional:** La implementaci√≥n se basar√° en el m√©todo de Static (Signed) Embedding de Metabase para garantizar la seguridad con la versi√≥n Open Source.\n\n## 2. Prerrequisitos\n*   **Dependencias:** Investigar si el proyecto ya usa una librer√≠a JWT. Si no, a√±adir `io.jsonwebtoken`.\n*   **Configuraci√≥n:** Variable de entorno `METABASE_SECRET_KEY`.\n*   **Stack Principal:** Backend: Spring Boot, Frontend: React.\n\n## 3. Implementaci√≥n Paso a Paso\n\n### 3.1 Backend (Spring Boot)\n\n*   **Paso 1: Configuraci√≥n Robusta (`application.properties` y Clase de Configuraci√≥n)**\n    *   **Archivo:** `application.properties`\n    *   **Objetivo:** Definir una configuraci√≥n escalable para los dashboards y sus permisos.\n    *   **C√≥digo:**\n        ```properties\n        metabase.site.url=http://localhost:3000\n        metabase.secret.key=${METABASE_SECRET_KEY}\n\n        # Configuraci√≥n de Dashboards Permitidos (formato de lista)\n        metabase.dashboards[0].id=5\n        metabase.dashboards[0].name=Dashboard Gerencial\n        metabase.dashboards[0].allowedRoles=ROLE_ADMIN,ROLE_MANAGER\n        metabase.dashboards[1].id=6\n        metabase.dashboards[1].name=Dashboard Operacional\n        metabase.dashboards[1].allowedRoles=ROLE_USER,ROLE_ADMIN\n        ```\n    *   **Archivo:** `src/main/java/com/cambiaso/ioc/config/MetabaseProperties.java`\n    *   **Objetivo:** Crear una clase para cargar la configuraci√≥n de forma segura y tipada.\n    *   **C√≥digo:**\n        ```java\n        import lombok.Data;\n        import org.springfram"
    },
    {
      "path": ".gemini/blueprints/refactorizacion_frontend_v5.md",
      "excerpt": "# Blueprint: Refactorizaci√≥n de Frontend para Sincronizaci√≥n con API de Ingesta (v5.0 - Final)\n\nEste documento detalla el plan de acci√≥n para refactorizar la vista de Ingesta de Datos. **Versi√≥n 5.0 es la versi√≥n final, incorporando cancelaci√≥n de peticiones e inyecci√≥n de proveedor de token para m√°xima robustez.**\n\n---\n## 1. Plan de Implementaci√≥n\n\n### Archivo: `package.json`\n*   **Acci√≥n:** A√±adir `axios`, `vitest`, `msw`, `@testing-library/react`.\n\n### Archivo: `src/types/api.ts` (Nuevo)\n*   **Acci√≥n:** Crear el archivo con las interfaces `JobStatus`, `StartProcessResponse`, `EtlJobStatusDto`, `StandardError`, y `EtlJob`.\n\n### Archivo: `src/utils/apiError.ts` (Nuevo)\n*   **Acci√≥n:** Crear el helper `parseApiError` para un manejo de errores consistente.\n\n### Archivo: `src/services/apiService.ts` (Nuevo)\n*   **Resumen de Cambios:**\n    1.  Implementar el sistema de \"Token Provider\" inyectable.\n    2.  A√±adir soporte para `AbortSignal` en la funci√≥n de subida de archivos.\n    3.  Incluir un helper para `Retry-After`.\n\n*   **C√≥digo a Implementar:**\n    ```typescript\n    import axios from 'axios';\n    import type { StartProcessResponse, EtlJobStatusDto } from '../types/api';\n\n    type TokenProvider = () => Promise<string | null> | string | null;\n\n    let getToken: TokenProvider = () => { /* ... (implementaci√≥n de fallback) ... */ };\n\n    export const setTokenProvider = (provider: TokenProvider) => {\n      getToken = provider;\n    };\n\n    export const apiClient = axios.create({ /* ... */ });\n\n    apiClient.interceptors.request.use(async (config) => { /* ... */ });\n    apiClient.interceptors.response.use( (response) => response, async (error) => { /* ... */ });\n\n    export const getRetryAfterMs = (retryAfter?: string | null): number | null => {\n      if (!retryAfter) return null;\n      const seconds = Number(retryAfter);\n      return Number.isFinite(seconds) ? Math.max(0, seconds * 1000) : null;\n    };\n\n    export const startEtlProcess = async (\n      file: File,\n      "
    },
    {
      "path": ".gemini/blueprints/02-FTV-ingesta-de-datos.md",
      "excerpt": "## Metadatos de la Ficha T√©cnica\n*   **ID:** `FTV-2/4`\n*   **Vista:** `Ingesta de Datos`\n---\n\n# Ficha T√©cnica de Vista: Ingesta de Datos (v1.4)\n\n## 1. Misi√≥n y Flujo de Usuario\n*   **Misi√≥n de la Vista:** Permitir al administrador cargar archivos de producci√≥n CSV de manera segura, proporcionando feedback claro e inmediato sobre el resultado del proceso de validaci√≥n e ingesta.\n*   **Flujo de Usuario Clave:**\n    1.  El administrador navega a la secci√≥n \"Ingesta de Datos\" (`DataIngestionPage`).\n    2.  Arrastra un archivo CSV al componente `DataUploadDropzone`.\n    3.  El sistema muestra el estado de carga.\n    4.  Al finalizar, se muestra un `Alert` de √©xito o error. Si hay error, el `UploadHistoryTable` muestra la fila fallida con un bot√≥n para ver detalles.\n    5.  El administrador hace clic en \"Ver Detalles\" para abrir el `ErrorLogModal`.\n\n## 2. Arquitectura de Componentes\nEsta vista se renderiza dentro del `AppLayout` y se compone de la siguiente jerarqu√≠a:\n\n### A. Componentes Reutilizados\n*   **Del Proyecto (`@src/`):** `PageBreadcrumb`, `Alert`, `Table`, `Modal`, `Button`, `FileInput`.\n\n### B. Nuevos Componentes a Crear\n#### B.1. Componente de P√°gina (Orquestador)\n*   **Nombre:** `DataIngestionPage.tsx`\n*   **Responsabilidad:** Orquestar la vista, gestionar el estado de carga/error del archivo, la respuesta de la API y los datos del historial.\n\n#### B.2. Componentes de UI (Reutilizables)\n*   **Nombre:** `DataUploadDropzone.tsx`\n*   **Responsabilidad:** Gestionar la selecci√≥n de archivos y mostrar el estado visual correspondiente.\n*   **Interfaz de Props (Props Interface):**\n    ```typescript\n    interface DataUploadDropzoneProps {\n      onFileSelect: (file: File) => void;\n      isUploading: boolean;\n      \"data-testid\"?: string;\n    }\n    ```\n*   **Nombre:** `UploadHistoryTable.tsx`\n*   **Responsabilidad:** Mostrar una tabla paginada con el historial de cargas.\n*   **Interfaz de Props (Props Interface):**\n    ```typescript\n    interface UploadHistoryTableProp"
    },
    {
      "path": ".gemini/blueprints/IOC-021-update-password-flow.md",
      "excerpt": "# Blueprint: Actualizaci√≥n de Contrase√±a Post-Reseteo\n\nEsta gu√≠a detalla el proceso paso a paso para implementar la funcionalidad que permite a un usuario actualizar su contrase√±a despu√©s de haber solicitado un reseteo.\n\n## 1. Objetivo y Alcance\n*   **Objetivo:** Crear una p√°gina segura y funcional en la ruta `/update-password` donde los usuarios puedan establecer una nueva contrase√±a tras hacer clic en el enlace de recuperaci√≥n enviado a su correo.\n*   **Stack Tecnol√≥gico Involucrado:** React, TypeScript, Supabase, React Router, Tailwind CSS.\n\n## 2. Prerrequisitos\n*   **Dependencias:** No se requieren nuevas dependencias. Se utilizar√°n las existentes (`@supabase/supabase-js`, `react-router-dom`).\n*   **Configuraci√≥n:** La URL de redirecci√≥n en el componente `ResetPasswordForm.tsx` debe apuntar a `/update-password`.\n\n## 3. Implementaci√≥n Paso a Paso\n\n### 3.1 Frontend (React)\n*   **Paso 1: Crear el Componente del Formulario (`UpdatePasswordForm.tsx`)**\n    *   **Prop√≥sito:** Este componente contendr√° el formulario y la l√≥gica para actualizar la contrase√±a del usuario. Manejar√° el evento `PASSWORD_RECOVERY` de Supabase.\n    *   **Archivo:** `src/components/auth/UpdatePasswordForm.tsx`\n    *   **C√≥digo:**\n        ```tsx\n        import { useState, useEffect } from \"react\";\n        import { useNavigate } from \"react-router-dom\";\n        import { supabase } from \"../../lib/supabaseClient\";\n        import Label from \"../form/Label\";\n        import Input from \"../form/input/InputField\";\n        import Button from \"../ui/button/Button\";\n\n        export default function UpdatePasswordForm() {\n          const [password, setPassword] = useState(\"\");\n          const [confirmPassword, setConfirmPassword] = useState(\"\");\n          const [loading, setLoading] = useState(false);\n          const [message, setMessage] = useState(\"\");\n          const [error, setError] = useState(\"\");\n          const navigate = useNavigate();\n\n          useEffect(() => {\n            const { data: { subs"
    },
    {
      "path": ".gemini/blueprints/task-ingesta-back-implementation-plan.md",
      "excerpt": "# Blueprint de Implementaci√≥n: Ingesta Asincr√≥nica (v3 - Refined)\n\n## 1. Objetivo\nEste documento es la gu√≠a de implementaci√≥n detallada para construir el ETL dimensional asincr√≥nico. Cada tarea est√° dise√±ada para ser ejecutada en secuencia, construyendo la funcionalidad de manera incremental y verificable.\n\n---\n\n### **Fase 1: Cimientos - Capa de Persistencia y Entidades**\n*Objetivo: Establecer el mapeo Objeto-Relacional (ORM) y asegurar la conectividad con la base de datos.*\n\n*   **[ ] `TASK-INGESTA-01`:** Mapear Entidades de Dimensi√≥n y Gobernanza\n    *   **Propietario:** Jaime Vicencio (Backend)\n    *   **Acci√≥n:** Crear las siguientes clases de entidad JPA en el paquete `com.cambiaso.ioc.persistence.entity`:\n        *   `DimMaquina`: Mapea la tabla `dim_maquina`.\n        *   `DimMaquinista`: Mapea la tabla `dim_maquinista`.\n        *   `EtlJob`: Mapea la tabla `etl_jobs`. Usar `UUID` para `jobId`.\n        *   `QuarantinedRecord`: Mapea la tabla `quarantined_records`.\n    *   **Verificaci√≥n:**\n        *   **√âxito:** La aplicaci√≥n arranca y las tablas son reconocidas por Hibernate.\n\n*   **[ ] `TASK-INGESTA-02`:** Mapear Entidad de Hechos con Clave Compuesta\n    *   **Propietario:** Jaime Vicencio (Backend)\n    *   **Dependencias:** `TASK-INGESTA-01`.\n    *   **Acci√≥n:**\n        1.  Crear una clase `@Embeddable` llamada `FactProductionId` que contenga `id` y `fechaContabilizacion`.\n        2.  Crear la entidad `FactProduction` que mapea la tabla `fact_production` y usa `@EmbeddedId` para la clave compuesta.\n    *   **Verificaci√≥n:**\n        *   **√âxito:** La aplicaci√≥n arranca y la relaci√≥n de clave compuesta es manejada correctamente por Hibernate.\n\n*   **[ ] `TASK-INGESTA-03`:** Crear Repositorios JPA\n    *   **Propietario:** Jaime Vicencio (Backend)\n    *   **Dependencias:** `TASK-INGESTA-02`.\n    *   **Acci√≥n:** Crear las interfaces de Spring Data JPA correspondientes para todas las entidades en el paquete `com.cambiaso.ioc.persistence.repository`.\n    *   **Ver"
    },
    {
      "path": ".gemini/blueprints/IOC-021-Supabase_Auth.md",
      "excerpt": "# IMPLEMENTATION_GUIDE-Supabase_Auth.md\n\nThis document outlines the step-by-step process for integrating Supabase Authentication into our Vite + React application.\n\n## 1. Overview & Objectives\n\n*   **Primary Goal:** To implement a complete, secure, and user-friendly authentication flow using Supabase, including user sign-up, sign-in, sign-out, and session management.\n*   **Key Features:**\n    *   Email/Password based sign-up and sign-in.\n    *   Protected routes accessible only to authenticated users.\n    *   A global authentication context (Auth Provider) to manage user state across the application.\n    *   Redirects for unauthenticated users.\n\n## 2. Prerequisites & Setup\n\n*   **Dependencies:** We will add the official Supabase client library.\n    *   Run the following command in your terminal:\n        ```bash\n        npm install @supabase/supabase-js\n        ```\n*   **Environment Variables:** Create a new file named `.env` in the root of the project (next to `package.json`) and add the following variables. You can find these keys in your Supabase project dashboard under `Settings` > `API`.\n\n    ```env\n    VITE_SUPABASE_URL=\"YOUR_SUPABASE_PROJECT_URL\"\n    VITE_SUPABASE_ANON_KEY=\"YOUR_SUPABASE_ANON_KEY\"\n    ```\n\n## 3. Step-by-Step Implementation\n\n### Step 3.1: Initialize Supabase Client\nCreate a new file to initialize and export a singleton Supabase client. This ensures we use a single instance throughout the app.\n\n*   **File Location:** `src/lib/supabaseClient.ts`\n*   **Code:**\n    ```typescript\n    import { createClient } from '@supabase/supabase-js';\n\n    const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n    const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n    if (!supabaseUrl || !supabaseAnonKey) {\n      throw new Error(\"Supabase URL and Anon Key must be defined in the environment variables.\");\n    }\n\n    export const supabase = createClient(supabaseUrl, supabaseAnonKey);\n    ```\n\n### Step 3.2: Create the Authentication Provider\nDesign a Rea"
    },
    {
      "path": ".gemini/blueprints/refactorizacion_frontend.md",
      "excerpt": "# Blueprint: Refactorizaci√≥n de Frontend para Sincronizaci√≥n con API de Ingesta\n\nEste documento detalla el plan de acci√≥n para refactorizar la vista de Ingesta de Datos del frontend, aline√°ndola con la API as√≠ncrona y robusta del backend.\n\n---\n## Archivo: `package.json`\n**Resumen de Cambios:**\n1.  A√±adir la dependencia `axios` (si no existe) para gestionar las peticiones HTTP.\n2.  (Opcional, recomendado) A√±adir `react-query` o similar si se decide gestionar el polling con queries.\n\n**Justificaci√≥n:**\nSe necesita un cliente HTTP robusto para manejar la comunicaci√≥n con la API, incluyendo la configuraci√≥n de interceptores para la autenticaci√≥n JWT. Una librer√≠a de queries puede simplificar polling y estados.\n\n---\n## Archivo: `src/types/api.ts` (Nuevo o a actualizar)\n**Resumen de Cambios:**\n1.  Centralizar todas las definiciones de tipos de la API.\n2.  Definir interfaces para los DTOs de respuesta y error del backend, con estados como uniones literales.\n\n**C√≥digo a Crear/Actualizar:**\n```typescript\n// DTOs de √âxito\nexport type EtlStatus = 'INICIADO' | 'EXITO' | 'FALLO';\n\nexport interface StartProcessResponse {\n  jobId: string;\n  fileName: string;\n  status: EtlStatus; // \"INICIADO\"\n}\n\nexport interface EtlJobStatusDto {\n  jobId: string;\n  fileName: string;\n  status: EtlStatus; // \"INICIADO\" | \"EXITO\" | \"FALLO\"\n  details: string | null;\n  minDate: string | null; // YYYY-MM-DD\n  maxDate: string | null; // YYYY-MM-DD\n  createdAt: string | null; // ISO datetime\n  finishedAt: string | null; // ISO datetime\n}\n\n// DTOs de Error\nexport interface StandardError {\n  error: string;\n  message: string;\n  timestamp: string;\n}\n\nexport interface UnauthorizedError {\n  timestamp: string;\n  status: 401;\n  error: 'Unauthorized' | string;\n  message: string;\n  path: string;\n}\n\nexport interface ForbiddenError {\n  timestamp: string;\n  status: 403;\n  error: 'Forbidden' | string;\n  message: string;\n  path: string;\n}\n\nexport type AnyApiError = StandardError | UnauthorizedError | ForbiddenError;\n\nex"
    },
    {
      "path": ".gemini/blueprints/ftv-file-preview.md",
      "excerpt": "# FTV-003: FilePreview (Componente UI)\n\n## Metadata\n- **ID**: FTV-003\n- **Technical Design**: TD-001-validacion-carga-archivos-etl-v2.md\n- **Tipo**: UI Component (Presentacional)\n- **Ubicaci√≥n**: `src/components/FilePreview.tsx`\n- **Sprint**: Sprint 2\n- **Fecha Creaci√≥n**: 2025-10-19\n- **Estado**: Draft\n\n---\n\n## 1. Prop√≥sito\n\n### 1.1. Descripci√≥n\nComponente de UI que muestra las primeras 14 l√≠neas de un archivo de texto con n√∫meros de l√≠nea, escapando el contenido para prevenir XSS. Incluye scroll si el contenido excede el espacio disponible.\n\n### 1.2. Caso de Uso\n```\nComo usuario que est√° validando un archivo,\nCuando el archivo pasa la validaci√≥n inicial,\nEntonces veo un preview de las primeras 14 l√≠neas,\nPara verificar visualmente que el contenido es correcto.\n```\n\n### 1.3. Ubicaci√≥n en la App\n- Mostrado en `DataIngestionPage` despu√©s de seleccionar un archivo\n- Ubicado encima de `FileValidationResult`\n- Siempre visible durante el proceso de validaci√≥n (requisito del TD)\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe\n\n```\n‚îå‚îÄ Preview del Archivo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Mostrando primeras 14 l√≠neas de produccion_2024-01-15.txt          ‚îÇ\n‚îÇ                                                                      ‚îÇ\n‚îÇ  1  Fecha de contabilizaci√≥n|M√°quina|N√∫mero de Log...                ‚îÇ\n‚îÇ  2  15/01/2024|MAQ001|1234567...                                     ‚îÇ\n‚îÇ  3  15/01/2024|MAQ002|1234568...                                     ‚îÇ\n‚îÇ  4  [TOTALES SAP - L√≠nea ignorada en validaci√≥n] üîµ                  ‚îÇ\n‚îÇ  5  15/01/2024|MAQ003|1234569...                                     ‚îÇ\n‚îÇ  6  15/01/2024|MAQ004|1234570...                                     ‚îÇ\n‚îÇ  7  15/01/2024|MAQ005|1234571...                                     ‚îÇ\n‚îÇ  8  15/01/2024|MAQ006|1234572...                                     ‚îÇ\n‚îÇ  9  15/01/2024|MAQ007|1234573...                                     ‚îÇ\n‚îÇ 10  15/01/2024|MAQ008|1234574...                                     ‚îÇ\n‚îÇ 11  15"
    },
    {
      "path": ".gemini/blueprints/04-FTV-acceso-y-seguridad.md",
      "excerpt": "## Metadatos de la Ficha T√©cnica\n*   **ID:** `FTV-4/4`\n*   **Vista:** `Acceso y Seguridad`\n---\n\n# Ficha T√©cnica de Vista: Acceso y Seguridad (v1.4)\n\n## 1. Misi√≥n y Flujo de Usuario\n*   **Misi√≥n de la Vista:** Proporcionar al administrador un control centralizado y seguro sobre el ciclo de vida de los usuarios y la granularidad de sus permisos, garantizando que el acceso a los datos cumpla con las pol√≠ticas de la compa√±√≠a.\n*   **Flujo de Usuario Clave:**\n    1.  El administrador navega a \"Acceso y Seguridad\" (`AccessSecurityPage`).\n    2.  En la pesta√±a \"Gesti√≥n de Usuarios\", abre el `UserCreateModal` para crear un nuevo usuario.\n    3.  Asigna un rol predefinido al nuevo usuario.\n    4.  Navega a la pesta√±a \"Gesti√≥n de Roles\" para abrir el `PermissionsMatrixModal` y ajustar los permisos de dicho rol.\n\n## 2. Arquitectura de Componentes\nEsta vista se renderiza dentro del `AppLayout` y utilizar√° un componente de Pesta√±as (`Tabs`) para organizar sus dos sub-secciones.\n\n### A. Componentes Reutilizados\n*   **Del Proyecto (`@src/`):** `PageBreadcrumb`, `Table`, `Modal`, `Button`, `Input`, `Select`, `Checkbox`, `Dropdown`, `Alert`.\n\n### B. Nuevos Componentes a Crear\n#### B.1. Componente de P√°gina (Orquestador)\n*   **Nombre:** `AccessSecurityPage.tsx`\n*   **Responsabilidad:** Orquestar las sub-vistas, gestionar el estado de la pesta√±a activa y los datos compartidos (lista de usuarios y roles).\n\n#### B.2. Componentes de UI (Reutilizables)\n*   **Nombre:** `UsersDataTable.tsx`\n*   **Responsabilidad:** Mostrar una tabla paginada y con capacidad de b√∫squeda de todos los usuarios del sistema.\n*   **Interfaz de Props (Props Interface):**\n    ```typescript\n    interface UsersDataTableProps {\n      users: UserData[];\n      currentUserEmail: string; // Para identificar al usuario actual\n      onEditRole: (userId: string) => void;\n      onDeleteUser: (userId: string) => void;\n      \"data-testid\"?: string;\n    }\n    ```\n*   **Nombre:** `UserCreateModal.tsx`\n*   **Responsabilidad:** Un f"
    },
    {
      "path": ".gemini/blueprints/IOC-006a-metabase-embedding-integration-v3.md",
      "excerpt": "# üìê DOCUMENTO 2: BLUEPRINT DE IMPLEMENTACI√ìN\n\n# Blueprint: Visualizaci√≥n de Dashboards con Metabase (v3 - Production Ready)\n\n## Estructura de Directorios del Proyecto\n\n```\nioc-project/\n‚îú‚îÄ‚îÄ backend/\n‚îÇ   ‚îî‚îÄ‚îÄ src/\n‚îÇ       ‚îú‚îÄ‚îÄ main/\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ java/com/cambiaso/ioc/\n‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/\n‚îÇ       ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MetabaseProperties.java ‚ú® NUEVO\n‚îÇ       ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CorsConfig.java ‚ú® NUEVO\n‚îÇ       ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SecurityConfig.java (MODIFICAR)\n‚îÇ       ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CacheConfig.java ‚ú® NUEVO\n‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/\n‚îÇ       ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DashboardController.java ‚ú® NUEVO\n‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/\n‚îÇ       ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MetabaseEmbeddingService.java ‚ú® NUEVO\n‚îÇ       ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DashboardAuditService.java ‚ú® NUEVO\n‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security/\n‚îÇ       ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CustomUserDetails.java ‚ú® NUEVO\n‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exception/\n‚îÇ       ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DashboardNotFoundException.java ‚ú® NUEVO\n‚îÇ       ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DashboardAccessDeniedException.java ‚ú® NUEVO\n‚îÇ       ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ GlobalExceptionHandler.java (MODIFICAR)\n‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ resources/\n‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ application.yml (MODIFICAR)\n‚îÇ       ‚îî‚îÄ‚îÄ test/\n‚îÇ           ‚îî‚îÄ‚îÄ java/com/cambiaso/ioc/\n‚îÇ               ‚îú‚îÄ‚îÄ service/\n‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ MetabaseEmbeddingServiceTest.java ‚ú® NUEVO\n‚îÇ               ‚îî‚îÄ‚îÄ controller/\n‚îÇ                   ‚îî‚îÄ‚îÄ DashboardControllerIntegrationTest.java ‚ú® NUEVO\n‚îî‚îÄ‚îÄ frontend/\n    ‚îî‚îÄ‚îÄ src/\n        ‚îú‚îÄ‚îÄ components/\n        ‚îÇ   ‚îú‚îÄ‚îÄ DashboardEmbed.tsx ‚ú® NUEVO\n        ‚îÇ   ‚îî‚îÄ‚îÄ ui/\n        ‚îÇ       ‚îú‚îÄ‚îÄ Spinner.tsx (USAR EXISTENTE)\n        ‚îÇ       ‚îî‚îÄ‚îÄ Alert.tsx (USAR EXISTENTE)\n        ‚îú‚îÄ‚îÄ types/\n        ‚îÇ   ‚îî‚îÄ‚îÄ dashboard.ts ‚ú® NUEVO\n        ‚îú‚îÄ‚îÄ hooks/\n        ‚îÇ   ‚îî‚îÄ‚îÄ useAuth.ts (USAR EXISTENTE)\n        ‚îî‚îÄ‚îÄ pages/\n            ‚îî‚îÄ‚îÄ DashboardsPage.tsx ‚ú® NUEVO (EJEMPLO)\n```\n\n---\n\n## Tareas T√©cnicas Derivadas\n\n### üî¥ SPRINT 1: Configuraci√≥n Base (P0)\n\n#### **BE-TASK-01**: A√±adir dependencias Maven\n\n**Archivo**: `pom.xml`\n**Estimaci√≥n**: 15 min\n\n```xml\n<!-- JWT -->\n<dependency>\n   "
    },
    {
      "path": ".gemini/blueprints/frontend/roles/ftv-role-assignment-modal.md",
      "excerpt": "# FTV-005: Role Assignment Modal\n\n**ID**: FTV-IOC-004-005  \n**Componente**: `RoleAssignmentModal`  \n**Tipo**: Feature Component (Modal)  \n**Padre**: `UserManagementPage`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nModal que permite asignar/remover m√∫ltiples roles a un usuario espec√≠fico con actualizaci√≥n optimista y feedback instant√°neo.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin click \"Manage Roles\" en UserRow\n2. Modal muestra usuario y roles actuales\n3. Admin toggle roles (on/off)\n4. Cada cambio se aplica inmediatamente (optimistic update)\n5. Backend confirma o rollback si error\n6. Admin cierra modal cuando termina\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Manage Roles - Juan P√©rez                           [√ó]   ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                            ‚îÇ\n‚îÇ  üë§ Juan P√©rez (juan@ioc.com)                             ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  Available Roles                                           ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ ‚òë ADMIN                                            ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ                                                     ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ   Acceso administrativo total al sistema           ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ   13 permissions                                    ‚îÇ   ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ ‚òê GERENTE      "
    },
    {
      "path": ".gemini/blueprints/frontend/roles/ftv-role-management-page.md",
      "excerpt": "# FTV-002: Role Management Page\n\n**ID**: FTV-IOC-004-002  \n**Componente**: `RoleManagementPage`  \n**Tipo**: Page Component  \n**Ruta**: `/admin/roles`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nP√°gina de administraci√≥n de roles del sistema que permite crear, editar, eliminar roles y gestionar permisos asociados a cada rol.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin accede a `/admin/roles`\n2. Ve lista de roles con conteo de usuarios y permisos asignados\n3. Puede crear nuevo rol, editar existente, o eliminar (si no est√° en uso)\n4. Puede asignar/remover permisos a roles\n5. Ve resumen de cu√°ntos usuarios tienen cada rol\n\n### 1.3. Ubicaci√≥n en la App\n```\nDashboard\n‚îî‚îÄ‚îÄ Admin Section\n    ‚îú‚îÄ‚îÄ User Management\n    ‚îî‚îÄ‚îÄ Role Management ‚Üê ESTA P√ÅGINA\n        ‚îî‚îÄ‚îÄ Permission Management\n```\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ IOC Platform - Role Management                      [Profile ‚ñæ]     ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Roles                                                                ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  [+ New Role]     ‚îÇ\n‚îÇ  ‚îÇ üîç Search roles...                          ‚îÇ                    ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
    },
    {
      "path": ".gemini/blueprints/frontend/roles/ftv-user-management-page.md",
      "excerpt": "# FTV-001: User Management Page\n\n**ID**: FTV-IOC-004-001  \n**Componente**: `UserManagementPage`  \n**Tipo**: Page Component  \n**Ruta**: `/admin/users`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nP√°gina principal de administraci√≥n de usuarios que permite a los administradores ver, crear, editar, eliminar y gestionar roles de usuarios del sistema IOC.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin accede a `/admin/users`\n2. Ve lista paginada de usuarios con filtros de b√∫squeda\n3. Puede crear nuevo usuario, editar existente, o eliminar (soft delete)\n4. Puede asignar/remover roles a usuarios mediante modal dedicado\n5. Puede filtrar por planta, estado activo, y buscar por nombre/email\n\n### 1.3. Ubicaci√≥n en la App\n```\nDashboard\n‚îî‚îÄ‚îÄ Admin Section\n    ‚îî‚îÄ‚îÄ User Management ‚Üê ESTA P√ÅGINA\n        ‚îú‚îÄ‚îÄ Role Management\n        ‚îî‚îÄ‚îÄ Permission Management\n```\n\n**Restricci√≥n de Acceso**: Solo usuarios con `ROLE_ADMIN`\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ IOC Platform - User Management                          [Profile ‚ñæ] ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Users                                                                ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  [+ New User]     ‚îÇ\n‚îÇ  ‚îÇ üîç Search by name or email...               ‚îÇ                    ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ"
    },
    {
      "path": ".gemini/blueprints/frontend/roles/ftv-permission-management-page.md",
      "excerpt": "# FTV-003: Permission Management Page\n\n**ID**: FTV-IOC-004-003  \n**Componente**: `PermissionManagementPage`  \n**Tipo**: Page Component  \n**Ruta**: `/admin/permissions`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nCat√°logo de permisos del sistema que permite crear, editar y eliminar permisos granulares que luego se asignan a roles.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin accede a `/admin/permissions`\n2. Ve grid de permisos disponibles con descripciones\n3. Puede crear nuevo permiso, editar existente, o eliminar (si no est√° asignado a roles)\n4. Los permisos se agrupan por categor√≠a (USER, ROLE, DASHBOARD, etc.)\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ IOC Platform - Permission Management                [Profile ‚ñæ]     ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Permissions                                                          ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  [+ New Permission]‚îÇ\n‚îÇ  ‚îÇ üîç Search permissions...                    ‚îÇ                    ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Category: [All ‚ñæ]                                                   ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  USER MANAGEMENT                                                     ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ\n"
    },
    {
      "path": ".gemini/blueprints/frontend/roles/ftv-user-form-modal.md",
      "excerpt": "# FTV-004: User Form Modal\n\n**ID**: FTV-IOC-004-004  \n**Componente**: `UserFormModal`  \n**Tipo**: Feature Component (Modal)  \n**Padre**: `UserManagementPage`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nModal que permite crear un nuevo usuario o editar uno existente con validaci√≥n en tiempo real y manejo de errores espec√≠ficos del backend.\n\n### 1.2. Casos de Uso\n\n**Modo CREATE**:\n1. Admin click \"New User\" ‚Üí Modal se abre vac√≠o\n2. Completa formulario (todos los campos requeridos)\n3. Submit ‚Üí POST /api/v1/admin/users\n4. Success ‚Üí Cierra modal, refresh lista, toast\n\n**Modo EDIT**:\n1. Admin click \"Edit\" en UserRow ‚Üí Modal se abre con datos precargados\n2. Modifica campos (email y supabaseUserId no editables)\n3. Submit ‚Üí PUT /api/v1/admin/users/{id}\n4. Success ‚Üí Actualiza lista, cierra modal\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII (Modo CREATE)\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Create User                                          [√ó]   ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                            ‚îÇ\n‚îÇ  Email *                                                   ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ user@example.com                                     ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ  ‚ÑπÔ∏è  Must be unique in the system                         ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  Supabase User ID *                                        ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ 123e4567-e89b-12d3-a456-426614174000                 ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  Fi"
    },
    {
      "path": ".gemini/blueprints/frontend/roles/README.md",
      "excerpt": "# Frontend Blueprints Index - IOC-004: User Role Management\n\n**Feature**: User, Role & Permission Management  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Sprint**: Sprint 3  \n**Fecha Generaci√≥n**: 2025-10-27  \n**Total FTVs**: 5\n\n---\n\n## üìã Resumen Ejecutivo\n\nEste √≠ndice lista todos los componentes frontend necesarios para implementar la gesti√≥n completa de usuarios, roles y permisos en la plataforma IOC. Los componentes cubren:\n\n- ‚úÖ Gesti√≥n de usuarios (CRUD completo)\n- ‚úÖ Gesti√≥n de roles y permisos\n- ‚úÖ Asignaci√≥n din√°mica de roles a usuarios\n- ‚úÖ Asignaci√≥n de permisos a roles (v√≠a modals)\n- ‚úÖ B√∫squeda, filtrado y paginaci√≥n\n- ‚úÖ Validaci√≥n en tiempo real\n- ‚úÖ Optimistic updates para mejor UX\n\n---\n\n## üìÑ Lista de FTVs Generados\n\n### Pages (Rutas Principales)\n\n#### FTV-001: User Management Page\n**Archivo**: `ftv-user-management-page.md`  \n**Componente**: `UserManagementPage`  \n**Ruta**: `/admin/users`  \n**Prop√≥sito**: P√°gina principal de administraci√≥n de usuarios con lista paginada, b√∫squeda, filtros y acciones CRUD.\n\n**Responsabilidades**:\n- Listar usuarios con paginaci√≥n (max 100 por p√°gina)\n- B√∫squeda por nombre/email (debounced)\n- Filtros por planta y estado activo\n- Crear nuevo usuario\n- Editar usuario existente\n- Eliminar usuario (soft delete)\n- Abrir modal de asignaci√≥n de roles\n\n**Endpoints Consumidos**:\n- GET `/api/v1/admin/users` (con query params)\n- POST `/api/v1/admin/users`\n- PUT `/api/v1/admin/users/{id}`\n- DELETE `/api/v1/admin/users/{id}`\n\n**Testing**: Unit tests, integration tests, E2E (Playwright)\n\n---\n\n#### FTV-002: Role Management Page\n**Archivo**: `ftv-role-management-page.md`  \n**Componente**: `RoleManagementPage`  \n**Ruta**: `/admin/roles`  \n**Prop√≥sito**: Administraci√≥n de roles del sistema con vista en cards mostrando usuarios asignados y permisos.\n\n**Responsabilidades**:\n- Listar roles con conteo de usuarios y permisos\n- Crear nuevo rol\n- Editar rol existente\n- Eliminar rol (solo si no est√° en uso)\n- Abrir modal de gest"
    },
    {
      "path": ".gemini/blueprints/frontend/roles-sin-refine/ftv-role-assignment-modal.md",
      "excerpt": "# FTV-005: Role Assignment Modal\n\n**ID**: FTV-IOC-004-005  \n**Componente**: `RoleAssignmentModal`  \n**Tipo**: Feature Component (Modal)  \n**Padre**: `UserManagementPage`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nModal que permite asignar/remover m√∫ltiples roles a un usuario espec√≠fico con actualizaci√≥n optimista y feedback instant√°neo.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin click \"Manage Roles\" en UserRow\n2. Modal muestra usuario y roles actuales\n3. Admin toggle roles (on/off)\n4. Cada cambio se aplica inmediatamente (optimistic update)\n5. Backend confirma o rollback si error\n6. Admin cierra modal cuando termina\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Manage Roles - Juan P√©rez                           [√ó]   ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                            ‚îÇ\n‚îÇ  üë§ Juan P√©rez (juan@ioc.com)                             ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  Available Roles                                           ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ ‚òë ADMIN                                            ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ                                                     ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ   Acceso administrativo total al sistema           ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ   13 permissions                                    ‚îÇ   ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ ‚òê GERENTE      "
    },
    {
      "path": ".gemini/blueprints/frontend/roles-sin-refine/ftv-role-management-page.md",
      "excerpt": "# FTV-002: Role Management Page\n\n**ID**: FTV-IOC-004-002  \n**Componente**: `RoleManagementPage`  \n**Tipo**: Page Component  \n**Ruta**: `/admin/roles`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nP√°gina de administraci√≥n de roles del sistema que permite crear, editar, eliminar roles y gestionar permisos asociados a cada rol.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin accede a `/admin/roles`\n2. Ve lista de roles con conteo de usuarios y permisos asignados\n3. Puede crear nuevo rol, editar existente, o eliminar (si no est√° en uso)\n4. Puede asignar/remover permisos a roles\n5. Ve resumen de cu√°ntos usuarios tienen cada rol\n\n### 1.3. Ubicaci√≥n en la App\n```\nDashboard\n‚îî‚îÄ‚îÄ Admin Section\n    ‚îú‚îÄ‚îÄ User Management\n    ‚îî‚îÄ‚îÄ Role Management ‚Üê ESTA P√ÅGINA\n        ‚îî‚îÄ‚îÄ Permission Management\n```\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ IOC Platform - Role Management                      [Profile ‚ñæ]     ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Roles                                                                ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  [+ New Role]     ‚îÇ\n‚îÇ  ‚îÇ üîç Search roles...                          ‚îÇ                    ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
    },
    {
      "path": ".gemini/blueprints/frontend/roles-sin-refine/ftv-user-management-page.md",
      "excerpt": "# FTV-001: User Management Page\n\n**ID**: FTV-IOC-004-001  \n**Componente**: `UserManagementPage`  \n**Tipo**: Page Component  \n**Ruta**: `/admin/users`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nP√°gina principal de administraci√≥n de usuarios que permite a los administradores ver, crear, editar, eliminar y gestionar roles de usuarios del sistema IOC.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin accede a `/admin/users`\n2. Ve lista paginada de usuarios con filtros de b√∫squeda\n3. Puede crear nuevo usuario, editar existente, o eliminar (soft delete)\n4. Puede asignar/remover roles a usuarios mediante modal dedicado\n5. Puede filtrar por planta, estado activo, y buscar por nombre/email\n\n### 1.3. Ubicaci√≥n en la App\n```\nDashboard\n‚îî‚îÄ‚îÄ Admin Section\n    ‚îî‚îÄ‚îÄ User Management ‚Üê ESTA P√ÅGINA\n        ‚îú‚îÄ‚îÄ Role Management\n        ‚îî‚îÄ‚îÄ Permission Management\n```\n\n**Restricci√≥n de Acceso**: Solo usuarios con `ROLE_ADMIN`\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ IOC Platform - User Management                          [Profile ‚ñæ] ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Users                                                                ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  [+ New User]     ‚îÇ\n‚îÇ  ‚îÇ üîç Search by name or email...               ‚îÇ                    ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ"
    },
    {
      "path": ".gemini/blueprints/frontend/roles-sin-refine/ftv-permission-management-page.md",
      "excerpt": "# FTV-003: Permission Management Page\n\n**ID**: FTV-IOC-004-003  \n**Componente**: `PermissionManagementPage`  \n**Tipo**: Page Component  \n**Ruta**: `/admin/permissions`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nCat√°logo de permisos del sistema que permite crear, editar y eliminar permisos granulares que luego se asignan a roles.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin accede a `/admin/permissions`\n2. Ve grid de permisos disponibles con descripciones\n3. Puede crear nuevo permiso, editar existente, o eliminar (si no est√° asignado a roles)\n4. Los permisos se agrupan por categor√≠a (USER, ROLE, DASHBOARD, etc.)\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ IOC Platform - Permission Management                [Profile ‚ñæ]     ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Permissions                                                          ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  [+ New Permission]‚îÇ\n‚îÇ  ‚îÇ üîç Search permissions...                    ‚îÇ                    ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Category: [All ‚ñæ]                                                   ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  USER MANAGEMENT                                                     ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ\n"
    },
    {
      "path": ".gemini/blueprints/frontend/roles-sin-refine/ftv-user-form-modal.md",
      "excerpt": "# FTV-004: User Form Modal\n\n**ID**: FTV-IOC-004-004  \n**Componente**: `UserFormModal`  \n**Tipo**: Feature Component (Modal)  \n**Padre**: `UserManagementPage`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Fecha Creaci√≥n**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nModal que permite crear un nuevo usuario o editar uno existente con validaci√≥n en tiempo real y manejo de errores espec√≠ficos del backend.\n\n### 1.2. Casos de Uso\n\n**Modo CREATE**:\n1. Admin click \"New User\" ‚Üí Modal se abre vac√≠o\n2. Completa formulario (todos los campos requeridos)\n3. Submit ‚Üí POST /api/v1/admin/users\n4. Success ‚Üí Cierra modal, refresh lista, toast\n\n**Modo EDIT**:\n1. Admin click \"Edit\" en UserRow ‚Üí Modal se abre con datos precargados\n2. Modifica campos (email y supabaseUserId no editables)\n3. Submit ‚Üí PUT /api/v1/admin/users/{id}\n4. Success ‚Üí Actualiza lista, cierra modal\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII (Modo CREATE)\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Create User                                          [√ó]   ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                            ‚îÇ\n‚îÇ  Email *                                                   ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ user@example.com                                     ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ  ‚ÑπÔ∏è  Must be unique in the system                         ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  Supabase User ID *                                        ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ 123e4567-e89b-12d3-a456-426614174000                 ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  Fi"
    },
    {
      "path": ".gemini/blueprints/frontend/roles-sin-refine/README.md",
      "excerpt": "# Frontend Blueprints Index - IOC-004: User Role Management\n\n**Feature**: User, Role & Permission Management  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md  \n**Sprint**: Sprint 3  \n**Fecha Generaci√≥n**: 2025-10-27  \n**Total FTVs**: 5\n\n---\n\n## üìã Resumen Ejecutivo\n\nEste √≠ndice lista todos los componentes frontend necesarios para implementar la gesti√≥n completa de usuarios, roles y permisos en la plataforma IOC. Los componentes cubren:\n\n- ‚úÖ Gesti√≥n de usuarios (CRUD completo)\n- ‚úÖ Gesti√≥n de roles y permisos\n- ‚úÖ Asignaci√≥n din√°mica de roles a usuarios\n- ‚úÖ Asignaci√≥n de permisos a roles (v√≠a modals)\n- ‚úÖ B√∫squeda, filtrado y paginaci√≥n\n- ‚úÖ Validaci√≥n en tiempo real\n- ‚úÖ Optimistic updates para mejor UX\n\n---\n\n## üìÑ Lista de FTVs Generados\n\n### Pages (Rutas Principales)\n\n#### FTV-001: User Management Page\n**Archivo**: `ftv-user-management-page.md`  \n**Componente**: `UserManagementPage`  \n**Ruta**: `/admin/users`  \n**Prop√≥sito**: P√°gina principal de administraci√≥n de usuarios con lista paginada, b√∫squeda, filtros y acciones CRUD.\n\n**Responsabilidades**:\n- Listar usuarios con paginaci√≥n (max 100 por p√°gina)\n- B√∫squeda por nombre/email (debounced)\n- Filtros por planta y estado activo\n- Crear nuevo usuario\n- Editar usuario existente\n- Eliminar usuario (soft delete)\n- Abrir modal de asignaci√≥n de roles\n\n**Endpoints Consumidos**:\n- GET `/api/v1/admin/users` (con query params)\n- POST `/api/v1/admin/users`\n- PUT `/api/v1/admin/users/{id}`\n- DELETE `/api/v1/admin/users/{id}`\n\n**Testing**: Unit tests, integration tests, E2E (Playwright)\n\n---\n\n#### FTV-002: Role Management Page\n**Archivo**: `ftv-role-management-page.md`  \n**Componente**: `RoleManagementPage`  \n**Ruta**: `/admin/roles`  \n**Prop√≥sito**: Administraci√≥n de roles del sistema con vista en cards mostrando usuarios asignados y permisos.\n\n**Responsabilidades**:\n- Listar roles con conteo de usuarios y permisos\n- Crear nuevo rol\n- Editar rol existente\n- Eliminar rol (solo si no est√° en uso)\n- Abrir modal de gest"
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/ftv-004-user-form-modal.md",
      "excerpt": "# FTV-IOC-004-004: User Form Modal\n\n**ID**: FTV-IOC-004-004  \n**Componente**: `UserFormModal`  \n**Tipo**: Modal Component  \n**Sprint**: Sprint 3 (IOC-004)  \n**Fecha**: 2025-10-28  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nModal reutilizable para crear y editar usuarios con validaci√≥n completa de formulario.\n\n### 1.2. Modos de Operaci√≥n\n- **Modo Create**: Todos los campos habilitados, incluido email y supabaseUserId\n- **Modo Edit**: Email y supabaseUserId readonly (no editables)\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ [X] Create User                                  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                  ‚îÇ\n‚îÇ  Email *                                         ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ user@cambiaso.com                          ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  Supabase User ID *                              ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ 123e4567-e89b-12d3-a456-426614174000       ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  First Name *          Second Name               ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ Juan           ‚îÇ    ‚îÇ Carlos             ‚îÇ   ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  First Lastname *      Second Lastname           ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ P√©rez          ‚îÇ    ‚îÇ Garc√≠a             ‚îÇ   ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  Plant                 Cost Center               ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ Lima ‚ñæ         ‚îÇ    ‚îÇ CC-001   "
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/ftv-008-role-badge.md",
      "excerpt": "# FTV-008: Role Badge Component\n\n## üìã Metadata\n\n- **ID:** ftv-008-role-badge\n- **Tipo:** Componente Reutilizable\n- **Feature:** IOC-004 User Role Management\n- **Technical Design:** TD-IOC-004-User-Role-Management-claude.md\n- **Parent:** ftv-001, ftv-002, ftv-003, ftv-005\n- **Versi√≥n:** 1.0\n- **Fecha:** 2025-10-28\n- **Autor:** Tech Lead (IA)\n- **Estado:** ‚úÖ Ready for Implementation\n\n---\n\n## üéØ Prop√≥sito\n\nComponente visual reutilizable para mostrar roles de usuario con colores consistentes adaptados al contexto chileno, iconos y estados. Debe ser accesible, responsivo y mantener la identidad visual del sistema IOC.\n\n---\n\n## üîß Props Interface\n\n```typescript\ninterface RoleBadgeProps {\n  /** Nombre del rol (ADMIN, GERENTE, ANALISTA) */\n  role: string;\n  \n  /** Tama√±o del badge */\n  size?: 'sm' | 'md' | 'lg';\n  \n  /** Mostrar icono */\n  showIcon?: boolean;\n  \n  /** Mostrar badge removible (con X) */\n  removable?: boolean;\n  \n  /** Callback cuando se remueve el badge */\n  onRemove?: (role: string) => void;\n  \n  /** Clase CSS adicional */\n  className?: string;\n  \n  /** Deshabilitar badge */\n  disabled?: boolean;\n}\n```\n\n---\n\n## üé® Dise√±o Visual\n\n### Variantes por Rol\n\n```typescript\nconst ROLE_VARIANTS = {\n  ADMIN: {\n    bg: 'bg-red-100 dark:bg-red-900',\n    text: 'text-red-800 dark:text-red-200',\n    border: 'border-red-200 dark:border-red-800',\n    icon: Shield,\n    label: 'Administrador'\n  },\n  GERENTE: {\n    bg: 'bg-blue-100 dark:bg-blue-900',\n    text: 'text-blue-800 dark:text-blue-200',\n    border: 'border-blue-200 dark:border-blue-800',\n    icon: UserCog,\n    label: 'Gerente'\n  },\n  ANALISTA: {\n    bg: 'bg-green-100 dark:bg-green-900',\n    text: 'text-green-800 dark:text-green-200',\n    border: 'border-green-200 dark:border-green-800',\n    icon: User,\n    label: 'Analista'\n  },\n  DEFAULT: {\n    bg: 'bg-gray-100 dark:bg-gray-800',\n    text: 'text-gray-800 dark:text-gray-200',\n    border: 'border-gray-200 dark:border-gray-700',\n    icon: HelpCircle,\n    label: 'Desconocido"
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/ftv-009-empty-state.md",
      "excerpt": "# FTV-IOC-004-009: Empty State Component\n\n**ID**: FTV-IOC-004-009  \n**Componente**: `EmptyState`  \n**Tipo**: Reusable UI Component  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md\n**Sprint**: Sprint 3 (IOC-004)  \n**Fecha**: 2025-10-28  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nComponente reutilizable para mostrar estados vac√≠os con ilustraci√≥n, mensaje contextualizado en espa√±ol chileno y acci√≥n opcional.\n\n### 1.2. Casos de Uso\n- Sin resultados de b√∫squeda\n- Sin usuarios registrados\n- Sin roles configurados\n- Sin permisos disponibles\n- Cualquier lista vac√≠a en la aplicaci√≥n\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                                         ‚îÇ\n‚îÇ              [  √çCONO  ]                ‚îÇ\n‚îÇ                                         ‚îÇ\n‚îÇ       No se encontraron usuarios        ‚îÇ\n‚îÇ                                         ‚îÇ\n‚îÇ   No hay usuarios que coincidan con tu  ‚îÇ\n‚îÇ     b√∫squeda. Intenta ajustar los       ‚îÇ\n‚îÇ              filtros.                   ‚îÇ\n‚îÇ                                         ‚îÇ\n‚îÇ          [ Limpiar Filtros ]            ‚îÇ\n‚îÇ                                         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n---\n\n## 3. Especificaci√≥n T√©cnica\n\n### 3.1. Props Interface\n\n```typescript\ninterface EmptyStateProps {\n  icon?: React.ReactNode;\n  title: string;\n  description?: string;\n  action?: React.ReactNode;\n  size?: \"sm\" | \"md\" | \"lg\";\n  className?: string;\n}\n```\n\n### 3.2. Size Mapping\n\n```typescript\nconst SIZE_CONFIG = {\n  sm: {\n    container: \"py-8\",\n    icon: \"w-12 h-12\",\n    title: \"text-lg\",\n    description: \"text-sm\",\n  },\n  md: {\n    container: \"py-12\",\n    icon: \"w-16 h-16\",\n    title: \"text-xl\",\n    description: \"text-base\",\n  },\n  lg: {\n    container: \"py-16\",\n    icon: \"w-20 h-20\",\n    title: \"text-2xl\",\n    description: \"text-lg\",\n  },\n} as const;\n```\n\n### 3.3. Estructura del Componente\n\n```typesc"
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/INDEX.md",
      "excerpt": "# IOC-004: Gesti√≥n de Usuarios, Roles y Permisos - √çndice de Vistas T√©cnicas Frontend (FTV)\n\n## üìã Descripci√≥n General\n\nEste √≠ndice documenta todos los Frontend Technical Views (FTVs) creados para implementar la funcionalidad de Gesti√≥n de Usuarios, Roles y Permisos basada en el Technical Design TD-IOC-004.\n\n**Dise√±o T√©cnico Base:** `.gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md`\n\n---\n\n## üéØ Alcance del Feature\n\nImplementar una interfaz administrativa completa para:\n- Gesti√≥n de usuarios (CRUD + asignaci√≥n de roles)\n- Gesti√≥n de roles (CRUD + asignaci√≥n de permisos)\n- Gesti√≥n de permisos (CRUD + visualizaci√≥n)\n- Visualizaci√≥n de relaciones y estados\n\n---\n\n## üìÅ Estructura de FTVs\n\n### P√°ginas Principales\n\n1. **[ftv-001-user-management-page.md](./ftv-001-user-management-page.md)**\n   - **Ruta:** `/admin/users`\n   - **Descripci√≥n:** P√°gina principal de gesti√≥n de usuarios con tabla, filtros, b√∫squeda y acciones CRUD\n   - **Componentes hijos:** ftv-007, ftv-004, ftv-005, ftv-009\n   - **APIs:** GET /api/v1/admin/users, DELETE /api/v1/admin/users/{id}\n\n2. **[ftv-002-role-management-page.md](./ftv-002-role-management-page.md)**\n   - **Ruta:** `/admin/roles`\n   - **Descripci√≥n:** P√°gina de gesti√≥n de roles con tabla, estad√≠sticas y permisos asociados\n   - **Componentes hijos:** ftv-006, ftv-008, ftv-009\n   - **APIs:** GET /api/v1/admin/roles, DELETE /api/v1/admin/roles/{id}\n\n3. **[ftv-003-permission-management-page.md](./ftv-003-permission-management-page.md)**\n   - **Ruta:** `/admin/permissions`\n   - **Descripci√≥n:** P√°gina de gesti√≥n de permisos con visualizaci√≥n de roles asociados\n   - **Componentes hijos:** ftv-009\n   - **APIs:** GET /api/v1/admin/permissions, POST /api/v1/admin/permissions\n\n### Componentes Modales\n\n4. **[ftv-004-user-form-modal.md](./ftv-004-user-form-modal.md)**\n   - **Tipo:** Modal de formulario\n   - **Prop√≥sito:** Crear y editar usuarios\n   - **Validaciones:** Correo, nombres, UUID Supabase, planta, centro de costo\n   - *"
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/ftv-005-role-assignment-modal.md",
      "excerpt": "# FTV-IOC-004-005: Role Assignment Modal\n\n**ID**: FTV-IOC-004-005  \n**Componente**: `RoleAssignmentModal`  \n**Tipo**: Modal Component  \n**Sprint**: Sprint 3 (IOC-004)  \n**Fecha**: 2025-10-28  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nModal para asignar y remover roles de un usuario espec√≠fico mediante checkboxes interactivos.\n\n### 1.2. Flujo de Usuario\n1. Admin selecciona \"Manage Roles\" en un usuario\n2. Modal muestra todos los roles disponibles\n3. Roles ya asignados aparecen marcados\n4. Admin marca/desmarca roles\n5. Cambios se aplican mediante API idempotente\n6. Modal se cierra y datos se actualizan\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ [X] Manage Roles - Juan P√©rez                    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                  ‚îÇ\n‚îÇ  Assign or remove roles for this user:          ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ ‚òë ADMIN                                    ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ   Full system administrator access         ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ ‚òë GERENTE                                  ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ   Manager with reporting capabilities      ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ ‚òê ANALISTA                                 ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ   Analyst with view-only access            ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  üí° Changes are applied immediately.            ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  [Close]                                         ‚îÇ\n‚îÇ                   "
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/ftv-001-user-management-page.md",
      "excerpt": "# FTV-IOC-004-001: User Management Page\n\n**ID**: FTV-IOC-004-001  \n**Componente**: `UserManagementPage`  \n**Tipo**: Page Component  \n**Ruta**: `/admin/users`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Fecha**: 2025-10-27  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nP√°gina principal de administraci√≥n de usuarios que permite a los administradores ver, crear, editar, eliminar y gestionar roles de usuarios del sistema IOC.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin accede a `/admin/users`\n2. Ve lista paginada de usuarios con filtros de b√∫squeda\n3. Puede crear nuevo usuario, editar existente, o eliminar (soft delete)\n4. Puede asignar/remover roles a usuarios mediante modal dedicado\n5. Puede filtrar por planta, estado activo, y buscar por nombre/email\n\n### 1.3. Ubicaci√≥n en la App\n```\nDashboard\n‚îî‚îÄ‚îÄ Admin Section\n    ‚îî‚îÄ‚îÄ User Management ‚Üê ESTA P√ÅGINA\n        ‚îú‚îÄ‚îÄ Role Management\n        ‚îî‚îÄ‚îÄ Permission Management\n```\n\n**Restricci√≥n de Acceso**: Solo usuarios con `ROLE_ADMIN`\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ IOC Platform - User Management                          [Profile ‚ñæ] ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Users                                                                ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  [+ New User]     ‚îÇ\n‚îÇ  ‚îÇ üîç Search by name or email...               ‚îÇ                    ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ\n‚îÇ                                                                       ‚îÇ\n‚îÇ  Filters:                                                         "
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/ftv-003-permission-management-page.md",
      "excerpt": "('VIEW_PLANTAS', 'Ver informaci√≥n de plantas'),\n('MANAGE_PLANTAS', 'Crear y editar plantas');\n```\n\n### 6.3. Edici√≥n de Permisos\n\n**Campos editables**:\n- ‚úÖ `description` - Puede actualizarse en cualquier momento\n\n**Campos readonly**:\n- ‚ùå `name` - NO puede cambiarse despu√©s de creado (evita romper referencias)\n- ‚ùå `id` - Auto-generado\n- ‚ùå `createdAt` - Auto-generado\n- ‚ùå `updatedAt` - Auto-actualizado\n\n**Raz√≥n**: El `name` es usado como referencia en code y en asignaciones a roles. Cambiarlo romper√≠a la integridad.\n\n### 6.4. Eliminaci√≥n de Permisos\n\n**Reglas**:\n1. Solo se puede eliminar si NO est√° asignado a ning√∫n rol\n2. Backend devuelve 409 Conflict si est√° asignado\n3. Frontend muestra mensaje claro al usuario\n4. Sugerencia: \"Remove it from roles first\"\n\n### 6.5. Performance\n\n- Lista completa sin paginaci√≥n (t√≠picamente < 100 permisos)\n- B√∫squeda con debounce de 300ms\n- Refetch autom√°tico despu√©s de crear/editar/eliminar\n\n---\n\n## 7. Accesibilidad\n\n### 7.1. ARIA Labels\n\n```typescript\n// Botones con labels descriptivos\n<Button\n  aria-label={`Edit permission ${permission.name}`}\n  onClick={() => handleEditPermission(permission.id)}\n>\n  <PencilIcon />\n</Button>\n\n<Button\n  aria-label={`Delete permission ${permission.name}`}\n  onClick={() => handleDeletePermission(permission.id, permission.name)}\n>\n  <TrashIcon />\n</Button>\n```\n\n### 7.2. Formularios\n\n```typescript\n// Labels expl√≠citos\n<label htmlFor=\"permission-name\">Permission Name *</label>\n<Input id=\"permission-name\" {...register(\"name\")} />\n\n// Mensajes de error asociados\n<Input\n  aria-invalid={!!errors.name}\n  aria-describedby={errors.name ? \"name-error\" : undefined}\n/>\n{errors.name && (\n  <p id=\"name-error\" role=\"alert\">\n    {errors.name.message}\n  </p>\n)}\n```\n\n### 7.3. Navegaci√≥n por Teclado\n\n- Tab order l√≥gico: Search ‚Üí New Permission ‚Üí Table rows ‚Üí Actions\n- Enter para submit en formularios\n- Escape para cerrar modales\n- Focus visible en todos los elementos interactivos\n\n---\n\n## 8. Casos de Uso Especiales\n\n### 8.1"
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/ftv-007-user-table.md",
      "excerpt": "# FTV-IOC-004-007: User Table Component\n\n**ID**: FTV-IOC-004-007  \n**Componente**: `UserTable`  \n**Tipo**: Reusable Component  \n**Technical Design**: TD-IOC-004-User-Role-Management-claude.md\n**Sprint**: Sprint 3 (IOC-004)  \n**Fecha**: 2025-10-28  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nComponente reutilizable de tabla para mostrar usuarios con columnas est√°ndar, acciones inline y dise√±o responsivo adaptado al contexto chileno.\n\n### 1.2. Caracter√≠sticas\n- Tabla responsive con layout adaptativo (desktop/mobile)\n- Muestra roles con badges coloridos\n- Acciones contextuales (Edit, Manage Roles, Delete)\n- Indicador de estado activo/inactivo\n- Skeleton loader durante carga\n- Empty state cuando no hay datos\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII (Desktop)\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Nombre          ‚îÇ Correo           ‚îÇ Planta ‚îÇ Roles      ‚îÇ Estado ‚îÇ Acciones‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ Juan P√©rez      ‚îÇ juan@ioc.com     ‚îÇ Lima   ‚îÇ ADMIN      ‚îÇ ‚óè Activo‚îÇ ‚öôÔ∏è üë• üóëÔ∏è ‚îÇ\n‚îÇ Mar√≠a Garc√≠a    ‚îÇ maria@ioc.com    ‚îÇ Callao ‚îÇ GERENTE    ‚îÇ ‚óè Activo‚îÇ ‚öôÔ∏è üë• üóëÔ∏è ‚îÇ\n‚îÇ Pedro L√≥pez     ‚îÇ pedro@ioc.com    ‚îÇ Lima   ‚îÇ ANALISTA   ‚îÇ ‚óã Inactivo‚îÇ ‚öôÔ∏è üë• üóëÔ∏è ‚îÇ\n‚îÇ Ana Rodr√≠guez   ‚îÇ ana@ioc.com      ‚îÇ ‚Äî      ‚îÇ ANALISTA   ‚îÇ ‚óè Activo‚îÇ ‚öôÔ∏è üë• üóëÔ∏è ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### 2.2. Wireframe ASCII (Mobile - Cards)\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Juan P√©rez                             ‚îÇ\n‚îÇ juan@ioc.com                           ‚îÇ\n‚îÇ                                        ‚îÇ\n‚îÇ üè≠ Lima    ‚îÇ ADMIN    ‚îÇ ‚óè Activo      ‚îÇ\n‚îÇ                                        ‚îÇ\n‚îÇ [Editar] [Gestionar Roles] [Eliminar] ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Mar√≠a Garc√≠a                           ‚îÇ\n‚îÇ maria@ioc.com                          ‚îÇ\n‚îÇ                "
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/ftv-002-role-management-page.md",
      "excerpt": "# FTV-IOC-004-002: Role Management Page\n\n**ID**: FTV-IOC-004-002  \n**Componente**: `RoleManagementPage`  \n**Tipo**: Page Component  \n**Ruta**: `/admin/roles`  \n**Sprint**: Sprint 3 (IOC-004)  \n**Fecha**: 2025-10-28  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nP√°gina de administraci√≥n de roles del sistema que permite crear, editar, eliminar roles y gestionar sus permisos asociados.\n\n### 1.2. Caso de Uso Principal\n**Actor**: Administrador (ROLE_ADMIN)\n\n**Flujo**:\n1. Admin accede a `/admin/roles`\n2. Ve lista de roles con cantidad de usuarios y permisos\n3. Puede crear nuevo rol, editar nombre/descripci√≥n, o eliminar\n4. Puede asignar/remover permisos a roles mediante modal\n5. Sistema previene eliminar roles en uso\n\n### 1.3. Ubicaci√≥n en la App\n```\nDashboard\n‚îî‚îÄ‚îÄ Admin Section\n    ‚îú‚îÄ‚îÄ User Management\n    ‚îî‚îÄ‚îÄ Role Management ‚Üê ESTA P√ÅGINA\n        ‚îî‚îÄ‚îÄ Permission Management\n```\n\n**Restricci√≥n de Acceso**: Solo usuarios con `ROLE_ADMIN`\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ IOC Platform - Role Management                      [Profile ‚ñæ] ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                                   ‚îÇ\n‚îÇ  Roles                                            [+ New Role]   ‚îÇ\n‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ\n‚îÇ                                                                   ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  [üîÑ Refresh]   ‚îÇ\n‚îÇ  ‚îÇ üîç Search roles...                         ‚îÇ                  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ\n‚îÇ                                                                   ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ Name      ‚îÇ Description      ‚îÇ Users ‚îÇ Perms ‚îÇ Actions  ‚îÇ   ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
    },
    {
      "path": ".gemini/blueprints/frontend/IOC-004-user-role-management/ftv-006-permission-assignment-modal.md",
      "excerpt": "# FTV-IOC-004-006: Permission Assignment Modal\n\n**ID**: FTV-IOC-004-006  \n**Componente**: `PermissionAssignmentModal`  \n**Tipo**: Modal Component  \n**Sprint**: Sprint 3 (IOC-004)  \n**Fecha**: 2025-10-28  \n**Estado**: ‚úÖ Ready for Implementation\n\n---\n\n## 1. Prop√≥sito y Contexto\n\n### 1.1. Prop√≥sito\nModal para asignar y remover permisos de un rol espec√≠fico de forma interactiva.\n\n### 1.2. Flujo de Usuario\n1. Admin selecciona \"Manage Permissions\" en un rol\n2. Modal muestra permisos disponibles agrupados por categor√≠a\n3. Permisos ya asignados aparecen marcados\n4. Admin marca/desmarca permisos\n5. Cambios se aplican mediante API idempotente\n6. Modal se cierra y datos se actualizan\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe ASCII\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ [X] Manage Permissions - GERENTE                 ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                  ‚îÇ\n‚îÇ  Assign or remove permissions for this role:    ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  User Management                                 ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ ‚òë VIEW_USERS                               ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ ‚òê MANAGE_USERS                             ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  Data & Analytics                                ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ ‚òë VIEW_DASHBOARD                           ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ ‚òë VIEW_REPORTS                             ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ ‚òê EXPORT_DATA                              ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  ETL Operations                                  ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ ‚òë UPLOAD_FILES                             ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ ‚òê MANAGE_ETL                               ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
    },
    {
      "path": ".gemini/blueprints/backend/bss-custom-validators.md",
      "excerpt": "# Backend Service Specification: Custom Validators\n\n## Metadata\n- ID: BSS-IOC-004-24\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- M√≥dulo: `Validation`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nDefinir validadores de Bean Validation reutilizables para reglas de dominio: unicidad de email y formato/validez de UUID de Supabase.\n\n---\n\n## 2. @UniqueEmail\n\n```java\n@Target({ ElementType.FIELD })\n@Retention(RetentionPolicy.RUNTIME)\n@Constraint(validatedBy = UniqueEmailValidator.class)\npublic @interface UniqueEmail {\n  String message() default \"Email ya est√° en uso\";\n  Class<?>[] groups() default {};\n  Class<? extends Payload>[] payload() default {};\n}\n\n@Component\n@RequiredArgsConstructor\npublic class UniqueEmailValidator implements ConstraintValidator<UniqueEmail, String> {\n  private final AppUserRepository appUserRepository;\n  \n  @Override\n  public boolean isValid(String value, ConstraintValidatorContext context) {\n    if (value == null || value.isBlank()) return true; // NotBlank se valida aparte\n    return !appUserRepository.existsByEmailIgnoreCase(value);\n  }\n}\n```\n\nUso:\n```java\npublic class UsuarioCreateRequest {\n  @NotBlank @Email @UniqueEmail\n  private String email;\n  // ...\n}\n```\n\n---\n\n## 3. @ValidSupabaseUUID\n\n```java\n@Target({ ElementType.FIELD })\n@Retention(RetentionPolicy.RUNTIME)\n@Constraint(validatedBy = ValidSupabaseUUIDValidator.class)\npublic @interface ValidSupabaseUUID {\n  String message() default \"UUID inv√°lido\";\n  Class<?>[] groups() default {};\n  Class<? extends Payload>[] payload() default {};\n}\n\npublic class ValidSupabaseUUIDValidator implements ConstraintValidator<ValidSupabaseUUID, UUID> {\n  @Override\n  public boolean isValid(UUID value, ConstraintValidatorContext context) {\n    // Si es UUID nativo, ya es v√°lido; permitir null y delegar a @NotNull cuando aplique\n    return value == null || value.toString().matches(\"^[0-9a-fA-F-]{36}$\");\n  }\n}\n```"
    },
    {
      "path": ".gemini/blueprints/backend/bss-assignment-controller.md",
      "excerpt": "# Backend Service Specification: AssignmentController\n\n## Metadata\n- ID: BSS-IOC-004-04\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `AssignmentController`\n- Tipo: Controller\n- Package: `com.cambiaso.ioc.controller.admin`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nGestionar asignaciones usuario-rol con endpoints dedicados bajo `/api/v1/admin/assignments`. Separa responsabilidades del `AdminUserController`.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\n@RestController\n@RequestMapping(\"/api/v1/admin/assignments\")\n@RequiredArgsConstructor\n@Tag(name = \"Role Assignments\")\npublic class AssignmentController {\n  private final AssignmentService assignmentService;\n\n  @PostMapping(\"/users/{userId}/roles/{roleId}\")\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<RolesResponse> assign(@PathVariable long userId, @PathVariable int roleId) {\n    return ResponseEntity.ok(new RolesResponse(assignmentService.assignRoleToUser(userId, roleId)));\n  }\n\n  @DeleteMapping(\"/users/{userId}/roles/{roleId}\")\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<Void> unassign(@PathVariable long userId, @PathVariable int roleId) {\n    assignmentService.removeRoleFromUser(userId, roleId);\n    return ResponseEntity.noContent().build();\n  }\n\n  @GetMapping(\"/users/{userId}/roles\")\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<RolesResponse> list(@PathVariable long userId) {\n    return ResponseEntity.ok(new RolesResponse(assignmentService.listRolesForUser(userId)));\n  }\n}\n```\n\n---\n\n## 3. Tests\n- Asignar/remover con usuarios/roles v√°lidos e inv√°lidos\n- Listado de roles del usuario\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-user-admin-service.md",
      "excerpt": "- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `UserAdminService`\n- Tipo: Service\n- Package: `com.cambiaso.ioc.service`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n\n---\n\n## 1. Prop√≥sito y Responsabilidad\nGestionar ciclo de vida de usuarios de aplicaci√≥n, validando unicidad y ejecutando soft delete.\n\nResponsabilidades:\n- Crear usuario con datos validados y roles iniciales (opcional)\n- Actualizar datos del usuario\n- Soft delete y desactivaci√≥n\n- Listado con filtros y paginaci√≥n\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface UserAdminService {\n  UsuarioResponse create(UsuarioCreateRequest request);\n  UsuarioResponse update(long id, UsuarioUpdateRequest request);\n  void softDelete(long id);\n  UsuarioResponse getById(long id);\n  Page<UsuarioResponse> list(int page, int size, String search, Integer plantaId, Boolean isActive);\n}\n\n@Service\n@RequiredArgsConstructor\n@Transactional\npublic class UserAdminServiceImpl implements UserAdminService {\n  private final AppUserRepository appUserRepository;\n  private final RoleRepository roleRepository;\n  private final UserRoleRepository userRoleRepository;\n  private final PlantaRepository plantaRepository;\n  private final UsuarioMapper mapper;\n\n  @Override\n  public UsuarioResponse create(UsuarioCreateRequest req) {\n    // Validaciones: email √∫nico (citext), supabase_user_id √∫nico\n    if (appUserRepository.existsByEmailIgnoreCase(req.getEmail())) {\n      throw new ConflictException(\"Email ya existe\");\n    }\n    if (appUserRepository.existsBySupabaseUserId(req.getSupabaseUserId())) {\n      throw new ConflictException(\"supabaseUserId ya existe\");\n    }\n\n    var user = new AppUser();\n    user.setSupabaseUserId(req.getSupabaseUserId());\n    user.setEmail(req.getEmail());\n    user.setPrimerNombre(req.getPrimerNombre());\n    user.setSegundoNombre(req.getSegundoNombre());\n    user.setPrimerApellido(req.getPri"
    },
    {
      "path": ".gemini/blueprints/backend/bss-entities.md",
      "excerpt": "# Backend Service Specification: JPA Entities (IOC-004)\n\n## Metadata\n- ID: BSS-IOC-004-19\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- M√≥dulo: `Entities`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nDefinir las entidades JPA que mapean el esquema SQL de usuario/rol/permiso descrito en `.gemini/sql/schema-user-role-management-unified.sql`.\n\n---\n\n## 2. Entidad: Planta\n\n```java\n@Entity\n@Table(name = \"plantas\", indexes = { @Index(name = \"idx_plantas_code\", columnList = \"code\", unique = true) })\npublic class Planta {\n  @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Integer id;\n  @Column(nullable = false, length = 50, unique = true) private String code;\n  @Column(nullable = false, length = 120) private String name;\n  @Column(columnDefinition = \"text\") private String address;\n  @Column(name = \"created_at\", nullable = false) private OffsetDateTime createdAt;\n  @Column(name = \"updated_at\", nullable = false) private OffsetDateTime updatedAt;\n}\n```\n\n---\n\n## 3. Entidad: AppUser\n\n```java\n@Entity\n@Table(name = \"app_users\",\n  indexes = {\n    @Index(name = \"idx_app_users_active\", columnList = \"is_active\"),\n    @Index(name = \"idx_app_users_supabase_uid\", columnList = \"supabase_user_id\"),\n    @Index(name = \"idx_app_users_planta\", columnList = \"planta_id\"),\n    @Index(name = \"idx_app_users_nombre\", columnList = \"primer_nombre, primer_apellido\")\n  }\n)\npublic class AppUser {\n  @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id;\n  @Column(name = \"supabase_user_id\", nullable = false, unique = true) private UUID supabaseUserId;\n  @Column(name = \"email\", nullable = false, unique = true) private String email; // citext en DB\n  @Column(name = \"primer_nombre\", nullable = false) private String primerNombre;\n  @Column(name = \"segundo_nombre\") private String segundoNombre;\n  @Column(name = \"primer_apellido\", nullable = false) private String primerApellido;\n  @"
    },
    {
      "path": ".gemini/blueprints/backend/bss-user-role-repository.md",
      "excerpt": "# Backend Service Specification: UserRoleRepository\n\n## Metadata\n- ID: BSS-IOC-004-12\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `UserRoleRepository`\n- Tipo: Repository\n- Package: `com.cambiaso.ioc.repository`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nAcceso a datos a la tabla pivote `user_roles` y consultas de roles por usuario.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface UserRoleRepository extends JpaRepository<UserRole, UserRoleKey> {\n  boolean existsByUserIdAndRoleId(long userId, int roleId);\n  boolean existsByRoleId(int roleId);\n  @Modifying\n  @Transactional\n  void deleteByUserIdAndRoleId(long userId, int roleId);\n\n  @Query(\"SELECT r.name FROM UserRole ur JOIN Role r ON ur.roleId = r.id WHERE ur.userId = :userId ORDER BY r.name\")\n  List<String> findRoleNamesByUserId(@Param(\"userId\") long userId);\n}\n\n@Embeddable\npublic class UserRoleKey implements Serializable {\n  private Long userId;\n  private Integer roleId;\n  // equals/hashCode\n}\n```\n\n---\n\n## 3. Tests\n- existsByUserIdAndRoleId, deleteByUserIdAndRoleId\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-role-controller.md",
      "excerpt": "# Backend Service Specification: RoleController\n\n## Metadata\n- ID: BSS-IOC-004-02\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `RoleController`\n- Tipo: Controller\n- Package: `com.cambiaso.ioc.controller.admin`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nExpose CRUD de roles bajo `/api/v1/admin/roles`.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\n@RestController\n@RequestMapping(\"/api/v1/admin/roles\")\n@RequiredArgsConstructor\n@Tag(name = \"Admin Roles\")\npublic class RoleController {\n  private final RoleService roleService;\n\n  @GetMapping\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<Page<RoleResponse>> list(@RequestParam(defaultValue = \"0\") int page,\n                                                 @RequestParam(defaultValue = \"20\") int size,\n                                                 @RequestParam(required = false) String search) {\n    return ResponseEntity.ok(roleService.list(page, size, search));\n  }\n\n  @PostMapping\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<RoleResponse> create(@Valid @RequestBody RoleRequest req) {\n    return ResponseEntity.status(HttpStatus.CREATED).body(roleService.create(req));\n  }\n\n  @PutMapping(\"/{id}\")\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<RoleResponse> update(@PathVariable int id, @Valid @RequestBody RoleRequest req) {\n    return ResponseEntity.ok(roleService.update(id, req));\n  }\n\n  @DeleteMapping(\"/{id}\")\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<Void> delete(@PathVariable int id) {\n    roleService.delete(id);\n    return ResponseEntity.noContent().build();\n  }\n}\n```\n\n---\n\n## 3. Reglas\n- Nombre de rol √∫nico (case-insensitive)\n- No borrar si est√° referenciado en `user_roles` o `role_permissions`\n\n---\n\n## 4. Tests\n- Crear rol √∫nico (201), duplicado (409)\n- Actualizar descripci√≥n (200"
    },
    {
      "path": ".gemini/blueprints/backend/bss-dto-contracts.md",
      "excerpt": "# Backend Service Specification: DTO Contracts (IOC-004)\n\n## Metadata\n- ID: BSS-IOC-004-18\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- M√≥dulo: `DTO Contracts`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nDefinir los contratos de datos (DTOs) usados por los Controllers y Services para el m√≥dulo de gesti√≥n de usuarios, roles y permisos.\n\n---\n\n## 2. DTOs de Usuario\n\n```java\n// requests/UsuarioCreateRequest.java\npublic class UsuarioCreateRequest {\n  @NotBlank(message = \"Email es requerido\")\n  @Email(message = \"Formato de email inv√°lido\")\n  private String email;\n\n  @NotNull(message = \"supabaseUserId es requerido\")\n  private UUID supabaseUserId;\n\n  @NotBlank(message = \"Primer nombre es requerido\")\n  @Size(min = 2, max = 100, message = \"Primer nombre debe tener entre 2 y 100 caracteres\")\n  private String primerNombre;\n\n  @Size(max = 100, message = \"Segundo nombre no debe exceder 100 caracteres\")\n  private String segundoNombre;\n\n  @NotBlank(message = \"Primer apellido es requerido\")\n  @Size(min = 2, max = 100, message = \"Primer apellido debe tener entre 2 y 100 caracteres\")\n  private String primerApellido;\n\n  @Size(max = 100, message = \"Segundo apellido no debe exceder 100 caracteres\")\n  private String segundoApellido;\n\n  private Integer plantaId; // nullable\n\n  @Size(max = 50, message = \"Centro de costo no debe exceder 50 caracteres\")\n  private String centroCosto; // nullable\n\n  private LocalDate fechaContrato; \n\n  private List<@NotBlank(message = \"El nombre del rol no puede estar vac√≠o\") String> roles; // opcional\n}\n\n// requests/UsuarioUpdateRequest.java\npublic class UsuarioUpdateRequest {\n  @NotBlank(message = \"Primer nombre es requerido\")\n  @Size(min = 2, max = 100, message = \"Primer nombre debe tener entre 2 y 100 caracteres\")\n  private String primerNombre;\n\n  @Size(max = 100, message = \"Segundo nombre no debe exceder 100 caracteres\")\n  private String segundoNombre;\n\n  "
    },
    {
      "path": ".gemini/blueprints/backend/bss-permission-repository.md",
      "excerpt": "# Backend Service Specification: PermissionRepository\n\n## Metadata\n- ID: BSS-IOC-004-11\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `PermissionRepository`\n- Tipo: Repository\n- Package: `com.cambiaso.ioc.repository`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nAcceso a datos para `permissions` con b√∫squeda por nombre y paginaci√≥n.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface PermissionRepository extends JpaRepository<Permission, Integer> {\n  Optional<Permission> findByNameIgnoreCase(String name);\n  boolean existsByNameIgnoreCase(String name);\n\n  @Query(\"SELECT p FROM Permission p WHERE (:search IS NULL OR LOWER(p.name) LIKE LOWER(CONCAT('%', :search, '%'))) \")\n  Page<Permission> search(@Param(\"search\") String search, Pageable pageable);\n}\n```\n\n---\n\n## 3. Tests\n- B√∫squeda por nombre\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-global-exception-handler.md",
      "excerpt": "# Backend Service Specification: Global Exception Handling\n\n## Metadata\n- ID: BSS-IOC-004-20\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `GlobalExceptionHandler`\n- Tipo: Controller Advice\n- Package: `com.cambiaso.ioc.exception`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nCentralizar el manejo de errores de la API y responder con un contrato consistente `ErrorResponse`.\n\n---\n\n## 2. Excepciones Personalizadas (sugeridas)\n- `ConflictException` (409)\n- `ResourceNotFoundException` (404)\n- `ForbiddenException` (403)\n- `UnauthorizedException` (401)\n- `BadRequestException` (400)\n\n---\n\n## 3. ErrorResponse (DTO est√°ndar)\n\n```java\npublic class ErrorResponse {\n  private String code;      // ej: RESOURCE_NOT_FOUND\n  private String message;   // mensaje legible\n  private int status;       // HTTP status code\n  private OffsetDateTime timestamp;\n  private String path;      // request path\n  private Map<String, String> validationErrors; // campo -> error\n}\n```\n\n---\n\n## 4. Implementaci√≥n (esqueleto)\n\n```java\n@RestControllerAdvice\n@Slf4j\npublic class GlobalExceptionHandler {\n\n  @ExceptionHandler(ResourceNotFoundException.class)\n  public ResponseEntity<ErrorResponse> handleNotFound(ResourceNotFoundException ex, HttpServletRequest req) {\n    return build(\"RESOURCE_NOT_FOUND\", ex.getMessage(), HttpStatus.NOT_FOUND, req.getRequestURI());\n  }\n\n  @ExceptionHandler(ConflictException.class)\n  public ResponseEntity<ErrorResponse> handleConflict(ConflictException ex, HttpServletRequest req) {\n    return build(\"CONFLICT\", ex.getMessage(), HttpStatus.CONFLICT, req.getRequestURI());\n  }\n\n  @ExceptionHandler(ForbiddenException.class)\n  public ResponseEntity<ErrorResponse> handleForbidden(ForbiddenException ex, HttpServletRequest req) {\n    return build(\"FORBIDDEN\", ex.getMessage(), HttpStatus.FORBIDDEN, req.getRequestURI());\n  }\n\n  @ExceptionHandler(MethodArgumentNotValidException.class)\n  "
    },
    {
      "path": ".gemini/blueprints/backend/bss-permission-mapper.md",
      "excerpt": "# Backend Service Specification: PermissionMapper\n\n## Metadata\n- ID: BSS-IOC-004-17\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `PermissionMapper`\n- Tipo: Mapper\n- Package: `com.cambiaso.ioc.mapper`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nMapear `Permission` a `PermissionResponse`.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\n@Mapper(componentModel = \"spring\")\npublic interface PermissionMapper {\n  PermissionResponse toResponse(Permission entity);\n}\n```\n\n---\n\n## 3. Tests\n- Campos name/description\n# Backend Service Specification: UsuarioMapper\n\n## Metadata\n- ID: BSS-IOC-004-15\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `UsuarioMapper`\n- Tipo: Mapper\n- Package: `com.cambiaso.ioc.mapper`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nConvertir entidades `AppUser` y relaciones en DTOs `UsuarioResponse` y mapear requests a entidad.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\n@Mapper(componentModel = \"spring\")\npublic interface UsuarioMapper {\n  @Mapping(target = \"fullName\", expression = \"java(getFullName(entity))\")\n  @Mapping(target = \"roles\", source = \"roles\")\n  UsuarioResponse toResponse(AppUser entity, List<String> roles);\n\n  default String getFullName(AppUser u) {\n    return Stream.of(u.getPrimerNombre(), u.getSegundoNombre(), u.getPrimerApellido(), u.getSegundoApellido())\n      .filter(Objects::nonNull)\n      .map(String::trim)\n      .filter(s -> !s.isEmpty())\n      .collect(Collectors.joining(\" \"));\n  }\n}\n```\n\n---\n\n## 3. Tests\n- Nombre completo sin segundo nombre/apellido\n- Roles ordenados alfab√©ticamente (si el repo ya los trae ordenados)\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-RoleAndPermissionRepositories.md",
      "excerpt": "# DEPRECATED\n\nEste blueprint combinado est√° deprecado. Usa los blueprints espec√≠ficos:\n- `bss-role-repository.md`\n- `bss-permission-repository.md`\n\n// ...existing code...\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-UserAdminService.md",
      "excerpt": "# DEPRECATED\n\nEste blueprint est√° deprecado. Usa `bss-user-admin-service.md` (lowercase) como versi√≥n can√≥nica.\n\n// ...existing code...\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-usuario-mapper.md",
      "excerpt": "# Backend Service Specification: UsuarioMapper\n\n## Metadata\n- ID: BSS-IOC-004-15\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `UsuarioMapper`\n- Tipo: Mapper\n- Package: `com.cambiaso.ioc.mapper`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nConvertir entidades `AppUser` y relaciones en DTOs `UsuarioResponse` y mapear requests a entidad cuando aplique.\n\n---\n\n## 2. Interfaz P√∫blica (MapStruct)\n\n```java\n@Mapper(componentModel = \"spring\")\npublic interface UsuarioMapper {\n  @Mapping(target = \"id\", source = \"entity.id\")\n  @Mapping(target = \"email\", source = \"entity.email\")\n  @Mapping(target = \"fullName\", expression = \"java(getFullName(entity))\")\n  @Mapping(target = \"plantaId\", source = \"entity.planta.id\")\n  @Mapping(target = \"plantaCode\", source = \"entity.planta.code\")\n  @Mapping(target = \"plantaName\", source = \"entity.planta.name\")\n  @Mapping(target = \"centroCosto\", source = \"entity.centroCosto\")\n  @Mapping(target = \"fechaContrato\", source = \"entity.fechaContrato\")\n  @Mapping(target = \"isActive\", source = \"entity.isActive\")\n  @Mapping(target = \"createdAt\", source = \"entity.createdAt\")\n  @Mapping(target = \"updatedAt\", source = \"entity.updatedAt\")\n  @Mapping(target = \"roles\", source = \"roles\")\n  UsuarioResponse toResponse(AppUser entity, List<String> roles);\n\n  default String getFullName(AppUser u) {\n    return Stream.of(u.getPrimerNombre(), u.getSegundoNombre(), u.getPrimerApellido(), u.getSegundoApellido())\n      .filter(Objects::nonNull)\n      .map(String::trim)\n      .filter(s -> !s.isEmpty())\n      .collect(Collectors.joining(\" \"));\n  }\n}\n```\n\n---\n\n## 3. Consideraciones\n- El listado de roles se inyecta como par√°metro secundario (`List<String> roles`), obtenido del repositorio de asignaciones.\n- Campos de planta son null-safe (MapStruct manejar√° nulls si `entity.planta` es null).\n- `fullName` se construye concatenando nombres no nulos/no vac√≠os en orden: primerNomb"
    },
    {
      "path": ".gemini/blueprints/backend/bss-app-user-repository.md",
      "excerpt": "# Backend Service Specification: AppUserRepository\n\n## Metadata\n- ID: BSS-IOC-004-09\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `AppUserRepository`\n- Tipo: Repository\n- Package: `com.cambiaso.ioc.repository`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nAcceso a datos para `app_users` con b√∫squedas por email, supabase_user_id y filtros.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface AppUserRepository extends JpaRepository<AppUser, Long>, AppUserSearchRepository {\n  Optional<AppUser> findByEmailIgnoreCase(String email);\n  boolean existsByEmailIgnoreCase(String email);\n  Optional<AppUser> findBySupabaseUserId(UUID supabaseUserId);\n  boolean existsBySupabaseUserId(UUID supabaseUserId);\n}\n\npublic interface AppUserSearchRepository {\n  Page<AppUser> search(String search, Integer plantaId, Boolean isActive, Pageable pageable);\n}\n```\n\n---\n\n## 3. Implementaci√≥n de b√∫squeda (ejemplo)\n\n```java\n@Repository\n@RequiredArgsConstructor\npublic class AppUserSearchRepositoryImpl implements AppUserSearchRepository {\n  private final EntityManager em;\n\n  @Override\n  public Page<AppUser> search(String search, Integer plantaId, Boolean isActive, Pageable pageable) {\n    // JPQL din√°mico simplificado\n    var jpql = new StringBuilder(\"SELECT u FROM AppUser u WHERE u.deletedAt IS NULL\");\n    var countJpql = new StringBuilder(\"SELECT COUNT(u) FROM AppUser u WHERE u.deletedAt IS NULL\");\n\n    if (search != null && !search.isBlank()) {\n      jpql.append(\" AND (LOWER(u.email) LIKE :q OR LOWER(u.primerNombre) LIKE :q OR LOWER(u.primerApellido) LIKE :q)\");\n      countJpql.append(\" AND (LOWER(u.email) LIKE :q OR LOWER(u.primerNombre) LIKE :q OR LOWER(u.primerApellido) LIKE :q)\");\n    }\n    if (plantaId != null) {\n      jpql.append(\" AND u.planta.id = :plantaId\");\n      countJpql.append(\" AND u.planta.id = :plantaId\");\n    }\n    if (isActive != null) {\n      jpql.append(\" AND u.isActive "
    },
    {
      "path": ".gemini/blueprints/backend/bss-JoinTableRepositories.md",
      "excerpt": "# DEPRECATED\n\nEste blueprint combinado est√° deprecado. Usa los blueprints espec√≠ficos:\n- `bss-user-role-repository.md`\n- `bss-role-permission-repository.md`\n\n// ...existing code...\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-role-repository.md",
      "excerpt": "# Backend Service Specification: RoleRepository\n\n## Metadata\n- ID: BSS-IOC-004-10\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `RoleRepository`\n- Tipo: Repository\n- Package: `com.cambiaso.ioc.repository`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nAcceso a datos para `roles` con b√∫squeda por nombre y paginaci√≥n.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface RoleRepository extends JpaRepository<Role, Integer> {\n  Optional<Role> findByNameIgnoreCase(String name);\n  boolean existsByNameIgnoreCase(String name);\n\n  @Query(\"SELECT r FROM Role r WHERE (:search IS NULL OR LOWER(r.name) LIKE LOWER(CONCAT('%', :search, '%'))) \")\n  Page<Role> search(@Param(\"search\") String search, Pageable pageable);\n\n  boolean existsById(int id);\n}\n```\n\n---\n\n## 3. Tests\n- B√∫squeda por nombre\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-role-mapper.md",
      "excerpt": "# Backend Service Specification: RoleMapper\n\n## Metadata\n- ID: BSS-IOC-004-16\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `RoleMapper`\n- Tipo: Mapper\n- Package: `com.cambiaso.ioc.mapper`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nMapear `Role` a `RoleResponse` y requests a entidad.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\n@Mapper(componentModel = \"spring\")\npublic interface RoleMapper {\n  RoleResponse toResponse(Role entity);\n}\n```\n\n---\n\n## 3. Tests\n- Campos name/description\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-admin-user-controller.md",
      "excerpt": "# Backend Service Specification: AdminUserController\n\n## Metadata\n- ID: BSS-IOC-004-01\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `AdminUserController`\n- Tipo: Controller\n- Package: `com.cambiaso.ioc.controller.admin`\n- Sprint: Sprint 3\n- Estado:\n  - [x] Draft\n  - [ ] En Revisi√≥n\n  - [ ] Aprobado\n  - [ ] Implementado\n- Autor: IA\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n\n---\n\n## 1. Prop√≥sito y Responsabilidad\n\n### 1.1. Descripci√≥n\nExpose CRUD de usuarios de aplicaci√≥n y endpoints de asignaci√≥n de roles bajo `/api/v1/admin/users`. Endpoints protegidos para administraci√≥n.\n\nResponsabilidad Principal:\n- Crear, leer, actualizar, eliminar (soft) usuarios\n- Asignar y remover roles a usuarios\n- Paginaci√≥n y filtros b√°sicos\n\nNO es responsable de:\n- L√≥gica de negocio compleja de asignaciones (Service)\n- Acceso a datos (Repositories)\n\n### 1.2. Ubicaci√≥n en la Arquitectura\n\nCapa: Presentation (REST Controller)\n\n```\n[Frontend] -> [AdminUserController] -> [UserAdminService, AssignmentService] -> [Repositories] -> [DB]\n```\n\n---\n\n## 2. Interfaz P√∫blica (Endpoints)\n\n```java\n@RestController\n@RequestMapping(\"/api/v1/admin/users\")\n@RequiredArgsConstructor\n@Tag(name = \"Admin Users\")\npublic class AdminUserController {\n\n  private final UserAdminService userAdminService;\n  private final AssignmentService assignmentService;\n\n  @PostMapping\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<UsuarioResponse> create(@Valid @RequestBody UsuarioCreateRequest req) {\n    var created = userAdminService.create(req);\n    return ResponseEntity.status(HttpStatus.CREATED).body(created);\n  }\n\n  @GetMapping\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<Page<UsuarioResponse>> list(\n      @RequestParam(defaultValue = \"0\") int page,\n      @RequestParam(defaultValue = \"20\") int size,\n      @RequestParam(required = false) String search,\n      @RequestParam(required = false) Integer pl"
    },
    {
      "path": ".gemini/blueprints/backend/bss-assignment-service.md",
      "excerpt": "# Backend Service Specification: AssignmentService\n\n## Metadata\n- ID: BSS-IOC-004-08\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `AssignmentService`\n- Tipo: Service\n- Package: `com.cambiaso.ioc.service`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nEncapsular la l√≥gica de asignaci√≥n y remoci√≥n de roles a usuarios (tabla `user_roles`), con idempotencia y validaciones.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface AssignmentService {\n  List<String> assignRoleToUser(long userId, int roleId);\n  void removeRoleFromUser(long userId, int roleId);\n  List<String> listRolesForUser(long userId);\n}\n\n@Service\n@RequiredArgsConstructor\n@Transactional\npublic class AssignmentServiceImpl implements AssignmentService {\n  private final AppUserRepository appUserRepository;\n  private final RoleRepository roleRepository;\n  private final UserRoleRepository userRoleRepository;\n\n  @Override\n  public List<String> assignRoleToUser(long userId, int roleId) {\n    var user = appUserRepository.findById(userId)\n      .orElseThrow(() -> new ResourceNotFoundException(\"Usuario no encontrado\"));\n    var role = roleRepository.findById(roleId)\n      .orElseThrow(() -> new ResourceNotFoundException(\"Rol no encontrado\"));\n\n    if (!userRoleRepository.existsByUserIdAndRoleId(userId, roleId)) {\n      userRoleRepository.save(new UserRole(userId, roleId));\n    }\n\n    return userRoleRepository.findRoleNamesByUserId(userId);\n  }\n\n  @Override\n  public void removeRoleFromUser(long userId, int roleId) {\n    if (!userRoleRepository.existsByUserIdAndRoleId(userId, roleId)) {\n      return; // idempotente\n    }\n    userRoleRepository.deleteByUserIdAndRoleId(userId, roleId);\n  }\n\n  @Override\n  @Transactional(readOnly = true)\n  public List<String> listRolesForUser(long userId) {\n    if (!appUserRepository.existsById(userId)) {\n      throw new ResourceNotFoundExce"
    },
    {
      "path": ".gemini/blueprints/backend/bss-jpa-auditing-config.md",
      "excerpt": "# Backend Service Specification: JPA Auditing Config\n\n## Metadata\n- ID: BSS-IOC-004-23\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `JpaAuditingConfig`\n- Tipo: Config\n- Package: `com.cambiaso.ioc.config`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nHabilitar auditor√≠a (createdBy, lastModifiedBy) para registrar acciones de administraci√≥n.\n\n---\n\n## 2. Config propuesta\n\n```java\n@Configuration\n@EnableJpaAuditing(auditorAwareRef = \"auditorAware\")\npublic class JpaAuditingConfig {\n  @Bean\n  public AuditorAware<String> auditorAware() {\n    return () -> Optional.ofNullable(SecurityContextHolder.getContext().getAuthentication())\n        .filter(Authentication::isAuthenticated)\n        .map(Authentication::getName);\n  }\n}\n```\n\n---\n\n## 3. Uso en entidades (ejemplo)\n\n```java\n@Entity\n@EntityListeners(AuditingEntityListener.class)\npublic class AppUser {\n  @CreatedBy\n  private String createdBy;\n  @LastModifiedBy\n  private String lastModifiedBy;\n}\n```\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-role-permission-repository.md",
      "excerpt": "# Backend Service Specification: RolePermissionRepository\n\n## Metadata\n- ID: BSS-IOC-004-13\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `RolePermissionRepository`\n- Tipo: Repository\n- Package: `com.cambiaso.ioc.repository`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nAcceso a datos de la tabla pivote `role_permissions` y consultas de permisos por rol.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface RolePermissionRepository extends JpaRepository<RolePermission, RolePermissionKey> {\n  boolean existsByRoleId(int roleId);\n  boolean existsByPermissionId(int permissionId);\n}\n\n@Embeddable\npublic class RolePermissionKey implements Serializable {\n  private Integer roleId;\n  private Integer permissionId;\n  // equals/hashCode\n}\n```\n\n---\n\n## 3. Tests\n- existsByRoleId, existsByPermissionId\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-security-config.md",
      "excerpt": "# Backend Service Specification: Security Config (JWT ‚Üí Authorities)\n\n## Metadata\n- ID: BSS-IOC-004-22\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `SecurityConfig`\n- Tipo: Config\n- Package: `com.cambiaso.ioc.config`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nConfigurar Spring Security para autenticar con JWT (Supabase) y mapear claims/roles a GrantedAuthorities (`ROLE_*`).\n\n---\n\n## 2. Puntos clave\n- Resource Server (JWT) con la clave p√∫blica de Supabase.\n- `JwtAuthenticationConverter` que transforma claims a authorities.\n- Endpoints admin (`/api/v1/admin/**`) requieren `ROLE_ADMIN`.\n\n---\n\n## 3. Esqueleto propuesto\n\n```java\n@Configuration\n@EnableMethodSecurity\n@RequiredArgsConstructor\npublic class SecurityConfig {\n\n  @Bean\n  SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n    http\n      .csrf(AbstractHttpConfigurer::disable)\n      .authorizeHttpRequests(reg -> reg\n        .requestMatchers(\"/actuator/**\").permitAll()\n        .requestMatchers(\"/api/v1/admin/**\").hasAuthority(\"ROLE_ADMIN\")\n        .anyRequest().authenticated()\n      )\n      .oauth2ResourceServer(oauth -> oauth\n        .jwt(jwt -> jwt.jwtAuthenticationConverter(jwtAuthConverter()))\n      );\n    return http.build();\n  }\n\n  @Bean\n  Converter<Jwt, ? extends AbstractAuthenticationToken> jwtAuthConverter() {\n    return jwt -> {\n      Collection<GrantedAuthority> authorities = new ArrayList<>();\n      // Map from custom claim (e.g., roles) to ROLE_*\n      List<String> roles = jwt.getClaimAsStringList(\"roles\");\n      if (roles != null) {\n        roles.forEach(r -> authorities.add(new SimpleGrantedAuthority(\"ROLE_\" + r.toUpperCase())));\n      }\n      return new JwtAuthenticationToken(jwt, authorities);\n    };\n  }\n}\n```\n\n---\n\n## 4. Tests\n- JWT sin roles ‚Üí 403 en `/api/v1/admin/**`\n- JWT con role ADMIN ‚Üí 200 en endpoints admin\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-permission-service.md",
      "excerpt": "# Backend Service Specification: PermissionService\n\n## Metadata\n- ID: BSS-IOC-004-07\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `PermissionService`\n- Tipo: Service\n- Package: `com.cambiaso.ioc.service`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nGestionar cat√°logo de permisos. Unicidad por nombre. Impedir borrado si referenciado.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface PermissionService {\n  Page<PermissionResponse> list(int page, int size, String search);\n  PermissionResponse create(PermissionRequest req);\n  PermissionResponse update(int id, PermissionRequest req);\n  void delete(int id);\n}\n\n@Service\n@RequiredArgsConstructor\n@Transactional\npublic class PermissionServiceImpl implements PermissionService {\n  private final PermissionRepository permissionRepository;\n  private final RolePermissionRepository rolePermissionRepository;\n\n  @Override\n  @Transactional(readOnly = true)\n  public Page<PermissionResponse> list(int page, int size, String search) {\n    var pageable = PageRequest.of(page, Math.min(size, 100), Sort.by(\"name\"));\n    return permissionRepository.search(search, pageable).map(PermissionMapper::toResponse);\n  }\n\n  @Override\n  public PermissionResponse create(PermissionRequest req) {\n    if (permissionRepository.existsByNameIgnoreCase(req.getName())) {\n      throw new ConflictException(\"Permiso duplicado\");\n    }\n    var p = new Permission();\n    p.setName(req.getName());\n    p.setDescription(req.getDescription());\n    return PermissionMapper.toResponse(permissionRepository.save(p));\n  }\n\n  @Override\n  public PermissionResponse update(int id, PermissionRequest req) {\n    var p = permissionRepository.findById(id)\n      .orElseThrow(() -> new ResourceNotFoundException(\"Permiso no encontrado\"));\n    if (!p.getName().equalsIgnoreCase(req.getName()) && permissionRepository.existsByNameIgnoreCase(r"
    },
    {
      "path": ".gemini/blueprints/backend/bss-role-service.md",
      "excerpt": "# Backend Service Specification: RoleService\n\n## Metadata\n- ID: BSS-IOC-004-06\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `RoleService`\n- Tipo: Service\n- Package: `com.cambiaso.ioc.service`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nGestionar cat√°logo de roles y validaciones de unicidad; impedir borrado con referencias.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface RoleService {\n  Page<RoleResponse> list(int page, int size, String search);\n  RoleResponse create(RoleRequest req);\n  RoleResponse update(int id, RoleRequest req);\n  void delete(int id);\n}\n\n@Service\n@RequiredArgsConstructor\n@Transactional\npublic class RoleServiceImpl implements RoleService {\n  private final RoleRepository roleRepository;\n  private final UserRoleRepository userRoleRepository;\n  private final RolePermissionRepository rolePermissionRepository;\n\n  @Override\n  @Transactional(readOnly = true)\n  public Page<RoleResponse> list(int page, int size, String search) {\n    var pageable = PageRequest.of(page, Math.min(size, 100), Sort.by(\"name\"));\n    var items = roleRepository.search(search, pageable);\n    return items.map(RoleMapper::toResponse);\n  }\n\n  @Override\n  public RoleResponse create(RoleRequest req) {\n    if (roleRepository.existsByNameIgnoreCase(req.getName())) {\n      throw new ConflictException(\"Rol duplicado\");\n    }\n    var role = new Role();\n    role.setName(req.getName());\n    role.setDescription(req.getDescription());\n    return RoleMapper.toResponse(roleRepository.save(role));\n  }\n\n  @Override\n  public RoleResponse update(int id, RoleRequest req) {\n    var role = roleRepository.findById(id)\n      .orElseThrow(() -> new ResourceNotFoundException(\"Rol no encontrado\"));\n    if (!role.getName().equalsIgnoreCase(req.getName()) && roleRepository.existsByNameIgnoreCase(req.getName())) {\n      throw new ConflictException(\"Nombre "
    },
    {
      "path": ".gemini/blueprints/backend/bss-planta-repository.md",
      "excerpt": "# Backend Service Specification: PlantaRepository\n\n## Metadata\n- ID: BSS-IOC-004-14\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `PlantaRepository`\n- Tipo: Repository\n- Package: `com.cambiaso.ioc.repository`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nAcceso a datos de `plantas` para validaci√≥n de pertenencia organizacional de usuarios.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\npublic interface PlantaRepository extends JpaRepository<Planta, Integer> {\n  Optional<Planta> findByCodeIgnoreCase(String code);\n}\n```\n\n---\n\n## 3. Tests\n- findByCodeIgnoreCase\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-AppUserRepository.md",
      "excerpt": "# DEPRECATED\n\nEste blueprint est√° deprecado. Usa `bss-app-user-repository.md` (lowercase) como versi√≥n can√≥nica.\n\n// ...existing code...\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-PlantaRepository.md",
      "excerpt": "# DEPRECATED\n\nEste blueprint est√° deprecado. Usa `bss-planta-repository.md` (lowercase) como versi√≥n can√≥nica.\n\n// ...existing code...\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-common-dtos.md",
      "excerpt": "# Backend Service Specification: Common DTOs\n\n## Metadata\n- ID: BSS-IOC-004-21\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- M√≥dulo: `Common DTOs`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nEstandarizar DTOs reutilizables como `ErrorResponse` y `PageResponse<T>`.\n\n---\n\n## 2. ErrorResponse (compartido)\n\n```java\npublic class ErrorResponse {\n  private String code;\n  private String message;\n  private int status;\n  private OffsetDateTime timestamp;\n  private String path;\n  private Map<String, String> validationErrors;\n}\n```\n\n---\n\n## 3. PageResponse<T>\n\n```java\npublic class PageResponse<T> {\n  private List<T> items;\n  private long totalElements;\n  private int totalPages;\n  private int currentPage;\n  private int pageSize;\n  private boolean hasNext;\n  private boolean hasPrevious;\n}\n```\n\n---\n\n## 4. Ubicaci√≥n sugerida\n- `src/main/java/com/cambiaso/ioc/dto/common`\n\n"
    },
    {
      "path": ".gemini/blueprints/backend/bss-index-IOC-004.md",
      "excerpt": "# Backend Service Specifications Index - IOC-004 (User Role Management)\n\nTechnical Design: `.gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md`\nFeature Plan: `.gemini/sprints/feature-plans/FP-IOC-004-User-Role-Management.md`\n\n## Controllers\n- bss-admin-user-controller.md\n- bss-role-controller.md\n- bss-permission-controller.md\n- bss-assignment-controller.md\n\n## Services\n- bss-user-admin-service.md\n- bss-role-service.md\n- bss-permission-service.md\n- bss-assignment-service.md\n\n## Repositories\n- bss-app-user-repository.md\n- bss-role-repository.md\n- bss-permission-repository.md\n- bss-user-role-repository.md\n- bss-role-permission-repository.md\n- bss-planta-repository.md\n\n## Mappers\n- bss-usuario-mapper.md\n- bss-role-mapper.md\n- bss-permission-mapper.md\n\n## Contracts (DTOs y Entidades)\n- bss-dto-contracts.md\n- bss-entities.md\n- bss-common-dtos.md\n\n## Exception Handling\n- bss-global-exception-handler.md\n\n## Configuraci√≥n\n- bss-security-config.md\n- bss-jpa-auditing-config.md\n\n## Validation\n- bss-custom-validators.md\n\n## Notas\n- Todos los endpoints admin requieren `ROLE_ADMIN`.\n- Limitar page size a 100 por performance.\n- Operaciones de asignaci√≥n son idempotentes.\n- AssignmentController es parte del scope (no opcional) para separar responsabilidades.\n\n---\n\n<!-- Implementation assessment: added by automation -->\n## Implementation assessment: order, locations and mapping\nA concise plan to implement the blueprints into code. Follow the numbered order to minimize merge conflicts and enable fast verification.\n\n1) Database / Migration\n- Action: Run and review SQL migration first.\n- File: `.gemini/sql/schema-user-role-management-unified.sql`\n- Why first: Entities/repositories depend on DB schema (types, constraints, RLS, indices).\n\n2) JPA Entities\n- Action: Create entity classes that map the SQL schema.\n- Files produced from: `bss-entities.md`\n- Target package: `src/main/java/com/cambiaso/ioc/model/entity`\n- Example files:\n  - `Planta.java` -> `plantas` tab"
    },
    {
      "path": ".gemini/blueprints/backend/bss-permission-controller.md",
      "excerpt": "# Backend Service Specification: PermissionController\n\n## Metadata\n- ID: BSS-IOC-004-03\n- Technical Design: .gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md\n- Clase: `PermissionController`\n- Tipo: Controller\n- Package: `com.cambiaso.ioc.controller.admin`\n- Sprint: Sprint 3\n- Estado: [x] Draft\n- Autor: IA\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n\n---\n\n## 1. Prop√≥sito\nCRUD de permisos bajo `/api/v1/admin/permissions`.\n\n---\n\n## 2. Interfaz P√∫blica\n\n```java\n@RestController\n@RequestMapping(\"/api/v1/admin/permissions\")\n@RequiredArgsConstructor\n@Tag(name = \"Admin Permissions\")\npublic class PermissionController {\n  private final PermissionService permissionService;\n\n  @GetMapping\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<Page<PermissionResponse>> list(@RequestParam(defaultValue = \"0\") int page,\n                                                       @RequestParam(defaultValue = \"20\") int size,\n                                                       @RequestParam(required = false) String search) {\n    return ResponseEntity.ok(permissionService.list(page, size, search));\n  }\n\n  @PostMapping\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<PermissionResponse> create(@Valid @RequestBody PermissionRequest req) {\n    return ResponseEntity.status(HttpStatus.CREATED).body(permissionService.create(req));\n  }\n\n  @PutMapping(\"/{id}\")\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<PermissionResponse> update(@PathVariable int id, @Valid @RequestBody PermissionRequest req) {\n    return ResponseEntity.ok(permissionService.update(id, req));\n  }\n\n  @DeleteMapping(\"/{id}\")\n  @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n  public ResponseEntity<Void> delete(@PathVariable int id) {\n    permissionService.delete(id);\n    return ResponseEntity.noContent().build();\n  }\n}\n```\n\n---\n\n## 3. Reglas\n- Nombre de permiso √∫nico\n- No borrar si referenciado en `role_permissions`\n\n---\n\n## 4. T"
    },
    {
      "path": ".gemini/templates/ftv-templates.md",
      "excerpt": "# Ficha T√©cnica de Vista: [Nombre del Componente]\n\n## Metadata\n- **ID**: FTV-[XXX]\n- **Technical Design**: [TD-XXX-nombre.md]\n- **Componente**: `[NombreComponente]`\n- **Tipo**: [Page | Layout | Feature Component | UI Component]\n- **Ruta** (si aplica): `/[ruta]`\n- **Sprint**: Sprint [X]\n- **Estado**: \n  - [ ] Draft\n  - [ ] En Revisi√≥n\n  - [ ] Aprobado\n  - [ ] Implementado\n- **Autor**: [Nombre o IA]\n- **Fecha Creaci√≥n**: [YYYY-MM-DD]\n- **√öltima Actualizaci√≥n**: [YYYY-MM-DD]\n\n---\n\n## 1. Prop√≥sito del Componente\n\n### 1.1. Descripci√≥n\n\n[Descripci√≥n breve de qu√© hace este componente y por qu√© existe]\n\n**Caso de Uso Principal**:\n```\nComo [tipo de usuario],\nCuando [contexto/acci√≥n],\nEntonces veo/interact√∫o con [este componente],\nPara [objetivo]\n```\n\n### 1.2. Ubicaci√≥n en la Aplicaci√≥n\n\n**Jerarqu√≠a de Navegaci√≥n**:\n```\n[P√°gina Padre] ‚Üí [Secci√≥n] ‚Üí [Este Componente]\n\nEjemplo:\nDashboard ‚Üí Panel Admin ‚Üí Ingesta de Datos ‚Üí DataUploadDropzone\n```\n\n**Rutas**:\n- Ruta Principal: `/[ruta]`\n- Rutas Relacionadas: `/[otra-ruta]`\n\n---\n\n## 2. Especificaci√≥n Visual\n\n### 2.1. Wireframe / Descripci√≥n Visual\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ [NombreComponente]                                          ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  [Descripci√≥n visual en ASCII o referencia a Figma]        ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ\n‚îÇ  ‚îÇ [Elemento hijo 1]                        ‚îÇ             ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ\n‚îÇ  ‚îÇ [Elemento hijo 2]                        ‚îÇ             ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [Bot√≥n Acc"
    },
    {
      "path": ".gemini/templates/technical-design-template.md",
      "excerpt": "# üìÑ PROMPT 6: Technical Design Generator\n\nPerfecto! Ahora vamos con el **Technical Design Generator** que convierte el QU√â (Feature Plan) en el C√ìMO t√©cnico.\n\n---\n\n## PARTE 1: Plantilla del Technical Design\n\n**Archivo**: `@.gemini/templates/technical-design-template.md`\n\n```markdown\n# Technical Design: [Nombre de la Feature]\n\n## Metadata\n- **ID**: TD-[XXX]\n- **Feature Plan**: [FP-XXX-nombre.md]\n- **Sprint**: Sprint [X]\n- **Autor**: [Nombre del Tech Lead o IA]\n- **Reviewers**: [Lista de revisores t√©cnicos]\n- **Estado**: \n  - [ ] Draft\n  - [ ] En Revisi√≥n\n  - [ ] Aprobado\n  - [ ] Implementado\n- **Fecha Creaci√≥n**: [YYYY-MM-DD]\n- **√öltima Actualizaci√≥n**: [YYYY-MM-DD]\n- **Versi√≥n**: 1.0\n\n---\n\n## 1. Resumen Ejecutivo\n\n### 1.1. Prop√≥sito de Este Documento\n\nEste documento describe la **arquitectura t√©cnica** y el **plan de implementaci√≥n** detallado para la feature:\n\n**[Nombre de la Feature]**\n\nBasado en el Feature Plan: `[FP-XXX-nombre.md]`\n\n### 1.2. Alcance T√©cnico\n\n**Qu√© cubre este dise√±o**:\n- Arquitectura de componentes frontend y backend\n- Modelo de datos detallado (schemas, migraciones)\n- Contratos de API completos (request/response)\n- Estrategia de seguridad y validaci√≥n\n- Plan de testing\n- Consideraciones de deployment\n\n**Qu√© NO cubre**:\n- Justificaci√≥n de negocio (ver Feature Plan)\n- Dise√±o visual/UX (ver mockups en FP)\n- Roadmap de producto (ver Sprint Backlog)\n\n### 1.3. Decisiones Arquitect√≥nicas Clave\n\n| Decisi√≥n | Opci√≥n Elegida | Alternativas Consideradas | Justificaci√≥n |\n|----------|----------------|---------------------------|---------------|\n| [Decisi√≥n 1] | [Opci√≥n] | [Alt 1, Alt 2] | [Raz√≥n t√©cnica] |\n| [Decisi√≥n 2] | [Opci√≥n] | [Alt 1, Alt 2] | [Raz√≥n t√©cnica] |\n\n---\n\n## 2. Arquitectura de la Soluci√≥n\n\n### 2.1. Diagrama de Arquitectura de Alto Nivel\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                       FRONTEND                              ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ"
    },
    {
      "path": ".gemini/templates/feature-plan-template.md.md",
      "excerpt": "# üìÑ PROMPT 5: Feature Plan Generator\n\nPerfecto, vamos paso a paso. Empecemos con el **Feature Plan Generator**.\n---\n\n## PARTE 1: Plantilla del Feature Plan\n\nPrimero, creemos la plantilla que el prompt usar√° como gu√≠a.\n**Archivo**: `@.gemini/templates/feature-plan-template.md`\n\n```markdown\n# Feature Plan: [Nombre de la Feature]\n## Metadata\n- **ID**: FP-[XXX]\n- **Sprint**: Sprint [X]\n- **Prioridad**: [Alta | Media | Baja]\n- **Tipo**: [Nueva Feature | Mejora | Bug Fix | Refactor]\n- **Estimaci√≥n**: [Story Points o D√≠as]\n- **Asignado a**: [Equipo/Persona o Pendiente]\n- **Estado**: \n- [ ] Planificaci√≥n\n - [ ] En Dise√±o\n - [ ] Listo para Desarrollo\n - [ ] En Desarrollo\n - [ ] En Testing\n - [ ] Completado\n- **Fecha Creaci√≥n**: [YYYY-MM-DD]\n- **√öltima Actualizaci√≥n**: [YYYY-MM-DD]\n---\n## 1. Contexto de Negocio\n### 1.1. Problema a Resolver\n**Contexto Actual**:\n[Descripci√≥n del estado actual del sistema y por qu√© no es suficiente]\n**Problema Espec√≠fico**:\n[Descripci√≥n concreta del problema que esta feature resuelve]\n**Impacto del Problema**:\n- **Usuarios afectados**: [Qui√©nes sufren este problema]\n- **Frecuencia**: [Con qu√© frecuencia ocurre]\n- **Severidad**: [Qu√© tan cr√≠tico es]\n- **Coste de NO resolverlo**: [Qu√© pasa si no se hace]\n**Ejemplo de Caso de Uso**:\n```\n\nUsuario: [Tipo de usuario]\nSituaci√≥n: [Contexto espec√≠fico]\nProblema: [Qu√© no puede hacer o qu√© es ineficiente]\nImpacto: [Consecuencia negativa]\n\n```\n---\n### 1.2. Soluci√≥n Propuesta\n**Qu√© vamos a construir** (descripci√≥n de alto nivel):\n[Explicaci√≥n de la soluci√≥n en 2-3 p√°rrafos]\n**Valor para el Usuario**:\n- [Beneficio 1]\n- [Beneficio 2]\n- [Beneficio 3]\n**Valor para el Negocio**:\n- [M√©trica 1 que mejorar√°]\n- [M√©trica 2 que mejorar√°]\n- [ROI estimado si aplica]\n---\n### 1.3. Alcance del MVP\n**‚úÖ Dentro del Alcance** (Sprint [X]):\n- [ ] [Feature core 1]\n- [ ] [Feature core 2]\n- [ ] [Feature core 3]\n**‚ùå Fuera del Alcance** (diferir para futuro):\n- [ ] [Feature nice-to-have 1] ‚Üí Sprint [X+1]\n- [ ] [Feature nice-to-have 2"
    },
    {
      "path": ".gemini/templates/bss-template.md",
      "excerpt": "# üìÑ PROMPT 8: Backend Service Specification (BSS) Generator\n\n---\n\n## PARTE 1: Plantilla de Backend Service Specification (BSS)\n\n**Archivo**: `@.gemini/templates/bss-template.md`\n\n```markdown\n# Backend Service Specification: [NombreClase]\n\n## Metadata\n- **ID**: BSS-[XXX]\n- **Technical Design**: [TD-XXX-nombre.md]\n- **Clase**: `[NombreClase]`\n- **Tipo**: [Service | Controller | Repository | WebSocket Handler | Scheduler | Event Listener]\n- **Package**: `com.[empresa].[proyecto].[modulo]`\n- **Sprint**: Sprint [X]\n- **Estado**: \n  - [ ] Draft\n  - [ ] En Revisi√≥n\n  - [ ] Aprobado\n  - [ ] Implementado\n- **Autor**: [Nombre o IA]\n- **Fecha Creaci√≥n**: [YYYY-MM-DD]\n- **√öltima Actualizaci√≥n**: [YYYY-MM-DD]\n\n---\n\n## 1. Prop√≥sito y Responsabilidad\n\n### 1.1. Descripci√≥n\n\n[Descripci√≥n de qu√© hace esta clase y por qu√© existe en la arquitectura]\n\n**Responsabilidad Principal**:\n- [Responsabilidad 1]\n- [Responsabilidad 2]\n- [Responsabilidad 3]\n\n**NO es responsable de** (anti-patterns a evitar):\n- ‚ùå [Cosa que NO debe hacer]\n- ‚ùå [Otra cosa fuera de scope]\n\n---\n\n### 1.2. Ubicaci√≥n en la Arquitectura\n\n```\n[Cliente/Frontend]\n      ‚Üì\n[Controller Layer] ‚Üê (Si esta clase es Controller)\n      ‚Üì\n[Service Layer]    ‚Üê (Si esta clase es Service)\n      ‚Üì\n[Repository Layer] ‚Üê (Si esta clase es Repository)\n      ‚Üì\n[Database/External Service]\n```\n\n**Capa**: [Presentation | Business Logic | Data Access | Infrastructure]\n\n---\n\n## 2. Interfaz P√∫blica\n\n### 2.1. M√©todos P√∫blicos\n\n```java\npackage com.[empresa].[proyecto].[modulo];\n\nimport [imports necesarios];\n\n/**\n * [Descripci√≥n de la clase]\n * \n * @author [Nombre]\n * @since [Versi√≥n]\n */\n@Service  // o @RestController, @Repository, etc.\npublic class [NombreClase] {\n    \n    /**\n     * [Descripci√≥n del m√©todo]\n     * \n     * @param param1 [descripci√≥n]\n     * @param param2 [descripci√≥n]\n     * @return [descripci√≥n del retorno]\n     * @throws [ExceptionType] cuando [condici√≥n]\n     */\n    public [ReturnType] metodo1([Param1Type] param1, [Param2Type] param"
    },
    {
      "path": ".gemini/strategy/3_Stack_Tecnologico_Front.md",
      "excerpt": "# GEMINI.MD: AI Collaboration Guide\n\nThis document provides essential context for AI models interacting with this project. Adhering to these guidelines will ensure consistency and maintain code quality.\n\n## 1. Project Overview & Purpose\n\n* **Primary Goal:** This project, named \"TailAdmin React,\" is a free and open-source admin dashboard template. It's designed to provide developers with a comprehensive, data-driven back-end, dashboard, or admin panel solution. It includes a variety of UI components, elements, and pages to facilitate the rapid development of feature-rich web projects.\n* **Business Domain:** This is a general-purpose admin dashboard template, applicable to various business domains such as E-commerce, Analytics, Marketing, and CRM.\n\n## 2. Core Technologies & Stack\n\n* **Languages:** TypeScript\n* **Frameworks & Runtimes:** React 19, Node.js (v18.x or later, v20.x recommended)\n* **Databases:** Not applicable (Frontend project).\n* **Key Libraries/Dependencies:** Tailwind CSS, ApexCharts, React Router, FullCalendar, Flatpickr.\n* **Package Manager(s):** npm (or yarn)\n\n## 3. Architectural Patterns\n\n* **Overall Architecture:** This is a client-side, component-based architecture typical of a React application. It appears to be a monolithic frontend application.\n* **Directory Structure Philosophy:**\n    * `/src`: Contains all the primary source code for the React application.\n        * `/src/components`: Reusable UI components.\n        * `/src/pages`: Top-level page components, likely corresponding to routes.\n        * `/src/layout`: Components related to the overall application layout (sidebar, header).\n        * `/src/context`: React context providers for state management.\n        * `/src/hooks`: Custom React hooks.\n        * `/src/icons`: SVG icons used in the application.\n    * `/public`: Contains static assets like images and favicons.\n    * `/dist`: (Generated) Contains the production build of the application.\n\n## 4. Coding Conventions & Style Guide\n\n* **F"
    },
    {
      "path": ".gemini/strategy/2_Product_Backlog.md",
      "excerpt": "# Product Backlog - Proyecto Inteligencia Operacional Cambiaso (IOC)\n\nEste documento contiene la lista completa y priorizada de Historias de Usuario, Tareas T√©cnicas y √âpicas para el proyecto IOC. Sirve como la √∫nica fuente de verdad para todos los requerimientos del producto.\n\n## Backlog General\n\n| ID | T√≠tulo | Feature | Prioridad | Asignado a | Sprint | SP | Criterios de Aceptaci√≥n |\n| :--- | :--- | :--- | :--- | :--- | :--- | :-: | :--- |\n| **IOC-001** | Cargar y validar un archivo CSV con datos de producci√≥n | Ingesta de Datos | Cr√≠tica | Boris | Sprint 1 | 5 | - La interfaz permite seleccionar y subir un archivo CSV.<br>- El sistema rechaza archivos con formato incorrecto (ej. columnas faltantes).<br>- Se muestra una notificaci√≥n de √©xito o error al finalizar la carga. |\n| **IOC-021** | Como Usuario, quiero iniciar sesi√≥n en la plataforma | Autenticaci√≥n | Cr√≠tica | Jaime | Sprint 1 | 5 | - El usuario puede ingresar con email y contrase√±a.<br>- Se muestra un error si las credenciales son incorrectas.<br>- Tras el login exitoso, se redirige al dashboard principal. |\n| **IOC-022** | Como Usuario, quiero cerrar mi sesi√≥n de forma segura | Autenticaci√≥n | Cr√≠tica | Jaime | Sprint 1 | 3 | - Al hacer clic en \"Cerrar Sesi√≥n\", se redirige a la p√°gina de login.<br>- La sesi√≥n anterior queda invalidada (no se puede volver con el bot√≥n \"Atr√°s\"). |\n| **IOC-023** | Construir el Layout Principal y las Rutas Protegidas | Infraestructura Frontend | Cr√≠tica | Jaime | Sprint 1 | 8 | - Se debe crear una estructura visual consistente (Navbar, Sidebar, etc.).<br>- Las rutas deben redirigir al login si el usuario no est√° autenticado.<br>- Las rutas de admin deben ser inaccesibles para roles no autorizados. |\n| **IOC-006a**| Como Gerente, quiero visualizar un dashboard con sus gr√°ficos y KPIs | Visualizaci√≥n de Datos | Cr√≠tica | Boris | Sprint 2 | 13 | - El sistema carga y muestra todos los gr√°ficos y m√©tricas configuradas.<br>- Se muestran indicadores de carga claros (ej. 'esquelet"
    },
    {
      "path": ".gemini/strategy/1_Definicion_Proyecto.md",
      "excerpt": "# GEMINI.MD: Gu√≠a de Colaboraci√≥n de IA para el Proyecto IOC (v2)\n\nEste documento es nuestra memoria central y gu√≠a estrat√©gica para la colaboraci√≥n con la IA en el proyecto \"Inteligencia Operacional Cambiaso (IOC)\". Seguir estas directrices asegurar√° que la IA comprenda el contexto, los objetivos y nuestras formas de trabajo para que act√∫e como un desarrollador senior m√°s del equipo.\n\n## 1. Resumen y Prop√≥sito del Proyecto (El \"Por Qu√©\")\n\n*   **Objetivo Principal:** Construir una plataforma de software de Business Intelligence (BI) para automatizar la ingesta y centralizaci√≥n de datos de producci√≥n, proporcionando a los stakeholders de Cambiaso una herramienta visual e interactiva que optimice la agilidad y fiabilidad de su toma de decisiones operativas.\n*   **Problema a Resolver:** Eliminar la dependencia cr√≠tica de procesos manuales basados en planillas de c√°lculo, que generan fragmentaci√≥n, inconsistencia de datos y una alta latencia en la informaci√≥n, dificultando una gesti√≥n √°gil y basada en evidencia.\n*   **Dominio de Negocio:** Inteligencia de Negocios (Business Intelligence) y An√°lisis de Datos aplicados a la optimizaci√≥n de operaciones en el sector de producci√≥n industrial de consumo masivo.\n\n## 2. Tecnolog√≠as Principales y Stack (El \"Con Qu√©\")\n\n*   **Backend:**\n    *   **Lenguaje:** Java 21\n    *   **Framework:** Spring Boot 3.5.5\n    *   **Dependencias Clave:** Spring Boot Starters (Data JPA, Security, Validation, Web), Lombok.\n    *   **Gestor de Paquetes:** Maven\n*   **Frontend:**\n    *   **Lenguaje:** TypeScript\n    *   **Framework:** React 19\n    *   **Dependencias Clave:** Tailwind CSS, ApexCharts, React Router, FullCalendar, Flatpickr.\n    *   **Gestor de Paquetes:** npm\n*   **Base de Datos:** PostgreSQL, gestionado a trav√©s de la plataforma Supabase.\n*   **Autenticaci√≥n:** Supabase Auth, con gesti√≥n de tokens JWT entre frontend y backend.\n*   **Visualizaci√≥n de Datos (BI):** Metabase (Open Source), ejecutado en Docker y embebido en el frontend.\n\n#"
    },
    {
      "path": ".gemini/strategy/5_Design_Tokens.md",
      "excerpt": "# Gu√≠a de Estilo Fundamental y Design Tokens (v1.1)\n\nEste documento formaliza el sistema de dise√±o de la plataforma IOC, basado en un an√°lisis del c√≥digo de la plantilla TailAdmin. Sirve como la fuente de verdad can√≥nica para toda la construcci√≥n de UI.\n\n## 1. Reglas de Oro del Dise√±o\n\n*   **Regla 1: Jerarqu√≠a Clara a trav√©s del Contraste.** La distinci√≥n entre elementos primarios y secundarios se logra principalmente a trav√©s del contraste de color del texto, no del tama√±o.\n    *   **Primario:** `text-gray-800 dark:text-white/90`\n    *   **Secundario:** `text-gray-500 dark:text-gray-400`\n*   **Regla 2: Separaci√≥n Sutil con Bordes.** Usa bordes y esquinas redondeadas para definir y separar contenedores. Evita usar colores de fondo diferentes para la separaci√≥n, manteniendo la interfaz limpia.\n*   **Regla 3: Feedback Interactivo Predecible.** Todos los elementos interactivos deben reaccionar al `hover` del usuario, ya sea aclarando su fondo o intensificando su color principal.\n\n---\n\n## 2. Design Tokens Formalizados\n\n### A. Layout y Contenedores\n*   **Padding de P√°gina Principal:** `p-4 md:p-6`\n    *   **Caso de Uso:** Espaciado general para el contenedor principal de cada p√°gina dentro del `AppLayout`.\n*   **Padding de Tarjeta:** `p-5 sm:p-6`\n    *   **Caso de Uso:** Espaciado interno para todos los componentes de tarjeta (`ComponentCard`).\n*   **Radio de Borde (Contenedores):** `rounded-2xl`\n    *   **Caso de Uso:** Estilo de borde est√°ndar para todas las tarjetas y contenedores principales.\n*   **Borde de Separaci√≥n:** `border border-gray-200 dark:border-gray-800`\n    *   **Caso de Uso:** Borde est√°ndar para tarjetas y separadores visuales.\n\n### B. Tipograf√≠a\n*   **T√≠tulo de P√°gina (h2):** `text-xl font-semibold text-gray-800 dark:text-white/90`\n    *   **Caso de Uso:** Para el t√≠tulo principal de cada vista, generalmente usado en `PageBreadcrumb`.\n*   **T√≠tulo de Secci√≥n (h3):** `text-lg font-semibold text-gray-800 dark:text-white/90`\n    *   **Caso de Uso:** Enca"
    },
    {
      "path": ".gemini/strategy/4_Stack_Tecnologico_Back.md",
      "excerpt": "# GEMINI.MD: AI Collaboration Guide\n\nThis document provides essential context for AI models interacting with this project. Adhering to these guidelines will ensure consistency and maintain code quality.\n\n## 1. Project Overview & Purpose\n\n* **Primary Goal:** This is a REST API backend for the \"Inteligencia Operacional Cambiaso\" project.\n* **Business Domain:** Inferred: Operational Intelligence. The specific domain is not clear from the provided information.\n\n## 2. Core Technologies & Stack\n\n* **Languages:** Java 21\n* **Frameworks & Runtimes:** Spring Boot 3.5.5\n* **Databases:** PostgreSQL\n* **Key Libraries/Dependencies:** \n    - Spring Boot Starter Data JPA\n    - Spring Boot Starter Security\n    - Spring Boot Starter Validation\n    - Spring Boot Starter Web\n    - Lombok\n* **Package Manager(s):** Maven\n\n## 3. Architectural Patterns\n\n* **Overall Architecture:** Monolithic Application, likely following a Model-View-Controller (MVC) or similar layered architecture common in Spring Boot applications.\n* **Directory Structure Philosophy:** Standard Maven project structure:\n    * `/src/main/java`: Contains the primary Java source code.\n    * `/src/main/resources`: Contains application configuration and static assets.\n    * `/src/test/java`: Contains all unit and integration tests.\n    * `/target`: Contains the compiled application and build artifacts.\n\n## 4. Coding Conventions & Style Guide\n\n* **Formatting:** Standard Java conventions. (Inferred from the limited source code).\n* **Naming Conventions:** \n    * `classes`: PascalCase (`IocbackendApplication`)\n    * `methods`, `variables`: camelCase (`main`, `args`)\n    * `packages`: lowercase (`com.cambiaso.ioc`)\n* **API Design:** RESTful principles are assumed given the use of Spring Boot Starter Web.\n* **Error Handling:** Not specified, but likely uses Spring Boot's default error handling mechanisms.\n\n## 5. Key Files & Entrypoints\n\n* **Main Entrypoint(s):** `src/main/java/com/cambiaso/ioc/IocbackendApplication.java`\n* **Config"
    },
    {
      "path": ".gemini/generador-de-componentes/cambiaso_manual_de_marca.md",
      "excerpt": "# manual_de_marca.md[^2][^1]\n\n### Prop√≥sito[^1][^2]\n\nEste manual define la voz y el tono de marca de Cambiaso para asegurar comunicaciones consistentes, claras y alineadas con su identidad corporativa y su sitio oficial. Integra principios, l√©xico y ejemplos aplicados, y anexa el texto de ‚ÄúNosotros‚Äù como referencia de identidad institucional.[^2][^1]\n\n### Conceptos clave[^1][^2]\n\n- Voz de marca: la personalidad estable y reconocible de Cambiaso en todos los canales, anclada en tradici√≥n familiar, liderazgo y calidad, que no cambia entre contextos.[^2][^1]\n- Tono de marca: la modulaci√≥n contextual de la voz (formalidad, cercan√≠a, emoci√≥n) que var√≠a por audiencia y canal sin alterar la identidad subyacente.[^1][^2]\n\n\n### Identidad de voz[^2][^1]\n\n- Personalidad: tradicional y familiar, con orgullo por su historia y un √©nfasis persistente en liderazgo, calidad y respeto por el entorno.[^1][^2]\n- Rasgos: experta, confiable y consciente, comunicando con orden y seriedad sin perder cercan√≠a hacia familias y comunidades.[^2][^1]\n- Territorios: t√©, hierbas, infusiones, yerba mate y soluciones para el hogar y la limpieza, integrados bajo una promesa de calidad cotidiana.[^1][^2]\n\n\n### Tono por contexto[^2][^1]\n\n- Institucional: formal, claro y cronol√≥gico para misi√≥n, historia, hitos y principios, privilegiando precisi√≥n y evidencias.[^1][^2]\n- Comercial: cercano, √∫til y orientado a beneficios, destacando variedad, conveniencia y el rol en la vida diaria del hogar.[^2][^1]\n- Sostenibilidad y comunidad: comprometido y pedag√≥gico, enfatizando reciclaje y pr√°cticas ecoamigables con lenguaje positivo y responsable.[^1][^2]\n\n\n### L√©xico: usar y evitar[^2][^1]\n\n- Usar: tradici√≥n, calidad, liderazgo, familiar, compromiso, reciclaje, pr√°cticas ecoamigables, respeto por el entorno, confianza.[^1][^2]\n- Evitar: hip√©rboles vac√≠as, tecnicismos innecesarios y adjetivaciones que puedan restar credibilidad o cercan√≠a en contextos de consumo masivo.[^2][^1]\n\n\n### Estilo y gram√°tica[^1][^2]\n"
    },
    {
      "path": ".gemini/generador-de-componentes/tailadmin_config.md",
      "excerpt": "<!-- BLOCK:BLOCK:001:START -->\n<!-- BLOCK_META: {\"id\":\"BLOCK:001\",\"type\":\"text\",\"title\":\"TailAdmin - Configuraci√≥n de Dise√±o\",\"lines\":7,\"hash\":\"4f5a4440\",\"created\":\"2025-10-27T16:08:40.080Z\"} -->\n# TailAdmin - Configuraci√≥n de Dise√±o\n> Documentaci√≥n auto-generada desde el proyecto\n> Fecha: 27-10-2025\n> Versi√≥n TailAdmin: 2.0.1\n\nEste documento detalla los tokens de dise√±o, componentes base y patrones de uso extra√≠dos del proyecto TailAdmin. Sirve como una referencia centralizada para mantener la consistencia visual y estructural en todo el desarrollo.\n\n<!-- BLOCK:BLOCK:001:END -->\n\n<!-- BLOCK:BLOCK:002:START -->\n<!-- BLOCK_META: {\"id\":\"BLOCK:002\",\"type\":\"section\",\"title\":\"üìã Metadatos\",\"lines\":5,\"hash\":\"602ee0f5\",\"created\":\"2025-10-27T16:08:40.080Z\"} -->\n## üìã Metadatos\n- **Ruta del proyecto:** `/mnt/ssd-480/repos/captone/tailadmin-free-tailwind-dashboard-template`\n- **Framework detectado:** HTML, AlpineJS\n- **Versi√≥n Tailwind:** 4.0.0\n\n<!-- BLOCK:BLOCK:002:END -->\n\n<!-- BLOCK:BLOCK:003:START -->\n<!-- BLOCK_META: {\"id\":\"BLOCK:003\",\"type\":\"code\",\"title\":\"üé® Tokens de Dise√±o\",\"lines\":131,\"hash\":\"620de0e8\",\"created\":\"2025-10-27T16:08:40.081Z\"} -->\n---\n\n## üé® Tokens de Dise√±o\n\n### Colores\n\n```javascript\n// üìÅ Fuente: src/css/style.css > @theme\n\ncolors: {\n  current: 'currentColor',\n  transparent: 'transparent',\n  white: '#ffffff',\n  black: '#101828',\n\n  brand: {\n    25: '#f2f7ff',\n    50: '#ecf3ff',\n    100: '#dde9ff',\n    200: '#c2d6ff',\n    300: '#9cb9ff',\n    400: '#7592ff',\n    500: '#465fff',\n    600: '#3641f5',\n    700: '#2a31d8',\n    800: '#252dae',\n    900: '#262e89',\n    950: '#161950',\n  },\n\n  'blue-light': {\n    25: '#f5fbff',\n    50: '#f0f9ff',\n    100: '#e0f2fe',\n    200: '#b9e6fe',\n    300: '#7cd4fd',\n    400: '#36bffa',\n    500: '#0ba5ec',\n    600: '#0086c9',\n    700: '#026aa2',\n    800: '#065986',\n    900: '#0b4a6f',\n    950: '#062c41',\n  },\n\n  gray: {\n    25: '#fcfcfd',\n    50: '#f9fafb',\n    100: '#f2f4f7',\n    200: '#e4e7ec',\n    300: '#d0d5dd',\n    400: '#9"
    },
    {
      "path": ".gemini/generador-de-componentes/ui_design_rules.md",
      "excerpt": "\n## üéØ PROMPT 2: Generador de Componentes UI\n\n```markdown\n# PROMPT: Generador de Componentes UI Cambiaso\n\n## Tu Rol\nEres un desarrollador frontend senior especializado en crear componentes \nReact/Next.js siguiendo sistemas de dise√±o establecidos.\n\n## Documentos de Referencia OBLIGATORIOS\n\nAntes de generar cualquier componente, DEBES consultar estos archivos:\n\n### 1. `.gemini/generador-de-componentes/tailadmin_config.md`\n**Prop√≥sito:** Configuraci√≥n t√©cnica base (colores, tipograf√≠a, espaciado)\n**Usar para:** \n- Clases de Tailwind CSS a utilizar\n- Colores disponibles\n- Tama√±os de texto\n- Espaciado est√°ndar\n- Componentes base existentes\n\n### 2. `.gemini//generador-de-componentes/cambiaso_manual_de_marca.md`\n**Prop√≥sito:** Voz, tono y personalidad de marca Cambiaso\n**Usar para:**\n- Textos y microcopy de componentes\n- Tono de mensajes (formal/cercano seg√∫n contexto)\n- Vocabulario espec√≠fico\n- Ejemplos de comunicaci√≥n\n\n### 3. `.gemini//generador-de-componentes/ui_design_rules.md` (este archivo)\n**Prop√≥sito:** Reglas espec√≠ficas de dise√±o y localizaci√≥n Chile\n**Usar para:**\n- Adaptaciones para usuarios chilenos\n- Validaciones (RUT, regi√≥n, etc.)\n- Formatos locales (fecha, moneda, tel√©fono)\n- Accesibilidad y responsive\n\n---\n\n## üá®üá± Reglas Espec√≠ficas Chile\n\n### Formato de Datos\n\n```javascript\n// Moneda\n'$2.990'           // SIN decimales, punto como separador de miles\n'$12.990'          // ‚úÖ Correcto\n'$12,990.00'       // ‚ùå Incorrecto\n\n// Fechas\n'DD/MM/YYYY'       // 25/01/2025\n'HH:mm hrs'        // 14:30 hrs\n\n// Tel√©fono\n'+56 9 XXXX XXXX'  // M√≥vil\n'(XX) XXXX XXXX'   // Fijo\n\n// RUT\n'12.345.678-9'     // Con puntos y gui√≥n\n// SIEMPRE validar d√≠gito verificador\n```\n\n### Componentes Obligatorios Chile\n\n```jsx\n// Input RUT\n<InputRUT \n  label=\"RUT\"\n  required\n  validate={true}\n  format=\"XX.XXX.XXX-X\"\n/>\n\n// Selector Regi√≥n/Comuna\n<RegionComunaSelector\n  onRegionChange={(region) => {}}\n  onComunaChange={(comuna) => {}}\n  required\n/>\n\n// Formato Precio\n<PrecioChileno\n  valor={299"
    },
    {
      "path": ".gemini/context/FTI_Integracion_Metabase_v2.md",
      "excerpt": "# Ficha T√©cnica de Implementaci√≥n (FTI): Integraci√≥n de Metabase (v2 - Refined)\n\n## 1. Resumen Ejecutivo y Objetivo\n\n*   **Feature:** Visualizaci√≥n de Datos y KPIs a trav√©s de Metabase.\n*   **Objetivo:** Integrar la plataforma de Business Intelligence (BI) Metabase (versi√≥n Open Source) con el ecosistema IOC para proporcionar capacidades de visualizaci√≥n de datos, creaci√≥n de dashboards y KPIs.\n*   **Enfoque Arquitect√≥nico:** Se desplegar√° Metabase como un servicio auto-hosteado (v√≠a Docker). El backend de Spring Boot actuar√° como un intermediario seguro para generar URLs de incrustaci√≥n firmadas (Static Embedding), que el frontend de React consumir√° para renderizar los dashboards en `iframes`.\n\n## 2. Actores y Responsabilidades\n\n*   **Administrador del Sistema:** Despliega y mantiene Metabase, gestiona la conexi√≥n a la BD y configura los dashboards.\n*   **Desarrollador Backend:** Implementa el endpoint seguro que genera las URLs firmadas.\n*   **Desarrollador Frontend:** Crea el componente de React que gestiona los estados (carga, error) y renderiza el `iframe`.\n*   **Analista / Administrador de Datos:** Crea y edita gr√°ficos y dashboards dentro de Metabase.\n\n## 3. Dise√±o de Alto Nivel y Contrato de API\n\n### 3.1. Diagrama de Flujo\n```\n+---------------------+      +-------------------------+      +------------------------+\n| Frontend (React)    |      | Backend (Spring Boot)   |      | Metabase (Docker)      |\n+---------------------+      +-------------------------+      +------------------------+\n           |                           |                                |\n           | 1. GET /api/dashboards/5  |                                |\n           |    (con Auth Token User)  |                                |\n           |-------------------------->|                                |\n           |                           | 2. Autoriza: ¬øPuede el usuario |\n           |                           |    ver el Dashboard 5?         |\n           |                      "
    },
    {
      "path": ".gemini/context/ideas.md",
      "excerpt": "# üìä Feature MVP: Res√∫menes Ejecutivos de Dashboards con IA\n\n## Documento de Dise√±o T√©cnico v1.0\n\n---\n\n## 1. Executive Summary\n\n### Idea Ganadora\n**Res√∫menes Ejecutivos de Dashboards al Instante**  \nProporcionar a los usuarios de la plataforma IOC insights autom√°ticos generados por IA cuando acceden a un dashboard de Metabase, reduciendo el tiempo de comprensi√≥n de datos de minutos a segundos.\n\n### Decisi√≥n Arquitect√≥nica\n**Spring Boot + Gemini API (integraci√≥n directa)** ‚Äî Sin orquestador externo (n8n)\n\n### Tiempo Estimado de Implementaci√≥n\n**8-12 horas** de desarrollo + 4 horas de testing\n\n### ROI Esperado\n- **Tiempo ahorrado por usuario:** 3-5 minutos por consulta de dashboard\n- **Adopci√≥n proyectada:** 80% de usuarios activos en 2 semanas\n- **Costo operativo:** ~$10-30/mes en llamadas a Gemini API\n\n---\n\n## 2. Definici√≥n del Problema\n\n### Contexto Actual\nLos dashboards de Metabase muestran **datos visuales** (gr√°ficos, tablas) pero requieren que el usuario:\n1. Interprete m√∫ltiples visualizaciones\n2. Compare per√≠odos manualmente\n3. Identifique patrones y anomal√≠as por s√≠ mismo\n4. Sintetice conclusiones para reportar a superiores\n\n**Tiempo promedio:** 5-8 minutos por dashboard  \n**Punto de dolor:** Gerentes con poco tiempo necesitan \"el resumen ejecutivo primero\"\n\n### Oportunidad\nAprovechar **Gemini 1.5 Flash** para generar autom√°ticamente 3-4 bullets con los hallazgos clave del dashboard, permitiendo a los usuarios captar el estado de la m√©trica en **menos de 10 segundos**.\n\n---\n\n## 3. Opciones Evaluadas\n\n### Opci√≥n A: Spring Boot + Gemini API (Directo)\n**Arquitectura:**\n```\nFrontend ‚Üí Spring Boot ‚Üí Metabase API ‚Üí Gemini API ‚Üí Cache (Supabase) ‚Üí Frontend\n```\n\n**Caracter√≠sticas:**\n- Integraci√≥n directa desde el backend existente\n- Endpoint REST s√≠ncrono `/api/ai/summary`\n- Cach√© en tabla de Supabase con TTL de 10 minutos\n- Fallback a resumen template si la IA falla\n\n**Tiempo de respuesta:** 2-5 segundos\n\n---\n\n### Opci√≥n B: n8n como Orquestador\n**Arquitectura:**\n```\n"
    },
    {
      "path": ".gemini/context/PRODUCT_BACKLOG.md",
      "excerpt": "# üìã PRODUCT BACKLOG - PLATAFORMA IOC\n## Sistema de Business Intelligence con Metabase + Gesti√≥n de Datos\n\n**Framework:** Scrum  \n**Duraci√≥n Sprints:** Sprint 1 (4 semanas) | Sprint 2 (3 semanas) | Sprint 3 (4 semanas)  \n**Visualizaci√≥n:** Tablero Kanban  \n**WIP Limit:** 3 tareas simult√°neas por persona  \n**√öltima Actualizaci√≥n:** 13 de Octubre, 2025\n**Product Owner:** Boris Arriagada  \n**Scrum Master:** Jaime Vicencio  \n**Development Team:** Boris Arriagada, Jaime Vicencio\n\n---\n\n## üéØ √âPICAS DEL PROYECTO\n\n| ID | Nombre | Objetivo | Estado |\n|----|--------|----------|--------|\n| **EP-01** | **Ingesta y Validaci√≥n de Datos** | Permitir al administrador cargar archivos CSV de producci√≥n con validaci√≥n autom√°tica, monitoreo de estado y gesti√≥n de errores detallada | üü¢ Activo |\n| **EP-02** | **Contenido Anal√≠tico y Visualizaciones** | Proporcionar herramientas completas para crear, gestionar y organizar dashboards, gr√°ficos y KPIs utilizando la integraci√≥n con Metabase | üü¢ Activo |\n| **EP-03** | **Acceso, Seguridad y Gesti√≥n de Usuarios** | Implementar un sistema robusto de gesti√≥n de usuarios, roles y permisos con control granular de acceso a dashboards y funcionalidades | üü¢ Activo |\n\n---\n\n## üìä CONFIGURATION KANBAN BOARD\n\n### Columnas y WIP Limits\n\n| Columna | WIP Limit | Definici√≥n | Pol√≠ticas de \"Done\" |\n|---------|-----------|------------|---------------------|\n| **Backlog** | ‚àû | Todas las historias priorizadas pendientes de iniciar | Historia refinada con criterios de aceptaci√≥n claros |\n| **In Progress** | 6 items | Desarrollo activo en curso | C√≥digo en rama feature + tests unitarios iniciados |\n| **Done** | ‚àû | Completado y desplegado | DoD completado + integrado en main + documentado |\n\n### WIP Limits por Rol\n- **Frontend Developer:** M√°ximo 3 tareas simult√°neas\n- **Backend Developer:** M√°ximo 3 tareas simult√°neas  \n- **QA Engineer:** M√°ximo 4 tareas simult√°neas (revisi√≥n)\n- **Product Owner:** Sin l√≠mite (priorizaci√≥n)\n\n---\n\n## ‚úÖ DEFINITION OF READY (DoR)\n\nToda "
    },
    {
      "path": ".gemini/context/cambiaso_manual_de_marca.md",
      "excerpt": "# manual_de_marca.md[^2][^1]\n\n### Prop√≥sito[^1][^2]\n\nEste manual define la voz y el tono de marca de Cambiaso para asegurar comunicaciones consistentes, claras y alineadas con su identidad corporativa y su sitio oficial. Integra principios, l√©xico y ejemplos aplicados, y anexa el texto de ‚ÄúNosotros‚Äù como referencia de identidad institucional.[^2][^1]\n\n### Conceptos clave[^1][^2]\n\n- Voz de marca: la personalidad estable y reconocible de Cambiaso en todos los canales, anclada en tradici√≥n familiar, liderazgo y calidad, que no cambia entre contextos.[^2][^1]\n- Tono de marca: la modulaci√≥n contextual de la voz (formalidad, cercan√≠a, emoci√≥n) que var√≠a por audiencia y canal sin alterar la identidad subyacente.[^1][^2]\n\n\n### Identidad de voz[^2][^1]\n\n- Personalidad: tradicional y familiar, con orgullo por su historia y un √©nfasis persistente en liderazgo, calidad y respeto por el entorno.[^1][^2]\n- Rasgos: experta, confiable y consciente, comunicando con orden y seriedad sin perder cercan√≠a hacia familias y comunidades.[^2][^1]\n- Territorios: t√©, hierbas, infusiones, yerba mate y soluciones para el hogar y la limpieza, integrados bajo una promesa de calidad cotidiana.[^1][^2]\n\n\n### Tono por contexto[^2][^1]\n\n- Institucional: formal, claro y cronol√≥gico para misi√≥n, historia, hitos y principios, privilegiando precisi√≥n y evidencias.[^1][^2]\n- Comercial: cercano, √∫til y orientado a beneficios, destacando variedad, conveniencia y el rol en la vida diaria del hogar.[^2][^1]\n- Sostenibilidad y comunidad: comprometido y pedag√≥gico, enfatizando reciclaje y pr√°cticas ecoamigables con lenguaje positivo y responsable.[^1][^2]\n\n\n### L√©xico: usar y evitar[^2][^1]\n\n- Usar: tradici√≥n, calidad, liderazgo, familiar, compromiso, reciclaje, pr√°cticas ecoamigables, respeto por el entorno, confianza.[^1][^2]\n- Evitar: hip√©rboles vac√≠as, tecnicismos innecesarios y adjetivaciones que puedan restar credibilidad o cercan√≠a en contextos de consumo masivo.[^2][^1]\n\n\n### Estilo y gram√°tica[^1][^2]\n"
    },
    {
      "path": ".gemini/context/ASSESSMENT-APP-HARDENING.md",
      "excerpt": "# ASSESSMENT - Estado General de la Aplicaci√≥n\n\n## Estado General del C√≥digo (2025-09-30)\n\n### üü¢ N√∫cleo Operativo\n- Arquitectura Spring Boot modular: separaci√≥n clara de servicios, controladores, entidades y repositorios.\n- ETL con mecanismos avanzados de retry, locks, observabilidad y watchdog.\n- Persistencia robusta con JPA/Hibernate y repositorios customizados.\n- Controladores REST para operaciones ETL y monitoreo.\n- Health Indicator (`/actuator/health/etl`) para monitoreo de estado.\n\n### üü° Problemas Detectados\n- **Errores de compilaci√≥n:**\n  - Imports o dependencias faltantes (`ActiveProfiles`, `Instant`).\n- **Fallos en tests de concurrencia y serializaci√≥n:**\n  - Locks y retry no garantizan serializaci√≥n en todos los casos cr√≠ticos.\n- **Cobertura de tests:**\n  - Alta en servicios ETL, pero algunos escenarios cr√≠ticos fallan.\n- **Observabilidad:**\n  - M√©tricas core presentes, gauges cr√≠ticos pendientes (`etl.jobs.active`, `etl.jobs.stuck`).\n\n### üü† Funcionalidades Parcialmente Implementadas\n- **Watchdog de jobs zombis:** C√≥digo presente, validaci√≥n real pendiente.\n- **M√©tricas avanzadas:** Faltan gauges y summaries para jobs activos, stuck y file size.\n- **Health Indicator:** Detalles como verificaci√≥n de √≠ndice y gauges no implementados.\n\n### üî¥ Limitaciones y Riesgos\n- **Dependencias y imports:** Errores bloquean CI/CD y ejecuci√≥n de tests.\n- **Serializaci√≥n de concurrencia:** Riesgo de corrupci√≥n de datos bajo carga extrema.\n- **Validaci√≥n en ambiente real:** Watchdog y observabilidad requieren pruebas en producci√≥n.\n\n### üß™ Cobertura de Tests\n- **Integraci√≥n:** Tests para retry, locks, unicidad y watchdog.\n- **Fallos:** Tests de concurrencia y serializaci√≥n presentan errores en aserciones cr√≠ticas.\n\n### üìã Pr√≥ximos Pasos Recomendados\n\n#### üö® Prioridad Alta\n1. Corregir imports y dependencias faltantes (`ActiveProfiles`, `Instant`).\n2. Fortalecer l√≥gica de locks y retry para concurrencia extrema.\n3. Validar watchdog y observabilidad en ambiente real.\n4. Completar "
    },
    {
      "path": ".gemini/context/ASSESSMENT-ETL-HARDENING.md",
      "excerpt": "# ASSESSMENT - ETL Hardening\n\n## Estado General del C√≥digo (2025-09-30)\n\n### üü¢ N√∫cleo Operativo\n- El sistema ETL implementa mecanismos robustos de retry, locks y m√©tricas.\n- La arquitectura de retry y serializaci√≥n est√° documentada y validada en ambiente sint√©tico.\n- La mayor√≠a de las funcionalidades cr√≠ticas est√°n presentes y operativas.\n\n### üü° Problemas Detectados\n- **Errores de compilaci√≥n:**\n  - `cannot find symbol: class ActiveProfiles` en tests. Falta import o dependencia de Spring Test.\n  - `cannot resolve symbol 'Instant'`: Falta import de `java.time.Instant` o conflicto de dependencias.\n- **Fallos en tests de concurrencia:**\n  - Los tests `AdvisoryLockSerializationTest` y `DataSyncConcurrencyTest` fallan en aserciones de tiempo y unicidad, indicando que los locks y el retry no est√°n serializando correctamente las operaciones concurrentes.\n  - Se detectan m√°s registros de los esperados en operaciones concurrentes, lo que puede indicar un bug en la l√≥gica de sincronizaci√≥n o en la limpieza previa de datos.\n\n### üü† Funcionalidades Parcialmente Implementadas\n- **Watchdog de jobs zombis:** C√≥digo presente, pero los tests no validan completamente el comportamiento en ambiente real.\n- **Observabilidad:** M√©tricas core presentes, pero faltan gauges cr√≠ticos (`etl.jobs.active`, `etl.jobs.stuck`).\n- **Health Indicator:** Endpoint `/actuator/health/etl` implementado, pero detalles como verificaci√≥n de √≠ndice y gauges est√°n pendientes.\n\n### üî¥ Limitaciones y Riesgos\n- **Dependencias y imports:** Errores de compilaci√≥n por s√≠mbolos no encontrados pueden bloquear el pipeline CI/CD y la ejecuci√≥n de tests.\n- **Serializaci√≥n de concurrencia:** Los fallos en tests sugieren que el sistema puede no ser seguro ante concurrencia extrema, lo que representa riesgo de corrupci√≥n de datos.\n- **Validaci√≥n en ambiente real:** El watchdog y algunos mecanismos de observabilidad requieren validaci√≥n en producci√≥n para asegurar su efectividad.\n\n### üß™ Cobertura de Tests\n- Tests de integraci"
    },
    {
      "path": ".gemini/context/etl_hardening_idempotencia_deduplicacion.md",
      "excerpt": "# ETL Hardening: Idempotencia, De-duplicaci√≥n, Concurrencia y Operaci√≥n\n\n## 1. Objetivo\nEndurecer el pipeline de ingesti√≥n para evitar duplicados l√≥gicos, controlar concurrencia, asegurar reemplazo consistente por rango de fechas y facilitar monitoreo / operaci√≥n.\n\n## 2. Alcance\nTablas implicadas:\n- `fact_production`\n- Dimensiones: `dim_maquina`, `dim_maquinista` (solo lectura + inserci√≥n de nuevos c√≥digos)\n\nNo incluye (futuro): Streaming por lotes, COPY, staging tables.\n\n## 3. Acciones Clave (Este Documento Cubre 5 Bloques)\n1. Feature flag para *advisory lock* (`etl.lock.enabled`).  \n2. SQL para detecci√≥n y limpieza de duplicados (pre UNIQUE).  \n3. SQL para √≠ndices y constraint de clave natural.  \n4. M√©tricas y observabilidad expuestas.  \n5. Procedimientos operativos: despliegue, rollback, realineo de secuencia.\n\n---\n## 4. Feature Flag de Concurrencia\n| Propiedad | Default | Descripci√≥n |\n|-----------|---------|-------------|\n| `etl.lock.enabled` | `true` | Si est√° activo se ejecuta `pg_advisory_xact_lock` basado en (minDate,maxDate). Evita solapamiento de ETLs con rangos intersectados. |\n\nDesactivaci√≥n temporal (ej. pruebas de rendimiento):\n```properties\netl.lock.enabled=false\n```\n\n### C√°lculo de la llave\n```java\nlong a = minDate.toEpochDay();\nlong b = maxDate.toEpochDay();\nlong key = (a << 32) ^ b; // garantiza distribuci√≥n aceptable\n```\n\n---\n## 5. Detecci√≥n y Limpieza de Duplicados\nLa clave natural candidata (sin constraint a√∫n):\n```\n(fecha_contabilizacion, maquina_fk, COALESCE(maquinista_fk,0), numero_log)\n```\n### 5.1 Detecci√≥n\n```sql\nSELECT fecha_contabilizacion,\n       maquina_fk,\n       COALESCE(maquinista_fk,0) AS maquinista_key,\n       numero_log,\n       COUNT(*) AS ocurrencias,\n       ARRAY_AGG(id ORDER BY id) AS ids\nFROM fact_production\nGROUP BY 1,2,3,4\nHAVING COUNT(*) > 1\nORDER BY ocurrencias DESC;\n```\n### 5.2 Aislar Duplicados\n```sql\nCREATE TABLE IF NOT EXISTS fact_production_dup AS\nSELECT fp.*\nFROM fact_production fp\nJOIN (\n    SELECT fecha_contabiliz"
    },
    {
      "path": ".gemini/context/METABASE_STATIC_EMBEDDING_GUIDE.md",
      "excerpt": "# Gu√≠a de Implementaci√≥n: Metabase Static Embedding para el Proyecto IOC\n\n## 1. Objetivo\nEste documento sirve como la gu√≠a t√©cnica para integrar dashboards de Metabase en la aplicaci√≥n frontend de React, utilizando el m√©todo de **Static (Signed) Embedding**. Este enfoque es el √∫nico viable para la versi√≥n Open Source de Metabase que garantiza la seguridad y el filtrado de datos por usuario.\n\n## 2. Arquitectura y Flujo de Datos\nEl flujo de la petici√≥n ser√° el siguiente:\n\n1.  **Frontend (React):** Un componente de React que necesita mostrar un dashboard realiza una petici√≥n a nuestro backend de Spring Boot. La petici√≥n puede incluir par√°metros de filtrado (ej. rango de fechas).\n2.  **Backend (Spring Boot):**\n    *   Recibe la petici√≥n del frontend.\n    *   Construye un payload de JWT (JSON Web Token) que contiene el ID del recurso (el dashboard) y los par√°metros de filtrado.\n    *   Firma criptogr√°ficamente este JWT usando el **\"Embedding Secret Key\"** proporcionado por Metabase.\n    *   Construye la URL final del `iframe`, que incluye el token firmado.\n    *   Devuelve esta URL completa y firmada al frontend.\n3.  **Frontend (React):**\n    *   Recibe la URL firmada del backend.\n    *   Renderiza un componente `<iframe>` con esa URL.\n4.  **Metabase:**\n    *   Recibe la petici√≥n del `iframe`.\n    *   Verifica la firma del JWT usando su \"Embedding Secret Key\".\n    *   Si la firma es v√°lida, muestra el dashboard con los filtros aplicados. Si no, muestra un error.\n\n**Principio de Seguridad Clave:** El \"Embedding Secret Key\" NUNCA debe salir del backend. La firma del token siempre debe ocurrir en el lado del servidor.\n\n---\n\n## 3. Fase 1: Configuraci√≥n en Metabase (Prerrequisitos)\n\nEstos pasos deben ser realizados por un administrador en la interfaz de Metabase.\n\n1.  **Habilitar \"Embedding\":**\n    *   Ir a `Settings` -> `Admin Settings` -> `Embedding`.\n    *   Hacer clic en **\"Enable\"**.\n\n2.  **Obtener la \"Embedding Secret Key\":**\n    *   En la misma p√°gina, se generar√° una "
    },
    {
      "path": ".gemini/context/tailadmin-react-component-docs.md",
      "excerpt": "\n# Documentaci√≥n de Componentes de React - TailAdmin\n\nTailAdmin React proporciona un conjunto de componentes totalmente responsivos para agilizar tu proceso de desarrollo. Estos componentes est√°n construidos con la flexibilidad en mente, permiti√©ndote personalizarlos para que se ajusten a las necesidades de tu proyecto mientras se mantiene el rendimiento y la usabilidad.\n\nPara usar un componente, imp√≥rtalo como se muestra en los ejemplos:\n`import ComponentName from \"../components/ComponentName\";`\n\n---\n## Directiva para Colaboraci√≥n de IA: Sistema de Dise√±o TailAdmin\n\n**Mandato:** Este documento es tu **fuente de verdad √∫nica y obligatoria** para toda la construcci√≥n de interfaces de usuario (UI) en el proyecto IOC. No debes usar, inventar ni sugerir componentes o estilos que no est√©n definidos aqu√≠, a menos que se te solicite expl√≠citamente como una nueva tarea de desarrollo.\n\n**Objetivo:** Garantizar la uniformidad visual, la coherencia en la interacci√≥n y la mantenibilidad del frontend, utilizando exclusivamente la biblioteca de componentes predefinida de TailAdmin.\n\n### Protocolo Obligatorio para Tareas de UI/UX\n\nPara cualquier tarea que implique dise√±ar o implementar una interfaz de usuario, debes seguir rigurosamente los siguientes pasos:\n\n1.  **[CONSULTAR]:** Antes de proponer cualquier dise√±o o escribir cualquier c√≥digo, debes consultar este documento para identificar los componentes de TailAdmin m√°s adecuados para cumplir con los requisitos de la tarea.\n\n2.  **[PLANIFICAR]:** En tu fase de planificaci√≥n (`[RAZONAR]`), debes nombrar expl√≠citamente los componentes que utilizar√°s. Tu plan debe ser verificable contra este documento.\n    *   **Ejemplo de Plan Correcto:** *\"Para la vista 'Gesti√≥n de Usuarios', mi plan es usar los siguientes componentes: `<Table>` para listar los usuarios, `<Button>` para las acciones, `<Modal>` para el formulario de creaci√≥n y `<PaginationWithText>` para la paginaci√≥n.\"*\n    *   **Ejemplo de Plan Incorrecto:** *\"Voy a crear una ta"
    },
    {
      "path": ".gemini/context/figma.md",
      "excerpt": "# üé® Gu√≠a Completa de Figma: AI Insights Panel\n\n## Estructura del Archivo Figma\n\n```\nüìÅ IOC - AI Insights Design System\n‚îú‚îÄ‚îÄ üé® Cover (Portada del proyecto)\n‚îú‚îÄ‚îÄ üìê Design Tokens (Sistema de dise√±o)\n‚îú‚îÄ‚îÄ üß© Components (Componentes reutilizables)\n‚îú‚îÄ‚îÄ üì± Screens (Pantallas completas)\n‚îú‚îÄ‚îÄ üé¨ Prototype (Flujo interactivo)\n‚îî‚îÄ‚îÄ üìã Handoff (Specs para desarrollo)\n```\n\n---\n\n## 1. Setup Inicial: Design Tokens\n\n### üé® Paleta de Colores (Color Styles)\n\n```\nPRIMARIOS:\n‚îú‚îÄ‚îÄ Purple/50    #FAF5FF\n‚îú‚îÄ‚îÄ Purple/100   #F3E8FF\n‚îú‚îÄ‚îÄ Purple/200   #E9D5FF\n‚îú‚îÄ‚îÄ Purple/500   #A855F7\n‚îú‚îÄ‚îÄ Purple/600   #9333EA  ‚Üê Principal\n‚îú‚îÄ‚îÄ Purple/700   #7E22CE\n\nSECUNDARIOS:\n‚îú‚îÄ‚îÄ Blue/50      #EFF6FF\n‚îú‚îÄ‚îÄ Blue/100     #DBEAFE\n‚îú‚îÄ‚îÄ Blue/500     #3B82F6\n‚îú‚îÄ‚îÄ Blue/600     #2563EB\n‚îú‚îÄ‚îÄ Blue/700     #1D4ED8\n\nINDIGO:\n‚îú‚îÄ‚îÄ Indigo/50    #EEF2FF\n‚îú‚îÄ‚îÄ Indigo/100   #E0E7FF\n\nESTADOS:\n‚îú‚îÄ‚îÄ Green/50     #F0FDF4\n‚îú‚îÄ‚îÄ Green/100    #DCFCE7\n‚îú‚îÄ‚îÄ Green/600    #16A34A\n‚îú‚îÄ‚îÄ Green/700    #15803D\n\n‚îú‚îÄ‚îÄ Red/50       #FEF2F2\n‚îú‚îÄ‚îÄ Red/100      #FEE2E2\n‚îú‚îÄ‚îÄ Red/600      #DC2626\n‚îú‚îÄ‚îÄ Red/700      #B91C1C\n\n‚îú‚îÄ‚îÄ Yellow/50    #FEFCE8\n‚îú‚îÄ‚îÄ Yellow/100   #FEF3C7\n‚îú‚îÄ‚îÄ Yellow/300   #FDE047\n‚îú‚îÄ‚îÄ Yellow/600   #CA8A04\n\nNEUTRALES:\n‚îú‚îÄ‚îÄ Gray/50      #F9FAFB\n‚îú‚îÄ‚îÄ Gray/100     #F3F4F6\n‚îú‚îÄ‚îÄ Gray/200     #E5E7EB\n‚îú‚îÄ‚îÄ Gray/300     #D1D5DB\n‚îú‚îÄ‚îÄ Gray/400     #9CA3AF\n‚îú‚îÄ‚îÄ Gray/500     #6B7280\n‚îú‚îÄ‚îÄ Gray/600     #4B5563\n‚îú‚îÄ‚îÄ Gray/700     #374151\n‚îú‚îÄ‚îÄ Gray/800     #1F2937\n‚îú‚îÄ‚îÄ Gray/900     #111827\n\nBACKGROUNDS:\n‚îú‚îÄ‚îÄ Gradient/Purple-Blue    Linear: 135¬∞, Purple/600 ‚Üí Blue/600\n‚îú‚îÄ‚îÄ Gradient/Purple-Light   Linear: 135¬∞, Purple/50 ‚Üí Blue/50 ‚Üí Indigo/50\n‚îú‚îÄ‚îÄ Gradient/Decorative     Radial: Purple/200 20% opacity\n```\n\n---\n\n### ‚úçÔ∏è Tipograf√≠a (Text Styles)\n\n```\nHEADINGS:\n‚îú‚îÄ‚îÄ H1/Bold          Inter, 32px, Bold (700), -0.02em\n‚îú‚îÄ‚îÄ H2/Bold          Inter, 24px, Bold (700), -0.01em\n‚îú‚îÄ‚îÄ H3/Bold          Inter, 18px, Bold (700), -0.01em\n‚îú‚îÄ‚îÄ H4/Semibold      Inter, 16px, Semibold (600)\n\nBODY:\n‚îú‚îÄ‚îÄ Body/Regular     Inter, 14px, Regular (400), 1.5 line-height\n‚îú‚îÄ‚îÄ Body/Medium      Inter, 14px, Medium (500)\n‚îú‚îÄ‚îÄ Body/Semibold "
    },
    {
      "path": ".gemini/context/README-ETL-HARDENING.md",
      "excerpt": "# ETL Hardening - Estado Operacional\n\n## üö® Quick Reference Card (Para Operadores)\n\n```bash\n# Verificaci√≥n diaria esencial (5 minutos)\ncurl -s localhost:8080/actuator/prometheus | grep -E \"(etl_jobs_stuck|etl_sync_collisions|etl_unique_index_present)\"\n\n# Query cr√≠tica de integridad (SQL)\nSELECT COUNT(*) - COUNT(DISTINCT fecha_contabilizacion, maquina_fk, COALESCE(maquinista_fk,0), numero_log) \nFROM fact_production WHERE fecha_contabilizacion >= CURRENT_DATE - INTERVAL '7 days';\n-- Resultado esperado: 0\n\n# Jobs zombis manuales\nSELECT job_id, status, created_at FROM etl_jobs \nWHERE status IN ('INICIADO','PROCESANDO','SINCRONIZANDO') AND created_at < NOW() - INTERVAL '1 hour';\n-- Resultado esperado: vac√≠o\n```\n\n## Estado Actual del Sistema\n\n### ‚úÖ FUNCIONALIDADES IMPLEMENTADAS Y OPERATIVAS\n\n- **Retry autom√°tico en colisiones UNIQUE** - Absorbe colisiones concurrentes (0 fallos propagados)\n- **√çndice UNIQUE natural** - `uq_fact_prod_natural` previene duplicados en BD\n- **Advisory locks PostgreSQL** - Serializaci√≥n de ventanas solapadas\n- **Job duration tracking** - Timer con tags de status (EXITO/FALLO)\n- **Tests de integraci√≥n** - Validaci√≥n de concurrencia y retry\n- **Health indicator b√°sico** - `/actuator/health/etl`\n\n### üî∂ FUNCIONALIDADES PARCIALMENTE IMPLEMENTADAS\n\n- **Watchdog de jobs zombis** - C√≥digo implementado, test unitario pendiente de validaci√≥n\n- **Observabilidad** - 8 m√©tricas core implementadas, 7 adicionales en desarrollo\n\n### ‚ùå LIMITACIONES CONOCIDAS\n\n- **Test del watchdog** - Requiere validaci√≥n en ambiente real (no sint√©tico)\n- **M√©tricas de dimensiones** - Solo detecta nuevas m√°quinas/maquinistas si est√°n implementadas\n- **File size tracking** - Depende de implementaci√≥n en parser service\n\n## M√©tricas: Estado Real vs Aspiracional\n\n| M√©trica | Estado | Tipo | Ubicaci√≥n en C√≥digo |\n|---------|---------|------|-------------------|\n| `etl.rows.deleted` | ‚úÖ IMPLEMENTADA | Counter | DataSyncService.java |\n| `etl.rows.inserted` | ‚úÖ IMPLEMENTADA | Counter | D"
    },
    {
      "path": ".gemini/context/dise√±o_de_arquitectura_sistema_de_ingesta_de_datos_asincronico.md",
      "excerpt": "# **Dise√±o de Arquitectura: Sistema de Ingesta y Sincronizaci√≥n Dimensional**\n\n**Proyecto:** Inteligencia Operacional Cambiaso (IOC)\n**Fecha:** 20 de Septiembre de 2025\n**Versi√≥n:** 7.2 (Final & Consolidated)\n\n#### **1. Resumen ejecutivo**\nLa arquitectura implementa un pipeline de ingesta asincr√≥nico, idempotente y transaccional, modelado en **Esquema de Estrella**. Se basa en un particionado anual de la tabla de hechos, una clave de negocio √∫nica para integridad a nivel de fila y una capa de gobernanza de jobs para una trazabilidad completa. Se ofrecen dos estrategias de sincronizaci√≥n (Delete+Insert y UPSERT) para asegurar la flexibilidad a largo plazo.\n\n#### **2. Objetivos y RNF**\n*   **Rendimiento:** Procesamiento en segundo plano, inserciones en lote y consultas aceleradas por particionamiento e √≠ndices.\n*   **Fiabilidad e Integridad:** Transacciones at√≥micas, validaciones, checks SQL, e idempotencia multinivel (archivo, ventana, fila).\n*   **Usabilidad y Observabilidad:** Respuesta `202 Accepted` inmediata con seguimiento por `jobId` v√≠a WebSocket y API REST.\n\n#### **3. Modelo de Datos (Fuente de Verdad: `schema.sql`)**\nEl dise√±o completo y detallado de la base de datos, incluyendo tablas, tipos de datos, particionamiento, √≠ndices y constraints, est√° definido en el archivo **`schema.sql`**, que es la √∫nica fuente de verdad para la estructura de datos.\n\n*   **Esquema:** Modelo Dimensional de Kimball (Esquema de Estrella).\n*   **Tabla de Hechos:** `fact_production`, particionada anualmente sobre `fecha_contabilizacion` y con una clave de negocio √∫nica para garantizar la integridad.\n*   **Tablas de Dimensiones:** `dim_maquina`, `dim_maquinista`, que contienen los atributos descriptivos.\n*   **Tablas de Gobernanza:** `etl_jobs` (con unicidad por `file_hash`) y `quarantined_records` para auditor√≠a y manejo de errores.\n\n#### **4. Vista L√≥gica y Flujo**\n- **API REST** recibe el archivo, valida duplicados y concurrencia, registra el `etl_job` con estado `INICIADO`, y "
    },
    {
      "path": ".gemini/context/METABASE_FRONTEND_ASSESSMENT.md",
      "excerpt": "--# üìä Assessment de Implementaci√≥n: Integraci√≥n de Metabase (Frontend)\n\n**Proyecto:** IOC Frontend - Inteligencia Operacional Cambiaso  \n**Fecha:** 9 de Octubre, 2025  \n**Versi√≥n:** 1.0  \n**Estado:** ‚úÖ IMPLEMENTATION COMPLETE - Mejoras Recomendadas\n\n---\n\n## üìã √çndice\n\n1. [Resumen Ejecutivo](#resumen-ejecutivo)\n2. [An√°lisis por Componente](#an√°lisis-por-componente)\n3. [Evaluaci√≥n por Pilares](#evaluaci√≥n-por-pilares)\n4. [Issues Identificadas](#issues-identificadas)\n5. [Fortalezas Destacadas](#fortalezas-destacadas)\n6. [Plan de Mejoras](#plan-de-mejoras)\n7. [Conclusiones](#conclusiones)\n\n---\n\n## 1. Resumen Ejecutivo\n\n### üéØ Estado General: **85% COMPLETADO** \n\nLa implementaci√≥n de la integraci√≥n de Metabase en el frontend React est√° **funcionalmente completa** y cumple con los requisitos b√°sicos establecidos en el blueprint. El sistema permite visualizar dashboards de forma segura con autenticaci√≥n, manejo de errores y auto-refresco de tokens.\n\n### üìä M√©tricas de Calidad\n\n| Aspecto | Puntaje | Estado |\n|---------|---------|--------|\n| **Completitud Funcional** | 100% | üü¢ Perfecto |\n| **Seguridad** | 85% | üü° Bueno |\n| **Resiliencia** | 90% | üü¢ Muy Bueno |\n| **UX/UI** | 80% | üü° Bueno |\n| **C√≥digo Limpio** | 85% | üü° Muy Bueno |\n| **Testing** | 0% | üî¥ Cr√≠tico |\n| **Documentaci√≥n** | 70% | üü° Aceptable |\n| **TypeScript** | 90% | üü¢ Muy Bueno |\n| **PROMEDIO GENERAL** | **75%** | üü° **Production-Ready con Mejoras** |\n\n### ‚úÖ Logros Principales\n\n1. ‚úÖ **Componente Reutilizable Completo**\n   - `DashboardEmbed.tsx` implementado con todas las props necesarias\n   - Manejo de estados (loading, error, success)\n   - Callbacks para eventos (onLoad, onError)\n\n2. ‚úÖ **Integraci√≥n de Seguridad**\n   - Autenticaci√≥n con Supabase JWT\n   - Token inyectado en headers de cada petici√≥n\n   - Iframe con sandbox restrictivo\n\n3. ‚úÖ **Resiliencia Implementada**\n   - Auto-refresco de token cada 8 minutos\n   - Timeout de 15 segundos con AbortController\n   - Manejo de errores HTTP espec√≠ficos (403, 404, 503)\n\n4"
    },
    {
      "path": ".gemini/context/etl-hardening-implementation-status.md",
      "excerpt": "# ETL Hardening Implementation - Estado Completo del Contexto\n\n**Fecha**: 2025-09-30  \n**Prop√≥sito**: Documento de contexto para continuidad de sesiones IA  \n**Progreso Total**: üéâ **100% COMPLETADO** üéâ  \n\n## üéØ RESUMEN EJECUTIVO\n\nEl proyecto de hardening ETL est√° **COMPLETAMENTE TERMINADO** y listo para producci√≥n:\n- ‚úÖ **N√∫cleo funcional 100% completo** (retry, locks, integridad)\n- ‚úÖ **11/11 m√©tricas cr√≠ticas implementadas** (descubiertas en EtlJobMetricsRegistrar.java)\n- ‚úÖ **Tests fortalecidos** (0 fallos en concurrencia)\n- ‚úÖ **Documentaci√≥n enterprise validada** por QA review\n- ‚úÖ **Watchdog 100% funcional** (c√≥digo implementado y funcionando)\n- ‚úÖ **Health checks completos** con verificaci√≥n real\n\n## üìã CHECKLIST FINAL - 100% COMPLETADO\n\n### ‚úÖ COMPLETADO AL 100%\n\n#### 1. Verificaci√≥n previa y modelo ‚úÖ\n- **1.1-1.4**: Duplicados=0, PK vigente, √≠ndices, tama√±o estable\n\n#### 2. √çndice UNIQUE natural ‚úÖ\n- **2.1**: `uq_fact_prod_natural` creado\n- **2.2**: Columnas validadas: `(fecha_contabilizacion, maquina_fk, COALESCE(maquinista_fk,0), numero_log)`\n- **2.3**: Evidencia documentada\n\n#### 3. Runtime (retry + locks) ‚úÖ\n- **3.1**: `etl.retry.unique.enabled=true`\n- **3.2**: `max-attempts=3` diferenciado prod/test\n- **3.3**: Verificador autom√°tico implementado\n\n#### 4. Validaciones end-to-end ‚úÖ\n- **4.1**: Idempotencia probada\n- **4.2**: Conflictos de ventana con tests determin√≠sticos\n- **4.3**: Deduplicaci√≥n intra-archivo\n\n#### 5. Retry - cobertura espec√≠fica ‚úÖ\n- **5.1**: Test de colisi√≥n concurrente **FORTALECIDO** a 0 fallos\n\n#### 6. Observabilidad ampliada ‚úÖ **COMPLETA** (11/11 m√©tricas)\n**‚úÖ TODAS IMPLEMENTADAS:**\n- `etl.rows.deleted` (Counter) - DataSyncService.java\n- `etl.rows.inserted` (Counter) - DataSyncService.java  \n- `etl.sync.duration` (Timer) - DataSyncService.java\n- `etl.sync.attempts` (Counter) - DataSyncService.java\n- `etl.sync.collisions` (Counter) - DataSyncService.java\n- `etl.job.total.duration` (Timer + tags) - EtlJobService.java\n- `etl.sync.window.days` (Sum"
    },
    {
      "path": ".gemini/context/desarrollo_proyecto.md",
      "excerpt": "# DESARROLLO DEL PROYECTO APT - FASE 2\n\n## Plataforma de Inteligencia Operacional Cambiaso (IOC)\n\n**Proyecto:** Sistema de Business Intelligence con Metabase + Gesti√≥n de Datos  \n**Instituci√≥n:** AIEP  \n**Programa:** Analista Programador de Aplicaciones de Gesti√≥n (APT)  \n**Fase:** Fase 2 - Desarrollo del Proyecto  \n**Per√≠odo:** Septiembre - Octubre 2025  \n**Equipo:**\n\n- **Product Owner y Desarrollador:** Boris Arriagada\n- **Scrum Master y Desarrollador:** Jaime Vicencio\n\n---\n\n## 1. RESUMEN AVANCE PROYECTO APT\n\n### 1.1 Resumen de Avance del Proyecto\n\nEl proyecto **Inteligencia Operacional Cambiaso (IOC)** ha completado exitosamente el **Sprint 1** (8 septiembre - 4 octubre 2025) alcanzando un **100% de cumplimiento** de los objetivos comprometidos. El sprint tuvo una duraci√≥n de 4 semanas calend√°ricas con 19 d√≠as h√°biles de trabajo (excluyendo los festivos 18 y 19 de septiembre). Se implement√≥ el ciclo de valor completo de extremo a extremo, permitiendo que un usuario pueda autenticarse en la plataforma, cargar datos de producci√≥n mediante archivos CSV y visualizar inmediatamente dashboards interactivos con KPIs actualizados.\n\n#### Actividades Realizadas y Objetivos Cumplidos\n\n**1. Implementaci√≥n del Sistema de Autenticaci√≥n y Autorizaci√≥n (IOC-021, IOC-022, IOC-023)**\n\nSe desarroll√≥ e implement√≥ un sistema robusto de autenticaci√≥n utilizando **Supabase Auth** integrado con **Spring Security 6** y tokens JWT. Las actividades incluyeron:\n\n- **Frontend (React + TypeScript):** Creaci√≥n de componentes de autenticaci√≥n (SignIn, SignUp) con validaci√≥n de formularios usando React Hook Form y Zod. Integraci√≥n completa con Supabase Auth incluyendo manejo de estados de sesi√≥n, persistencia de tokens y redirecci√≥n condicional por roles.\n\n- **Backend (Spring Boot 3.5.5):** Configuraci√≥n de Spring Security con filtros personalizados (`JwtRequestFilter`) para validar tokens en cada petici√≥n. Implementaci√≥n de `AuthController` y `AuthService` para gestionar el login y generaci√≥n d"
    },
    {
      "path": ".gemini/context/ASSESSMENT-FULL-CODEBASE.md",
      "excerpt": "# ASSESSMENT COMPLETO - C√≥digo Fuente\n\nFecha: 2025-09-30\nResponsable: (auto generado)\n\nObjetivo\n--------\nRevisar recursivamente todo el c√≥digo fuente del proyecto y producir un informe por funcionalidad (archivo/clase/m√≥dulo) con:\n- Prop√≥sito funcional\n- Nivel de madurez (Alta/Media/Baja)\n- Calidad de c√≥digo (estilo, patrones, antipatr√≥ns detectados)\n- Cobertura de tests (qu√© pruebas existen / fallan / est√°n deshabilitadas)\n- Riesgos, defectos y observaciones t√©cnicas\n- Recomendaciones concretas y priorizadas para correcci√≥n\n\nResumen ejecutivo (r√°pido)\n--------------------------\nLa aplicaci√≥n es una Spring Boot bien estructurada con un n√∫cleo ETL robusto: parseo de archivos, sincronizaci√≥n con la BD, gesti√≥n de jobs y notificaciones WebSocket. Se incorporaron mecanismos avanzados: retry frente a violaciones UNIQUE, advisory locks para serializar ventanas, watchdog para jobs stuck y m√©tricas Micrometer. La calidad general es buena y el dise√±o modular es s√≥lido.\n\nPros\n- Arquitectura modular basada en Spring Boot: capas bien separadas (controller, service, persistence, config) que facilitan mantenimiento y extensi√≥n.\n- N√∫cleo ETL maduro: parsing defensivo, deduplicado, persistencia por batch, manejo de dimensiones y orquestaci√≥n de jobs.\n- Mecanismos resilientes: retry configurables, circuit-breaker (Resilience4j), advisory locks y watchdog para casos de jobs atascados.\n- Observabilidad integrada: Micrometer (timers, counters, summaries) y `HealthIndicator` para chequeos de integridad de la BD.\n- Soporte para notificaciones en tiempo real (WebSocket / STOMP) y control de rate-limiting por usuario.\n- Buenas pr√°cticas transaccionales: uso de `TransactionTemplate` y `REQUIRES_NEW` para aislar persistencia de dimensiones.\n- Tests presentes (unitarios e integraci√≥n) para escenarios cr√≠ticos, y uso de Testcontainers para pruebas con Postgres.\n\nContras\n- Inestabilidad en tests de concurrencia/integraci√≥n: varios tests intermitentes o deshabilitados, lo que impacta la confianz"
    },
    {
      "path": ".gemini/context/TESTING_STRATEGY.md",
      "excerpt": "# üìò **INFORME T√âCNICO: Estrategia de Testing Implementada**\n\n> **Para:** Agentes de IA y Desarrolladores Futuros  \n> **Fecha:** 2025-10-25  \n> **Proyecto:** IOC Backend  \n> **Resultado:** ‚úÖ 100% Tests Pasando\n\n---\n\n## üìä **RESUMEN EJECUTIVO**\n\n### **Problema Original**\n- ‚ùå Tests fallaban por dependencias no satisfechas (`NotificationService`, `SimpMessagingTemplate`, `MeterRegistry`)\n- ‚ùå Configuraci√≥n duplicada causaba conflictos de beans\n- ‚ùå Falta de consistencia entre tests (cada uno configurado diferente)\n- ‚ùå Tests lentos por cargar contextos completos innecesariamente\n\n### **Soluci√≥n Implementada**\n- ‚úÖ **Patr√≥n de Testing Centralizado** con `AbstractIntegrationTest` + `GlobalTestConfiguration`\n- ‚úÖ **Mocks globales** para servicios externos (WebSocket, m√©tricas, notificaciones)\n- ‚úÖ **Configuraci√≥n por perfil** (`test` para H2, `pgtest` para PostgreSQL)\n- ‚úÖ **Slice tests** donde es apropiado (`@WebMvcTest`, `@DataJpaTest`)\n\n### **Resultado**\n- ‚úÖ **Todos los tests pasan** (100% success rate)\n- ‚úÖ **Configuraci√≥n mantenible** (un solo lugar para cambios globales)\n- ‚úÖ **Tests r√°pidos** (H2 en memoria para la mayor√≠a)\n- ‚úÖ **Arquitectura escalable** (f√°cil agregar nuevos tests)\n\n---\n\n## üèóÔ∏è **ARQUITECTURA DE TESTING IMPLEMENTADA**\n\n### **Estructura de Archivos Clave**\n\n```\nsrc/test/\n‚îú‚îÄ‚îÄ java/com/cambiaso/ioc/\n‚îÇ   ‚îú‚îÄ‚îÄ AbstractIntegrationTest.java          ‚Üê Clase base para tests de integraci√≥n\n‚îÇ   ‚îú‚îÄ‚îÄ config/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GlobalTestConfiguration.java      ‚Üê Mocks globales\n‚îÇ   ‚îú‚îÄ‚îÄ controller/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardControllerTest.java      ‚Üê Usa AbstractIntegrationTest\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SecurityConfigTest.java           ‚Üê Usa AbstractIntegrationTest\n‚îÇ   ‚îú‚îÄ‚îÄ integration/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RoleManagementIntegrationTest.java ‚Üê Usa AbstractIntegrationTest\n‚îÇ   ‚îî‚îÄ‚îÄ service/\n‚îÇ       ‚îî‚îÄ‚îÄ AdvisoryLockSerializationTest.java ‚Üê Usa Testcontainers + perfil pgtest\n‚îÇ\n‚îî‚îÄ‚îÄ resources/\n    ‚îú‚îÄ‚îÄ application-test.properties           ‚Üê Config para tests con H2\n    ‚îî‚îÄ‚îÄ application-pgtest.properties         ‚Üê Co"
    },
    {
      "path": ".gemini/context/FTI_Integracion_Metabase_v3.md",
      "excerpt": "# üìò DOCUMENTO 1: GU√çA DE IMPLEMENTACI√ìN\n\n# Gu√≠a de Implementaci√≥n: Metabase Static Embedding para el Proyecto IOC\n\n## üìë Tabla de Contenidos\n\n1. [Quick Start](#quick-start)\n2. [Objetivo y Contexto](#objetivo-y-contexto)\n3. [Arquitectura del Sistema](#arquitectura-del-sistema)\n4. [Decisiones T√©cnicas Clave](#decisiones-t√©cnicas-clave)\n5. [Flujo de Datos y Seguridad](#flujo-de-datos-y-seguridad)\n6. [Consideraciones de Producci√≥n](#consideraciones-de-producci√≥n)\n7. [Troubleshooting](#troubleshooting)\n\n---\n\n## Quick Start\n\n**¬øNecesitas tener un dashboard funcionando en 15 minutos?** Sigue estos 5 pasos m√≠nimos:\n\n1. **Habilita embedding en Metabase**: `Settings` ‚Üí `Embedding` ‚Üí `Enable` ‚Üí Copia la secret key\n2. **Configura el backend**: A√±ade `METABASE_SECRET_KEY` a tus variables de entorno\n3. **Copia el c√≥digo base**: Usa el Blueprint para crear `MetabaseEmbeddingService` y `DashboardController`\n4. **Configura un dashboard**: Edita `application.yml` con el ID y roles permitidos\n5. **Renderiza en React**: Usa el componente `DashboardEmbed` con el `dashboardId`\n\nPara detalles completos, consulta el [Blueprint](#) o contin√∫a leyendo esta gu√≠a.\n\n---\n\n## Objetivo y Contexto\n\n### ¬øQu√© estamos construyendo?\n\nUna integraci√≥n segura de dashboards de **Metabase Open Source** dentro de la aplicaci√≥n IOC, donde:\n\n- Los usuarios ven dashboards **filtrados autom√°ticamente** por sus atributos (departamento, regi√≥n, ID de usuario)\n- El acceso est√° **controlado por roles** (ROLE_ADMIN, ROLE_USER, etc.)\n- Los dashboards est√°n **embebidos nativamente** en la UI de React, sin redirecciones\n- La seguridad se garantiza mediante **tokens firmados** generados en el backend\n\n### ¬øPor qu√© Static Embedding?\n\nMetabase Open Source ofrece dos m√©todos de embedding:\n\n| M√©todo                        | Seguridad         | Filtrado Din√°mico | Disponible en OSS |\n| ----------------------------- | ----------------- | ----------------- | ----------------- |\n| **Public Embedding**          | ‚ùå Ninguna        "
    },
    {
      "path": ".gemini/context/project_summary.md",
      "excerpt": "# Resumen T√©cnico del Proyecto: Inteligencia Operacional Cambiaso (IOC)\n\n> **Generado por**: M√≥dulo de IA (Full-Stack)\n> **Fecha**: 2025-10-10T19:30:00Z\n> **Versi√≥n**: 1.1-INTEGRATED\n> **Estado**: ‚úÖ Completado\n\n---\n\n## 1. Contexto del Proyecto\n\n### 1.1. Prop√≥sito\n\n**¬øQu√© es este proyecto?**\nEs una plataforma de Business Intelligence (BI) dise√±ada para automatizar la ingesta, procesamiento y visualizaci√≥n de datos de producci√≥n de la empresa Cambiaso.\n\n**Problema que Resuelve**:\nElimina la dependencia de procesos manuales en planillas de c√°lculo, centralizando los datos para permitir una toma de decisiones m√°s √°gil y basada en evidencia.\n\n**Valor para el Usuario**:\nProporciona a los administradores y gerentes dashboards interactivos y en tiempo real sobre la producci√≥n, eficiencia y otros KPIs operativos.\n\n### 1.2. Objetivos Clave\n\n1. **Ingesta de Datos Asincr√≥nica**: Procesar archivos de producci√≥n de gran tama√±o sin bloquear la interfaz de usuario.\n2. **Visualizaci√≥n Segura de Dashboards**: Integrar Metabase para mostrar dashboards, con control de acceso por roles.\n3. **Gobernanza y Monitoreo**: Proveer herramientas para auditar las cargas de datos y monitorear la salud del sistema.\n\n### 1.3. Audiencia/Usuarios\n\n- **Usuarios Primarios**: Administradores (para la carga de datos) y Gerentes/Analistas (para la visualizaci√≥n de dashboards).\n- **Roles Detectados**: `ROLE_ADMIN`, `ROLE_MANAGER`, `ROLE_USER` (inferido de `MetabaseProperties`).\n\n### 1.4. Estado Actual\n\n**Backend**:\n\n- ‚úÖ Autenticaci√≥n y autorizaci√≥n implementada.\n- ‚úÖ 3 endpoints REST implementados.\n- ‚úÖ Integraci√≥n con Supabase (Auth y DB) y Metabase.\n- ‚úÖ Pipeline ETL asincr√≥nico con monitoreo de jobs.\n- ‚úÖ Watchdog para jobs atascados.\n- ‚úÖ Sistema de cach√© y circuit breaker.\n\n**Frontend**:\n\n- ‚úÖ Flujo de autenticaci√≥n de usuario completo (Login, Logout, Signup, Reset Password).\n- ‚úÖ UI para la p√°gina de \"Ingesta de Datos\" implementada (pendiente de conexi√≥n a API).\n- ‚úÖ Integraci√≥n de dashboards de Metabase 100"
    },
    {
      "path": ".gemini/context/METABASE_INTEGRATION_ASSESSMENT.md",
      "excerpt": "# üìä Assessment de Implementaci√≥n: Integraci√≥n de Metabase\n\n**Proyecto:** IOC Backend - Inteligencia Operacional Cambiaso  \n**Fecha:** 9 de Octubre, 2025  \n**Versi√≥n:** 2.0 (Final)  \n**Estado:** ‚úÖ PRODUCTION-READY (100% completitud)\n\n---\n\n## üìã √çndice\n\n1. [Resumen Ejecutivo](#resumen-ejecutivo)\n2. [Objetivo y Arquitectura](#objetivo-y-arquitectura)\n3. [Componentes Implementados](#componentes-implementados)\n4. [Evaluaci√≥n por Pilares](#evaluaci√≥n-por-pilares)\n5. [Tests Implementados](#tests-implementados)\n6. [Issues Identificadas y Resueltas](#issues-identificadas-y-resueltas)\n7. [Infraestructura](#infraestructura)\n8. [Plan de Acci√≥n](#plan-de-acci√≥n)\n9. [Conclusiones](#conclusiones)\n\n---\n\n## 1. Resumen Ejecutivo\n\n### üéØ Estado General: **100% COMPLETADO** üéâ\n\nLa implementaci√≥n de la integraci√≥n de Metabase mediante **Static Embedding** est√° **completamente terminada y lista para producci√≥n**. El sistema permite incrustar dashboards de Metabase de forma segura en el frontend React, con un backend Spring Boot que act√∫a como intermediario de seguridad.\n\n### üìä M√©tricas de Calidad\n\n| Aspecto | Puntaje | Estado |\n|---------|---------|--------|\n| **Completitud de Implementaci√≥n** | 100% | üü¢ Perfecto |\n| **Seguridad** | 95% | üü¢ Excelente |\n| **Resiliencia** | 100% | üü¢ Perfecto |\n| **Performance** | 100% | üü¢ Perfecto |\n| **Observabilidad** | 100% | üü¢ Perfecto |\n| **Contrato API** | 100% | üü¢ Perfecto |\n| **Testing** | 100% | üü¢ Perfecto |\n| **Infraestructura** | 100% | üü¢ Perfecto |\n| **PROMEDIO GENERAL** | **99%** | üü¢ **Production-Ready** |\n\n### ‚úÖ Logros Principales\n\n1. ‚úÖ **Arquitectura de Seguridad Completa**\n   - JWT signing con validaci√≥n de secret key\n   - Protecci√≥n contra clickjacking (CSP + X-Frame-Options)\n   - Rol PostgreSQL READ-ONLY para Metabase\n   - Gesti√≥n de secretos desde variables de entorno\n\n2. ‚úÖ **Resiliencia Implementada**\n   - Circuit Breaker con Resilience4j\n   - Fallback method para degradaci√≥n graceful\n   - **Rate Limiting configurado: 10 req/60s** ‚≠ê\n   - C"
    },
    {
      "path": ".gemini/context/CHANGELOG-ETL-HARDENING.md",
      "excerpt": "# CHANGELOG - ETL Hardening\n\n## [2.0.0] - 2025-09-30 - HARDENING COMPLETO\n\n### üöÄ Nuevas Funcionalidades\n\n#### Watchdog de Jobs Zombis\n- **EtlJobWatchdog**: Detecta y termina autom√°ticamente jobs stuck\n- **Configuraci√≥n**: `etl.jobs.watchdog.enabled`, `etl.jobs.watchdog.interval-ms`, `etl.jobs.stuck.threshold-minutes`\n- **M√©trica**: `etl.jobs.watchdog.terminations` (Counter)\n- **Implementaci√≥n**: Custom repository para evitar issues con OffsetDateTime en JPQL\n\n#### Sistema de Retry Robusto\n- **Retry autom√°tico** en colisiones UNIQUE constraint\n- **Reset de IDs** para evitar stale entities tras rollback\n- **Backoff exponencial** (200ms * attempt)\n- **Configuraci√≥n**: `etl.retry.unique.enabled`, `etl.retry.unique.max-attempts`\n\n#### Observabilidad Completa (15+ m√©tricas)\n- **Core ETL**: `etl.rows.deleted`, `etl.rows.inserted`, `etl.sync.duration`\n- **Retry/Colisiones**: `etl.sync.attempts`, `etl.sync.collisions`\n- **Jobs**: `etl.job.total.duration` (Timer con tags status), `etl.jobs.active`, `etl.jobs.stuck`\n- **Ventanas**: `etl.sync.window.days`, `etl.sync.records.per.batch`\n- **Dimensiones**: `etl.dim.new.maquina`, `etl.dim.new.maquinista`\n- **Archivos**: `etl.file.size.bytes`, `etl.rows.duplicate.ratio`\n- **Integridad**: `etl.unique.index.present`, `etl.window.conflicts`\n\n### üîß Mejoras T√©cnicas\n\n#### Base de Datos\n- **√çndice UNIQUE natural**: `uq_fact_prod_natural` en (fecha_contabilizacion, maquina_fk, COALESCE(maquinista_fk,0), numero_log)\n- **Verificador autom√°tico** del √≠ndice en startup\n- **Custom repository implementation** para operaciones complejas\n\n#### DataSyncService\n- **Detecci√≥n mejorada** de UNIQUE violations (SQLState 23505, mensajes, stack trace)\n- **Reset autom√°tico de IDs** en reintentos\n- **M√©tricas integradas** en cada operaci√≥n\n- **Advisory locks** para serializaci√≥n cuando necesario\n\n#### EtlJobService  \n- **Timer autom√°tico** de duraci√≥n total de jobs\n- **Tags por status** (EXITO/FALLO) en m√©tricas\n- **Logging mejorado** de transiciones de est"
    },
    {
      "path": ".gemini/prompts-v2/03-project_summary_sync.md",
      "excerpt": "# üìÑ PROMPT 3: Project Summary Sync Validator\n\n```markdown\n# VALIDADOR Y SINCRONIZADOR DE RESUMEN T√âCNICO\n## 1. CONFIGURACI√ìN\n**Prop√≥sito**: Detectar cambios en los repositorios backend/frontend desde la √∫ltima generaci√≥n del `project-summary.md` y sincronizar el documento con el estado actual del c√≥digo.\n**Cu√°ndo usar este prompt**:\n- ‚úÖ Despu√©s de agregar/remover dependencias importantes\n- ‚úÖ Despu√©s de cambios arquitect√≥nicos\n- ‚úÖ Antes de onboarding de nuevos desarrolladores\n- ‚úÖ Peri√≥dicamente (mensual/por sprint) para mantener docs actualizadas\n- ‚úÖ Cuando sospechas que la documentaci√≥n est√° desactualizada\n**Puede ejecutarse desde**: `ioc-backend` O `ioc-frontend` (auto-detecta)\n**Salida**: \n- Reporte de divergencias\n- Documento actualizado (opcional)\n- Recomendaciones de sincronizaci√≥n\n---\n## 2. MANDATO OPERATIVO (PARA LA IA)\n**Tu Rol**: Documentation Sync Engineer con capacidad de an√°lisis de divergencias.\n**Tu Responsabilidad**:\n1. Detectar desde qu√© repositorio se ejecuta\n2. Leer el `project-summary.md` existente\n3. Analizar el c√≥digo actual de ambos repos (o del disponible)\n4. Comparar estado actual vs documentado\n5. Generar reporte de divergencias\n6. Ofrecer opciones de sincronizaci√≥n\n7. Actualizar documento si se solicita\n---\n## 3. PROTOCOLO DE SINCRONIZACI√ìN\n### FASE 1: Detecci√≥n de Contexto\n#### Acci√≥n 1.1: Identificar Repositorio Actual\n```bash\n# Script mental de detecci√≥n:\nif (existe package.json con \"react\" o \"vue\" o \"angular\"):\n REPO_ACTUAL = \"FRONTEND\"\n REPO_HERMANO = \"BACKEND\"\n RUTA_HERMANO = \"../ioc-backend\"\nelif (existe pom.xml o build.gradle):\n REPO_ACTUAL = \"BACKEND\"\n REPO_HERMANO = \"FRONTEND\"\n RUTA_HERMANO = \"../ioc-frontend\"\nelse:\n ERROR(\"No se puede determinar el tipo de repositorio\")\n DETENER()\nMODO = \"SYNC_VALIDATOR\"\n```\n\n#### Acci√≥n 1.2: Localizar Documento Existente\n\n```bash\n# Buscar project-summary.md en orden de prioridad:\nUBICACIONES_BUSQUEDA = [\n \"@.gemini/project-summary.md\", # Mismo repo\n \"../@.gemini/project-summary.md\", # Repo padre"
    },
    {
      "path": ".gemini/prompts-v2/generador_pedagogico.md",
      "excerpt": "# üéØ Prompt Completo - Generador de Documentaci√≥n Pedag√≥gica Spring Boot\n\n```markdown\nAct√∫a como un **Spring Boot Senior Developer** experto en mentor√≠a t√©cnica y arquitectura de software.\n\n**OBJETIVO**: Ayudarme a aprender Spring Boot profundamente, analizando este proyecto real desde los fundamentos hasta los detalles. Genera documentaci√≥n pedag√≥gica en 3 archivos Markdown separados.\n\n---\n\n## üìÅ FORMATO DE SALIDA (3 ARCHIVOS MARKDOWN)\n\nGenera el an√°lisis en **3 archivos Markdown separados** con esta estructura:\n\n### üìÑ Archivo 1: `01-IOC-Vision-General.md`\n**Contenido**: Fases 1 y 2 completas\n- Estructura del proyecto y arquitectura\n- Patr√≥n arquitect√≥nico identificado\n- Flujo de datos principal\n- Responsabilidades detalladas por cada capa (dto/, entity/, repository/, service/, controller/, mapper/, exception/, config/, security/)\n\n**Tama√±o**: 3000-4000 palabras\n\n---\n\n### üìÑ Archivo 2: `02-IOC-Analisis-Detallado.md`\n**Contenido**: Fase 3 completa\n- An√°lisis archivo por archivo siguiendo el orden pedag√≥gico\n- IocbackendApplication.java\n- Configuraciones (SecurityConfig, CorsConfig, etc.)\n- Entities, DTOs, Repositories, Services, Controllers\n- Mappers y Exception Handlers\n\n**Tama√±o**: 5000-7000 palabras (el m√°s extenso)\n\n---\n\n### üìÑ Archivo 3: `03-IOC-Resumen-Produccion.md`\n**Contenido**: Fases 4 y 5 completas\n- Resumen de aprendizaje con checklist de conceptos\n- Patrones de dise√±o identificados\n- Glosario completo de anotaciones\n- An√°lisis de seguridad, resiliencia y observabilidad\n- Plan de estudio sugerido\n\n**Tama√±o**: 2000-3000 palabras\n\n---\n\n**INSTRUCCIONES DE GENERACI√ìN**:\n\n1. Genera **UN ARCHIVO A LA VEZ**\n2. Al finalizar cada archivo, muestra:\n   ```\n   ‚úÖ Archivo [nombre.md] completado.\n   üìù Copia el contenido de arriba y gu√°rdalo como [nombre.md]\n   \n   ¬øContin√∫o con el siguiente archivo?\n   Responde \"CONTINUAR\" o \"PAUSA\"\n   ```\n3. Cada archivo debe:\n   - Ser completamente **auto-contenido**\n   - Incluir **√≠ndice navegable**\n   - Tener **links de navegaci√≥n** al"
    },
    {
      "path": ".gemini/prompts-v2/04-backend_sync_brief_generator_v4.md",
      "excerpt": "# Prompt Mejorado: Backend Sync Brief Generator (v4) - IOC Platform\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n\n**Prop√≥sito**: Este prompt analiza las Fichas T√©cnicas de Vista (FTVs) del proyecto IOC y genera un brief de sincronizaci√≥n validado para el equipo Backend (Spring Boot).\n\n**Acci√≥n Requerida**: Ninguna. Audita autom√°ticamente el directorio de blueprints.\n\n**Modo de Uso**: Copia y pega en Gemini CLI.\n\n---\n\n## 2. CONTEXTO DEL PROYECTO (MAPA MENTAL DE LA IA)\n\n### Stack Tecnol√≥gico Target\n\n**Frontend**: React 19 + TypeScript + Vite + Tailwind CSS  \n**Backend**: Spring Boot 3 + Java 21 + PostgreSQL  \n**Auth**: Supabase (JWT Provider)  \n**Analytics**: Metabase (AWS EC2)\n\n### Arquitectura de Informaci√≥n\n\n```\n@.gemini/blueprints/       ‚Üê Fuente primaria (FTVs)\n@.gemini/sprints/          ‚Üê Contexto de negocio (backlog)\n@.gemini/sprints/backend_sync_brief.md ‚Üê Archivo de salida\n```\n\n---\n\n## 3. MANDATO OPERATIVO (PARA LA IA)\n\n**Tu Rol**: Lead Software Architect especializado en contratos de API para arquitecturas desacopladas.\n\n**Tu Misi√≥n**: Generar un \"Backend Sync Brief\" que traduzca requisitos de UI en especificaciones de API en formato TypeScript, listas para implementaci√≥n en Spring Boot.\n\n---\n\n## 4. PROTOCOLO DE EJECUCI√ìN (MANDATORIO)\n\n### **Fase 1: An√°lisis y Extracci√≥n**\n\n#### Acci√≥n 1.1: Escaneo de Fuentes\n- Identifica todos los archivos `.md` en `@.gemini/blueprints/`\n- Extrae TODOS los bloques que contengan:\n  - `Endpoint:` o `API Endpoint:`\n  - Bloques de c√≥digo TypeScript/interfaces\n  - Secciones \"Contrato de API\" o \"Backend Requirements\"\n\n#### Acci√≥n 1.2: Normalizaci√≥n\nPara cada endpoint encontrado, extrae:\n\n```typescript\n{\n  method: \"GET\" | \"POST\" | \"PUT\" | \"DELETE\",\n  path: string,                    // ej: /api/v1/etl/upload\n  purpose: string,                 // Descripci√≥n del negocio\n  source_ftv: string[],            // Archivos de origen\n  auth_required: boolean,          // Default: true\n  roles: string[],                 // ej: [\"ADMIN\", \"ANALYST\"]"
    },
    {
      "path": ".gemini/prompts-v2/09-validate-blueprint-implementation.md",
      "excerpt": "# üìÑ PROMPT 9 MEJORADO: Multi-Blueprint Feature Validator\n\n**Archivo**: `@.gemini/prompts/09-validate-blueprint-implementation.md` (versi√≥n mejorada)\n\n```markdown\n# VALIDADOR DE IMPLEMENTACI√ìN DE BLUEPRINTS (v2 - Multi-Feature)\n## 1. CONFIGURACI√ìN\n**Prop√≥sito**: Validar implementaciones de c√≥digo contra blueprints, con soporte para:\n- ‚úÖ Validaci√≥n individual (1 blueprint ‚Üí 1 archivo)\n- ‚úÖ Validaci√≥n de feature completa (N blueprints ‚Üí M archivos)\n**Input**: \n- **Modo Single**: 1 blueprint + 1 archivo de c√≥digo\n- **Modo Feature**: M√∫ltiples blueprints + m√∫ltiples archivos de c√≥digo\n**Output**: \n- Reporte de validaci√≥n con score global\n- An√°lisis de consistencia entre componentes (solo modo Feature)\n- Matriz de integraci√≥n (solo modo Feature)\n- Recomendaciones accionables\n**Audiencia**: Desarrollador, Code Reviewer, Tech Lead, QA Lead\n---\n## 2. MANDATO OPERATIVO (PARA LA IA)\n**Tu Rol**: QA Architect con experiencia en validaci√≥n de conformidad, integraci√≥n de sistemas y auditor√≠a t√©cnica.\n**Tu Misi√≥n**: \n1. Detectar el modo de validaci√≥n (Single vs Feature)\n2. Analizar blueprints y c√≥digo implementado\n3. Validar conformidad individual y coherencia grupal\n4. Identificar gaps, inconsistencias y riesgos de integraci√≥n\n5. Generar reporte con score objetivo y recomendaciones espec√≠ficas\n---\n## 3. PROTOCOLO DE EJECUCI√ìN\n### FASE 0: Detecci√≥n de Modo\n#### Acci√≥n 0.1: Solicitar Modo de Validaci√≥n\n```markdown\nüîç SELECCI√ìN DE MODO DE VALIDACI√ìN\n¬øQu√© deseas validar?\n**Opci√≥n A: Validaci√≥n Individual (Single)**\nValida un componente/clase contra su blueprint espec√≠fico.\nIdeal para: Code review de un componente, validar refactor.\n**Opci√≥n B: Validaci√≥n de Feature Completa (Feature)**\nValida m√∫ltiples componentes relacionados de una misma feature.\nIdeal para: Validar feature antes de merge, QA de sprint.\n¬øQu√© modo deseas usar? (A/B)\n[ESPERAR RESPUESTA]\n```\n\n---\n\n### MODO A: Validaci√≥n Individual (Single)\n\n**[Usar el flujo del prompt anterior - FASES 1-5 sin cambios]**\n---\n\n### MODO B: "
    },
    {
      "path": ".gemini/prompts-v2/01-project_summary_backend_generator.md",
      "excerpt": "# Soluci√≥n: Prompts Coordinados para Multi-Repo\n\nPerfecto, vamos a crear **3 prompts especializados** que trabajan en secuencia:\n\n1. **Backend Prompt** ‚Üí Genera el esqueleto con contexto arquitect√≥nico\n2. **Frontend Prompt** ‚Üí Completa las secciones espec√≠ficas de UI/UX\n3. **Merger Prompt** (opcional) ‚Üí Sincroniza si se ejecutaron en paralelo\n\n---\n\n## üìÑ PROMPT 1: Backend - Project Summary Generator\n\n```markdown\n# GENERADOR DE RESUMEN T√âCNICO - M√ìDULO BACKEND\n\n## 1. CONFIGURACI√ìN\n\n**Contexto de Ejecuci√≥n**: Este prompt se ejecuta en el repositorio `ioc-backend`.\n\n**Objetivo**: Generar el documento base `project-summary.md` con:\n- ‚úÖ Toda la informaci√≥n arquitect√≥nica\n- ‚úÖ Stack completo de backend\n- ‚úÖ Base de datos y servicios externos\n- ‚úÖ Seguridad y autenticaci√≥n\n- ‚è≥ Placeholders para que el frontend complete sus secciones\n\n**Salida**: `@.gemini/project-summary.md` (versi√≥n backend completa con TODOs para frontend)\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\n**Tu Rol**: Tech Lead de Backend con visi√≥n arquitect√≥nica completa.\n\n**Tu Responsabilidad**:\n1. Analizar el repositorio backend\n2. Generar documento completo de arquitectura\n3. Dejar secciones espec√≠ficas de frontend marcadas con `<!-- FRONTEND: completar -->`\n4. Crear archivo de instrucciones para el equipo frontend\n\n---\n\n## 3. PROTOCOLO DE AN√ÅLISIS\n\n### FASE 1: Detecci√≥n de Contexto\n\nEjecuta este script mental:\n\n```bash\n# Verificar que estamos en el repositorio correcto\n¬øExiste pom.xml o build.gradle? ‚Üí Backend Java confirmado\n¬øExiste src/main/java/? ‚Üí Estructura Spring Boot confirmada\n¬øExiste package.json? ‚Üí ERROR: Est√°s en el repo frontend\n\n# Si est√°s en el repo correcto:\nMODO = \"BACKEND\"\nGENERAR = \"Documento completo con placeholders frontend\"\n```\n\n### FASE 2: An√°lisis Backend Completo\n\nRealiza escaneo profundo de:\n\n#### 2.1. Configuraci√≥n Spring Boot\n\n```java\n// Archivos a analizar:\n- pom.xml ‚Üí Dependencias y versiones\n- src/main/resources/application.properties ‚Üí Configuraci√≥n\n- src/main/resources/applica"
    },
    {
      "path": ".gemini/prompts-v2/backend_sync_brief_generator_v4.md",
      "excerpt": "# Prompt Mejorado: Backend Sync Brief Generator (v4) - IOC Platform\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n\n**Prop√≥sito**: Este prompt analiza las Fichas T√©cnicas de Vista (FTVs) del proyecto IOC y genera un brief de sincronizaci√≥n validado para el equipo Backend (Spring Boot).\n\n**Acci√≥n Requerida**: Ninguna. Audita autom√°ticamente el directorio de blueprints.\n\n**Modo de Uso**: Copia y pega en Gemini CLI.\n\n---\n\n## 2. CONTEXTO DEL PROYECTO (MAPA MENTAL DE LA IA)\n\n### Stack Tecnol√≥gico Target\n\n**Frontend**: React 19 + TypeScript + Vite + Tailwind CSS  \n**Backend**: Spring Boot 3 + Java 21 + PostgreSQL  \n**Auth**: Supabase (JWT Provider)  \n**Analytics**: Metabase (AWS EC2)\n\n### Arquitectura de Informaci√≥n\n\n```\n@.gemini/blueprints/       ‚Üê Fuente primaria (FTVs)\n@.gemini/sprints/          ‚Üê Contexto de negocio (backlog)\n@.gemini/sprints/backend_sync_brief.md ‚Üê Archivo de salida\n```\n\n---\n\n## 3. MANDATO OPERATIVO (PARA LA IA)\n\n**Tu Rol**: Lead Software Architect especializado en contratos de API para arquitecturas desacopladas.\n\n**Tu Misi√≥n**: Generar un \"Backend Sync Brief\" que traduzca requisitos de UI en especificaciones de API en formato TypeScript, listas para implementaci√≥n en Spring Boot.\n\n---\n\n## 4. PROTOCOLO DE EJECUCI√ìN (MANDATORIO)\n\n### **Fase 1: An√°lisis y Extracci√≥n**\n\n#### Acci√≥n 1.1: Escaneo de Fuentes\n- Identifica todos los archivos `.md` en `@.gemini/blueprints/`\n- Extrae TODOS los bloques que contengan:\n  - `Endpoint:` o `API Endpoint:`\n  - Bloques de c√≥digo TypeScript/interfaces\n  - Secciones \"Contrato de API\" o \"Backend Requirements\"\n\n#### Acci√≥n 1.2: Normalizaci√≥n\nPara cada endpoint encontrado, extrae:\n\n```typescript\n{\n  method: \"GET\" | \"POST\" | \"PUT\" | \"DELETE\",\n  path: string,                    // ej: /api/v1/etl/upload\n  purpose: string,                 // Descripci√≥n del negocio\n  source_ftv: string[],            // Archivos de origen\n  auth_required: boolean,          // Default: true\n  roles: string[],                 // ej: [\"ADMIN\", \"ANALYST\"]"
    },
    {
      "path": ".gemini/prompts-v2/ftv-generador-refine.md",
      "excerpt": "# üéØ S√≠, Refine tiene soporte oficial para Supabase\n\n## üì¶ Paquete Oficial\n\n```bash\nnpm install @refinedev/supabase @supabase/supabase-js\n```\n\n---\n\n## ‚ö†Ô∏è IMPORTANTE: Tu Caso Espec√≠fico\n\nEn tu proyecto tienes una arquitectura h√≠brida:\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Frontend (React + Refine)                  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Backend REST API (Spring Boot)             ‚îÇ  ‚Üê Tu API custom\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Supabase Auth (JWT)                        ‚îÇ  ‚Üê Solo autenticaci√≥n\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  PostgreSQL en Supabase                     ‚îÇ  ‚Üê Solo base de datos\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### ‚ùå NO uses `@refinedev/supabase` para Data Provider\n\n**Raz√≥n**: Tu backend es Spring Boot con endpoints REST custom (`/api/v1/admin/users`, etc.), NO la API auto-generada de Supabase.\n\n**Usa**: Data Provider REST gen√©rico de Refine.\n\n### ‚úÖ S√ç usa `@refinedev/supabase` para Auth Provider\n\n**Raz√≥n**: S√≠ usas Supabase Auth para autenticaci√≥n JWT.\n\n---\n\n## üìã Actualizaci√≥n del Prompt para el Agente IA\n\n# üìã Instrucciones para Generaci√≥n de FTV - IOC-004 (Actualizado)\n\n**Destinatario**: Agente IA Generador de Componentes  \n**Proyecto**: User Role Management Frontend  \n**Versi√≥n**: 1.1\n\n---\n\n## üéØ Objetivo\n\nGenerar componentes frontend (FTV) que implementen operaciones CRUD utilizando una arquitectura espec√≠fica de 3 capas:\n\n```\nCapa 1: Refine Core (solo hooks de l√≥gica, SIN componentes visuales)\nCapa 2: TailAdmin v2.0.1 (componentes UI puros)\nCapa 3: React Hook Form + Zod (gesti√≥n de formularios y validaci√≥n)\n```\n\n---\n\n## üì¶ Dependencias Requeridas\n\nInstalar las **√∫ltimas versiones** de:\n\n### Capa de L√≥gica (Refine Headless)\n- `@refinedev/core`\n- `@refinedev/react-router-v6`\n- `@refinedev/react-hook-form`\n\n### ‚ö° NUEVO: Integraci√≥n Supabase\n- `@refinedev/supabase` (solo para Auth Provider)\n- `@supabase/supabase-js`\n\n### Capa de Formularios y Validaci√≥n"
    },
    {
      "path": ".gemini/prompts-v2/02-project_summary_frontend_generator.md",
      "excerpt": "# üìÑ PROMPT 2: Frontend - Project Summary Completer\n\n```markdown\n# COMPLETADOR DE RESUMEN T√âCNICO - M√ìDULO FRONTEND\n\n## 1. CONFIGURACI√ìN\n\n**Contexto de Ejecuci√≥n**: Este prompt se ejecuta en el repositorio `ioc-frontend`.\n\n**Objetivo**: Leer el `project-summary.md` generado por el backend y completar todas las secciones espec√≠ficas de frontend.\n\n**Prerequisito**: El Backend Module debe haber generado el archivo base.\n\n**Salida**: `@.gemini/project-summary.md` (versi√≥n completa y sincronizada)\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\n**Tu Rol**: Frontend Lead con conocimiento profundo de arquitectura de UI.\n\n**Tu Responsabilidad**:\n1. Leer el archivo `project-summary.md` existente (generado por backend)\n2. Identificar TODAS las secciones marcadas con `<!-- FRONTEND: completar -->`\n3. Analizar el repositorio frontend\n4. Completar las secciones faltantes\n5. Validar consistencia con la informaci√≥n del backend\n6. Actualizar metadatos de sincronizaci√≥n\n\n---\n\n## 3. PROTOCOLO DE EJECUCI√ìN\n\n### FASE 1: Validaci√≥n de Pre-requisitos\n\n#### Acci√≥n 1.1: Verificar Repositorio Correcto\n\n```bash\n# Ejecuta este script mental:\n\n¬øExiste package.json con \"react\" o \"vue\" o \"angular\"? ‚Üí ‚úÖ Frontend confirmado\n¬øExiste pom.xml o solo archivos Java? ‚Üí ‚ùå ERROR: Est√°s en el repo backend\n¬øExiste src/ con estructura de frontend? ‚Üí ‚úÖ Continuar\n\n# Resultado esperado:\nMODO = \"FRONTEND\"\n```\n\n**Si est√°s en el repositorio incorrecto**:\n\n```markdown\n‚ùå ERROR: Repositorio Incorrecto\n\nEste prompt est√° dise√±ado para ejecutarse en el repositorio FRONTEND (ioc-frontend).\n\nRepositorio detectado: [ioc-backend / otro]\n\nüîß Acci√≥n requerida:\n1. Navega al repositorio correcto: `cd ../ioc-frontend`\n2. Vuelve a ejecutar este prompt\n\nDETENER EJECUCI√ìN\n```\n\n---\n\n#### Acci√≥n 1.2: Verificar Existencia del Archivo Base\n\n```bash\n# Buscar archivo en:\nRUTA_1: @.gemini/project-summary.md (mismo repo)\nRUTA_2: ../@.gemini/project-summary.md (repo padre compartido)\nRUTA_3: ../ioc-backend/@.gemini/project-summary.md (repo herman"
    },
    {
      "path": ".gemini/prompts-v2/06-generate-technical-design.md",
      "excerpt": "# GENERADOR DE TECHNICAL DESIGN (v1)\n\n## 1. CONFIGURACI√ìN\n\n**Prop√≥sito**: Convertir un Feature Plan aprobado en un Technical Design detallado con arquitectura, modelo de datos, contratos de API y plan de implementaci√≥n completo.\n\n**Input**: \n- Feature Plan espec√≠fico (`FP-XXX-nombre.md`)\n- Project Summary (`@.gemini/project-summary.md`)\n\n**Output**: \n- `@.gemini/sprints/technical-designs/TD-XXX-[nombre].md`\n- Checklist de implementaci√≥n\n\n**Audiencia**: Tech Lead, Desarrolladores (Backend y Frontend), DevOps\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\n**Tu Rol**: Senior Software Architect con experiencia en arquitecturas fullstack (React + Spring Boot), bases de datos relacionales, y mejores pr√°cticas de desarrollo.\n\n**Tu Misi√≥n**: \n1. Leer y comprender el Feature Plan completamente\n2. Analizar el contexto t√©cnico actual (Project Summary)\n3. Dise√±ar la arquitectura t√©cnica √≥ptima para la feature\n4. Generar contratos de API completos y precisos\n5. Dise√±ar modelo de datos normalizado y eficiente\n6. Proveer c√≥digo de ejemplo para guiar la implementaci√≥n\n7. Identificar consideraciones de performance, seguridad y escalabilidad\n8. Crear un plan de testing comprehensivo\n\n---\n\n## 3. PROTOCOLO DE EJECUCI√ìN\n\n### FASE 1: Carga de Contexto\n\n#### Acci√≥n 1.1: Validar que se Proporcione el Feature Plan\n\n```markdown\nüîç SOLICITUD DE FEATURE PLAN\n\nPara generar un Technical Design, necesito el Feature Plan a implementar.\n\nPor favor proporciona:\n\n**Opci√≥n A**: ID del Feature Plan\nEjemplo: FP-005\n\n**Opci√≥n B**: Ruta completa del archivo\nEjemplo: @.gemini/sprints/feature-plans/FP-005-real-time-notifications.md\n\n**Opci√≥n C**: Pega el contenido del Feature Plan aqu√≠\n\n[ESPERAR RESPUESTA]\n```\n\n**Si el usuario proporciona solo un ID**:\n\n```bash\n# Buscar el archivo autom√°ticamente\nRUTA = \"@.gemini/sprints/feature-plans/\"\nPATRON = \"FP-{ID}-*.md\"\n\n# Buscar archivo que coincida\nARCHIVO_ENCONTRADO = buscar(RUTA + PATRON)\n\nif not ARCHIVO_ENCONTRADO:\n    ERROR(\"No se encontr√≥ Feature Plan con ID: {ID}"
    },
    {
      "path": ".gemini/prompts-v2/08-generate-backend-service-spec.md",
      "excerpt": "# üìÑ PROMPT 8: Backend Service Specification (BSS) Generator (Parte 2)\n\n## PARTE 2: El Prompt Generador\n\n**Archivo**: `@.gemini/prompts/08-generate-backend-service-spec.md`\n\n```markdown\n# GENERADOR DE BACKEND SERVICE SPECIFICATIONS (BSS) (v1)\n\n## 1. CONFIGURACI√ìN\n\n**Prop√≥sito**: Convertir un Technical Design aprobado en Backend Service Specifications (BSS) detalladas para cada clase de backend (Services, Controllers, Repositories), listas para implementaci√≥n.\n\n**Input**: \n- Technical Design espec√≠fico (`TD-XXX-nombre.md`)\n- Project Summary (`@.gemini/project-summary.md`)\n\n**Output**: \n- M√∫ltiples BSS: `@.gemini/blueprints/backend/bss-[clase].md` (una por clase)\n- √çndice de especificaciones generadas\n\n**Audiencia**: Desarrolladores Backend, Tech Lead, QA\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\n**Tu Rol**: Backend Architect con experiencia en Spring Boot, arquitectura en capas, patrones de dise√±o y mejores pr√°cticas de desarrollo Java empresarial.\n\n**Tu Misi√≥n**: \n1. Leer y comprender el Technical Design completamente\n2. Identificar TODAS las clases backend necesarias\n3. Para cada clase, generar una BSS completa con:\n   - Interfaz p√∫blica y firma de m√©todos\n   - Implementaci√≥n detallada con c√≥digo ejecutable\n   - Reglas de negocio y validaciones\n   - Manejo de transacciones y errores\n   - Tests unitarios y de integraci√≥n completos\n4. Asegurar consistencia entre BSS (naming, patrones, excepciones)\n5. Generar c√≥digo Java production-ready\n6. Proveer checklist de implementaci√≥n\n\n---\n\n## 3. PROTOCOLO DE EJECUCI√ìN\n\n### FASE 1: Carga y An√°lisis del Technical Design\n\n#### Acci√≥n 1.1: Solicitar Technical Design\n\n```markdown\nüîç SOLICITUD DE TECHNICAL DESIGN\n\nPara generar Backend Service Specifications, necesito el Technical Design.\n\nPor favor proporciona:\n\n**Opci√≥n A**: ID del Technical Design\nEjemplo: TD-005\n\n**Opci√≥n B**: Ruta completa del archivo\nEjemplo: @.gemini/sprints/technical-designs/TD-005-real-time-notifications.md\n\n**Opci√≥n C**: Pega el contenido del Technical Des"
    },
    {
      "path": ".gemini/prompts-v2/05-generate-feature-plan.md",
      "excerpt": "# GENERADOR DE FEATURE PLAN (v1)\n## 1. CONFIGURACI√ìN\n**Prop√≥sito**: Convertir una idea o requerimiento de negocio en un Feature Plan estructurado y completo, listo para ser convertido en Technical Design.\n**Input**: \n- Idea/requerimiento del usuario (texto libre)\n- Context: `@.gemini/project-summary.md`\n**Output**: \n- `@.gemini/sprints/feature-plans/FP-XXX-[nombre].md`\n- Checklist de pr√≥ximos pasos\n**Audiencia del Documento**: Product Owner, Tech Lead, Stakeholders, Equipo de Desarrollo\n---\n## 2. MANDATO OPERATIVO (PARA LA IA)\n**Tu Rol**: Product Manager Senior con experiencia t√©cnica, capaz de traducir ideas de negocio en especificaciones accionables.\n**Tu Misi√≥n**: \n1. Entender profundamente la idea/problema del usuario\n2. Hacer preguntas clarificadoras si falta informaci√≥n cr√≠tica\n3. Leer el contexto del proyecto (project-summary.md)\n4. Generar un Feature Plan completo siguiendo la plantilla\n5. Asegurar que es accionable (no ambiguo, con criterios medibles)\n---\n## 3. PROTOCOLO DE EJECUCI√ìN\n### FASE 1: Recopilaci√≥n de Informaci√≥n\n#### Acci√≥n 1.1: Identificar Tipo de Input\nEl usuario puede proporcionar el requerimiento en diferentes formatos:\n**Formato A: Idea General** (m√°s com√∫n)\n```\n\n\"Quiero agregar notificaciones en tiempo real para cuando termine un trabajo ETL\"\n\n```\n**Formato B: Historia de Usuario**\n```\n\nComo administrador, quiero recibir notificaciones cuando un archivo termine de procesarse,\npara no tener que refrescar manualmente la p√°gina.\n\n```\n**Formato C: Problema Espec√≠fico**\n```\n\nLos usuarios se quejan de que no saben cu√°ndo termina el procesamiento de archivos.\nTenemos que reducir el tiempo de espera percibido.\n\n```\n**Formato D: Requerimiento T√©cnico**\n```\n\nNecesitamos implementar WebSocket para push notifications desde el backend.\n\n```\n**Tu tarea**: Detectar el formato y extraer:\n- `problema_core`: ¬øQu√© problema se intenta resolver?\n- `solucion_propuesta`: ¬øHay alguna soluci√≥n espec√≠fica mencionada?\n- `usuarios_afectados`: ¬øQui√©nes se benefician?\n-"
    },
    {
      "path": ".gemini/prompts-v2/07-generate-blueprint-ftv.md",
      "excerpt": "# üìÑ PROMPT 7: Blueprint/FTV Generator (Parte 2)\n\n## PARTE 2: El Prompt Generador\n\n**Archivo**: `@.gemini/prompts/07-generate-blueprint-ftv.md`\n\n```markdown\n# GENERADOR DE BLUEPRINTS/FTVs (v1)\n\n## 1. CONFIGURACI√ìN\n\n**Prop√≥sito**: Convertir un Technical Design aprobado en Fichas T√©cnicas de Vista (FTVs) detalladas para cada componente frontend, listas para implementaci√≥n.\n\n**Input**: \n- Technical Design espec√≠fico (`TD-XXX-nombre.md`)\n- Project Summary (`@.gemini/project-summary.md`)\n\n**Output**: \n- M√∫ltiples FTVs: `@.gemini/blueprints/ftv-[componente].md` (una por componente)\n- √çndice de blueprints generados\n\n**Audiencia**: Desarrolladores Frontend, QA, UX Designer\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\n**Tu Rol**: Frontend Architect con experiencia en React, arquitectura de componentes, accesibilidad y mejores pr√°cticas de desarrollo UI.\n\n**Tu Misi√≥n**: \n1. Leer y comprender el Technical Design completamente\n2. Identificar TODOS los componentes frontend necesarios\n3. Para cada componente, generar una FTV completa con:\n   - Especificaci√≥n visual detallada\n   - Props, estado y l√≥gica\n   - Contratos de API consumidos\n   - Manejo de errores y estados\n   - Tests y accesibilidad\n4. Asegurar consistencia entre FTVs (naming, patrones, estilos)\n5. Generar c√≥digo de ejemplo ejecutable\n6. Proveer checklist de implementaci√≥n\n\n---\n\n## 3. PROTOCOLO DE EJECUCI√ìN\n\n### FASE 1: Carga y An√°lisis del Technical Design\n\n#### Acci√≥n 1.1: Solicitar Technical Design\n\n```markdown\nüîç SOLICITUD DE TECHNICAL DESIGN\n\nPara generar Blueprints/FTVs, necesito el Technical Design a implementar.\n\nPor favor proporciona:\n\n**Opci√≥n A**: ID del Technical Design\nEjemplo: TD-005\n\n**Opci√≥n B**: Ruta completa del archivo\nEjemplo: @.gemini/sprints/technical-designs/TD-005-real-time-notifications.md\n\n**Opci√≥n C**: Pega el contenido del Technical Design aqu√≠\n\n[ESPERAR RESPUESTA]\n```\n\n**Si el usuario proporciona solo un ID**:\n\n```bash\n# Buscar el archivo autom√°ticamente\nRUTA = \"@.gemini/sprints/technical-desi"
    },
    {
      "path": ".gemini/prompts-v2/project_summary_backend_generator.md",
      "excerpt": "# Generador de Resumen de Proyecto Backend (prompts-v2)\n\nEste documento proporciona una plantilla y gu√≠a para generar res√∫menes de proyectos backend usando un prompt estandarizado (versi√≥n v2). Est√° pensado para integrarse en pipelines de an√°lisis o en asistentes que deben producir un resumen t√©cnico, prioridades y tareas accionables a partir del c√≥digo fuente y la configuraci√≥n del repositorio.\n\nProp√≥sito\n- Proveer una salida consistente y estructurada que describa el estado, alcance, riesgos, dependencias y pr√≥ximos pasos de un proyecto backend.\n- Facilitar que herramientas autom√°ticas o revisores humanos obtengan r√°pidamente una visi√≥n √∫til y reproducible.\n\nAlcance\n- Orientado a proyectos backend Java (Spring/Maven) pero aplicable a otros stacks con peque√±a adaptaci√≥n.\n- Analiza: estructura de carpetas, ficheros de configuraci√≥n (pom.xml, application*.properties), scripts Docker/compose, y tests.\n\nContrato (inputs / outputs)\n- Input (esperado):\n  - repo_summary: texto corto describiendo la intenci√≥n del repo (opcional si el agente puede inferirlo).\n  - files_scanned: lista de rutas y extractos relevantes (pom.xml, Dockerfile, application.properties, src/). Ideal: 3‚Äì10 fragmentos clave.\n  - env: perfil de despliegue objetivo (local, dev, prod, docker-compose).\n  - focus: (opcional) foco deseado por el solicitante (p. ej., \"priorizar errores cr√≠ticos\", \"auditor√≠a de seguridad\", \"preparar para despliegue\").\n- Output (debe generar):\n  - metadata: { projectName, mainLanguage, buildTool, runtime, repoSizeEstimate }\n  - summary: p√°rrafo de 3‚Äì6 l√≠neas con la idea central del backend y su estado.\n  - health: evaluaci√≥n corta (GREEN/YELLOW/RED) y razones.\n  - topIssues: lista priorizada (3‚Äì7) con severidad, descripci√≥n y ubicaci√≥n de archivos.\n  - techDebt: lista de items t√©cnicos a medio plazo.\n  - quickWins: 3 acciones peque√±as, r√°pidas y seguras.\n  - recommendedNextSteps: 5‚Äì10 pasos m√°s completos.\n  - commands: comandos concretos para build/test/run (basados en el repo)"
    },
    {
      "path": ".gemini/prompts-v2/project_summary_frontend_generator.md",
      "excerpt": "# üìÑ PROMPT 2: Frontend - Project Summary Completer\n\n```markdown\n# COMPLETADOR DE RESUMEN T√âCNICO - M√ìDULO FRONTEND\n\n## 1. CONFIGURACI√ìN\n\n**Contexto de Ejecuci√≥n**: Este prompt se ejecuta en el repositorio `ioc-frontend`.\n\n**Objetivo**: Leer el `project-summary.md` generado por el backend y completar todas las secciones espec√≠ficas de frontend.\n\n**Prerequisito**: El Backend Module debe haber generado el archivo base.\n\n**Salida**: `@.gemini/project-summary.md` (versi√≥n completa y sincronizada)\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\n**Tu Rol**: Frontend Lead con conocimiento profundo de arquitectura de UI.\n\n**Tu Responsabilidad**:\n1. Leer el archivo `project-summary.md` existente (generado por backend)\n2. Identificar TODAS las secciones marcadas con `<!-- FRONTEND: completar -->`\n3. Analizar el repositorio frontend\n4. Completar las secciones faltantes\n5. Validar consistencia con la informaci√≥n del backend\n6. Actualizar metadatos de sincronizaci√≥n\n\n---\n\n## 3. PROTOCOLO DE EJECUCI√ìN\n\n### FASE 1: Validaci√≥n de Pre-requisitos\n\n#### Acci√≥n 1.1: Verificar Repositorio Correcto\n\n```bash\n# Ejecuta este script mental:\n\n¬øExiste package.json con \"react\" o \"vue\" o \"angular\"? ‚Üí ‚úÖ Frontend confirmado\n¬øExiste pom.xml o solo archivos Java? ‚Üí ‚ùå ERROR: Est√°s en el repo backend\n¬øExiste src/ con estructura de frontend? ‚Üí ‚úÖ Continuar\n\n# Resultado esperado:\nMODO = \"FRONTEND\"\n```\n\n**Si est√°s en el repositorio incorrecto**:\n\n```markdown\n‚ùå ERROR: Repositorio Incorrecto\n\nEste prompt est√° dise√±ado para ejecutarse en el repositorio FRONTEND (ioc-frontend).\n\nRepositorio detectado: [ioc-backend / otro]\n\nüîß Acci√≥n requerida:\n1. Navega al repositorio correcto: `cd ../ioc-frontend`\n2. Vuelve a ejecutar este prompt\n\nDETENER EJECUCI√ìN\n```\n\n---\n\n#### Acci√≥n 1.2: Verificar Existencia del Archivo Base\n\n```bash\n# Buscar archivo en:\nRUTA_1: @.gemini/project-summary.md (mismo repo)\nRUTA_2: ../@.gemini/project-summary.md (repo padre compartido)\nRUTA_3: ../ioc-backend/@.gemini/project-summary.md (repo herman"
    },
    {
      "path": ".gemini/validation/IOC-004-blueprint-validation.md",
      "excerpt": "# VALIDACI√ìN DE IMPLEMENTACI√ìN ‚Äî IOC-004 (User Role Management)\n\nFecha: 2025-10-27\n√öltima revisi√≥n: 2025-10-27 (actualizaci√≥n: ver notas sobre versi√≥n API, create semantics y JPA Auditing)\nGenerado por: Validador multi-blueprint (v2)\nBasado en: \n- Technical Design: `.gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md`\n- BSS index: `.gemini/blueprints/backend/bss-index-IOC-004.md`\n- SQL esquema: `.gemini/sql/schema-user-role-management-unified.sql`\n\nResumen ejecutivo (r√°pido)\n-------------------------\nSe ha validado la implementaci√≥n backend de IOC-004 contra los blueprints enumerados en `bss-index-IOC-004.md`.\nResultado global: 94 / 100 ‚Äî Muy alta madurez funcional; se han aplicado correcciones recientes solicitadas (prefijo `/api/v1` en controladores, `201 Created` en POST, y configuraci√≥n de JPA Auditing).  Solo queda pendiente la generaci√≥n/documentaci√≥n OpenAPI autom√°tica (no se detect√≥ la dependencia `springdoc` en el `pom.xml`).\n\nResumen de hallazgos clave (actualizado)\n- ‚úÖ Implementado y verificado: entidades JPA, repositorios, servicios, controllers admin (ahora con prefijo `/api/v1`), mappers (MapStruct), validadores, handlers de excepci√≥n, `SecurityConfig` (Jwt->ROLE mapping), tests unitarios y de integraci√≥n (Testcontainers), y el script SQL con RLS y funciones (`has_role`, `has_permission`).\n- ‚úÖ Correcciones aplicadas recientemente:\n  - Versionado de API: controladores expuestos bajo `/api/v1/admin/*` ‚Äî ver `src/main/java/com/cambiaso/ioc/controller/admin/*`.\n  - Sem√°ntica REST: endpoints `create` ahora devuelven `201 Created` y establecen `Location` al recurso creado.\n  - Auditor√≠a JPA: existe `src/main/java/com/cambiaso/ioc/config/JpaAuditingConfig.java` con `@EnableJpaAuditing`.\n- ‚ö†Ô∏è Pendiente: Documentaci√≥n OpenAPI/Swagger ‚Äî no se detect√≥ la dependencia `springdoc-openapi` ni anotaciones OpenAPI en el c√≥digo fuente. Si la dependencia fue a√±adida localmente, confirma que se ha commiteado; si no, puedo agregar `springdoc` y gene"
    },
    {
      "path": ".gemini/evidencias/Sprint-2-Backlog_backup_20251014.md",
      "excerpt": "# Sprint 2 ‚Äì Sprint Backlog (Desatando la Interactividad Anal√≠tica)\n\n## Metadata del Sprint\n\n**Proyecto:** Plataforma IOC - Sistema de Business Intelligence  \n**Sprint:** Sprint 2 - Interactividad Anal√≠tica  \n**Per√≠odo:** 6 de Octubre - 25 de Octubre, 2025  \n**Duraci√≥n:** 3 semanas (15 d√≠as h√°biles)  \n**Equipo:**\n- **Product Owner:** Boris Arriagada\n- **Scrum Master:** Jaime Vicencio\n- **Development Team:** Boris Arriagada (Backend/Frontend), Jaime Vicencio (Frontend/Backend)\n\n**Festivos/No laborables:** Ninguno durante este per√≠odo\n\n**Velocity del Equipo:** ~10 SP/semana (basado en Sprint 1: 41 SP en 4 semanas)  \n**Capacidad del Sprint:** 21 Story Points\n\n---\n\n## üéØ SPRINT GOAL\n\n**\"Transformar el dashboard est√°tico en una herramienta de an√°lisis interactiva donde el usuario final pueda filtrar datos por l√≠nea, per√≠odo y taller, adem√°s de comparar desempe√±o entre turnos y l√≠neas para investigar patrones de rendimiento y exportar resultados.\"**\n\nAl finalizar este Sprint, los gerentes y supervisores podr√°n:\n- Aplicar filtros din√°micos a los dashboards para an√°lisis espec√≠ficos\n- Comparar m√©tricas entre diferentes turnos, l√≠neas y per√≠odos\n- Exportar visualizaciones y datos en formato PDF/Excel para reportes\n- Identificar patrones de rendimiento y oportunidades de mejora mediante comparativas interactivas\n\n**Valor de Negocio:** Habilitar an√°lisis profundo y toma de decisiones basada en comparativas, eliminando la necesidad de exportar a herramientas externas.\n\n---\n\n## Historias Comprometidas\n\n| ID | T√≠tulo | Tipo | Feature | Prioridad | SP | Asignado | Estado |\n| :--- | :--- | :--- | :--- | :--- | :-: | :--- | :--- |\n| IOC-008 | Como gerente, quiero comparar el desempe√±o entre turnos y l√≠neas para identificar patrones y oportunidades de mejora. | Historia de Usuario | An√°lisis Comparativo | Cr√≠tica | 13 | Boris | üìã Backlog |\n| IOC-012 | Como supervisor-analista, quiero filtrar datos por l√≠nea, periodo y taller para realizar an√°lisis detallados y espec√≠ficos. | Historia "
    },
    {
      "path": ".gemini/evidencias/Sprint-1-Backlog.md",
      "excerpt": "# Sprint 1 ‚Äì Sprint Backlog (El Ciclo de Valor Completo)\n\n## Objetivo del Sprint\nEntregar un ciclo de valor de extremo a extremo: un usuario podr√° autenticarse, cargar datos de producci√≥n a trav√©s de un archivo CSV y visualizar inmediatamente un dashboard con KPIs y gr√°ficos que reflejen esa nueva informaci√≥n.\n\n## Historias Comprometidas\n| ID | T√≠tulo | Tipo | Feature | Prioridad | SP | Asignado | Estado |\n| :--- | :--- | :--- | :--- | :--- | :-: | :--- | :--- |\n| IOC-021 | Como usuario, quiero iniciar sesi√≥n en la plataforma para acceder a las funcionalidades que corresponden a mi rol. | Historia de Usuario | Autenticaci√≥n | Cr√≠tica | 5 | Jaime | ‚úÖ Terminada |\n| IOC-022 | Como usuario, quiero cerrar sesi√≥n de forma segura para proteger mi cuenta cuando termino de usar la plataforma. | Historia de Usuario | Autenticaci√≥n | Cr√≠tica | 2 | Jaime | ‚úÖ Terminada |\n| IOC-023 | Como usuario, quiero navegar entre las secciones principales de la aplicaci√≥n para acceder f√°cilmente a las diferentes funcionalidades. | Historia de Usuario | Infraestructura Frontend | Cr√≠tica | 8 | Jaime | ‚úÖ Terminada |\n| IOC-001 | Como administrador, quiero cargar y validar archivos de producci√≥n para asegurar que solo datos fiables y de alta calidad se carguen en la base de datos. | Historia de Usuario | Ingesta de Datos | Cr√≠tica | 13 | Boris | ‚úÖ Terminada |\n| IOC-006 | Como gerente, quiero visualizar un dashboard con KPIs actualizados para tomar decisiones informadas sobre la operaci√≥n de manera r√°pida y eficiente. | Historia de Usuario | Visualizaci√≥n de Datos | Cr√≠tica | 13 | Boris | ‚úÖ Terminada |\n\n### Criterios de Aceptaci√≥n\n\n**IOC-021: Como usuario, quiero iniciar sesi√≥n en la plataforma para acceder a las funcionalidades que corresponden a mi rol.**\n- ‚úÖ Login exitoso: Al ingresar credenciales correctas, el sistema inicia sesi√≥n y redirige al dashboard\n- ‚úÖ Login fallido: Al ingresar credenciales incorrectas, el sistema muestra un mensaje de error y no permite el acceso\n- ‚úÖ Redirecci√≥n post"
    },
    {
      "path": ".gemini/evidencias/VALIDACION_FEATURE_FTV_INGESTA_CLIENTE.md",
      "excerpt": "# VALIDACI√ìN DE IMPLEMENTACI√ìN VS BLUEPRINTS\n\nFeature: Validaci√≥n client-side para Ingesta de Datos (FTV-001..FTV-005)\nFecha: 2025-10-20\nAutor: QA Architecture (autogenerado)\nEstado: En revisi√≥n\n\n---\n\n1. Alcance y fuentes\n\n- Blueprints (FTVs) revisados\n  - .gemini/blueprints/ftv-file-validator.md (FTV-001)\n  - .gemini/blueprints/ftv-use-file-validation.md (FTV-002)\n  - .gemini/blueprints/ftv-file-preview.md (FTV-003)\n  - .gemini/blueprints/ftv-file-validation-result.md (FTV-004)\n  - .gemini/blueprints/ftv-data-upload-dropzone-integration.md (FTV-005)\n- C√≥digo implementado\n  - src/services/FileValidator.ts\n  - src/hooks/useFileValidation.ts\n  - src/components/FilePreview.tsx\n  - src/components/FileValidationResult.tsx\n  - src/components/admin/DataUploadDropzone.tsx\n  - src/types/file-validation.types.ts\n\n---\n\n2. Resumen ejecutivo y puntuaci√≥n (ACTUALIZADO)\n\n- Resultado global: 92/100 (EXCELENTE)\n- Cobertura de blueprints: 5/5 componentes implementados e integrados.\n- Estado clave: La integraci√≥n P0 (gate de validaci√≥n en `DataUploadDropzone`) ha sido completada. El flujo ahora valida autom√°ticamente al dropear/seleccionar, muestra preview y resultado, y solo permite la subida al backend tras confirmaci√≥n del usuario cuando la validaci√≥n es exitosa.\n\nTabla de puntuaci√≥n por componente\n- FTV-001 FileValidator: 90/100\n- FTV-002 useFileValidation: 90/100\n- FTV-003 FilePreview: 90/100\n- FTV-004 FileValidationResult: 88/100\n- FTV-005 Integraci√≥n DataUploadDropzone: 96/100\n\n---\n\n3. Validaci√≥n individual por componente (resumen actualizado)\n\n3.1. FTV-001 FileValidator (src/services/FileValidator.ts)\n- Hallazgos\n  - Prechecks implementados: extensi√≥n .txt, tama√±o m√°ximo (50MB), archivo vac√≠o. OK\n  - Encoding: heur√≠stica UTF-8 con fallback a Windows-1252. OK\n  - Headers: compara n√∫mero de columnas y presencia de nombres esperados; usa delimitador '|'. OK\n  - Muestreo: valida primeras 10 filas, con chequeos de campos requeridos, n√∫meros (Cantidad, Peso) y fechas (DD/MM/YYYY); i"
    },
    {
      "path": ".gemini/evidencias/RISK_AUDIT_MVP.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/evidencias/PRODUCT_BACKLOG.md",
      "excerpt": "# üìã PRODUCT BACKLOG - PLATAFORMA IOC\n## Sistema de Business Intelligence con Metabase + Gesti√≥n de Datos\n\n**Framework:** Scrum  \n**Duraci√≥n Sprints:** Sprint 1 (4 semanas) | Sprint 2 (3 semanas) | Sprint 3 (4 semanas)  \n**Visualizaci√≥n:** Tablero Kanban  \n**WIP Limit:** 3 tareas simult√°neas por persona  \n**√öltima Actualizaci√≥n:** 13 de Octubre, 2025\n**Product Owner:** Boris Arriagada  \n**Scrum Master:** Jaime Vicencio  \n**Development Team:** Boris Arriagada, Jaime Vicencio\n\n---\n\n## üéØ √âPICAS DEL PROYECTO\n\n| ID | Nombre | Objetivo | Estado |\n|----|--------|----------|--------|\n| **EP-01** | **Ingesta y Validaci√≥n de Datos** | Permitir al administrador cargar archivos CSV de producci√≥n con validaci√≥n autom√°tica, monitoreo de estado y gesti√≥n de errores detallada | üü¢ Activo |\n| **EP-02** | **Contenido Anal√≠tico y Visualizaciones** | Proporcionar herramientas completas para crear, gestionar y organizar dashboards, gr√°ficos y KPIs utilizando la integraci√≥n con Metabase | üü¢ Activo |\n| **EP-03** | **Acceso, Seguridad y Gesti√≥n de Usuarios** | Implementar un sistema robusto de gesti√≥n de usuarios, roles y permisos con control granular de acceso a dashboards y funcionalidades | üü¢ Activo |\n\n---\n\n## üìä CONFIGURATION KANBAN BOARD\n\n### Columnas y WIP Limits\n\n| Columna | WIP Limit | Definici√≥n | Pol√≠ticas de \"Done\" |\n|---------|-----------|------------|---------------------|\n| **Backlog** | ‚àû | Todas las historias priorizadas pendientes de iniciar | Historia refinada con criterios de aceptaci√≥n claros |\n| **In Progress** | 6 items | Desarrollo activo en curso | C√≥digo en rama feature + tests unitarios iniciados |\n| **Done** | ‚àû | Completado y desplegado | DoD completado + integrado en main + documentado |\n\n### WIP Limits por Rol\n- **Frontend Developer:** M√°ximo 3 tareas simult√°neas\n- **Backend Developer:** M√°ximo 3 tareas simult√°neas  \n- **QA Engineer:** M√°ximo 4 tareas simult√°neas (revisi√≥n)\n- **Product Owner:** Sin l√≠mite (priorizaci√≥n)\n\n---\n\n## ‚úÖ DEFINITION OF READY (DoR)\n\nToda "
    },
    {
      "path": ".gemini/evidencias/definicion_del_proyecto_ioc.md",
      "excerpt": "}\n\n\n\n\n\n\t\nPARTE I\n1. Antecedentes Personales\nA continuaci√≥n, se presenta una tabla en la que debes completar la informaci√≥n solicitada. \n\n\nNombre estudiante 1\nBoris Hector Arriagada Rojas\nRut estudiante 1\n16.330.999-8\nNombre estudiante 2\nJaime Antonio Vicencio Rubilar\nRut estudiante 2\n13.9120.58-2\nCarrera\nIngenier√≠a en Inform√°tica\nSede\nVi√±a del Mar\n\n\n2. Descripci√≥n Proyecto APT\nEn la descripci√≥n debes se√±alar brevemente el nombre de tu proyecto APT y las competencias del perfil de egreso que vas a poner en pr√°ctica. Si en tu carrera est√°n definidas las √°reas de desempe√±o, tambi√©n menciona a qu√© √°reas de desempe√±o est√° vinculado el proyecto. \n\n\nNombre del proyecto\nInteligencia Operacional Cambiaso (IOC)\n√Årea (s) de desempe√±o(s)\nEl proyecto \"Intelligencia Operacional Cambiaso (IOC)\" se enmarca directamente en el √°rea de las Tecnolog√≠as de Informaci√≥n, abarcando un amplio espectro de las capacidades descritas en el perfil de egreso de Ingenier√≠a en Inform√°tica de Duoc UC. Espec√≠ficamente, el proyecto nos permitir√° desempe√±arnos en las siguientes funciones:\nAn√°lisis y Dise√±o de Soluciones: Involucra la comprensi√≥n de las necesidades del negocio, en estrecha colaboraci√≥n con el Product Owner (P.O.), para dise√±ar una plataforma de software que responda a los desaf√≠os operativos, definiendo su arquitectura y componentes principales.\nDesarrollo e Implementaci√≥n de Sistemas: Comprende la construcci√≥n y el despliegue de la soluci√≥n de software en un entorno de producci√≥n, asegurando su correcto funcionamiento y accesibilidad para todos los stakeholders involucrados.\nGesti√≥n de la Calidad del Software: Implica la planificaci√≥n y ejecuci√≥n de un proceso de verificaci√≥n sistem√°tico para garantizar que el producto final cumpla con los m√°s altos est√°ndares de fiabilidad, integridad de los datos, disponibilidad, tolerancia a fallos, rendimiento, escalabilidad y usabilidad antes de ser entregado a los usuarios.\nGesti√≥n de la Seguridad de la Informaci√≥n: Un pilar central del proyecto "
    },
    {
      "path": ".gemini/evidencias/plan_de_sprints.md",
      "excerpt": "### **Checklist de Cobertura de Historias de Usuario del MVP Core (Actualizado)**\n\n| ID | Enunciado de la Historia de Usuario | Sprint 1: Fundaci√≥n y Visualizaci√≥n | Sprint 2: Interactividad y Filtros | Sprint 3: Gobernanza y Administraci√≥n |\n| :---- | :---- | :---- | :---- | :---- |\n| **IOC-001** | Administrador puede cargar y validar archivos de producci√≥n. | ‚úÖ |  |  |\n| **IOC-006** | Gerente puede visualizar un dashboard con KPIs actualizados. | ‚úÖ |  |  |\n| **IOC-021** | Usuario puede iniciar sesi√≥n en la plataforma. | ‚úÖ |  |  |\n| **IOC-022** | Usuario puede cerrar sesi√≥n de forma segura. | ‚úÖ |  |  |\n| **IOC-023** | El sistema tiene un Layout y Rutas Protegidas. | ‚úÖ |  |  |\n| **IOC-008** | Gerente puede comparar el desempe√±o entre entidades. |  | ‚úÖ |  |\n| **IOC-012** | Supervisor-Analista puede filtrar datos en el dashboard. |  | ‚úÖ |  |\n| **IOC-002** | Administrador puede validar datos cargados autom√°ticamente. |  |  | ‚úÖ |\n| **IOC-003** | Administrador puede gestionar usuarios, roles y permisos. |  |  | ‚úÖ |\n| **IOC-019** | Administrador puede crear y gestionar gr√°ficos. |  |  | ‚úÖ |\n| **IOC-020** | Administrador puede dise√±ar la disposici√≥n del dashboard. |  |  | ‚úÖ |\n\n---\n\n### **Historias de Usuario Fuera del MVP Core (Post-MVP)**\n\n| ID | Enunciado de la Historia de Usuario | Estado |\n| :---- | :---- | :---- |\n| **IOC-004** | Administrador puede gestionar usuarios y roles | Post-MVP |\n| **IOC-005** | Gerente puede recibir alertas en caso de desviaciones | Post-MVP |\n| **IOC-007** | Gerente puede recibir alertas autom√°ticas | Post-MVP |\n| **IOC-009** | Gerente puede analizar tendencias hist√≥ricas | Post-MVP |\n| **IOC-010** | Gerente puede personalizar dashboards | Post-MVP |\n| **IOC-011** | Gerente puede acceder desde dispositivos m√≥viles | Post-MVP |\n| **IOC-013** | Supervisor-Analista puede reportar incidencias | Post-MVP |\n| **IOC-014** | Supervisor-Analista puede descargar reportes en PDF o Excel | Post-MVP |\n| **IOC-015** | Supervisor-Analista puede exportar d"
    },
    {
      "path": ".gemini/evidencias/Sprint-2-Backlog (another copy).md",
      "excerpt": "# Sprint 2 ‚Äì Sprint Backlog (Desatando la Interactividad Anal√≠tica)\n\n## Metadata del Sprint\n\n**Proyecto:** Plataforma IOC - Sistema de Business Intelligence  \n**Sprint:** Sprint 2 - Interactividad Anal√≠tica  \n**Per√≠odo:** 6 de Octubre - 24 de Octubre, 2025  \n**Duraci√≥n:** 3 semanas (15 d√≠as h√°biles)  \n**Equipo:**\n- **Product Owner:** Boris Arriagada\n- **Scrum Master:** Jaime Vicencio\n- **Development Team:** Boris Arriagada (Backend/Frontend), Jaime Vicencio (Frontend/Backend)\n\n**Festivos/No laborables:** Ninguno durante este per√≠odo\n\n**Velocity del Equipo:** ~10 SP/semana (basado en Sprint 1: 41 SP en 4 semanas)  \n**Capacidad Te√≥rica del Sprint:** 30 SP (10 SP/semana √ó 3 semanas)\n**Capacidad Comprometida:** 21 SP (70% de capacidad - incluye buffer 30%)\n**Buffer para Impedimentos:** 9 SP (~30% reservado para spikes t√©cnicos, riesgos e imprevistos)\n\n**Justificaci√≥n del Buffer Amplio:**\n- Riesgo alto: Generaci√≥n de PDFs complejos (35% probabilidad)\n- Primera vez usando Apache POI y Flying Saucer (curva de aprendizaje)\n- Boris tiene doble rol (PO + Dev) reduciendo capacidad efectiva ~20%\n\n---\n\n## üéØ SPRINT GOAL\n\n**\"Transformar el dashboard est√°tico en una herramienta de an√°lisis interactiva donde el usuario final pueda filtrar datos por l√≠nea, per√≠odo y maqu√≠na, adem√°s de comparar desempe√±o entre turnos y l√≠neas para investigar patrones de rendimiento y exportar resultados.\"**\n\nAl finalizar este Sprint, los gerentes y supervisores podr√°n:\n- Aplicar filtros din√°micos a los dashboards para an√°lisis espec√≠ficos\n- Comparar m√©tricas entre diferentes turnos, l√≠neas y per√≠odos\n- Exportar visualizaciones y datos en formato PDF/Excel para reportes\n- Identificar patrones de rendimiento y oportunidades de mejora mediante comparativas interactivas\n\n**Valor de Negocio:** Habilitar an√°lisis profundo y toma de decisiones basada en comparativas, eliminando la necesidad de exportar a herramientas externas.\n\n---\n\n## Historias Comprometidas\n\n| ID | T√≠tulo | Tipo | Feature | Prioridad | SP "
    },
    {
      "path": ".gemini/evidencias/Sprint-2-Backlog_backup_20251014_053140.md",
      "excerpt": "# Sprint 2 ‚Äì Sprint Backlog (Desatando la Interactividad Anal√≠tica)\n\n## Metadata del Sprint\n\n**Proyecto:** Plataforma IOC - Sistema de Business Intelligence  \n**Sprint:** Sprint 2 - Interactividad Anal√≠tica  \n**Per√≠odo:** 6 de Octubre - 25 de Octubre, 2025  \n**Duraci√≥n:** 3 semanas (15 d√≠as h√°biles)  \n**Equipo:**\n- **Product Owner:** Boris Arriagada\n- **Scrum Master:** Jaime Vicencio\n- **Development Team:** Boris Arriagada (Backend/Frontend), Jaime Vicencio (Frontend/Backend)\n\n**Festivos/No laborables:** Ninguno durante este per√≠odo\n\n**Velocity del Equipo:** ~10 SP/semana (basado en Sprint 1: 41 SP en 4 semanas)  \n**Capacidad del Sprint:** 21 Story Points\n\n---\n\n## üéØ SPRINT GOAL\n\n**\"Transformar el dashboard est√°tico en una herramienta de an√°lisis interactiva donde el usuario final pueda filtrar datos por l√≠nea, per√≠odo y taller, adem√°s de comparar desempe√±o entre turnos y l√≠neas para investigar patrones de rendimiento y exportar resultados.\"**\n\nAl finalizar este Sprint, los gerentes y supervisores podr√°n:\n- Aplicar filtros din√°micos a los dashboards para an√°lisis espec√≠ficos\n- Comparar m√©tricas entre diferentes turnos, l√≠neas y per√≠odos\n- Exportar visualizaciones y datos en formato PDF/Excel para reportes\n- Identificar patrones de rendimiento y oportunidades de mejora mediante comparativas interactivas\n\n**Valor de Negocio:** Habilitar an√°lisis profundo y toma de decisiones basada en comparativas, eliminando la necesidad de exportar a herramientas externas.\n\n---\n\n## Historias Comprometidas\n\n| ID | T√≠tulo | Tipo | Feature | Prioridad | SP | Asignado | Estado |\n| :--- | :--- | :--- | :--- | :--- | :-: | :--- | :--- |\n| IOC-008 | Como gerente, quiero comparar el desempe√±o entre turnos y l√≠neas para identificar patrones y oportunidades de mejora. | Historia de Usuario | An√°lisis Comparativo | Cr√≠tica | 13 | Boris | üìã Backlog |\n| IOC-012 | Como supervisor-analista, quiero filtrar datos por l√≠nea, periodo y taller para realizar an√°lisis detallados y espec√≠ficos. | Historia "
    },
    {
      "path": ".gemini/evidencias/Sprint-2-Backlog.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/evidencias/RISK_REGISTER_SCRUM.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/evidencias/RISK_DASHBOARD_DAILY.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/evidencias/desarrollo_proyecto.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/evidencias/RISK_REGISTER_PATCH_v1.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/evidencias/plantilla_product_backlog.md",
      "excerpt": "# üéØ ¬°CORRECTO! Generando la Plantilla\n\nTienes toda la raz√≥n. Cre√© los **prompts** pero falta la **plantilla real**. Procediendo a generar la plantilla de Product Backlog nivel EST√ÅNDAR:\n---\n\n# üìã PLANTILLA DE PRODUCT BACKLOG\n\n## Metodolog√≠a: Scrum + Kanban Board\n\n---\n\n## üìä METADATA DEL PRODUCTO\n\n| Campo                           | Valor                 |\n| ------------------------------- | --------------------- |\n| **Nombre del Producto**         | [Nombre del Producto] |\n| **Versi√≥n del Backlog**         | 1.0                   |\n| **Fecha de Creaci√≥n**           | [YYYY-MM-DD]          |\n| **√öltima Actualizaci√≥n**        | [YYYY-MM-DD]          |\n| **Product Owner**               | [Nombre y contacto]   |\n| **Scrum Master**                | [Nombre y contacto]   |\n| **Duraci√≥n de Sprint**          | [2] semanas           |\n| **Velocidad Actual del Equipo** | [20-25] puntos/sprint |\n\n---\n\n## üéØ VISI√ìN Y OBJETIVOS\n\n### Visi√≥n del Producto\n\n[Descripci√≥n de la visi√≥n: ¬øQu√© problema resuelve? ¬øPara qui√©n? ¬øCu√°l es la propuesta de valor √∫nica?]\n\n### Objetivos Estrat√©gicos (3-6 meses)\n\n1. [Objetivo 1 - Medible y con fecha]\n2. [Objetivo 2 - Medible y con fecha]\n3. [Objetivo 3 - Medible y con fecha]\n   \n   ### Stakeholders Principales\n   \n   | Stakeholder  | Rol                    | Nivel de Influencia | Inter√©s Principal |\n   | ------------ | ---------------------- | ------------------- | ----------------- |\n   | [Nombre/Rol] | [Sponsor/Usuario/etc.] | Alto/Medio/Bajo     | [Descripci√≥n]     |\n   | [Nombre/Rol] | [Sponsor/Usuario/etc.] | Alto/Medio/Bajo     | [Descripci√≥n]     |\n\n---\n\n## üë• DEFINICI√ìN DE ROLES DE USUARIO\n\n| Rol     | Descripci√≥n                    | Necesidades Principales | Nivel T√©cnico   |\n| ------- | ------------------------------ | ----------------------- | --------------- |\n| [Rol 1] | [Descripci√≥n del usuario tipo] | [Lista de necesidades]  | Bajo/Medio/Alto |\n| [Rol 2] | [Descripci√≥n del usuario tipo] | [Lista de necesidades]  | Bajo/Medio/Alto |\n| ["
    },
    {
      "path": ".gemini/evidencias/AUDITORIA_DESARROLLO_PROYECTO.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/evidencias/Sprint-2-Stack-Alignment-Analysis.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/evidencias/Sprint-2-Task-Names-Analysis.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/evidencias/Sprint-2-Task-Names-PATCH.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/prompts/document_task.md",
      "excerpt": "# Prompt: Documentar Tarea Completada\n\nTu rol ahora es el de un Asistente de Documentaci√≥n T√©cnica.\n\nNuestra tarea es documentar la implementaci√≥n de la historia de usuario **{{ID_DE_LA_HISTORIA}}** que acabamos de completar, a√±adiendo una nueva entrada al archivo de bit√°cora `@.gemini/sprints/BITACORA_SPRINT_1.md`.\n\n**Instrucciones:**\n\n1.  **Analiza el Contexto:** Revisa nuestra conversaci√≥n reciente, el plan, el c√≥digo generado y las pruebas realizadas para la historia **{{ID_DE_LA_HISTORIA}}**.\n\n2.  **Genera el Contenido:** Utilizando la informaci√≥n analizada, completa la siguiente plantilla de Markdown. No incluyas los comentarios de la plantilla en la salida final.\n\n    ```markdown\n    ## {{ID_DE_LA_HISTORIA}}: {{TITULO_DE_LA_HISTORIA}}\n\n    *   **Objetivo de Negocio (El \"Para Qu√©\"):** <!-- Rellenar con el valor de negocio de la historia -->\n    *   **Criterios de Aceptaci√≥n Clave:**\n        *   <!-- Listar aqu√≠ los criterios de aceptaci√≥n principales -->\n\n    ### Desglose T√©cnico de la Implementaci√≥n\n\n    *   **Plan Aprobado:** <!-- Resumir el plan de alto nivel que se acord√≥ -->\n\n    *   **Archivos Creados/Modificados:**\n        *   <!-- Listar archivos clave modificados -->\n\n    *   **Resumen de la Implementaci√≥n:**\n        <!-- Explicar de forma concisa pero t√©cnica qu√© se hizo -->\n\n    ### Verificaci√≥n y Pruebas Realizadas\n\n    *   **Pruebas Automatizadas:**\n        *   **(Backend) Pruebas Unitarias:** <!-- Describir las pruebas unitarias creadas -->\n    *   **Pruebas Manuales (End-to-End):**\n        *   **Caso de Prueba 1 (Happy Path):** <!-- Describir el flujo de prueba exitoso -->\n        *   **Caso de Prueba 2 (Caso de Error):** <!-- Describir un flujo de prueba de error -->\n\n    *   **Commit de Referencia (Squashed):**\n        *   `[hash-del-commit-post-merge] - tipo(√°mbito): descripci√≥n corta ({{ID_DE_LA_HISTORIA}}) (#PR)`\n    ---\n    ```\n\n3.  **Actualiza el Archivo de Bit√°cora:**\n    *   Lee el contenido del archivo `@.gemini/sprints/BITACORA_SPRINT"
    },
    {
      "path": ".gemini/prompts/run-technical-audit.md",
      "excerpt": "# üìä Prompt: Auditor√≠a T√©cnica y Generaci√≥n de Assessment (v4.1 - Stack Auto-Detection)\n\n## ‚ö° Gu√≠a R√°pida de Uso\n\n**Ejemplo de inicio:**\n```\n\"Audita la implementaci√≥n t√©cnica.\nBlueprint: @/IOC-006a-metabase-embedding-integration-v3.md\nReporte Dev: @/METABASE_INTEGRATION_ASSESSMENT.md\nProcede con auditor√≠a completa.\"\n```\n\n**La IA leer√° autom√°ticamente:**\n- `@/.gemini/strategy/3_Stack_Tecnologico_Front.md`\n- `@/.gemini/strategy/4_Stack_Tecnologico_Back.md`\n\n---\n\n## üéØ Mandato Operativo para la IA\n\nEres un **Principal Technical Auditor & QA Architect** con expertise en arquitectura de software empresarial. Tu misi√≥n es realizar una auditor√≠a t√©cnica **objetiva, cuantificable y accionable**.\n\n---\n\n## üìã Protocolo de Auditor√≠a (Mandatorio)\n\n### **FASE 0: Carga Autom√°tica del Stack Tecnol√≥gico** üîÑ\n\n**Antes de cualquier otra acci√≥n, ejecuta:**\n\n1. **Lee autom√°ticamente los archivos de stack:**\n   ```\n   STACK_BACKEND  = contenido de @/.gemini/strategy/4_Stack_Tecnologico_Back.md\n   STACK_FRONTEND = contenido de @/.gemini/strategy/3_Stack_Tecnologico_Front.md\n   ```\n\n2. **Extrae y estructura la informaci√≥n del stack:**\n   ```yaml\n   Backend:\n     Framework: [extraer de documento]\n     Version: [extraer de documento]\n     Java: [extraer versi√≥n]\n     Build Tool: [Maven/Gradle]\n     Database: [tipo y versi√≥n]\n     Key Dependencies:\n       - [listar con versiones]\n     Testing Stack:\n       - [listar frameworks]\n     Observability:\n       - [listar herramientas]\n   \n   Frontend:\n     Framework: [extraer de documento]\n     Version: [extraer de documento]\n     Language: [TypeScript/JavaScript + versi√≥n]\n     Build Tool: [Vite/Webpack/etc]\n     Key Libraries:\n       - [listar con versiones]\n     Testing Stack:\n       - [listar frameworks]\n     State Management:\n       - [Redux/Zustand/Context/etc]\n   ```\n\n3. **Genera Checklists Din√°micos:**\n   Bas√°ndote en las versiones detectadas, carga los checklists espec√≠ficos.\n\n4. **Quality Gate:**\n   ```\n   ‚ùå Si no se pueden leer los archivos "
    },
    {
      "path": ".gemini/prompts/as.md",
      "excerpt": "# Prompt: Refactorizar para Consistencia Visual\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n*   **Prop√≥sito:** Este prompt instruye a la IA para analizar un componente React existente, compararlo con una referencia de HTML puro (de TailAdmin) y refactorizar el componente para que coincida visualmente a la perfecci√≥n.\n*   **Acci√≥n Requerida:** Edita las dos variables en la secci√≥n de ejecuci√≥n: la ruta al componente a refactorizar y el c√≥digo HTML de referencia.\n*   **Modo de Uso:** Edita las variables, copia todo el contenido y p√©galo en Gemini CLI.\n\n---\n\n## 2. TEMPLATE DE EJECUCI√ìN (EDITAR ESTA SECCI√ìN)\n\nRUTA_DEL_COMPONENTE_A_REFACTORIZAR: \"@src/components/MetricCard.tsx\"\n\nCODIGO_HTML_DE_REFERENCIA: \"\"\"\n\n<!doctype html>\n<html lang=\"en\">\n\n        <!-- ===== Main Content Start ===== -->\n        <main>\n          <div class=\"mx-auto max-w-(--breakpoint-2xl) p-4 md:p-6\">\n            <div class=\"grid grid-cols-12 gap-4 md:gap-6\">\n              <div class=\"col-span-12\">\n                <!-- Metric Group Four -->\n                <div class=\"grid grid-cols-1 gap-4 sm:grid-cols-2 md:gap-6 xl:grid-cols-3\">\n  <!-- Metric Item Start -->\n  <div\n    class=\"rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6\"\n  >\n    <h4 class=\"text-title-sm font-bold text-gray-800 dark:text-white/90\">\n      $120,369\n    </h4>\n\n    <div class=\"mt-4 flex items-end justify-between sm:mt-5\">\n      <div>\n        <p class=\"text-theme-sm text-gray-700 dark:text-gray-400\">\n          Active Deal\n        </p>\n      </div>\n\n      <div class=\"flex items-center gap-1\">\n        <span\n          class=\"flex items-center gap-1 rounded-full bg-success-50 px-2 py-0.5 text-theme-xs font-medium text-success-600 dark:bg-success-500/15 dark:text-success-500\"\n        >\n          +20%\n        </span>\n\n        <span class=\"text-theme-xs text-gray-500 dark:text-gray-400\">\n          From last month\n        </span>\n      </div>\n    </div>\n  </div>\n  <!-- Metric Item End -->\n\n  <!-- Metr"
    },
    {
      "path": ".gemini/prompts/crear_plan_refactorizacion_frontend.md",
      "excerpt": "Prompt de Sincronizaci√≥n Frontend-Backend (Mejorado)\n1. Rol y Objetivo\nAct√∫a como un desarrollador Full-Stack senior, experto en React, TypeScript y Spring Boot. Tu objetivo es analizar la documentaci√≥n oficial del backend y el estado actual del frontend para realizar las modificaciones necesarias en el frontend, logrando una integraci√≥n completa, robusta y segura conforme a los contratos de API, y debes crear un archivo llamado @.gemini/blueprints/refactorizacion_frontend.md .\n2. Fuentes de Verdad (Contexto Proporcionado)\nConsidera √∫nicamente los siguientes documentos y c√≥digo fuente como referencia:\nsumario.md: Resumen t√©cnico de la arquitectura backend.\nfrontend_sync_brief.md: Contrato de API oficial y detallado. Presta especial atenci√≥n a endpoints, DTOs, c√≥digos de estado y esquemas de error.\nSPRINT_1_SEGUIMIENTO.md: Estado funcional del sprint, √∫til para saber qu√© est√° completo o en progreso.\nBITACORA_SPRINT_1.md: Desglose t√©cnico de implementaciones, √∫til para entender la l√≥gica y estructura de los componentes existentes.\nC√≥digo fuente del frontend (@src): Base de c√≥digo React a modificar.\n3. Tarea Principal\nImplementa la l√≥gica de red para la ingesta de datos, conectando la UI con los endpoints del backend. La UI ya existe pero usa l√≥gica simulada (ver bit√°cora IOC-001).\n4. Pasos Detallados a Ejecutar\nSigue estos pasos, presentando los fragmentos de c√≥digo modificados y explicando el porqu√© de cada cambio.\nPaso 1: Servicio de API Centralizado\nIdentifica o crea un archivo para la l√≥gica de API (ej: src/services/api.ts).\nConfigura una instancia de axios (o el cliente HTTP usado) con la baseURL del backend (usa VITE_API_BASE_URL).\nImplementa un interceptor que a√±ada el token JWT (Authorization: Bearer <token>) a todas las peticiones. El token debe obtenerse del AuthProvider o localStorage, seg√∫n la implementaci√≥n.\nPaso 2: L√≥gica de Subida de Archivos\nUbica el componente responsable de la subida (ej: DataUploadDropzone.tsx o DataIngestionPage.tsx).\nReemplaza la "
    },
    {
      "path": ".gemini/prompts/implement_ftv.md",
      "excerpt": " # Prompt: Director de Implementaci√≥n de Ficha T√©cnica de Vista (FTV)\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n*   **Prop√≥sito:** Este prompt ejecuta la implementaci√≥n de una Ficha T√©cnica de Vista (FTV) de forma controlada, iterativa y transparente.\n*   **Acci√≥n Requerida:** Edita la variable `{{FTV_PATH}}` con la ruta al blueprint que quieres implementar.\n*   **Modo de Uso:** Edita la variable y luego copia/pega todo el contenido en Gemini CLI. La IA te guiar√° a trav√©s del proceso.\n\n---\n\n## 2. TEMPLATE DE EJECUCI√ìN (EDITAR ESTA SECCI√ìN)\n\nFTV_PATH: \"@.gemini/blueprints/01-FTV-panel-principal.md\"\n\n---\n\n## 3. MANDATO OPERATIVO (PARA LA IA)\n\nTu rol es el de un **Lead Frontend Developer** met√≥dico y transparente, encargado de ejecutar una especificaci√≥n t√©cnica de forma incremental.\n\n**Fuente de Verdad (Source of Truth):**\nTu √∫nica especificaci√≥n es el contenido del archivo `{{FTV_PATH}}`.\n\n**PROTOCOLO DE EJECUCI√ìN (MANDATORIO):**\nDebes ejecutar la implementaci√≥n siguiendo un plan de trabajo que t√∫ mismo crear√°s y mantendr√°s actualizado.\n\n---\n\n### Fase 0: Planificaci√≥n y Creaci√≥n del Checklist de Tareas\n*   **Objetivo:** Descomponer la FTV en un checklist de micro-tareas accionables.\n*   **Acciones:**\n    1.  Lee y analiza la totalidad del archivo `{{FTV_PATH}}`.\n    2.  Crea y presenta una **lista de tareas (checklist) en formato Markdown**. Esta lista debe desglosar la implementaci√≥n en pasos l√≥gicos y granulares (ej. \"Crear archivo `MetricCard.tsx`\", \"Implementar interfaz de props para `MetricCard`\", \"Renderizar `MetricCard` con datos falsos\", \"A√±adir estado `loading` a `AdminDashboardPage`\", etc.).\n    3.  **Espera la aprobaci√≥n del plan antes de continuar.**\n\n---\n\n### Fase de Ejecuci√≥n Iterativa\n*   **Objetivo:** Implementar el plan de trabajo tarea por tarea.\n*   **Acciones:**\n    1.  **Anuncia tu trabajo:** Comienza cada respuesta declarando qu√© tarea(s) del checklist vas a completar.\n    2.  **Ejecuta:** Realiza la implementaci√≥n de la(s) tarea(s) anunciada(s).\n  "
    },
    {
      "path": ".gemini/prompts/create_blueprint_v2.md",
      "excerpt": "y # Prompt: Crear Nuevo Blueprint de Implementaci√≥n (v2)\n\n### Gu√≠a R√°pida para el Humano\n1.  **Edita la secci√≥n `## Template de Ejecuci√≥n`** m√°s abajo con los detalles de la tarea que acabas de completar.\n2.  **Copia el contenido completo de este archivo** (`Ctrl+A`, `Ctrl+C`).\n3.  **Pega el contenido en Gemini CLI** y presiona `Enter`.\n\n---\n\n## Template de Ejecuci√≥n (EDITAR ESTA SECCI√ìN)\n\n**ID_DE_LA_HISTORIA**: ‚ÄúIOC-001‚Äù.\n\n**DESCRIPCION_DE_LA_FUNCIONALIDAD**: ‚ÄúOptimizaci√≥n y Robustecimiento del Pipeline de Ingesta de Datos ETL‚Äù.\n\n**TAREA_ESPECIFICA_EN_KEBAB_CASE**: ‚Äúetl-pipeline-batch-and-validation-refactor‚Äù\n\n**CONTEXTO_ADICIONAL**: ‚ÄúRefactorizar el ParserService actual para que procese archivos grandes de forma eficiente (sin agotar la memoria) y a√±adir una capa de validaci√≥n expl√≠cita para detectar datos corruptos antes de llegar a la base de datos.‚Äù.\n\n**STACK_PRINCIPAL**: ‚ÄúSpring Boot + JPA + Jakarta Bean Validation‚Äù\n\n---\n\n## Instrucciones para la IA (NO EDITAR ESTA SECCI√ìN)\n\nTu rol es el de un Senior Solutions Architect y Asistente de Documentaci√≥n T√©cnica.\n\nUtilizando las variables definidas en la secci√≥n `## Template de Ejecuci√≥n`, realiza las siguientes acciones:\n\n1.  **Analiza el Contexto:** Revisa nuestra conversaci√≥n reciente, el plan, el c√≥digo generado y las pruebas realizadas para la implementaci√≥n de la historia `{{ID_DE_LA_HISTORIA}}`. Esta es tu fuente de verdad.\n\n2.  **Define el Nombre del Archivo:** Construye el nombre del archivo para el nuevo blueprint usando el formato `[ID_Historia]-[tarea-especifica].md`, basado en las variables `{{ID_DE_LA_HISTORIA}}` y `{{TAREA_ESPECIFICA_EN_KEBAB_CASE}}`.\n\n3.  **Genera el Contenido del Blueprint:** Utilizando el contexto analizado, genera el contenido completo del blueprint siguiendo estrictamente la siguiente plantilla de Markdown.\n\n    ```markdown\n    # Blueprint: {{DESCRIPCION_DE_LA_FUNCIONALIDAD}}\n\n    Esta gu√≠a detalla el proceso paso a paso para implementar la funcionalidad.\n\n    ## 1. Objetivo y Al"
    },
    {
      "path": ".gemini/prompts/create_blueprint_v3.md",
      "excerpt": "# Prompt: Generador Inteligente de Blueprints y Tareas de Backlog (v5)\n\n### Gu√≠a R√°pida (Interacci√≥n por Conversaci√≥n)\n*   **Prop√≥sito:** Este prompt genera un blueprint de implementaci√≥n y las tareas de backlog asociadas a partir de una solicitud en lenguaje natural.\n*   **Modo de Uso:** Simplemente, pide a Gemini que cree el blueprint para una tarea espec√≠fica. La IA buscar√° la tarea en el backlog del sprint y te pedir√° confirmaci√≥n.\n    *   **Ejemplo 1 (por descripci√≥n):** `\"Crea el blueprint para la tarea de 'optimizar el pipeline ETL'\"`\n    *   **Ejemplo 2 (por ID):** `\"Genera la documentaci√≥n para la historia IOC-001\"`\n    *   **Ejemplo 3 (por clave):** `\"Documenta la tarea 'etl-pipeline-batch-and-validation-refactor'\"`\n\n---\n\n## Instrucciones para la IA (NO EDITAR ESTA SECCI√ìN)\n\nTu rol es el de un Principal Solutions Architect y Asistente de Gesti√≥n de Proyectos.\n\nTu misi√≥n es interpretar la solicitud del usuario, identificar la tarea correspondiente en el backlog del sprint y, tras obtener la confirmaci√≥n, generar de forma aut√≥noma un blueprint de implementaci√≥n y las tareas t√©cnicas asociadas.\n\n### Flujo de Trabajo Mandatorio\n\n**1. Interpretaci√≥n de la Solicitud y B√∫squeda Sem√°ntica:**\n*   **Fuente de Verdad Primaria:** `@.gemini/sprints/Sprint-1-Backlog.md`.\n*   **Acci√≥n:**\n    1.  Analiza la solicitud en lenguaje natural del usuario.\n    2.  Lee el archivo fuente del backlog.\n    3.  Realiza una **b√∫squeda sem√°ntica** para encontrar la **√∫nica y mejor coincidencia** para la tarea descrita por el usuario.\n    4.  **Pide Confirmaci√≥n (Quality Gate):** Presenta la tarea que has encontrado y pide confirmaci√≥n expl√≠cita al usuario. Ejemplo: `\"He identificado la siguiente tarea en el backlog: 'IOC-001 - Optimizaci√≥n y Robustecimiento del Pipeline...'. ¬øEs correcto? ¬øProcedo a generar el blueprint?\"`\n*   **Manejo de Errores (Cr√≠tico):**\n    *   **Si el archivo Fuente de Verdad no existe:** Det√©n el proceso e informa al usuario del error y de la ruta esperada.\n   "
    },
    {
      "path": ".gemini/prompts/diseno_ux.md",
      "excerpt": "### **El Prompt Mejorado (v2)**\n\n```markdown\nTu misi√≥n es actuar como un Senior Product Manager con un fuerte background en UX, transformando los requerimientos de negocio del proyecto IOC en un dise√±o de interfaz coherente y accionable para la \"Vista de Administrador\".\n\n**Fuentes de Verdad (Sources of Truth):**\nTu an√°lisis debe basarse **exclusivamente** en los siguientes artefactos:\n1.  `@.gemini/strategy/2_Product_Backlog.md`: Para extraer todas las funcionalidades del rol \"Administrador\".\n2.  `@.gemini/strategy/1_Definicion_Proyecto.md`: Para comprender el prop√≥sito estrat√©gico global del m√≥dulo de administraci√≥n.\n\n**Proceso de Trabajo (Tu Razonamiento):**\n1.  **Extracci√≥n y Agrupaci√≥n Tem√°tica:** Identifica todas las Historias de Usuario (HU) del backlog donde el actor es \"Como Administrador\". Agr√∫palas por temas funcionales (ej. todo lo relacionado con usuarios, todo lo relacionado con gr√°ficos, etc.).\n2.  **S√≠ntesis y Dise√±o de Flujo:** No solo listes las features. Piensa en el flujo de trabajo de un administrador. ¬øC√≥mo se relacionan estas secciones? ¬øCu√°l es el orden l√≥gico para presentarlas en una interfaz? Tu dise√±o de navegaci√≥n debe reflejar este flujo de trabajo.\n3.  **Identificaci√≥n de Oportunidades (Gap Analysis):** Basado en los requerimientos expl√≠citos, identifica y sugiere funcionalidades complementarias de bajo esfuerzo que mejorar√≠an dr√°sticamente la usabilidad (ej. un campo de b√∫squeda en una tabla de usuarios, un bot√≥n para \"duplicar\" un gr√°fico).\n4.  **Generaci√≥n del Documento:** Produce un √∫nico documento Markdown bien formateado que describa tu dise√±o propuesto, siguiendo la plantilla exacta que se detalla a continuaci√≥n.\n\n---\n### **PLANTILLA DE SALIDA OBLIGATORIA**\n\n# Dise√±o de la Vista de Administrador - Plataforma IOC (v2)\n\n## 1. Racional de Dise√±o (Design Rationale)\n[Comienza explicando tus decisiones de dise√±o de alto nivel. ¬øPor qu√© agrupaste las secciones de la manera en que lo hiciste? ¬øQu√© principio gu√≠a la estructura de navegaci√≥"
    },
    {
      "path": ".gemini/prompts/create_blueprint.md",
      "excerpt": "# Prompt: Crear Nuevo Blueprint de Implementaci√≥n\n\n### Gu√≠a R√°pida para el Humano\n1.  **Edita la secci√≥n `## Template de Ejecuci√≥n`** m√°s abajo con los detalles de la tarea que acabas de completar.\n2.  **Copia el contenido completo de este archivo** (`Ctrl+A`, `Ctrl+C`).\n3.  **Pega el contenido en Gemini CLI** y presiona `Enter`.\n\n---\n\n## Template de Ejecuci√≥n (EDITAR ESTA SECCI√ìN)\n\nID_DE_LA_HISTORIA: \"IOC-021\"\nDESCRIPCION_DE_LA_FUNCIONALIDAD: \"Flujo de Autenticaci√≥n con Supabase\"\nTAREA_ESPECIFICA_EN_KEBAB_CASE: \"supabase-auth-flow\"\n\n---\n\n## Instrucciones para la IA (NO EDITAR ESTA SECCI√ìN)\n\nTu rol es el de un Senior Solutions Architect y Asistente de Documentaci√≥n T√©cnica.\n\nUtilizando las variables definidas en la secci√≥n `## Template de Ejecuci√≥n`, realiza las siguientes acciones:\n\n1.  **Analiza el Contexto:** Revisa nuestra conversaci√≥n reciente, el plan, el c√≥digo generado y las pruebas realizadas para la implementaci√≥n de la historia `{{ID_DE_LA_HISTORIA}}`. Esta es tu fuente de verdad.\n\n2.  **Define el Nombre del Archivo:** Construye el nombre del archivo para el nuevo blueprint usando el formato `[ID_Historia]-[tarea-especifica].md`, basado en las variables `{{ID_DE_LA_HISTORIA}}` y `{{TAREA_ESPECIFICA_EN_KEBAB_CASE}}`.\n\n3.  **Genera el Contenido del Blueprint:** Utilizando el contexto analizado, genera el contenido completo del blueprint siguiendo estrictamente la siguiente plantilla de Markdown.\n\n    ```markdown\n    # Blueprint: {{DESCRIPCION_DE_LA_FUNCIONALIDAD}}\n\n    Esta gu√≠a detalla el proceso paso a paso para implementar la funcionalidad.\n\n    ## 1. Objetivo y Alcance\n    *   **Objetivo:** <!-- Describir qu√© se logra con este blueprint. -->\n    *   **Stack Tecnol√≥gico Involucrado:** <!-- Listar tecnolog√≠as clave. -->\n\n    ## 2. Prerrequisitos\n    *   **Dependencias:** <!-- Listar dependencias de npm o pom.xml. -->\n    *   **Configuraci√≥n:** <!-- Mencionar variables de entorno o configuraci√≥n. -->\n\n    ## 3. Implementaci√≥n Paso a Paso\n\n    ### 3.1 Backe"
    },
    {
      "path": ".gemini/prompts/create_backend_sync_brief.md",
      "excerpt": "# Prompt: Generar Brief de Sincronizaci√≥n para el Backend (v3)\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n*   **Prop√≥sito:** Este prompt instruye a la IA para que analice un directorio completo de Fichas T√©cnicas, sintetice los requisitos de la API, y genere un brief de sincronizaci√≥n validado para el equipo de backend.\n*   **Acci√≥n Requerida:** Ninguna. Este prompt est√° dise√±ado para auditar autom√°ticamente el directorio de blueprints.\n*   **Modo de Uso:** Copia y pega el contenido completo en Gemini CLI.\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\nTu rol es el de un **Lead Software Architect** especializado en la definici√≥n de contratos de API. Tu misi√≥n es generar un **\"Backend Sync Brief\"** validado, que traduzca los requisitos de la UI en especificaciones de API claras, consistentes y accionables.\n\n### Contexto de Operaci√≥n (Tu Mapa Mental)\nPara esta tarea, debes tener en cuenta la siguiente arquitectura de informaci√≥n:\n*   **Repositorio de Blueprints (Tu Fuente Primaria):** El directorio `@.gemini/blueprints` contiene todas las Fichas T√©cnicas de Vista (FTVs) que debes analizar. Todas las referencias a FTVs deben apuntar aqu√≠.\n*   **Contexto del Sprint (Tu Foco T√°ctico):** El directorio `@.gemini/sprints` contiene el backlog (`Sprint-1-Backlog.md`) y la bit√°cora del sprint actual. Puedes usar estos archivos para entender el **prop√≥sito de negocio** de un endpoint si la FTV no es suficientemente clara.\n\n**PROTOCOLO DE S√çNTESIS Y GENERACI√ìN (MANDATORIO):**\n\n### Fase 1: An√°lisis y S√≠ntesis Inteligente\n*   **Acci√≥n:**\n    1.  Realiza un escaneo completo del directorio `@.gemini/blueprints` para identificar todos los archivos de Ficha T√©cnica de Vista (`.md`).\n    2.  Extrae todos los requisitos de API de cada FTV.\n    3.  **Agrupa los requisitos por endpoint √∫nico (M√©todo + Ruta)**.\n    4.  Para cada endpoint, **fusiona los contratos de datos**. Si encuentras contratos conflictivos para el mismo endpoint, **det√©n el proceso y reporta la inconsistencia** para que sea re"
    },
    {
      "path": ".gemini/prompts/refine_output.md",
      "excerpt": "# Prompt: Ciclo de Refinamiento y Quality Assurance v2.0\n\n## 1. Prop√≥sito y Modo de Uso\n*   **Prop√≥sito:** Este prompt instruye a la IA para que realice una revisi√≥n cr√≠tica y constructiva de su **propia salida anterior**, proponiendo e implementando mejoras concretas.\n*   **Modo de Uso:** Despu√©s de que la IA genere un plan, documento o c√≥digo, simplemente env√≠a el contenido completo de este prompt. No necesitas editar ni configurar nada. La IA sabr√° que debe refinar lo que acaba de crear.\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\nTu rol cambia ahora al de un **Senior Quality Assurance Architect** y **Refinement Specialist**. Tu misi√≥n es realizar una revisi√≥n cr√≠tica y constructiva del artefacto que has generado en tu respuesta inmediatamente anterior (de ahora en adelante, `{{SALIDA_ANTERIOR}}`), con el objetivo de elevar su calidad.\n\n**PROTOCOLO DE REVISI√ìN Y REFACTORIZACI√ìN (MANDATORIO):**\nDebes ejecutar el siguiente proceso en tres fases. No pases a la siguiente fase sin la aprobaci√≥n expl√≠cita del usuario (ej: \"ok\", \"procede\", \"aplica los cambios\").\n\n### Fase 1: Autoevaluaci√≥n Cr√≠tica\n*   **Objetivo:** Analizar la `{{SALIDA_ANTERIOR}}` contra un conjunto de criterios de calidad.\n*   **Acciones:**\n    1.  Relee tu `{{SALIDA_ANTERIOR}}` y eval√∫ala honestamente seg√∫n los siguientes ejes:\n        *   **Claridad y Simplicidad:** ¬øEs f√°cil de entender? ¬øHay ambig√ºedades? ¬øSe puede simplificar sin perder valor?\n        *   **Eficiencia y Concisi√≥n:** ¬øHay redundancia o \"bloat\"? ¬øSe podr√≠a lograr el mismo objetivo con menos c√≥digo, menos pasos o menos texto?\n        *   **Robustez y Casos L√≠mite:** (Si aplica a un plan o c√≥digo) ¬øConsidera los casos de error, estados vac√≠os o entradas inesperadas? ¬øEs resiliente?\n        *   **Alineaci√≥n Estrat√©gica:** ¬øSe alinea perfectamente con los mandatos de nuestro `GEMINI.md` y las fuentes de verdad del proyecto (backlog, gu√≠as de estilo, etc.)? ¬øHay alguna desviaci√≥n?\n        *   **Seguridad:** (Si aplica a c√≥digo) ¬øHay alg"
    },
    {
      "path": ".gemini/prompts/audit_and_formalize_design_system.md",
      "excerpt": "# Prompt: Auditar C√≥digo y Formalizar Gu√≠a de Estilo\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n*   **Prop√≥sito:** Este prompt instruye a la IA para que audite el c√≥digo fuente de la plantilla TailAdmin, ignorando nuestro propio c√≥digo, para formalizar los principios de dise√±o en un documento `design_tokens.md`.\n*   **Acci√≥n Requerida:** Ninguna. Este prompt est√° listo para ser usado.\n*   **Modo de Uso:** Copia y pega el contenido completo en Gemini CLI.\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\nTu rol es el de un **Auditor de C√≥digo y Arquitecto de Sistemas de Dise√±o**. Tu misi√≥n es realizar una auditor√≠a sistem√°tica del **c√≥digo base original de la plantilla TailAdmin** para destilar y formalizar sus \"design tokens\" impl√≠citos en un documento de directrices expl√≠cito y can√≥nico.\n\n**PROTOCOLO DE AN√ÅLISIS Y S√çNTESIS (MANDATORIO):**\n\n### Fase 1: Auditor√≠a Sistem√°tica del C√≥digo Fuente\n*   **Acci√≥n:** Realiza un escaneo recursivo de todos los archivos `.tsx` dentro del directorio `@src/`.\n*   **Regla de Exclusi√≥n Cr√≠tica:** Debes **ignorar por completo** el contenido de los siguientes archivos durante tu an√°lisis, ya que fueron generados por IA y no forman parte del sistema de dise√±o original de TailAdmin:\n    *   `@src/pages/admin/AdminDashboardPage.tsx`\n    *   `@src/pages/AuthPages/ResetPassword.tsx`\n    *   `@src/pages/AuthPages/UpdatePassword.tsx`\n    *   `@src/pages/Account.tsx`\n\n### Fase 2: An√°lisis de Frecuencia y Contexto\n*   **Acci√≥n:** Mientras auditas los archivos **permitidos**, construye en tu memoria una tabla de frecuencia de las clases de Tailwind CSS utilizadas. Presta especial atenci√≥n al contexto (en qu√© tipo de elementos HTML/JSX se aplican).\n\n### Fase 3: S√≠ntesis y Generaci√≥n del Reporte\n*   **Acci√≥n:** Basado en tu an√°lisis de los archivos de la plantilla original, sintetiza los patrones m√°s consistentes. Descarta los estilos de un solo uso. Luego, genera el documento de gu√≠a de estilo.\n\n**Tarea de Salida:**\nCrea un nuevo archivo llamado `design_to"
    },
    {
      "path": ".gemini/prompts/align_components_to_design_system.md",
      "excerpt": "# Prompt: Alinear Componentes con el Sistema de Dise√±o (v2)\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n*   **Prop√≥sito:** Este prompt instruye a la IA para auditar y alinear sistem√°ticamente una lista de componentes con la gu√≠a de estilo `design_tokens.md`.\n*   **Acci√≥n Requerida:** Lista los archivos a refactorizar en la variable `ARCHIVOS_A_REFACTORIZAR`.\n*   **Modo de Uso:** Edita la variable, copia todo el contenido y p√©galo en Gemini CLI. La IA te guiar√° a trav√©s del proceso optimizado.\n\n---\n\n## 2. TEMPLATE DE EJECUCI√ìN (EDITAR ESTA SECCI√ìN)\n\nARCHIVOS_A_REFACTORIZAR: \"\"\"\n- @src/pages/admin/AdminDashboardPage.tsx\n- @src/pages/AuthPages/ResetPassword.tsx\n- @src/pages/AuthPages/UpdatePassword.tsx\n- @src/pages/Account.tsx\n\"\"\"\n\n---\n\n## 3. MANDATO OPERATIVO (PARA LA IA)\n\nTu rol es el de un **Senior Frontend Architect** ejecutando una auditor√≠a de consistencia de UI. Tu misi√≥n es refactorizar los componentes en `{{ARCHIVOS_A_REFACTORIZAR}}` para que se conformen al 100% con nuestra gu√≠a de estilo can√≥nica.\n\n**Fuentes de Verdad (Sources of Truth):**\n1.  **La Gu√≠a de Estilo (El Objetivo):** `@.gemini/strategy/4_Design_Tokens.md`\n2.  **Los Componentes (El Estado Actual):** La lista de archivos en `{{ARCHIVOS_A_REFACTORIZAR}}`.\n\n**PROTOCOLO DE REFACTORIZACI√ìN ITERATIVO Y OPTIMIZADO (MANDATORIO):**\nProcesa **un archivo a la vez**. Para cada archivo, ejecuta el siguiente ciclo de dos fases.\n\n---\n\n**Inicio del Proceso:**\n*   Anuncia el n√∫mero total de archivos a procesar y cu√°l es el primer archivo con el que vas a trabajar.\n\n**CICLO POR ARCHIVO:**\n\n### Fase 1: Auditor√≠a y Propuesta de Refactorizaci√≥n\n*   **Objetivo:** Analizar las desviaciones del componente actual y proponer un plan de acci√≥n concreto, justificado y listo para aprobar.\n*   **Acciones:**\n    1.  Lee el contenido del archivo React actual.\n    2.  Comp√°ralo meticulosamente con las reglas en `design_tokens.md`.\n    3.  Genera y presenta un **\"Reporte de Auditor√≠a\"** que contenga dos partes:\n        *   **A. Propues"
    },
    {
      "path": ".gemini/prompts/02-auditor_de_calidad_de_output_en_bloques.md",
      "excerpt": "# üîç Prompt de Auto-Auditor√≠a Exhaustiva (Reutilizable)\n\n```markdown\n# META-PROMPT: Auditor de Calidad de Output\n\n## üéØ TU MISI√ìN\n\nEres un auditor t√©cnico senior experto en m√∫ltiples disciplinas. Tu trabajo es \nanalizar tu salida anterior con ojo cr√≠tico, encontrar problemas, inconsistencias, \nmejoras y validar contra est√°ndares de la industria.\n\n**IMPORTANTE:** S√© brutalmente honesto. Encuentra los problemas, no los ocultes.\n\n---\n\n## üìã PROCESO DE AUDITOR√çA\n\n### PASO 1: Identificaci√≥n del Output\n\n```markdown\n## üì¶ Output a Auditar\n\n**Tipo:** [C√≥digo / Componente / Documentaci√≥n / Configuraci√≥n / Dise√±o]\n**Contexto:** [Descripci√≥n breve]\n**Archivos involucrados:** [Lista]\n**Tecnolog√≠as:** [Stack utilizado]\n**Audiencia:** [Qui√©n lo usar√°]\n```\n\n---\n\n### PASO 2: An√°lisis Multi-Dimensional\n\nEval√∫a el output en estas **12 dimensiones**, con scoring de 0-10:\n\n---\n\n## üìä DIMENSIONES DE EVALUACI√ìN\n\n### 1Ô∏è‚É£ COMPLETITUD (0-10)\n\n**Criterios:**\n- [ ] ¬øSe completaron TODOS los requisitos solicitados?\n- [ ] ¬øFaltan casos edge o escenarios?\n- [ ] ¬øHay TODOs o placeholders sin resolver?\n- [ ] ¬øSe cubrieron todos los estados posibles?\n- [ ] ¬øLa documentaci√≥n est√° completa?\n\n**Checklist detallado:**\n```markdown\n- [ ] Requisito 1: [Completo / Parcial / Falta]\n- [ ] Requisito 2: [Completo / Parcial / Falta]\n- [ ] Casos edge considerados: [Lista]\n- [ ] Estados cubiertos: [default, hover, active, disabled, loading, error, empty...]\n- [ ] Documentaci√≥n: [Completa / Incompleta / Falta]\n```\n\n**Score:** __/10\n\n**Issues encontrados:**\n```markdown\nüî¥ CR√çTICO:\n- [Descripci√≥n del issue cr√≠tico]\n\nüü° MODERADO:\n- [Descripci√≥n del issue moderado]\n\nüîµ MENOR:\n- [Descripci√≥n del issue menor]\n```\n\n**Recomendaciones:**\n```markdown\n1. [Acci√≥n espec√≠fica con prioridad]\n2. [Acci√≥n espec√≠fica con prioridad]\n```\n\n---\n\n### 2Ô∏è‚É£ CONSISTENCIA (0-10)\n\n**Criterios:**\n- [ ] ¬øNaming conventions consistente?\n- [ ] ¬øEstilo de c√≥digo uniforme?\n- [ ] ¬øPatrones de dise√±o coherentes?\n- [ ] ¬øAlineado con referencias citadas (tailad"
    },
    {
      "path": ".gemini/prompts/fix_bug.md",
      "excerpt": "# Prompt: Protocolo de Correcci√≥n de Errores (v2)\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n*   **Prop√≥sito:** Este prompt gu√≠a a la IA a trav√©s de un proceso iterativo y seguro para analizar, corregir y verificar un bug reportado.\n*   **Acci√≥n Requerida:** Rellena los detalles del bug en la secci√≥n `BUG_REPORT`.\n*   **Modo de Uso:** Edita la secci√≥n, copia todo el contenido y p√©galo en Gemini CLI.\n\n---\n\n## 2. TEMPLATE DE EJECUCI√ìN (EDITAR ESTA SECCI√ìN)\n\nBUG_REPORT: \"\"\"\n- **ID de la Tarea/Bug:** `IOC-BUG-001`\n- **Comportamiento Actual:** \"cuando se deslogea el usuariol (boton log out desde el menu de usuario, redirige exitosamente al login, pero no impide que se vuelva al panel principal (creo que no borra el token del navegador) \"\n- **Comportamiento Esperado:** \"que no se pueda entra al dashboard luego de apretar Sign Out\"\n- **Pasos para Reproducirlo:**\n    1. ...\n    2. ...\n- **Archivos Relevantes Sugeridos:**\n    - ``\n\"\"\"\n\n---\n\n## 3. MANDATO OPERATIVO (PARA LA IA)\n\nTu rol es el de un **Senior Software Engineer** especializado en debugging y an√°lisis de causa ra√≠z. Tu misi√≥n es investigar, corregir y verificar el bug descrito en el `BUG_REPORT` siguiendo un protocolo iterativo.\n\n**PROTOCOLO DE CORRECCI√ìN DE ERRORES (MANDATORIO):**\nSigue rigurosamente las siguientes fases. Detente en cada punto de control y espera la aprobaci√≥n expl√≠cita del usuario.\n\n### Fase 1: An√°lisis de Causa Ra√≠z y Validaci√≥n de Hip√≥tesis\n*   **Objetivo:** Identificar el origen exacto del problema y validar esa suposici√≥n antes de planificar una soluci√≥n.\n*   **Acciones:**\n    1.  Analiza el `BUG_REPORT` y los archivos relevantes.\n    2.  Formula una **Hip√≥tesis de Causa Ra√≠z** clara.\n    3.  Prop√≥n un **M√©todo de Validaci√≥n** para confirmar tu hip√≥tesis (ej. \"a√±adir un `console.log` en X punto para verificar el valor de la variable Y\", \"ejecutar un test espec√≠fico\", \"consultar un archivo de configuraci√≥n Z\").\n\n*   **Punto de Control:** Presenta tu hip√≥tesis y el m√©todo de validaci√≥n. Si el usuar"
    },
    {
      "path": ".gemini/prompts/create_ux_blueprints.md",
      "excerpt": "# Prompt: Generar Fichas T√©cnicas de Vista (FTV)\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n*   **Prop√≥sito:** Este prompt transforma el dise√±o de producto en especificaciones t√©cnicas detalladas (Fichas T√©cnicas) para cada vista principal de la UI.\n*   **Acci√≥n Requerida:** Ninguna. Este prompt es de \"un solo uso\". Simplemente copia y p√©galo en Gemini CLI.\n\n---\n\n## 2. MANDATO OPERATIVO (PARA LA IA)\n\nTu rol es el de un **Lead Frontend Architect**. Tu misi√≥n es descomponer el documento de dise√±o de producto en un conjunto de **Fichas T√©cnicas de Vista (FTV)**, que servir√°n como la especificaci√≥n can√≥nica para el desarrollo en React.\n\n**Fuentes de Verdad (Sources of Truth):**\nDebes sintetizar la informaci√≥n de las siguientes fuentes en orden de precedencia:\n1.  **Requisitos:** `@.gemini/strategy/diseno_vista_admin.md`\n2.  **Gu√≠a de Marca:** `@.gemini/context/cambiaso_manual_de_marca.md`\n3.  **Sistema de Dise√±o:** `@.gemini/blueprints/tailadmin-react-component-docs.md`\n4.  **C√≥digo Existente:** `@src/`\n\n**Proceso de Razonamiento (Mandatorio):**\n\n1.  **An√°lisis Hol√≠stico:** Primero, lee todas las fuentes para entender el alcance completo. Identifica el n√∫mero total de vistas a generar (`{{TOTAL_VISTAS}}`).\n2.  **Mapeo de Requisitos a Componentes:** En tu memoria, construye una **Tabla de Mapeo**. Para cada funcionalidad descrita en el documento de dise√±o, mapea los componentes (TailAdmin o existentes en `@src/`) que pueden satisfacerla. Este mapa informar√° tu decisi√≥n de reutilizar vs. crear.\n3.  **Iteraci√≥n y Generaci√≥n:** Procesa cada vista principal secuencialmente, manteniendo un contador (`{{NUMERO_ACTUAL}}`), y genera una Ficha T√©cnica para cada una.\n\n**Tarea de Salida:**\n\nPara cada vista principal, genera un archivo de Ficha T√©cnica en `@.gemini/blueprints/`.\n\n*   **Formato del Nombre de Archivo:** `[NN]-FTV-[Nombre-de-Vista-en-kebab-case].md` (donde `[NN]` es un n√∫mero de dos d√≠gitos, ej. `01`, `02`).\n*   **Contenido del Archivo:** El contenido debe seguir estrictame"
    },
    {
      "path": ".gemini/diagnostics/IOC-004-refine-integration-diagnosis.md",
      "excerpt": "# üîç Diagn√≥stico de Integraci√≥n Refine - IOC-004\n**Fecha:** 2025-10-29  \n**Feature:** User Role Management (IOC-004)  \n**Estado:** üî¥ ERRORES CR√çTICOS DETECTADOS\n\n---\n\n## 1Ô∏è‚É£ RESUMEN EJECUTIVO\n\n### Problema Principal\nLos archivos `src/pages/admin/users/list.tsx` y `src/pages/admin/roles/list.tsx` est√°n **completamente vac√≠os** (solo 1 l√≠nea cada uno), causando el error:\n\n```\nApp.tsx:19 Uncaught SyntaxError: The requested module '/src/pages/admin/roles/list.tsx' \ndoes not provide an export named 'RoleManagementPage' (at App.tsx:19:10)\n```\n\n### Causa Ra√≠z Identificada\n**Los componentes `UserManagementPage` y `RoleManagementPage` nunca fueron implementados**, a pesar de que:\n- ‚úÖ Las rutas est√°n correctamente configuradas en `App.tsx`\n- ‚úÖ Los men√∫s est√°n correctamente configurados en `AppSidebar.tsx`\n- ‚úÖ El componente `PermissionManagementPage` S√ç est√° implementado (295 l√≠neas)\n- ‚úÖ Los componentes auxiliares (modales, tablas, badges) S√ç existen\n\n### Severidad\n- üî¥ **CR√çTICA**\n\n### Impacto\n- [x] Bloquea navegaci√≥n a p√°ginas de administraci√≥n (`/admin/usuarios` y `/admin/roles`)\n- [x] Impide CRUD de usuarios/roles\n- [ ] Rompe autenticaci√≥n/autorizaci√≥n\n- [ ] Solo afecta UX/performance\n\n---\n\n## 2Ô∏è‚É£ HALLAZGOS DETALLADOS\n\n### A. Exports/Imports Inconsistentes\n\n#### ‚ùå Errores Encontrados\n| Archivo | Export Actual | Import en App.tsx | Estado | L√≠neas |\n|---------|---------------|-------------------|--------|--------|\n| users/list.tsx | **NINGUNO** (archivo vac√≠o) | `import { UserManagementPage }` | ‚ùå ERROR | 1 |\n| roles/list.tsx | **NINGUNO** (archivo vac√≠o) | `import { RoleManagementPage }` | ‚ùå ERROR | 1 |\n| permissions/list.tsx | `export const PermissionManagementPage` | `import { PermissionManagementPage }` | ‚úÖ OK | 295 |\n\n#### üìã Detalle de Discrepancias\n\n**Archivo 1: src/pages/admin/users/list.tsx**\n```typescript\n// ARCHIVO ACTUALMENTE VAC√çO (solo 1 l√≠nea)\n// Se espera un componente completo que exporte:\n// export const UserManagementPage: React.FC = () => { ... }\n```\n\n**Arc"
    },
    {
      "path": ".gemini/diagnostics/BACKEND-FIX-user-creation-with-supabase.md",
      "excerpt": "# üîß Backend Fix: Automatizar Creaci√≥n de Usuarios en Supabase\n\n**Fecha:** 2025-10-29  \n**Problema:** El backend actual requiere que el admin cree manualmente el usuario en Supabase y copie el UUID  \n**Soluci√≥n:** Automatizar la creaci√≥n de cuenta en Supabase desde el backend\n\n---\n\n## üìã Cambios Necesarios en el Backend (Java/Spring Boot)\n\n### 1. Agregar Dependencia de Supabase (si no existe)\n\n```xml\n<!-- pom.xml -->\n<dependency>\n    <groupId>io.github.jan-tennert.supabase</groupId>\n    <artifactId>supabase-kt-jvm</artifactId>\n    <version>2.0.0</version>\n</dependency>\n\n<!-- O usar el cliente HTTP directamente -->\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-webflux</artifactId>\n</dependency>\n```\n\n### 2. Crear Servicio para Supabase Auth\n\n```java\npackage com.cambiaso.ioc.service;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Service;\nimport org.springframework.web.reactive.function.client.WebClient;\nimport reactor.core.publisher.Mono;\n\nimport java.util.Map;\nimport java.util.UUID;\n\n@Service\n@RequiredArgsConstructor\npublic class SupabaseAuthService {\n\n    @Value(\"${supabase.url}\")\n    private String supabaseUrl;\n\n    @Value(\"${supabase.service-role-key}\")\n    private String serviceRoleKey;\n\n    private final WebClient.Builder webClientBuilder;\n\n    /**\n     * Crea un usuario en Supabase Auth usando la Admin API\n     * @param email Email del usuario\n     * @param password Contrase√±a temporal\n     * @return UUID del usuario creado en Supabase\n     */\n    public UUID createSupabaseUser(String email, String password) {\n        WebClient webClient = webClientBuilder\n            .baseUrl(supabaseUrl)\n            .defaultHeader(\"apikey\", serviceRoleKey)\n            .defaultHeader(\"Authorization\", \"Bearer \" + serviceRoleKey)\n            .build();\n\n        Map<String, Object> requestBody = Map.of(\n            \"email\", email,\n            \""
    },
    {
      "path": ".gemini/diagnostics/IOC-004-corrections-summary.md",
      "excerpt": "# ‚úÖ Resumen de Correcciones - IOC-004 Refine Integration (ACTUALIZADO)\n\n**Fecha de actualizaci√≥n:** 2025-10-29  \n**Feature:** User Role Management (IOC-004)  \n**Estado:** ‚úÖ CORRECCIONES APLICADAS Y VERIFICADAS\n\n---\n\nBreve resumen: implement√© las p√°ginas faltantes (`UserManagementPage`, `RoleManagementPage`), correg√≠ firmas de props de los modales (UserFormModal, RoleAssignmentModal, PermissionAssignmentModal), a√±ad√≠ handlers `onSave` para creaci√≥n/actualizaci√≥n y asignaci√≥n de roles/permisos, y solucion√© errores de TypeScript y duplicados en archivos.\n\nChecklist de cambios realizados\n\n- [x] Detectar causa ra√≠z: `src/pages/admin/users/list.tsx` y `src/pages/admin/roles/list.tsx` estaban vac√≠os o duplicados.\n- [x] Implementar `src/pages/admin/users/list.tsx` (UserManagementPage) reutilizando patrones de `permissions/list.tsx`.\n- [x] Implementar `src/pages/admin/roles/list.tsx` (RoleManagementPage).\n- [x] **CR√çTICO:** Configurar `QueryClientProvider` en `main.tsx` ‚Äî Refine v5+ requiere React Query para funcionar. Error resuelto: \"No QueryClient set, use QueryClientProvider to set one\".\n- [x] Corregir imports/exports en `src/App.tsx` (ahora apuntan a componentes implementados).\n- [x] Corregir firmas de props de modales: eliminar props inv√°lidas (`mode`, `onSuccess`) y usar `onSave` cuando aplique.\n- [x] A√±adir carga de recursos auxiliares para modales:\n  - Permisos (`useList('admin/permissions')`) en `roles/list.tsx`.\n  - Roles (`useList('admin/roles')`) en `users/list.tsx`.\n- [x] Implementar handlers `handleSavePermissions`, `handleSaveRoles`, `handleCreateSubmit`, `handleUpdateSubmit` que usan `useCreate`/`useUpdate` de Refine y devuelven Promise<void> para integrarse con `UserFormModal`.\n- [x] Limpiar duplicados cr√≠ticos (archivo `roles/list.tsx` estaba triplicado ‚Äî se reemplaz√≥ por una √∫nica versi√≥n correcta). Se guard√≥ copia de respaldo en `/tmp/roles-list-backup.tsx`.\n- [x] Ejecutar type-check: `npx tsc --noEmit` ‚Üí 0 errores reportados en c√≥digo de aplicaci√≥n.\n\n--"
    },
    {
      "path": ".gemini/backups/tailadmin-documentacion.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/prompts-backend/generate_backend_implementation_plan.md",
      "excerpt": "# Prompt: Generar Plan de Implementaci√≥n de Backend (v2)\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n*   **Prop√≥sito:** Este prompt instruye a la IA para analizar una arquitectura y generar un plan de implementaci√≥n detallado, con tareas numeradas, dependencias y propietarios sugeridos.\n*   **Acci√≥n Requerida:** Proporciona la ruta al documento de arquitectura y un prefijo para los IDs de las tareas.\n*   **Modo de Uso:** Edita las variables, copia todo el contenido y p√©galo en Gemini CLI.\n\n---\n\n## 2. TEMPLATE DE EJECUCI√ìN (EDITAR ESTA SECCI√ìN)\n\nRUTA_DOCUMENTO_ARQUITECTURA: \"@.gemini/blueprints/dise√±o_de_arquitectura_sistema_de_ingesta_de_datos_asincronico.md\"\nPREFIJO_TAREAS: \"TASK-INGESTA-BACK\"\n\n---\n\n## 3. MANDATO OPERATIVO (PARA LA IA)\n\nTu rol es el de un **Senior Backend Tech Lead**. Tu misi√≥n es tomar el documento de arquitectura en `{{RUTA_DOCUMENTO_ARQUITECTURA}}` y descomponerlo en un **Blueprint de Implementaci√≥n** detallado, secuencial y contextualizado para nuestro equipo.\n\n### Contexto de Operaci√≥n\n*   **Gu√≠a Estrat√©gica:** Antes de empezar, lee los archivos: \n*   `@.gemini/strategy/1_Definicion_Proyecto.md`\n*   `@.gemini/strategy/2_Product_Backlog.md`\n*   `@.gemini/strategy/3_Stack_Tecnologico.md`\n*   `@.gemini/strategy/4_Design_Tokens.md`*    para entender los roles y responsabilidades del equipo, Definicion del Proyecto, El Product Backlog, etc.\n\n**PROTOCOLO DE DESCOMPOSICI√ìN Y GENERACI√ìN (MANDATORIO):**\n\n### Fase 1: An√°lisis de Dependencias y Asignaci√≥n\n*   **Acci√≥n:** Lee el documento de arquitectura. Identifica los componentes clave y sus interdependencias para establecer un orden de construcci√≥n l√≥gico. Bas√°ndote en los roles del `GEMINI.md`, asigna un propietario sugerido a cada tarea.\n\n### Fase 2: Generaci√≥n del Blueprint de Implementaci√≥n\n*   **Acci√≥n:** Genera un nuevo documento Markdown (`[prefijo-en-kebab-case]-implementation-plan.md`) en la ruta `@.gemini/blueprints/` con el contenido generado, siguiendo estrictamente la siguiente plantilla:\n\n---\n#"
    },
    {
      "path": ".gemini/prompts-backend/creador-de-ficha-tecnica-implementacion.md",
      "excerpt": "# PROMPT: Principal Solutions Architect & Technical Planner\n\n## 1. Rol y Misi√≥n\n\nActuaremos como un \"Principal Solutions Architect\", un rol senior responsable de guiar al equipo de desarrollo en la planificaci√≥n de nuevas funcionalidades. Nuestra misi√≥n es generar de manera aut√≥noma un documento de dise√±o t√©cnico de alta calidad, la **Ficha T√©cnica de Implementaci√≥n (FTI)**, que sea robusto, completo y estrat√©gicamente alineado con los est√°ndares del proyecto.\n\n## 2. Jerarqu√≠a de Fuentes de Verdad\n\nPara tomar decisiones de dise√±o y hacer inferencias, nos adheriremos estrictamente a la siguiente jerarqu√≠a de autoridad, en orden descendente de prioridad. Una fuente de nivel inferior **nunca** puede contradecir a una de nivel superior.\n\n1.  **Mandatos del Usuario:** Instrucciones expl√≠citas en la solicitud actual.\n2.  **Est√°ndares del Proyecto (C√≥digo):** Patrones de dise√±o, arquitecturas y librer√≠as ya existentes en la base de c√≥digo. La consistencia con el c√≥digo existente es prioritaria.\n3.  **Est√°ndares del Proyecto (Documentaci√≥n):** Reglas y gu√≠as definidas en `@.gemini/strategy`, `CONTRIBUTING.md` u otros documentos de arquitectura.\n4.  **Mejores Pr√°cticas de la Industria:** Est√°ndares reconocidos (ej. SOLID, patrones de dise√±o, OWASP) que se usar√°n como √∫ltimo recurso cuando no exista un precedente en las fuentes superiores.\n\n## 3. Flujo de Trabajo de Planificaci√≥n y Generaci√≥n\n\nSeguiremos un proceso riguroso para garantizar la m√°xima calidad del resultado final.\n\n### Paso 0: Quality Gate de la Solicitud\nAntes de iniciar, validaremos la solicitud del usuario. Si la solicitud es demasiado vaga o carece de un objetivo claro (ej: \"Haz una FTI para el login\"), **no procederemos**. En su lugar, informaremos al usuario que la solicitud es insuficiente para generar un plan de calidad y le haremos 2-3 preguntas clave para clarificar el objetivo y el alcance.\n\n### Paso 1: Verificaci√≥n de Herramientas\nVerificaremos la existencia del archivo de plantilla en `@.gemini/temp"
    },
    {
      "path": ".gemini/prompts-backend/implement_ingesta_backend_plan.md",
      "excerpt": "# Prompt: Director de Implementaci√≥n de Backend (v2)\n\n## 1. CONFIGURACI√ìN (PARA EL HUMANO)\n*   **Prop√≥sito:** Este prompt instruye a la IA para ejecutar un plan de implementaci√≥n de backend por m√≥dulos, generando el c√≥digo y las pruebas correspondientes, y finalizando con una descripci√≥n de Pull Request.\n*   **Acci√≥n Requerida:** Edita las tres variables en la secci√≥n de ejecuci√≥n.\n*   **Modo de Uso:** Edita las variables y copia/pega todo el contenido en Gemini CLI.\n\n---\n\n## 2. TEMPLATE DE EJECUCI√ìN (EDITAR ESTA SECCI√ìN)\n\nPLAN_DE_IMPLEMENTACION: \"@.gemini/blueprints/task-ingesta-back-implementation-plan.md\"\nDISE√ëO_DE_ARQUITECTURA: \"@.gemini/context/dise√±o_de_arquitectura_sistema_de_ingesta_de_datos_asincronico.md\"\nESQUEMA_DB: \"@.gemini/sql/schema_etl.sql\"\n\n---\n\n## 3. MANDATO OPERATIVO (PARA LA IA)\n\nTu rol es el de un **Lead Backend Engineer**. Tu misi√≥n es ejecutar el plan de trabajo en `{{PLAN_DE_IMPLEMENTACION}}` de forma modular y profesional, culminando en la preparaci√≥n de un Pull Request.\n\n**PROTOCOLO DE EJECUCI√ìN POR FASES (MANDATORIO):**\n\n### Fase 0: Kick-off y Estrategia de Implementaci√≥n\n*   **Objetivo:** Demostrar una comprensi√≥n hol√≠stica de la tarea.\n*   **Acci√≥n:** Lee los tres documentos de contexto (`Plan`, `Arquitectura`, `Esquema`). Presenta un resumen de alto nivel de tu estrategia de implementaci√≥n, describiendo c√≥mo los m√≥dulos del plan se conectan para cumplir con la visi√≥n de la arquitectura.\n*   **Punto de Control:** Espera la aprobaci√≥n de la estrategia (\"Estrategia aprobada, inicia la implementaci√≥n del primer m√≥dulo\") antes de continuar.\n\n---\n\n### Fase de Ejecuci√≥n por M√≥dulos\n*   **Objetivo:** Implementar el plan de trabajo, un m√≥dulo a la vez.\n*   **Acci√≥n:**\n    1.  Anuncia con qu√© m√≥dulo del plan de implementaci√≥n vas a trabajar.\n    2.  Implementa **todas las tareas** de ese m√≥dulo.\n    3.  Para cada tarea, genera tanto el **c√≥digo de producci√≥n** como el **c√≥digo de prueba (unitario/integraci√≥n)** que la verifica.\n    4.  Presenta t"
    },
    {
      "path": ".gemini/sprints/Sprint-1-Backlog.md",
      "excerpt": "# Sprint 1 ‚Äì Sprint Backlog (El Ciclo de Valor Completo)\n\n## Objetivo del Sprint\nEntregar un ciclo de valor de extremo a extremo: un usuario podr√° autenticarse, cargar datos de producci√≥n a trav√©s de un archivo CSV y visualizar inmediatamente un dashboard con KPIs y gr√°ficos que reflejen esa nueva informaci√≥n.\n\n## Historias Comprometidas\n| ID | T√≠tulo | Tipo | Feature | Prioridad | SP | Asignado | Estado |\n| :--- | :--- | :--- | :--- | :--- | :-: | :--- | :--- |\n| IOC-021 | Como Usuario, quiero iniciar sesi√≥n en la plataforma | Historia de Usuario | Autenticaci√≥n | Cr√≠tica | 5 | Jaime | ‚úÖ **Terminada** |\n| IOC-022 | Como Usuario, quiero cerrar mi sesi√≥n de forma segura | Historia de Usuario | Autenticaci√≥n | Cr√≠tica | 3 | Jaime | ‚úÖ **Terminada** |\n| IOC-023 | Construir el Layout Principal y las Rutas Protegidas | Tarea T√©cnica | Infraestructura Frontend | Cr√≠tica | 8 | Jaime | ‚úÖ **Terminada** |\n| IOC-001 | Cargar y validar un archivo CSV con datos de producci√≥n | Historia de Usuario | Ingesta de Datos | Cr√≠tica | 5 | Boris | üü° **En Progreso** |\n| IOC-006a | Como Gerente, quiero visualizar un dashboard con sus gr√°ficos y KPIs | Historia de Usuario | Visualizaci√≥n de Datos | Cr√≠tica | 13 | Boris | ‚ùå **Por Hacer** |\n\n## Checklist de Tareas del Sprint\n\n| ID | Capa | Historia | Responsable | Tarea T√©cnica | Estado |\n| :--- | :--- | :--- | :--- | :--- | :--- |\n| **BE-TASK-01** | Backend | `IOC-021` | Jaime | Configurar Spring Security, CORS y dependencias de JWT. | ‚úÖ **Terminada** |\n| **BE-TASK-02** | Backend | `IOC-023` | Jaime | Implementar `JwtRequestFilter` para validar tokens en cada petici√≥n. | ‚úÖ **Terminada** |\n| **BE-TASK-03** | Backend | `IOC-021` | Jaime | Crear `AuthController` y `AuthService` para manejar el login y la generaci√≥n de JWT. | ‚úÖ **Terminada** |\n| **FE-TASK-01** | Frontend | `IOC-021` | Jaime | Crear vistas y componentes para el flujo de autenticaci√≥n (SignIn, SignUp, etc.). | ‚úÖ **Terminada** |\n| **FE-TASK-02** | Frontend | `IOC-021` | Jaime | Inte"
    },
    {
      "path": ".gemini/sprints/SPRINT_1_SEGUIMIENTO.md",
      "excerpt": "# Seguimiento del Sprint 1: Flujo de Datos y Seguridad\n\nEste documento proporciona una vista en tiempo real del progreso del Sprint 1, mostrando el estado de las historias de usuario y el avance en t√©rminos de Story Points (SP).\n\n*   **Fecha de Inicio (Estimada):** Lunes, 15 de Septiembre de 2025\n*   **Duraci√≥n:** 2 semanas (10 d√≠as h√°biles)\n*   **Total de Story Points Comprometidos:** 21 SP\n\n---\n\n## Resumen de Progreso\n\n*   **Story Points Completados:** 8 SP\n*   **Story Points Restantes:** 13 SP\n*   **Progreso del Sprint:** 38% completado\n\n---\n\n## 1. Tablero de Estado de Historias\n\nEsta tabla muestra el estado actual de cada historia comprometida en el sprint.\n\n| ID      | T√≠tulo                                       | SP | Estado        | Notas / Pr√≥ximos Pasos                                                                                             |\n| :------ | :------------------------------------------- | :- | :------------ | :----------------------------------------------------------------------------------------------------------------- |\n| `IOC-021` | Como Usuario, quiero iniciar sesi√≥n          | 5  | ‚úÖ **Terminada**  | Flujo completo de registro, login y reseteo de contrase√±a implementado.                                            |\n| `IOC-022` | Como Usuario, quiero cerrar mi sesi√≥n        | 3  | ‚úÖ **Terminada**  | Funcionalidad de logout implementada y verificada como parte de la historia `IOC-021`.                             |\n| `IOC-023` | Construir el Layout y Rutas Protegidas       | 8  | üü° **En Progreso** | Base de rutas protegidas implementada. **Pr√≥ximo paso:** Restaurar todas las rutas del dashboard dentro del layout. |\n| `IOC-001` | Cargar y validar un archivo CSV              | 5  | ‚ùå **Por Hacer**  | Pendiente de iniciar.                                                                                              |\n\n---\n\n## 2. Tabla de Burndown\n\nEsta tabla simula el gr√°fico de burndown, registrando el trabajo completado (SP \"quemados\") al"
    },
    {
      "path": ".gemini/sprints/IMPEDIMENT_LOG_SPRINT_1.md",
      "excerpt": "# Registro de Impedimentos del Sprint 1 (v1.3)\n\nEste documento es un artefacto vivo utilizado para rastrear, gestionar y aprender de todos los obst√°culos que afectan el progreso del Sprint 1.\n\n---\n\n## Proceso de Gesti√≥n de Impedimentos\n1.  **Identificaci√≥n:** Cualquier miembro del equipo a√±ade un nuevo impedimento a la lista.\n2.  **An√°lisis:** En la Daily Scrum, se define el plan de acci√≥n, el responsable, la causa ra√≠z y la acci√≥n preventiva.\n3.  **Seguimiento:** El estado se actualiza diariamente hasta su resoluci√≥n.\n\n---\n\n## Registro de Impedimentos\n\n| ID | Impedimento | Responsable | Plan de Acci√≥n | Causa Ra√≠z | Acci√≥n Preventiva | Estado |\n| :--- | :--- | :--- | :--- | :--- | :--- | :--- |\n| **IMP-001** | **Flujo de usuario incompleto (Error 404):** La p√°gina `/update-password` no exist√≠a. | **Jaime** | Implementar la vista y ruta faltantes seg√∫n el blueprint. | **Planificaci√≥n Incompleta:** El blueprint inicial no contempl√≥ la p√°gina de destino del enlace de reseteo. | **Mejora de Blueprints:** Actualizar todos los futuros blueprints para incluir expl√≠citamente todas las vistas y rutas implicadas en un flujo. | ‚úÖ **Resuelto** |\n| **IMP-002** | **Deuda t√©cnica por tipado laxo:** El uso de `any` y la falta de tipos espec√≠ficos generaron advertencias de calidad. | **Jaime** | Refactorizar los componentes afectados para usar tipos estrictos e interfaces. | **Desarrollo Acelerado:** Se prioriz√≥ la funcionalidad sobre la calidad de tipos en la implementaci√≥n inicial. | **Definici√≥n de Hecho (DoD):** A√±adir un criterio al DoD que exija \"cero advertencias de `any` expl√≠cito\" en el c√≥digo nuevo. | ‚úÖ **Resuelto** |\n| **IMP-03** | **UX Inconsistente en notificaciones:** El uso de `alert()` nativo romp√≠a con el sistema de dise√±o. | **Jaime** | Instalar `react-hot-toast` y refactorizar los formularios para usar notificaciones emergentes. | **Falta de un Sistema de Notificaciones:** El proyecto no contaba con una soluci√≥n estandarizada para notificaciones. | **Decisi√≥n de "
    },
    {
      "path": ".gemini/sprints/COHERENCE_AUDIT_REPORT_SPRINT_1.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/TAREAS_ADICIONALES_SPRINT_1.md",
      "excerpt": "# Tareas Adicionales del Sprint 1: Arquitectura y Calidad\n\nEste documento complementa la `BITACORA_SPRINT_1.md` y registra tareas t√©cnicas transversales que mejoran la calidad, mantenibilidad y experiencia de desarrollo del proyecto, pero que no est√°n directamente ligadas a una √∫nica historia de usuario.\n\n---\n## TASK-001: Dise√±o e Implementaci√≥n del Panel de Administraci√≥n\n\n*   **Estado:** ‚úÖ **Terminada**\n*   **Objetivo T√©cnico:** Transformar los requerimientos del backlog en especificaciones t√©cnicas (blueprints) y desarrollar la primera vista del panel de administraci√≥n.\n*   **Archivos Creados:**\n    *   `diseno_vista_admin.md`\n    *   `.gemini/blueprints/01-FTV-panel-principal.md` (y los otros 3 FTVs)\n    *   `src/pages/admin/AdminDashboardPage.tsx`\n    *   `src/components/admin/MetricCard.tsx`\n    *   `src/components/admin/QuickAccessButton.tsx`\n    *   `src/components/ui/skeletons/MetricCardSkeleton.tsx`\n*   **Resumen de la Implementaci√≥n:** Se dise√±√≥ la arquitectura completa de la vista de administrador y se document√≥ en Fichas T√©cnicas de Vista (FTVs). Posteriormente, se implement√≥ la primera de estas vistas, el \"Panel Principal\" (`AdminDashboardPage`), creando sus componentes de UI reutilizables (`MetricCard`, `QuickAccessButton`) y esqueletos de carga para una mejor UX. Se a√±adi√≥ la ruta y el enlace correspondiente en el men√∫ lateral.\n*   **Verificaci√≥n y Pruebas Realizadas:**\n    *   **Pruebas Manuales (CATs):** Se verific√≥ manualmente el cumplimiento de todos los Criterios de Aceptaci√≥n T√©cnicos definidos en `01-FTV-panel-principal.md`:\n        *   **CAT-1 (Carga):** Se confirm√≥ la aparici√≥n de `SkeletonLoaders` al cargar la vista.\n        *   **CAT-2 (√âxito):** Se confirm√≥ el renderizado correcto de los componentes con datos simulados.\n        *   **CAT-3 (Error):** Se prob√≥ (descomentando un `throw new Error`) que la vista muestra un componente `Alert` de error.\n        *   **CAT-4 (Vac√≠o):** Se prob√≥ (modificando los datos simulados) que los componente"
    },
    {
      "path": ".gemini/sprints/backend_sync_brief.md",
      "excerpt": "# Backend Sync Brief - IOC Platform\n**Versi√≥n**: 2025-10-10 13:00\n**Stack Target**: Spring Boot 3 + Java 21\n**Contrato Format**: TypeScript (para referencia Frontend)\n**Fuente**: An√°lisis de c√≥digo fuente (`/src/main/java`)\n\n---\n\n## 1. Metadatos de Generaci√≥n\n\n**Generado**: 2025-10-10T16:00:00Z\n**Fuentes Analizadas**:\n- `DashboardController.java`\n- `EtlController.java`\n- `EtlJobStatusDto.java`\n- `MetabaseProperties.java`\n\n**Estad√≠sticas**:\n- Endpoints encontrados: 3\n- Configuraciones analizadas: 1\n- Conflictos detectados: 0\n- Advertencias: 0\n\n---\n\n## 2. Pol√≠tica de Seguridad Global\n\n### Mecanismo de Autenticaci√≥n\n- **Provider**: Supabase GoTrue (inferido de `SecurityConfig`)\n- **Token Format**: JWT en header `Authorization: Bearer <token>`\n- **Validaci√≥n Backend**: Spring Security como Resource Server\n\n### Matriz de Acceso por Endpoint\n\n| Endpoint | M√©todo | Auth | Roles | Rate Limit |\n|----------|--------|------|-------|------------|\n| `/api/v1/dashboards/{dashboardId}` | GET | ‚úÖ | `isAuthenticated()` | `dashboardAccess` |\n| `/api/etl/start-process` | POST | ‚úÖ | `isAuthenticated()` | N/A |\n| `/api/etl/jobs/{jobId}/status` | GET | ‚úÖ | `isAuthenticated()` | N/A |\n\n---\n\n## 3. Contratos de API\n\n### 3.1. Dashboards\n\n#### `GET /api/v1/dashboards/{dashboardId}`\n\n**Prop√≥sito**: Genera una URL firmada de corta duraci√≥n para renderizar un dashboard de Metabase en un iframe.\n**Fuente**: `DashboardController.java`\n\n##### Request\n\n```typescript\n// Path Params\ninterface GetDashboardUrlParams {\n  dashboardId: number; // Validado con @Min(1) @Max(999999)\n}\n```\n\n##### Response (200 OK)\n\n```typescript\ninterface DashboardUrlResponse {\n  signedUrl: string;\n  expiresInMinutes: number;\n  dashboardId: number;\n}\n```\n\n##### Error Responses\n- **401 Unauthorized**: Token JWT inv√°lido o expirado.\n- **403 Forbidden**: (Si se implementan roles espec√≠ficos).\n- **404 Not Found**: Si el `dashboardId` no est√° configurado.\n- **429 Too Many Requests**: Rate limit excedido.\n- **500 Internal Server Err"
    },
    {
      "path": ".gemini/sprints/BITACORA_SPRINT_1.md",
      "excerpt": "# Bit√°cora T√©cnica del Sprint 1\n\nEste documento registra el desglose t√©cnico de las implementaciones realizadas durante el Sprint 1. Sirve como una memoria t√©cnica para futuras consultas, mantenimiento y onboarding de nuevos miembros al equipo.\n\n---\n<!-- COMIENZO DE LA PLANTILLA DE HISTORIA - NO MODIFICAR -->\n## [ID de la Historia]: [T√≠tulo de la Historia]\n\n*   **Objetivo de Negocio (El \"Para Qu√©\"):** [Descripci√≥n concisa del valor que aporta la historia al usuario/negocio.]\n*   **Criterios de Aceptaci√≥n Clave:**\n    *   [Criterio 1]\n    *   [Criterio 2]\n    *   ...\n\n### Desglose T√©cnico de la Implementaci√≥n\n\n*   **Plan Aprobado:** [Resumen del plan de alto nivel que Gemini propuso antes de la implementaci√≥n.]\n\n*   **Archivos Creados/Modificados:**\n    *   `ruta/al/archivo1.java` (Backend)\n    *   `ruta/al/componente1.tsx` (Frontend)\n    *   ...\n\n*   **Resumen de la Implementaci√≥n:**\n    [Explicaci√≥n t√©cnica detallada pero concisa. Por ejemplo: \"Se cre√≥ el `AuthController` en el backend con un endpoint POST `/api/auth/login` que utiliza el `AuthService` para validar credenciales contra Supabase. En caso de √©xito, genera un JWT. En el frontend, el componente `LoginPage` ahora gestiona el estado del formulario y, al enviarlo, llama al endpoint, almacenando el JWT en `localStorage` y redirigiendo al usuario al dashboard principal.\"]\n\n### Verificaci√≥n y Pruebas Realizadas\n\n*   **Pruebas Automatizadas:**\n    *   **(Backend) Pruebas Unitarias:** [Describe brevemente qu√© se prob√≥. Ej: \"Se cre√≥ `AuthControllerTest` para verificar el endpoint `/api/auth/login` con credenciales v√°lidas (esperando status 200 OK) y credenciales inv√°lidas (esperando status 401 Unauthorized).\"]\n    *   **(Frontend) Pruebas de Componentes:** [Si aplica. Ej: \"Se prob√≥ que el componente `LoginForm` maneja correctamente los estados de carga y error.\"]\n\n*   **Pruebas Manuales (End-to-End):**\n    *   **Caso de Prueba 1 (Happy Path):** [Describe el flujo. Ej: \"1. Navegar a `/login`. 2. Ingresar un email"
    },
    {
      "path": ".gemini/sprints/IMPEDIMENT_LOG_SPRINT_1_v3.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/SPRINT_1_RETROSPECTIVE.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/CORRECTION_PLAN_SPRINT_1.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/backend_sync_brief_IOC-004.md",
      "excerpt": "# Backend Sync Brief - IOC-004: User Role Management\n**Versi√≥n**: 2025-10-27 (v1.0)  \n**Stack Target**: Spring Boot 3.5.5 + Java 21 + PostgreSQL (Supabase)  \n**Contrato Format**: TypeScript (para referencia Frontend)  \n**Estado**: ‚úÖ Implementado y Validado (Score: 94/100)\n\n---\n\n## 1. Metadatos de Generaci√≥n\n\n**Generado**: 2025-10-27T00:00:00Z  \n**Fuentes Analizadas**:\n- `.gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md`\n- `.gemini/validation/IOC-004-blueprint-validation.md`\n- Implementaci√≥n verificada en `src/main/java/com/cambiaso/ioc/controller/admin/*`\n\n**Estad√≠sticas**:\n- Endpoints implementados: 17\n- Controllers: 4 (AdminUserController, RoleController, PermissionController, AssignmentController)\n- Conflictos detectados: 0\n- Advertencias: 1 (OpenAPI/Swagger pendiente de a√±adir)\n\n---\n\n## 2. Pol√≠tica de Seguridad Global\n\n### Mecanismo de Autenticaci√≥n\n- **Provider**: Supabase GoTrue\n- **Token Format**: JWT en header `Authorization: Bearer <token>`\n- **Validaci√≥n Backend**: Spring Security como Resource Server\n- **JWKS Endpoint**: `https://[SUPABASE_URL]/auth/v1/.well-known/jwks.json`\n- **Claims Extra√≠dos**: `sub` (UUID del usuario), `realm_access.roles`, `roles`\n\n### Autorizaci√≥n\n- **Mapeo de Roles**: Claims `realm_access.roles` y `roles` ‚Üí `ROLE_ADMIN`, `ROLE_GERENTE`, `ROLE_ANALISTA`\n- **Pol√≠tica General**: Todos los endpoints admin requieren `ROLE_ADMIN`\n- **RLS en Supabase**: Pol√≠ticas habilitadas en tablas `app_users`, `roles`, `permissions`, `user_roles`, `role_permissions`\n\n### Matriz de Acceso por Endpoint\n\n| Endpoint | M√©todo | Auth | Roles Requeridos | Rate Limit |\n|----------|--------|------|------------------|------------|\n| `/api/v1/admin/users` | GET | ‚úÖ | ADMIN | 100/min |\n| `/api/v1/admin/users` | POST | ‚úÖ | ADMIN | 20/min |\n| `/api/v1/admin/users/{id}` | GET | ‚úÖ | ADMIN | 100/min |\n| `/api/v1/admin/users/{id}` | PUT | ‚úÖ | ADMIN | 50/min |\n| `/api/v1/admin/users/{id}` | DELETE | ‚úÖ | ADMIN | 10/min |\n| `/api/v1/admin/roles"
    },
    {
      "path": ".gemini/sprints/REFACTOR_PLAN_SPRINT_1.md",
      "excerpt": "# Plan de Tareas para la Refactorizaci√≥n de Ingesta de Datos (Sprint 1)\n\nEste documento desglosa el blueprint `refactorizacion_frontend_v3.md` en tareas accionables para ser gestionadas en un tablero Kanban (GitHub Projects).\n\n---\n\n### **√âpica: Refactorizaci√≥n de la Ingesta de Datos (IOC-001 Integraci√≥n)**\n\n---\n\n#### **Fase 1: Configuraci√≥n y Estructura (SETUP)**\n\n-   [ ] **RF-S01:** **Configurar Dependencias:** Instalar `axios` para peticiones HTTP y `vitest`, `msw`, `@testing-library/react` para el entorno de pruebas.\n-   [ ] **RF-S02:** **Definir Contratos de API:** Crear el archivo `src/types/api.ts` y a√±adir las interfaces TypeScript para todos los DTOs de √©xito (`StartProcessResponse`, `EtlJobStatusDto`) y de error (`StandardError`).\n-   [ ] **RF-S03:** **Crear Helper de Errores:** Crear el archivo `src/utils/apiError.ts` con la funci√≥n `parseApiError` para estandarizar el manejo de errores de la API en toda la aplicaci√≥n.\n\n---\n\n#### **Fase 2: Servicio de API (API)**\n\n-   [ ] **RF-A01:** **Inicializar Cliente HTTP:** Crear el archivo `src/services/apiService.ts` y configurar la instancia de `axios` con la `baseURL` y los interceptores.\n-   [ ] **RF-A02:** **Implementar Interceptor de Petici√≥n:** A√±adir la l√≥gica al interceptor de `axios` para obtener el token JWT del `AuthProvider` e inyectarlo en la cabecera `Authorization` de cada petici√≥n.\n-   [ ] **RF-A03:** **Implementar Interceptor de Respuesta:** A√±adir la l√≥gica al interceptor de `axios` para detectar respuestas `401` o `403` y ejecutar una funci√≥n de `signOut` global.\n-   [ ] **RF-A04:** **Implementar Subida de Archivo:** Crear la funci√≥n `startEtlProcess` en `apiService.ts` que env√≠e el archivo como `multipart/form-data` y gestione el progreso de la subida.\n-   [ ] **RF-A05:** **Implementar Consulta de Estado:** Crear la funci√≥n `getJobStatus` en `apiService.ts` que acepte un `jobId` y consulte el estado del trabajo.\n\n---\n\n#### **Fase 3: Refactorizaci√≥n de Componentes de UI (UI)**\n\n-   [ ] **RF-UI01:"
    },
    {
      "path": ".gemini/sprints/BURNDOWN_CHART_SPRINT_1.md",
      "excerpt": "# Burndown Chart del Sprint 1 (v1.1)\n\nEste documento visualiza el progreso del equipo y registra las decisiones clave tomadas durante el Sprint 1.\n\n## Par√°metros del Sprint\n*   **Duraci√≥n Total:** 13 d√≠as h√°biles\n*   **Story Points (SP) Comprometidos:** 21 SP\n*   **Progreso Ideal por D√≠a (SP quemados):** 21 SP / 13 d√≠as ‚âà **1.62 SP/d√≠a**\n\n---\n\n## Tabla de Seguimiento (Burndown)\n\n| D√≠a | Fecha (Estimada) | Decisiones / Acciones Clave del D√≠a | SP Quemados (D√≠a) | SP Quemados (Acumulado) | SP Restantes (Real) | SP Restantes (Ideal) | Desviaci√≥n |\n| :-: | :--- | :--- | :---: | :---: | :---: | :---: | :---: |\n| 0   | 15/09 | Inicio del Sprint | 0 | 0 | 21 | 21.00 | 0.00 |\n| 1   | 16/09 | Implementaci√≥n inicial de autenticaci√≥n. | 0 | 0 | 21 | 19.38 | **+1.62** |\n| 2   | 17/09 | Finalizaci√≥n de HU `IOC-021` y `IOC-022`. | 8 | 8 | 13 | 17.76 | **-4.76** |\n| 3   | 18/09 | (Feriado) | 0 | 8 | 13 | 17.76 | **-4.76** |\n| 4   | 19/09 | (Feriado) | 0 | 8 | 13 | 17.76 | **-4.76** |\n| 5   | 22/09 | **Decisi√≥n:** Iniciar refactorizaci√≥n y correcci√≥n de deuda t√©cnica identificada por Qodana. | 0 | 8 | 13 | 16.14 | **-3.14** |\n| 6   | 23/09 | **Decisi√≥n:** Implementar notificaciones emergentes (`react-hot-toast`) para mejorar la UX. | 0 | 8 | 13 | 14.52 | **-1.52** |\n| 7   | 24/09 | Implementaci√≥n de la vista `AdminDashboard` (`01-FTV-panel-principal`). | 0 | 8 | 13 | 12.90 | **+0.10** |\n| 8   | 25/09 | | | | | 11.28 | |\n| 9   | 26/09 | | | | | 9.66 | |\n| 10  | 29/09 | | | | | 8.04 | |\n| 11  | 30/09 | | | | | 6.42 | |\n| 12  | 01/10 | | | | | 4.80 | |\n| 13  | 02/10 | | | | | **0.00** | |\n\n---\n\n### An√°lisis del Progreso (al D√≠a 7)\n\n*   **Estado Actual:** Estamos ligeramente por **delante** de la l√≠nea ideal por **0.10 Story Points**.\n*   **Observaciones:** A pesar de dedicar tiempo a tareas de no-desarrollo (refactorizaci√≥n, documentaci√≥n), el r√°pido avance inicial nos mantiene en una buena posici√≥n. La desviaci√≥n positiva es m√≠nima, lo que indica que estamos casi exactamente donde de"
    },
    {
      "path": ".gemini/sprints/frontend_sync_brief.md",
      "excerpt": "# Frontend Sync Brief: API del Backend (v2025-09-21)\n\n## 1. Resumen Ejecutivo\nEste documento es la especificaci√≥n oficial de la API del backend, generada desde el c√≥digo fuente (controladores y DTOs). Sirve como contrato de integraci√≥n para que el equipo de Frontend consuma los endpoints de forma segura y consistente.\n\n## 2. Pol√≠tica de Autenticaci√≥n\n- Mecanismo: Todos los endpoints protegidos requieren un JWT en la cabecera `Authorization: Bearer <token>`.\n- Errores: Las peticiones sin token v√°lido a endpoints protegidos devolver√°n `401 Unauthorized` o `403 Forbidden`.\n\n### 2.1 Esquemas de Error (payloads estandarizados)\n- Errores generales (validez de archivo, conflicto de job, argumentos inv√°lidos, tama√±o de archivo, fallos internos)\n  - Fuente: GlobalExceptionHandler (com.cambiaso.ioc.exception)\n  ```typescript\n  // Usado en: 400, 409, 413, 500\n  interface StandardError {\n    error: string;     // \"VALIDATION_ERROR\" | \"INVALID_ARGUMENT\" | \"CONFLICT\" | \"FILE_TOO_LARGE\" | \"INTERNAL_ERROR\"\n    message: string;   // detalle humano-legible\n    timestamp: string; // ISO-8601 con offset (OffsetDateTime)\n  }\n  ```\n- Errores de seguridad (autenticaci√≥n/autorizaci√≥n)\n  - Fuente: SecurityExceptionHandler (com.cambiaso.ioc.security)\n  ```typescript\n  // 401 Unauthorized\n  interface UnauthorizedError {\n    timestamp: string; // ISO LocalDateTime\n    status: 401;\n    error: \"Unauthorized\";\n    message: string;   // p.ej. \"Authentication failed: <detalle>\"\n    path: string;      // ruta solicitada\n  }\n\n  // 403 Forbidden\n  interface ForbiddenError {\n    timestamp: string; // ISO LocalDateTime\n    status: 403;\n    error: \"Forbidden\";\n    message: string;   // p.ej. \"You do not have permission to access this resource.\"\n    path: string;      // ruta solicitada\n  }\n  ```\n\n---\n\n## 3. API Endpoints Disponibles\n\n### Endpoint: [POST] /api/etl/start-process\n- Descripci√≥n: Inicia un proceso ETL para el archivo CSV subido. Valida, calcula hash para idempotencia, crea el job y dispara el"
    },
    {
      "path": ".gemini/sprints/FP-001-CustomUserDetails-JWT-Converter.md",
      "excerpt": "# Feature Plan: CustomUserDetails JWT Converter for Metabase Filters\n\n## Metadata\n- **ID**: FP-001\n- **Sprint**: Sprint Current\n- **Prioridad**: Alta\n- **Tipo**: Bug Fix / Mejora\n- **Estimaci√≥n**: 2-3 d√≠as\n- **Asignado a**: Backend Team\n- **Estado**: \n  - [x] Planificaci√≥n\n  - [ ] En Dise√±o\n  - [ ] Listo para Desarrollo\n  - [ ] En Desarrollo\n  - [ ] En Testing\n  - [ ] Completado\n- **Fecha Creaci√≥n**: 2025-10-22\n- **√öltima Actualizaci√≥n**: 2025-10-22\n\n---\n\n## 1. Contexto de Negocio\n\n### 1.1. Problema a Resolver\n\n**Contexto Actual**:\nEl sistema de autenticaci√≥n actual utiliza tokens JWT de Supabase que son validados correctamente por Spring Security. Sin embargo, cuando se crea el objeto de autenticaci√≥n, el \"principal\" (la identidad del usuario) permanece como un objeto `Jwt` gen√©rico est√°ndar de Spring Security, en lugar de nuestra clase personalizada `CustomUserDetails` que contiene informaci√≥n espec√≠fica del dominio como `department`, `region`, `userId`, y `fullName`.\n\n**Problema Espec√≠fico**:\nEl `MetabaseEmbeddingService` necesita acceder a estos campos adicionales para construir los \"Locked Parameters\" (filtros de seguridad) que restringen qu√© datos puede ver cada usuario en los dashboards. Actualmente, cuando intenta hacer un cast del principal gen√©rico a `CustomUserDetails`, la conversi√≥n falla, generando el siguiente warning:\n\n```\nWARN c.c.i.service.MetabaseEmbeddingService: Authentication principal is not CustomUserDetails. Attribute-based filters will not be applied.\n```\n\n**Impacto del Problema**:\n- **Usuarios afectados**: Todos los usuarios que acceden a dashboards de Metabase\n- **Frecuencia**: Ocurre en cada solicitud de dashboard (100% de las veces)\n- **Severidad**: Alta - Los dashboards pueden no renderizarse correctamente o mostrar datos sin filtrar\n- **Coste de NO resolverlo**: \n  - Riesgo de seguridad: usuarios podr√≠an ver datos que no les corresponden\n  - Errores en frontend: `TypeError: Cannot read properties of undefined (reading 'cols')`\n  - Dash"
    },
    {
      "path": ".gemini/sprints/SPRINT_1_RETROSPECTIVE_VALIDATION.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/DAILY_SCRUM_SUMMARY_SPRINT_1.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/IMPEDIMENT_LOG_SPRINT_1_v2.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/sumario.md",
      "excerpt": "# Sumario t√©cnico ‚Äì ioc-backend\n\nEste documento resume el prop√≥sito del proyecto, componentes clave, pr√°cticas de calidad aplicadas y recomendaciones de mejora.\n\n## Resumen ejecutivo\nBackend Spring Boot para orquestar procesos ETL: recibe archivos, valida, calcula hash/idempotencia, ejecuta carga transaccional (delete+insert por ventana), publica m√©tricas y notificaciones en tiempo real, y protege endpoints con JWT y rate limiting est√°ndar.\n\n- P√∫blico objetivo: devs backend/frontend, SRE/ops, QA.\n- Objetivos: confiabilidad del ETL, trazabilidad (job/status), observabilidad y seguridad por defecto.\n\n## Stack y dependencias\n- Lenguaje/Runtime: Java 21\n- Framework: Spring Boot 3.5.5\n- Persistencia: Spring Data JPA / Hibernate, PostgreSQL\n- Seguridad: Spring Security (Resource Server, JWT)\n- Observabilidad: Spring Boot Actuator, Micrometer, Prometheus\n- Resiliencia: Resilience4j (Circuit Breaker, TimeLimiter)\n- Tiempo real: WebSocket (STOMP)\n- Rate limiting: Bucket4j (con Caffeine Cache)\n- Utilidades: Lombok\n\n## Arquitectura y componentes\n- Controller\n  - EtlController: expone endpoints para iniciar el proceso ETL y consultar estado.\n- Services\n  - EtlProcessingService: orquesta el pipeline ETL (validaci√≥n, parseo, ventana de fechas, sincronizaci√≥n, m√©tricas, notificaciones).\n  - EtlJobService: gesti√≥n de entidad de jobs ETL (crear, actualizar estado, ventanas, locking de rango).\n  - DataSyncService: operaci√≥n transaccional de borrado + inserci√≥n para sincronizar datos (delete+insert en rango) con manejo de excepciones.\n  - NotificationService: env√≠o de notificaciones a usuarios y sistema (integraci√≥n WebSocket).\n- Interceptors\n  - RateLimitInterceptor: control de tasa por usuario/IP en rutas /api/etl/**, devuelve headers est√°ndar de rate limit.\n- Configuraci√≥n\n  - SecurityConfig: CORS, autenticaci√≥n JWT como Resource Server, reglas de autorizaci√≥n.\n  - WebConfig: registro de interceptores.\n  - WebSocketConfig y WebSocketSecurityConfig: broker STOMP y autenticaci√≥n v√≠a "
    },
    {
      "path": ".gemini/sprints/SPRINT_1_DEMO.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/sprint_2/REPORTE_AUDITORIA_PLAN_TRABAJO_V3.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/sprint_2/evidencias.md",
      "excerpt": "# Evidencias Fase 2\n\nEste documento detalla la estructura jer√°rquica de los archivos y carpetas de evidencia para la Fase 2 del proyecto.\n\n## /evidencias_a_entregar\n\nA continuaci√≥n se presentan los artefactos y entregables principales.\n\n- **01.-historias_de_usuario**\n- **02.-product_backlog.md**\n- **2.4_GuiaEstudiante_Fase 2_DesarrolloProyecto APT.docx**\n- **03.-cronograma.png**\n\n### /sprint_1\n\nEntregables correspondientes al Sprint 1.\n\n- **01.-Sprint-1-Backlog.md**\n- **02.-kanban** `https://github.com/users/qb4745/projects/6`\n- **02.-tablero_kanban.png**\n- **03.-daily_scrum_summary_sprint_1.md**\n- **04.-impediment_log_sprint_1.md**\n- **05.-burndown_chart.ipynb**\n- **05.-burndown_chart.png**\n- **05.-sprint1_burndown_REAL.png**\n- **06.-sprint_1_retrospective.md**\n- **07.-sprint_1_demo.md**\n\n### /sprint_2\n\nEntregables correspondientes al Sprint 2.\n\n- **01.-sprint_2_backlog.md**\n- **02.-kanban** `https://github.com/users/qb4745/projects/7/views/1`\n- **02.-tablero_kanban.png**\n- **03.-daily_scrum_summary_sprint_2.md**\n- **04.-impediment_log_sprint_2.md**\n- **05.-sprint_2_burndown_chart.ipynb**\n- **05.-sprint2_grafico_burndown.png**\n\n### /extras\n\nArchivos adicionales y de soporte del proyecto.\n\n- **1.-costos_del_proyecto**\n- **2.-tests.zip**\n- **3.-ERD-2025-10-14-022739.png**\n- **3.-schema-actual.sql**\n- **3.-supabase-schema-bdyvzjpkycnekjrlqlfp.png**\n- **04.-risk_register.md**\n"
    },
    {
      "path": ".gemini/sprints/sprint_2/desarrollo_proyecto (another copy).md",
      "excerpt": "# DESARROLLO DEL PROYECTO APT - FASE 2\n## Plataforma de Inteligencia Operacional Cambiaso (IOC)\n\n**Proyecto:** Sistema de Business Intelligence con Metabase + Gesti√≥n de Datos  \n**Instituci√≥n:** AIEP  \n**Programa:** Analista Programador de Aplicaciones de Gesti√≥n (APT)  \n**Fase:** Fase 2 - Desarrollo del Proyecto  \n**Per√≠odo:** Septiembre - Octubre 2025  \n**Equipo:**\n- **Product Owner y Desarrollador:** Boris Arriagada\n- **Scrum Master y Desarrollador:** Jaime Vicencio\n\n---\n\n## 1. RESUMEN AVANCE PROYECTO APT\n\n### 1.1 Resumen de Avance del Proyecto\n\nEl proyecto **Inteligencia Operacional Cambiaso (IOC)** ha completado exitosamente el **Sprint 1** (8 septiembre - 4 octubre 2025) alcanzando un **100% de cumplimiento** de los objetivos comprometidos. El sprint tuvo una duraci√≥n de 4 semanas calend√°ricas con 19 d√≠as h√°biles de trabajo (excluyendo los festivos 18 y 19 de septiembre). Se implement√≥ el ciclo de valor completo de extremo a extremo, permitiendo que un usuario pueda autenticarse en la plataforma, cargar datos de producci√≥n mediante archivos CSV y visualizar inmediatamente dashboards interactivos con KPIs actualizados.\n\n#### Actividades Realizadas y Objetivos Cumplidos\n\n**1. Implementaci√≥n del Sistema de Autenticaci√≥n y Autorizaci√≥n (IOC-021, IOC-022, IOC-023)**\n\nSe desarroll√≥ e implement√≥ un sistema robusto de autenticaci√≥n utilizando **Supabase Auth** integrado con **Spring Security 6** y tokens JWT. Las actividades incluyeron:\n\n- **Frontend (React + TypeScript):** Creaci√≥n de componentes de autenticaci√≥n (SignIn, SignUp) con validaci√≥n de formularios usando React Hook Form y Zod. Integraci√≥n completa con Supabase Auth incluyendo manejo de estados de sesi√≥n, persistencia de tokens y redirecci√≥n condicional por roles.\n\n- **Backend (Spring Boot 3.5.5):** Configuraci√≥n de Spring Security con filtros personalizados (`JwtRequestFilter`) para validar tokens en cada petici√≥n. Implementaci√≥n de `AuthController` y `AuthService` para gestionar el login y generaci√≥n de "
    },
    {
      "path": ".gemini/sprints/sprint_2/Sprint-2-Backlog.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/sprint_2/PATCH_PLAN_TRABAJO_V3.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/sprint_2/DAILY_SCRUM_SUMMARY_SPRINT_2.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/sprint_2/plan_trabajo.md",
      "excerpt": "**\n\n|                                                                                             |\n| ------------------------------------------------------------------------------------------- |\n| 7. Plan de Trabajo                                                                          |\n| En la siguiente tabla define la planificaci√≥n de tu Proyecto APT de acuerdo a lo requerido. |\n\n|                                                        |                                                   |                                                                                                                                                         |                                                           |                              |                                         |                                                                                             |                                  |                                                                                                      |\n| ------------------------------------------------------ | ------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------- | ---------------------------- | --------------------------------------- | ------------------------------------------------------------------------------------------- | -------------------------------- | ---------------------------------------------------------------------------------------------------- |\n| Plan de Trabajo Proyecto APT                           |                                                   |                                                                                                                                                         |                                                           |                           "
    },
    {
      "path": ".gemini/sprints/sprint_2/2.5_APT122_Sumativa_Avance_Fase2.md",
      "excerpt": "# Evaluaci√≥n Fase 2\n\n## Nombre: Informe avance Proyecto APT\n\n| Sigla   | Nombre Asignatura | Tiempo Asignado | % Ponderaci√≥n |\n|:------- |:----------------- |:--------------- |:------------- |\n| PTY4614 | Capstone          | semana 9        | 20%           |\n\n## 01. Agente evaluativo\n\n- [x] Heteroevaluaci√≥n\n- [ ] Coevaluaci√≥n\n- [ ] Autoevaluaci√≥n\n\n## 02. Tabla de Especificaciones\n\n| Resultado de Aprendizaje                                                                        | Indicador de Logro (IL)                                                                                                                                       | Indicador de Evaluaci√≥n (IE)*                                                                                                                                                                                                            | Ponderaci√≥n Indicador Logro | Ponderaci√≥n Indicador de Evaluaci√≥n |\n|:----------------------------------------------------------------------------------------------- |:------------------------------------------------------------------------------------------------------------------------------------------------------------- |:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:--------------------------- |:----------------------------------- |\n| RA2 Desarrolla el Proyecto APT, seg√∫n los est√°ndares de calidad establecidos por la disciplina. | IL 2.1 Desarrolla las actividades planificadas del proyecto APT, incluyendo las evidencias que cumplen con los est√°ndares definidos por la disciplina.        | 1. Propone ajustes al Proyecto APT considerando dificultades, facilitadores y retroalimentaci√≥n.                                                                                                                                      "
    },
    {
      "path": ".gemini/sprints/sprint_2/desarrollo_proyecto.md",
      "excerpt": "# DESARROLLO DEL PROYECTO APT - FASE 2\n\n## Plataforma de Inteligencia Operacional Cambiaso (IOC)\n\n**Proyecto:** Sistema de Business Intelligence con Metabase + Gesti√≥n de Datos  \n**Instituci√≥n:** AIEP  \n**Programa:** Analista Programador de Aplicaciones de Gesti√≥n (APT)  \n**Fase:** Fase 2 - Desarrollo del Proyecto  \n**Per√≠odo:** Septiembre - Octubre 2025  \n**Equipo:**\n\n- **Product Owner y Desarrollador:** Boris Arriagada\n- **Scrum Master y Desarrollador:** Jaime Vicencio\n\n---\n\n## 1. RESUMEN AVANCE PROYECTO APT\n\n### 1.1 Resumen de Avance del Proyecto\n\nEl proyecto **Inteligencia Operacional Cambiaso (IOC)** ha completado exitosamente el **Sprint 1** (8 septiembre - 4 octubre 2025) alcanzando un **100% de cumplimiento** de los objetivos comprometidos. El sprint tuvo una duraci√≥n de 4 semanas calend√°ricas con 19 d√≠as h√°biles de trabajo (excluyendo los festivos 18 y 19 de septiembre). Se implement√≥ el ciclo de valor completo de extremo a extremo, permitiendo que un usuario pueda autenticarse en la plataforma, cargar datos de producci√≥n mediante archivos CSV y visualizar inmediatamente dashboards interactivos con KPIs actualizados.\n\n#### Actividades Realizadas y Objetivos Cumplidos\n\n**1. Implementaci√≥n del Sistema de Autenticaci√≥n y Autorizaci√≥n (IOC-021, IOC-022, IOC-023)**\n\nSe desarroll√≥ e implement√≥ un sistema robusto de autenticaci√≥n utilizando **Supabase Auth** integrado con **Spring Security 6** y tokens JWT. Las actividades incluyeron:\n\n- **Frontend (React + TypeScript):** Creaci√≥n de componentes de autenticaci√≥n (SignIn, SignUp) con validaci√≥n de formularios usando React Hook Form y Zod. Integraci√≥n completa con Supabase Auth incluyendo manejo de estados de sesi√≥n, persistencia de tokens y redirecci√≥n condicional por roles.\n\n- **Backend (Spring Boot 3.5.5):** Configuraci√≥n de Spring Security con filtros personalizados (`JwtRequestFilter`) para validar tokens en cada petici√≥n. Implementaci√≥n de `AuthController` y `AuthService` para gestionar el login y generaci√≥n d"
    },
    {
      "path": ".gemini/sprints/sprint_2/plan_trabajo_v3.md",
      "excerpt": "# PLAN DE TRABAJO v2 - PROYECTO APT IOC\n\n## Plataforma de Inteligencia Operacional Cambiaso\n\n---\n\n## Plan de Trabajo con Enfoque Scrum\n\n| **Competencia o unidades de competencias**                                   | **Nombre de Actividades/Tareas**                              | **Descripci√≥n Actividades/Tareas**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | **Recursos**                                                                    | **Duraci√≥n de la actividad**                                                | **Responsable**                                 | **Observaciones**                                                                                                                                    | **Estado de Avance**                               | **Ajustes**                                                                                                                                                                                                                                                                                                                                                          |\n|:---------------------------------------------------------------------------- |:------------------------------------------------------------- |:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------"
    },
    {
      "path": ".gemini/sprints/sprint_2/IMPEDIMENT_LOG_SPRINT_2.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/sprint_2/COHERENCE_AUDIT_REPORT_SPRINT_2.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/sprint_2/Sprint-2-Week-1-Tasks.md",
      "excerpt": ""
    },
    {
      "path": ".gemini/sprints/technical-designs/TD-001-validacion-carga-archivos-etl.md",
      "excerpt": "# Technical Design: Validaci√≥n de Carga de Archivos ETL (Capa de Protecci√≥n Frontend)\n\n## Metadata\n- **ID**: TD-001\n- **Feature Plan**: .gemini/sprints/feature-plans/FP-001-validacion-carga-archivos-etl.md\n- **Sprint**: Sprint 2\n- **Autor**: Equipo IOC / Tech Lead (propuesta)\n- **Reviewers**: Frontend Lead, Backend Lead, QA\n- **Estado**:\n  - [x] Draft\n  - [ ] En Revisi√≥n\n  - [ ] Aprobado\n  - [ ] Implementado\n- **Fecha Creaci√≥n**: 2025-10-19\n- **√öltima Actualizaci√≥n**: 2025-10-19\n- **Versi√≥n**: 1.0\n\n---\n\n## 1. Resumen Ejecutivo\n\n### 1.1. Prop√≥sito de Este Documento\n\nDescribir la soluci√≥n t√©cnica y el plan de implementaci√≥n para la feature \"Validaci√≥n de Carga de Archivos ETL\" (cliente). El objetivo es evitar uploads innecesarios y ofrecer feedback inmediato al usuario validando archivos TXT antes de enviarlos al backend.\n\nBasado en el Feature Plan: `.gemini/sprints/feature-plans/FP-001-validacion-carga-archivos-etl.md`\n\n### 1.2. Alcance T√©cnico\n\nCubre:\n- Arquitectura y componentes frontend involucrados\n- Modelo de datos TypeScript y contratos internos\n- Librer√≠as y dependencias nuevas propuestas\n- Estrategia de validaci√≥n y UX\n- Plan de testing y criterios de aceptaci√≥n\n\nNo cubre:\n- Cambios en backend (la validaci√≥n final sigue all√≠)\n- Validaciones complejas de negocio (se quedan en backend)\n\n### 1.3. Decisiones Arquitect√≥nicas Clave\n\n| Decisi√≥n | Opci√≥n Elegida | Alternativas Consideradas | Justificaci√≥n |\n|---|---:|---|---|\n| Parsing client-side | `FileReader` + parsing ligero (papaparse si aplica) | Parsear todo el archivo en Web Worker; delegar al backend | Validaciones r√°pidas (<2s) y UX mejorada sin cargar backend. Web Worker queda como optimizaci√≥n si archivos grandes. |\n| Librer√≠a para parsing | `papaparse` (solo si se detecta delimitador complejo) | Implementaci√≥n manual, `csv-parse` | `papaparse` es ligera, madura y funciona bien en navegador; alternativa native si solo pipes. |\n| Modo de validaci√≥n | Strict-only (sin override) | Modo permissive (toggle) | "
    },
    {
      "path": ".gemini/sprints/technical-designs/TD-001-validacion-carga-archivos-etl-v2.md",
      "excerpt": "# Technical Design v2: Validaci√≥n de Carga de Archivos ETL (Capa de Protecci√≥n Frontend)\n\n## Metadata\n- **ID**: TD-001 (v2)\n- **Feature Plan**: .gemini/sprints/feature-plans/FP-001-validacion-carga-archivos-etl.md\n- **Sprint**: Sprint 2\n- **Autor**: Equipo IOC / Tech Lead\n- **Reviewers**: Frontend Lead, Backend Lead, QA\n- **Estado**:\n  - [x] Draft\n  - [ ] En Revisi√≥n\n  - [ ] Aprobado\n  - [ ] Implementado\n- **Fecha Creaci√≥n**: 2025-10-19\n- **√öltima Actualizaci√≥n**: 2025-10-19\n- **Versi√≥n**: 2.0\n\n---\n\n## 0. Cambios clave vs v1\n- M√°quina de estados expl√≠cita del validador y contratos formales (c√≥digos de error, severidad, config runtime).\n- Algoritmos detallados para detecci√≥n de encoding (BOM + TextDecoder fatal), parsing de encabezados y sampling con excepci√≥n de l√≠nea 4 (totales SAP).\n- Pseudoc√≥digo y skeletons de implementaci√≥n (servicio, hook y UI).\n- Feature flag, telemetr√≠a y plan de rollout seguro.\n- Matriz de pruebas, fixtures y consideraciones de i18n, accesibilidad, performance y seguridad.\n\n---\n\n## 1. Resumen Ejecutivo\n\n### 1.1. Prop√≥sito\nImplementar validaci√≥n client-side de archivos ETL antes de subir al backend, bloqueando cargas con errores de formato para reducir la carga del servidor y mejorar la experiencia de usuario.\n\n### 1.2. Alcance T√©cnico\nQu√© cubre:\n- Validaci√≥n frontend (hook + servicio + UI).\n- Preview obligatorio de 14 l√≠neas.\n- Detecci√≥n de encoding (UTF-8 / Windows-1252).\n- Validaci√≥n de encabezados y datos (primeras N l√≠neas, excepci√≥n l√≠nea 4 SAP).\n\nQu√© NO cubre:\n- Validaci√≥n exhaustiva del archivo completo (se realiza en backend).\n- Cambios en los endpoints backend existentes (salvo metadata adicional en request).\n- Procesamiento ETL.\n\n### 1.3. Decisiones Arquitect√≥nicas Clave\n\n| Decisi√≥n | Opci√≥n Elegida | Alternativas | Justificaci√≥n |\n|---|---:|---|---|\n| D√≥nde validar | Frontend (client-side) | Backend-only | Reducir el n√∫mero de uploads inv√°lidos y mejorar UX |\n| Detecci√≥n encoding | BOM + TextDecoder({fatal:true}) | Librer√≠a exter"
    },
    {
      "path": ".gemini/sprints/technical-designs/TD-IOC-004-User-Role-Management-claude.md",
      "excerpt": "# Technical Design: Gesti√≥n de Usuarios, Roles y Permisos (IOC-004)\n\n## Metadata\n- ID: TD-IOC-004\n- Feature Plan: .gemini/sprints/feature-plans/FP-IOC-004-User-Role-Management.md\n- Sprint: Sprint 3\n- Autor: Tech Lead (IA)\n- Reviewers: Backend Lead, Frontend Lead, DevOps\n- Estado:\n  - [x] Draft\n  - [ ] En Revisi√≥n\n  - [ ] Aprobado\n  - [ ] Implementado\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n- Versi√≥n: 1.0\n\n---\n\n## 1. Resumen Ejecutivo\n\n### 1.1. Prop√≥sito de Este Documento\nEste documento define el c√≥mo t√©cnico para implementar la feature ‚ÄúGesti√≥n de Usuarios, Roles y Permisos‚Äù, basada en el Feature Plan FP-IOC-004. Cubre arquitectura, modelo de datos, contratos API, seguridad, testing y plan de implementaci√≥n.\n\n### 1.2. Alcance T√©cnico\n- Arquitectura de componentes backend y consideraciones frontend\n- Modelo de datos en Postgres (Supabase) con migraciones idempotentes\n- Contratos de API REST completos\n- Estrategia de seguridad (JWT + RBAC + RLS Supabase)\n- Plan de pruebas (unidad, integraci√≥n, seguridad)\n- Plan de despliegue y rollback\n\nFuera de alcance: auto-provisioning de usuarios desde eventos Supabase (Sprint 4), auditor√≠a avanzada y asignaci√≥n directa de permisos a usuario.\n\n### 1.3. Decisiones Arquitect√≥nicas Clave\n- Identidad: usar supabase_user_id (UUID) como referencia externa y app_users.id (BIGSERIAL) como PK interna\n- Email case-insensitive: CITEXT con unique\n- RBAC local: roles y permisos gestionados en DB local; Spring Security mapea roles a authorities ROLE_*\n- RLS en Supabase: habilitada en tablas cr√≠ticas y reforzada con funciones has_role/has_permission\n- CRUD admin-only: endpoints bajo ROLE_ADMIN, con excepciones de lectura seg√∫n reglas\n\nAlternativas consideradas: usar solo claims del JWT para permisos (rechazada por falta de dinamismo), usar UUID como PK para app_users (posible, se prioriza BIGSERIAL por simplicidad e historiales existentes).\n\n---\n\n## 2. Arquitectura de la Soluci√≥n\n\n### 2.1. Diagrama de Alto Nivel (texto)\n-"
    },
    {
      "path": ".gemini/sprints/sprint_1/Sprint-1-Backlog.md",
      "excerpt": "# Sprint 1 ‚Äì Sprint Backlog (El Ciclo de Valor Completo)\n\n## Per√≠odo del Sprint\n- **Fechas:** 8 Septiembre 2025 ‚Äì 3 Octubre 2025\n- **Duraci√≥n:** 4 semanas (excluyendo festivos 18-19 Septiembre)\n- **D√≠as h√°biles:** 18 d√≠as\n\n## Objetivo del Sprint\nEntregar un ciclo de valor de extremo a extremo: un usuario podr√° autenticarse, cargar datos de producci√≥n a trav√©s de un archivo CSV y visualizar inmediatamente un dashboard con KPIs y gr√°ficos que reflejen esa nueva informaci√≥n.\n\n## Historias Comprometidas\n| ID | T√≠tulo | Tipo | Feature | Prioridad | SP | Asignado | Estado |\n| :--- | :--- | :--- | :--- | :--- | :-: | :--- | :--- |\n| IOC-021 | Como usuario, quiero iniciar sesi√≥n en la plataforma para acceder a las funcionalidades que corresponden a mi rol. | Historia de Usuario | Autenticaci√≥n | Cr√≠tica | 5 | Jaime | ‚úÖ Terminada |\n| IOC-022 | Como usuario, quiero cerrar sesi√≥n de forma segura para proteger mi cuenta cuando termino de usar la plataforma. | Historia de Usuario | Autenticaci√≥n | Cr√≠tica | 2 | Jaime | ‚úÖ Terminada |\n| IOC-023 | Como usuario, quiero navegar entre las secciones principales de la aplicaci√≥n para acceder f√°cilmente a las diferentes funcionalidades. | Historia de Usuario | Infraestructura Frontend | Cr√≠tica | 8 | Jaime | ‚úÖ Terminada |\n| IOC-001 | Como administrador, quiero cargar y validar archivos de producci√≥n para asegurar que solo datos fiables y de alta calidad se carguen en la base de datos. | Historia de Usuario | Ingesta de Datos | Cr√≠tica | 13 | Boris | ‚úÖ Terminada |\n| IOC-006 | Como gerente, quiero visualizar un dashboard con KPIs actualizados para tomar decisiones informadas sobre la operaci√≥n de manera r√°pida y eficiente. | Historia de Usuario | Visualizaci√≥n de Datos | Cr√≠tica | 13 | Boris | ‚úÖ Terminada |\n\n### Criterios de Aceptaci√≥n\n\n**IOC-021: Como usuario, quiero iniciar sesi√≥n en la plataforma para acceder a las funcionalidades que corresponden a mi rol.**\n- ‚úÖ Login exitoso: Al ingresar credenciales correctas, el sistema inicia sesi√≥"
    },
    {
      "path": ".gemini/sprints/sprint_1/SPRINT_1_SEGUIMIENTO.md",
      "excerpt": "# Seguimiento del Sprint 1: Flujo de Datos y Seguridad\n\nEste documento proporciona una vista en tiempo real del progreso del Sprint 1, mostrando el estado de las historias de usuario y el avance en t√©rminos de Story Points (SP).\n\n*   **Fecha de Inicio (Estimada):** Lunes, 15 de Septiembre de 2025\n*   **Duraci√≥n:** 2 semanas (10 d√≠as h√°biles)\n*   **Total de Story Points Comprometidos:** 21 SP\n\n---\n\n## Resumen de Progreso\n\n*   **Story Points Completados:** 8 SP\n*   **Story Points Restantes:** 13 SP\n*   **Progreso del Sprint:** 38% completado\n\n---\n\n## 1. Tablero de Estado de Historias\n\nEsta tabla muestra el estado actual de cada historia comprometida en el sprint.\n\n| ID      | T√≠tulo                                       | SP | Estado        | Notas / Pr√≥ximos Pasos                                                                                             |\n| :------ | :------------------------------------------- | :- | :------------ | :----------------------------------------------------------------------------------------------------------------- |\n| `IOC-021` | Como Usuario, quiero iniciar sesi√≥n          | 5  | ‚úÖ **Terminada**  | Flujo completo de registro, login y reseteo de contrase√±a implementado.                                            |\n| `IOC-022` | Como Usuario, quiero cerrar mi sesi√≥n        | 3  | ‚úÖ **Terminada**  | Funcionalidad de logout implementada y verificada como parte de la historia `IOC-021`.                             |\n| `IOC-023` | Construir el Layout y Rutas Protegidas       | 8  | üü° **En Progreso** | Base de rutas protegidas implementada. **Pr√≥ximo paso:** Restaurar todas las rutas del dashboard dentro del layout. |\n| `IOC-001` | Cargar y validar un archivo CSV              | 5  | ‚ùå **Por Hacer**  | Pendiente de iniciar.                                                                                              |\n\n---\n\n## 2. Tabla de Burndown\n\nEsta tabla simula el gr√°fico de burndown, registrando el trabajo completado (SP \"quemados\") al"
    },
    {
      "path": ".gemini/sprints/sprint_1/IMPEDIMENT_LOG_SPRINT_1.md",
      "excerpt": "# Registro de Impedimentos del Sprint 1 (v1.3)\n\nEste documento es un artefacto vivo utilizado para rastrear, gestionar y aprender de todos los obst√°culos que afectan el progreso del Sprint 1.\n\n---\n\n## Proceso de Gesti√≥n de Impedimentos\n1.  **Identificaci√≥n:** Cualquier miembro del equipo a√±ade un nuevo impedimento a la lista.\n2.  **An√°lisis:** En la Daily Scrum, se define el plan de acci√≥n, el responsable, la causa ra√≠z y la acci√≥n preventiva.\n3.  **Seguimiento:** El estado se actualiza diariamente hasta su resoluci√≥n.\n\n---\n\n## Registro de Impedimentos\n\n| ID | Impedimento | Responsable | Plan de Acci√≥n | Causa Ra√≠z | Acci√≥n Preventiva | Estado |\n| :--- | :--- | :--- | :--- | :--- | :--- | :--- |\n| **IMP-001** | **Flujo de usuario incompleto (Error 404):** La p√°gina `/update-password` no exist√≠a. | **Jaime** | Implementar la vista y ruta faltantes seg√∫n el blueprint. | **Planificaci√≥n Incompleta:** El blueprint inicial no contempl√≥ la p√°gina de destino del enlace de reseteo. | **Mejora de Blueprints:** Actualizar todos los futuros blueprints para incluir expl√≠citamente todas las vistas y rutas implicadas en un flujo. | ‚úÖ **Resuelto** |\n| **IMP-002** | **Deuda t√©cnica por tipado laxo:** El uso de `any` y la falta de tipos espec√≠ficos generaron advertencias de calidad. | **Jaime** | Refactorizar los componentes afectados para usar tipos estrictos e interfaces. | **Desarrollo Acelerado:** Se prioriz√≥ la funcionalidad sobre la calidad de tipos en la implementaci√≥n inicial. | **Definici√≥n de Hecho (DoD):** A√±adir un criterio al DoD que exija \"cero advertencias de `any` expl√≠cito\" en el c√≥digo nuevo. | ‚úÖ **Resuelto** |\n| **IMP-03** | **UX Inconsistente en notificaciones:** El uso de `alert()` nativo romp√≠a con el sistema de dise√±o. | **Jaime** | Instalar `react-hot-toast` y refactorizar los formularios para usar notificaciones emergentes. | **Falta de un Sistema de Notificaciones:** El proyecto no contaba con una soluci√≥n estandarizada para notificaciones. | **Decisi√≥n de "
    },
    {
      "path": ".gemini/sprints/sprint_1/COHERENCE_AUDIT_REPORT_SPRINT_1.md",
      "excerpt": "# üìã REPORTE DE VALIDACI√ìN DE COHERENCIA Y TRAZABILIDAD\n## Sprint 1 - Resumen de Daily Scrums\n\n**Auditor:** Sistema de Validaci√≥n Automatizado  \n**Fecha de Auditor√≠a:** 14 de Octubre, 2025  \n**Sprint Auditado:** Sprint 1 (8 Sept - 3 Oct 2025)  \n**Documentos Validados:** 5 artefactos Scrum\n\n---\n\n## SECCI√ìN 1: RESUMEN EJECUTIVO\n\n### Calificaci√≥n de Coherencia Global\n\n| Dimensi√≥n | Nota | Estado |\n|-----------|------|--------|\n| **Trazabilidad Historias** | 10/10 | üü¢ |\n| **Trazabilidad Impedimentos** | 10/10 | üü¢ |\n| **Trazabilidad Riesgos** | 9/10 | üü¢ |\n| **Consistencia de M√©tricas** | 7/10 | üü° |\n| **Completitud Documental** | 9/10 | üü¢ |\n| **COHERENCIA TOTAL** | **9.0/10** | **üü¢ EXCELENTE** |\n\n### Veredicto\n\nEl Resumen de Daily Scrums del Sprint 1 demuestra una **coherencia excepcional** con los dem√°s artefactos del proyecto. La trazabilidad de historias e impedimentos es perfecta (100%), con evidencia clara de seguimiento diario. La estructura del documento es profesional y sigue el formato minimalista propuesto. Sin embargo, se detectaron **3 inconsistencias menores** en fechas/cronolog√≠a y algunas discrepancias en el progreso reportado de Story Points que requieren correcci√≥n.\n\n### Top 3 Hallazgos Cr√≠ticos\n\n1. **üü° INCONSISTENCIA TEMPORAL CR√çTICA:** El documento indica festivos 18-19 Sept como \"Mi√©rcoles y Jueves\", pero seg√∫n el calendario real (18-Sept es Jueves, 19-Sept es Viernes). Esto causa desalineaci√≥n en todos los d√≠as de la semana posteriores al 17 de septiembre.\n\n2. **üü° DISCREPANCIA EN PROGRESO DE SPs (D√≠a 6):** El Daily del 15-Sept reporta \"15/41 pts\" pero las historias completadas (IOC-021: 5SP + IOC-022: 2SP) suman solo **7 SPs**, no 15. IOC-023 (8SP) se completa en el D√≠a 8, no antes.\n\n3. **üü¢ EVENTO FINAL MOVIDO:** El documento indica Sprint Review y Retrospective el 2-Oct (D√≠a 18), pero las notas finales dicen \"3-Oct-2025 - 4:00 PM\". Debe aclararse si el sprint termin√≥ el 2 o el 3 de octubre.\n\n---\n\n## SECCI√ìN 2: VALIDACI√ìN DE TRAZABILIDAD\n\n### 2.1 Histo"
    },
    {
      "path": ".gemini/sprints/sprint_1/TAREAS_ADICIONALES_SPRINT_1.md",
      "excerpt": "# Tareas Adicionales del Sprint 1: Arquitectura y Calidad\n\nEste documento complementa la `BITACORA_SPRINT_1.md` y registra tareas t√©cnicas transversales que mejoran la calidad, mantenibilidad y experiencia de desarrollo del proyecto, pero que no est√°n directamente ligadas a una √∫nica historia de usuario.\n\n---\n## TASK-001: Dise√±o e Implementaci√≥n del Panel de Administraci√≥n\n\n*   **Estado:** ‚úÖ **Terminada**\n*   **Objetivo T√©cnico:** Transformar los requerimientos del backlog en especificaciones t√©cnicas (blueprints) y desarrollar la primera vista del panel de administraci√≥n.\n*   **Archivos Creados:**\n    *   `diseno_vista_admin.md`\n    *   `.gemini/blueprints/01-FTV-panel-principal.md` (y los otros 3 FTVs)\n    *   `src/pages/admin/AdminDashboardPage.tsx`\n    *   `src/components/admin/MetricCard.tsx`\n    *   `src/components/admin/QuickAccessButton.tsx`\n    *   `src/components/ui/skeletons/MetricCardSkeleton.tsx`\n*   **Resumen de la Implementaci√≥n:** Se dise√±√≥ la arquitectura completa de la vista de administrador y se document√≥ en Fichas T√©cnicas de Vista (FTVs). Posteriormente, se implement√≥ la primera de estas vistas, el \"Panel Principal\" (`AdminDashboardPage`), creando sus componentes de UI reutilizables (`MetricCard`, `QuickAccessButton`) y esqueletos de carga para una mejor UX. Se a√±adi√≥ la ruta y el enlace correspondiente en el men√∫ lateral.\n*   **Verificaci√≥n y Pruebas Realizadas:**\n    *   **Pruebas Manuales (CATs):** Se verific√≥ manualmente el cumplimiento de todos los Criterios de Aceptaci√≥n T√©cnicos definidos en `01-FTV-panel-principal.md`:\n        *   **CAT-1 (Carga):** Se confirm√≥ la aparici√≥n de `SkeletonLoaders` al cargar la vista.\n        *   **CAT-2 (√âxito):** Se confirm√≥ el renderizado correcto de los componentes con datos simulados.\n        *   **CAT-3 (Error):** Se prob√≥ (descomentando un `throw new Error`) que la vista muestra un componente `Alert` de error.\n        *   **CAT-4 (Vac√≠o):** Se prob√≥ (modificando los datos simulados) que los componente"
    },
    {
      "path": ".gemini/sprints/sprint_1/backend_sync_brief.md",
      "excerpt": "# Backend Sync Brief (2025-09-19)\n\n## 1. Metadatos del Documento\n*   **Generado el:** 2025-09-19 12:00:00 UTC\n*   **Fuentes Analizadas:**\n    *   `01-FTV-panel-principal.md`\n    *   `02-FTV-ingesta-de-datos.md`\n    *   `03-FTV-contenido-analitico.md`\n    *   `04-FTV-acceso-y-seguridad.md`\n\n## 2. Resumen Ejecutivo\nEste documento especifica los requisitos de la API consolidados desde la perspectiva del Frontend. Sirve como un contrato unificado para la implementaci√≥n de los endpoints necesarios para las funcionalidades de administraci√≥n.\n\n## 3. Pol√≠tica de Seguridad Global\n*   **Mecanismo:** El Frontend enviar√° un **JWT** en la cabecera `Authorization: Bearer <token>` en todas las peticiones a los endpoints listados a continuaci√≥n. El Backend debe proteger todos estos endpoints, asegurando que solo usuarios con el rol de \"Administrador\" puedan acceder.\n\n---\n\n## 4. API Endpoints Requeridos\n\n### Endpoint: `GET /api/admin/dashboard/summary`\n*   **Prop√≥sito:** Obtener un resumen de m√©tricas y datos de gr√°ficos para poblar el Panel Principal de Administraci√≥n.\n*   **FTVs de Origen:** `01-FTV-panel-principal.md`\n*   **Contrato de Petici√≥n (Request Body/Params):**\n    ```typescript\n    // N/A\n    ```\n*   **Contrato de Respuesta (Response Body - Consolidado):**\n    ```typescript\n    interface DashboardSummary {\n      metrics: {\n        activeUsers: number;\n        lastUploadStatus: '√âxito' | 'Fallo' | 'N/A';\n        kpiAlerts: number;\n      };\n      charts: {\n        userActivity: { date: string; count: number; }[];\n        uploadHistory: { month: string; count: number; }[];\n      };\n    }\n    ```\n\n### Endpoint: `POST /api/admin/data/upload`\n*   **Prop√≥sito:** Subir un archivo CSV de producci√≥n para su validaci√≥n e ingesta.\n*   **FTVs de Origen:** `02-FTV-ingesta-de-datos.md`\n*   **Contrato de Petici√≥n (Request Body/Params):**\n    ```typescript\n    // FormData con una clave \"file\" que contiene el archivo CSV.\n    ```\n*   **Contrato de Respuesta (Response Body - Consolidado):*"
    },
    {
      "path": ".gemini/sprints/sprint_1/BITACORA_SPRINT_1.md",
      "excerpt": "# Bit√°cora T√©cnica del Sprint 1\n\nEste documento registra el desglose t√©cnico de las implementaciones realizadas durante el Sprint 1. Sirve como una memoria t√©cnica para futuras consultas, mantenimiento y onboarding de nuevos miembros al equipo.\n\n---\n<!-- COMIENZO DE LA PLANTILLA DE HISTORIA - NO MODIFICAR -->\n## [ID de la Historia]: [T√≠tulo de la Historia]\n\n*   **Objetivo de Negocio (El \"Para Qu√©\"):** [Descripci√≥n concisa del valor que aporta la historia al usuario/negocio.]\n*   **Criterios de Aceptaci√≥n Clave:**\n    *   [Criterio 1]\n    *   [Criterio 2]\n    *   ...\n\n### Desglose T√©cnico de la Implementaci√≥n\n\n*   **Plan Aprobado:** [Resumen del plan de alto nivel que Gemini propuso antes de la implementaci√≥n.]\n\n*   **Archivos Creados/Modificados:**\n    *   `ruta/al/archivo1.java` (Backend)\n    *   `ruta/al/componente1.tsx` (Frontend)\n    *   ...\n\n*   **Resumen de la Implementaci√≥n:**\n    [Explicaci√≥n t√©cnica detallada pero concisa. Por ejemplo: \"Se cre√≥ el `AuthController` en el backend con un endpoint POST `/api/auth/login` que utiliza el `AuthService` para validar credenciales contra Supabase. En caso de √©xito, genera un JWT. En el frontend, el componente `LoginPage` ahora gestiona el estado del formulario y, al enviarlo, llama al endpoint, almacenando el JWT en `localStorage` y redirigiendo al usuario al dashboard principal.\"]\n\n### Verificaci√≥n y Pruebas Realizadas\n\n*   **Pruebas Automatizadas:**\n    *   **(Backend) Pruebas Unitarias:** [Describe brevemente qu√© se prob√≥. Ej: \"Se cre√≥ `AuthControllerTest` para verificar el endpoint `/api/auth/login` con credenciales v√°lidas (esperando status 200 OK) y credenciales inv√°lidas (esperando status 401 Unauthorized).\"]\n    *   **(Frontend) Pruebas de Componentes:** [Si aplica. Ej: \"Se prob√≥ que el componente `LoginForm` maneja correctamente los estados de carga y error.\"]\n\n*   **Pruebas Manuales (End-to-End):**\n    *   **Caso de Prueba 1 (Happy Path):** [Describe el flujo. Ej: \"1. Navegar a `/login`. 2. Ingresar un email"
    },
    {
      "path": ".gemini/sprints/sprint_1/IMPEDIMENT_LOG_SPRINT_1_v3.md",
      "excerpt": "# Registro de Impedimentos del Sprint 1 (v3.0)\n\n**Proyecto:** IOC (Indicadores Operacionales Cambiaso)  \n**Sprint:** Sprint 1 - El Ciclo de Valor Completo  \n**Per√≠odo:** 8 Septiembre - 3 Octubre 2025 (19 d√≠as laborables, excluyendo festivos 18-19 Sept)  \n**Equipo:**\n- Boris Rojas (Product Owner + Developer)\n- Jaime Arancibia (Scrum Master + Developer)\n\n---\n\n## üìä Estado Actual\n\n| M√©trica | Valor |\n|---------|-------|\n| **Total de Impedimentos** | 16 |\n| **Resueltos** | 16 (100%) |\n| **Pendientes** | 0 |\n| **Tiempo Promedio de Resoluci√≥n** | 1.2 d√≠as |\n| **Impedimentos Cr√≠ticos** | 4 (IMP-007, IMP-009, IMP-013, IMP-016) |\n| **Impedimentos de Alto Impacto** | 6 |\n| **Impedimentos de Impacto Medio** | 6 |\n\n---\n\n## Proceso de Gesti√≥n de Impedimentos\n\n1. **Identificaci√≥n:** Cualquier miembro del equipo reporta el impedimento en la Daily Scrum.\n2. **Clasificaci√≥n:** Se asigna ID, impacto (üî¥ Cr√≠tico / üü° Alto / üü¢ Medio) y responsable.\n3. **An√°lisis:** Se define plan de acci√≥n, causa ra√≠z y acci√≥n preventiva.\n4. **Seguimiento:** El estado se actualiza diariamente hasta su resoluci√≥n.\n5. **Cierre:** Se documenta la soluci√≥n y se calcula el tiempo de resoluci√≥n.\n\n---\n\n## üìã Registro de Impedimentos Resueltos\n\n| ID | Impacto | Impedimento | Responsable | Detectado | Resuelto | D√≠as | Soluci√≥n Aplicada | Causa Ra√≠z | Acci√≥n Preventiva |\n| :--- | :---: | :--- | :--- | :---: | :---: | :-: | :--- | :--- | :--- |\n| **IMP-001** | üü° Alto | **Flujo de usuario incompleto (Error 404):** La p√°gina `/update-password` no exist√≠a, causando error 404 al resetear contrase√±a. | Jaime | 11-Sep | 12-Sep | 1 | Implementar la vista UpdatePasswordPage.tsx y agregar la ruta en App.tsx seg√∫n el blueprint de autenticaci√≥n. | **Planificaci√≥n Incompleta:** El blueprint inicial no contempl√≥ la p√°gina de destino del enlace de reseteo. | **Mejora de Blueprints:** Actualizar todos los futuros blueprints para incluir expl√≠citamente todas las vistas y rutas implicadas en un flujo end-to-end. |\n| **IMP-002** | üü¢ "
    },
    {
      "path": ".gemini/sprints/sprint_1/SPRINT_1_RETROSPECTIVE.md",
      "excerpt": "# üîÑ Sprint Retrospective - Sprint 1\n\n**Proyecto:** IOC (Indicadores Operacionales Cambiaso)  \n**Sprint:** Sprint 1 - El Ciclo de Valor Completo  \n**Per√≠odo:** 8 Septiembre - 5 Octubre 2025 (4 semanas + 2 d√≠as extra)  \n**Equipo:** Boris Rojas (Developer), Jaime Arancibia (Developer)\n\n---\n\n## üìä DATOS DEL SPRINT\n\n### Completado\n- ‚úÖ **IOC-021:** Como usuario, quiero iniciar sesi√≥n en la plataforma (5 SP)\n- ‚úÖ **IOC-022:** Como usuario, quiero cerrar sesi√≥n de forma segura (2 SP)\n- ‚úÖ **IOC-023:** Como usuario, quiero navegar entre secciones principales (8 SP)\n- ‚úÖ **IOC-001:** Como administrador, quiero cargar y validar archivos de producci√≥n (13 SP)\n- ‚úÖ **IOC-006:** Como gerente, quiero visualizar dashboard con KPIs actualizados (13 SP)\n\n### Impedimentos Resueltos\n- **Total:** 16 impedimentos (4 cr√≠ticos, 6 altos, 6 medios)\n- **Tasa de resoluci√≥n:** 100% - Tiempo promedio: 1.2 d√≠as\n- **Impedimentos destacados:**\n  - IMP-009: Rendimiento ETL (4+ min ‚Üí <30 seg) - Mejora de 800%\n  - IMP-016: Agotamiento de conexiones BD - DataSource dual\n  - IMP-007: Tests masivamente rotos - Perfil test con H2\n  - IMP-013: Bucle de renderizado infinito - Optimizaci√≥n con useCallback\n\n### M√©tricas\n- **Planificado:** 41 pts | **Completado:** 41 pts (100%)\n- **D√≠as h√°biles planeados:** 18 d√≠as | **D√≠as realmente trabajados:** 20 d√≠as\n- **‚ö†Ô∏è Horas extras:** 2 d√≠as de fin de semana (5 Octubre)\n- **Impedimentos resueltos:** 16/16 (100%)\n- **Velocidad nominal:** 10.25 SP/semana ‚ùå (incluye overtime)\n- **Velocidad sostenible:** 9.2 SP/semana ‚úÖ (sin overtime)\n- **Tareas t√©cnicas completadas:** 40/40 (100%)\n\n---\n\n## 1. ‚úÖ ¬øQu√© sali√≥ bien?\n\n### 1.1 Resoluci√≥n excepcional de impedimentos cr√≠ticos\n**Evidencia:** 16 impedimentos resueltos en promedio de 1.2 d√≠as, incluyendo 4 cr√≠ticos (IMP-007, IMP-009, IMP-013, IMP-016) que fueron resueltos en 1-2 d√≠as cada uno. Destac√≥ IMP-009 que mejor√≥ el rendimiento del ETL en 800% (de 4+ min a <30 seg).\n\n**Impacto:** La capacidad del equipo para identificar, analizar"
    },
    {
      "path": ".gemini/sprints/sprint_1/CORRECTION_PLAN_SPRINT_1.md",
      "excerpt": "# üîß PLAN DE CORRECCI√ìN - Sprint 1 Daily Scrum Summary\n\n**Fecha de Generaci√≥n:** 14 de Octubre, 2025  \n**Documento Base:** COHERENCE_AUDIT_REPORT_SPRINT_1.md  \n**Documento a Corregir:** DAILY_SCRUM_SUMMARY_SPRINT_1.md  \n**Total de Correcciones:** 5 cr√≠ticas + 2 opcionales\n\n---\n\n## üìã RESUMEN EJECUTIVO\n\n| Tipo | Cantidad | Impacto | Estado |\n|------|----------|---------|--------|\n| üî¥ Cr√≠ticas | 5 | Alto | ‚è≥ Pendiente |\n| üü° Opcionales | 2 | Bajo | ‚è≥ Pendiente |\n| **TOTAL** | **7** | - | **En ejecuci√≥n** |\n\n---\n\n## üî¥ CORRECCIONES CR√çTICAS (Aplicar inmediatamente)\n\n### CORRECCI√ìN #1: Descripci√≥n de festivos incorrecta\n\n**Documento:** `DAILY_SCRUM_SUMMARY_SPRINT_1.md`\n\n**L√≠nea/Secci√≥n:** L√≠nea 4 (encabezado del documento)\n\n**Problema:** Los festivos est√°n etiquetados como \"Mi√©rcoles y Jueves\" cuando en realidad son \"Jueves y Viernes\"\n\n**Cambio:**\n```diff\n- **Per√≠odo:** 8 Septiembre - 4 Octubre 2025 (4 semanas, excluyendo festivos 18-19 Sept)\n+ **Per√≠odo:** 8 Septiembre - 3 Octubre 2025 (4 semanas, excluyendo festivos 18-19 Sept)\n```\n\n**Ubicaciones adicionales a corregir:**\n```diff\nL√≠nea ~35 (Secci√≥n SEMANA 2):\n- ## üìÖ SEMANA 2: 15-17, 20 Septiembre (Festivos 18-19 Sept - Mi√©rcoles y Jueves)\n+ ## üìÖ SEMANA 2: 15-17, 20 Septiembre (Festivos 18-19 Sept - Jueves y Viernes)\n```\n\n**Justificaci√≥n:** Seg√∫n el calendario real de Chile 2025:\n- 18 de Septiembre 2025 = **Jueves** (D√≠a de la Independencia)\n- 19 de Septiembre 2025 = **Viernes** (D√≠a de las Glorias del Ej√©rcito)\n\n---\n\n### CORRECCI√ìN #2: Progreso de Story Points incorrecto en D√≠a 6 (15-Sept)\n\n**Documento:** `DAILY_SCRUM_SUMMARY_SPRINT_1.md`\n\n**L√≠nea/Secci√≥n:** Daily - 15 Septiembre 2025 - Sprint 1 D√≠a 6 (Lunes)\n\n**Problema:** Reporta \"15/41 pts\" cuando solo se completaron IOC-021 (5 SP) + IOC-022 (2 SP) = 7 SP\n\n**Cambio:**\n```diff\n### Daily - 15 Septiembre 2025 - Sprint 1 D√≠a 6 (Lunes)\n\n**üéØ Sprint Goal:** \"Entregar ciclo completo: Auth ‚Üí Ingesta ‚Üí Visualizaci√≥n\"\n\n- **Progreso:** 2/5 historias | 15/41 pts\n+ **Progreso:** 2/5"
    },
    {
      "path": ".gemini/sprints/sprint_1/REFACTOR_PLAN_SPRINT_1.md",
      "excerpt": "# Plan de Tareas para la Refactorizaci√≥n de Ingesta de Datos (Sprint 1)\n\nEste documento desglosa el blueprint `refactorizacion_frontend_v3.md` en tareas accionables para ser gestionadas en un tablero Kanban (GitHub Projects).\n\n---\n\n### **√âpica: Refactorizaci√≥n de la Ingesta de Datos (IOC-001 Integraci√≥n)**\n\n---\n\n#### **Fase 1: Configuraci√≥n y Estructura (SETUP)**\n\n-   [ ] **RF-S01:** **Configurar Dependencias:** Instalar `axios` para peticiones HTTP y `vitest`, `msw`, `@testing-library/react` para el entorno de pruebas.\n-   [ ] **RF-S02:** **Definir Contratos de API:** Crear el archivo `src/types/api.ts` y a√±adir las interfaces TypeScript para todos los DTOs de √©xito (`StartProcessResponse`, `EtlJobStatusDto`) y de error (`StandardError`).\n-   [ ] **RF-S03:** **Crear Helper de Errores:** Crear el archivo `src/utils/apiError.ts` con la funci√≥n `parseApiError` para estandarizar el manejo de errores de la API en toda la aplicaci√≥n.\n\n---\n\n#### **Fase 2: Servicio de API (API)**\n\n-   [ ] **RF-A01:** **Inicializar Cliente HTTP:** Crear el archivo `src/services/apiService.ts` y configurar la instancia de `axios` con la `baseURL` y los interceptores.\n-   [ ] **RF-A02:** **Implementar Interceptor de Petici√≥n:** A√±adir la l√≥gica al interceptor de `axios` para obtener el token JWT del `AuthProvider` e inyectarlo en la cabecera `Authorization` de cada petici√≥n.\n-   [ ] **RF-A03:** **Implementar Interceptor de Respuesta:** A√±adir la l√≥gica al interceptor de `axios` para detectar respuestas `401` o `403` y ejecutar una funci√≥n de `signOut` global.\n-   [ ] **RF-A04:** **Implementar Subida de Archivo:** Crear la funci√≥n `startEtlProcess` en `apiService.ts` que env√≠e el archivo como `multipart/form-data` y gestione el progreso de la subida.\n-   [ ] **RF-A05:** **Implementar Consulta de Estado:** Crear la funci√≥n `getJobStatus` en `apiService.ts` que acepte un `jobId` y consulte el estado del trabajo.\n\n---\n\n#### **Fase 3: Refactorizaci√≥n de Componentes de UI (UI)**\n\n-   [ ] **RF-UI01:"
    },
    {
      "path": ".gemini/sprints/sprint_1/BURNDOWN_CHART_SPRINT_1.md",
      "excerpt": "# Burndown Chart del Sprint 1 (v1.1)\n\nEste documento visualiza el progreso del equipo y registra las decisiones clave tomadas durante el Sprint 1.\n\n## Par√°metros del Sprint\n*   **Duraci√≥n Total:** 13 d√≠as h√°biles\n*   **Story Points (SP) Comprometidos:** 21 SP\n*   **Progreso Ideal por D√≠a (SP quemados):** 21 SP / 13 d√≠as ‚âà **1.62 SP/d√≠a**\n\n---\n\n## Tabla de Seguimiento (Burndown)\n\n| D√≠a | Fecha (Estimada) | Decisiones / Acciones Clave del D√≠a | SP Quemados (D√≠a) | SP Quemados (Acumulado) | SP Restantes (Real) | SP Restantes (Ideal) | Desviaci√≥n |\n| :-: | :--- | :--- | :---: | :---: | :---: | :---: | :---: |\n| 0   | 15/09 | Inicio del Sprint | 0 | 0 | 21 | 21.00 | 0.00 |\n| 1   | 16/09 | Implementaci√≥n inicial de autenticaci√≥n. | 0 | 0 | 21 | 19.38 | **+1.62** |\n| 2   | 17/09 | Finalizaci√≥n de HU `IOC-021` y `IOC-022`. | 8 | 8 | 13 | 17.76 | **-4.76** |\n| 3   | 18/09 | (Feriado) | 0 | 8 | 13 | 17.76 | **-4.76** |\n| 4   | 19/09 | (Feriado) | 0 | 8 | 13 | 17.76 | **-4.76** |\n| 5   | 22/09 | **Decisi√≥n:** Iniciar refactorizaci√≥n y correcci√≥n de deuda t√©cnica identificada por Qodana. | 0 | 8 | 13 | 16.14 | **-3.14** |\n| 6   | 23/09 | **Decisi√≥n:** Implementar notificaciones emergentes (`react-hot-toast`) para mejorar la UX. | 0 | 8 | 13 | 14.52 | **-1.52** |\n| 7   | 24/09 | Implementaci√≥n de la vista `AdminDashboard` (`01-FTV-panel-principal`). | 0 | 8 | 13 | 12.90 | **+0.10** |\n| 8   | 25/09 | | | | | 11.28 | |\n| 9   | 26/09 | | | | | 9.66 | |\n| 10  | 29/09 | | | | | 8.04 | |\n| 11  | 30/09 | | | | | 6.42 | |\n| 12  | 01/10 | | | | | 4.80 | |\n| 13  | 02/10 | | | | | **0.00** | |\n\n---\n\n### An√°lisis del Progreso (al D√≠a 7)\n\n*   **Estado Actual:** Estamos ligeramente por **delante** de la l√≠nea ideal por **0.10 Story Points**.\n*   **Observaciones:** A pesar de dedicar tiempo a tareas de no-desarrollo (refactorizaci√≥n, documentaci√≥n), el r√°pido avance inicial nos mantiene en una buena posici√≥n. La desviaci√≥n positiva es m√≠nima, lo que indica que estamos casi exactamente donde de"
    },
    {
      "path": ".gemini/sprints/sprint_1/frontend_sync_brief.md",
      "excerpt": "# Frontend Sync Brief: API del Backend (v2025-09-21)\n\n## 1. Resumen Ejecutivo\nEste documento es la especificaci√≥n oficial de la API del backend, generada desde el c√≥digo fuente (controladores y DTOs). Sirve como contrato de integraci√≥n para que el equipo de Frontend consuma los endpoints de forma segura y consistente.\n\n## 2. Pol√≠tica de Autenticaci√≥n\n- Mecanismo: Todos los endpoints protegidos requieren un JWT en la cabecera `Authorization: Bearer <token>`.\n- Errores: Las peticiones sin token v√°lido a endpoints protegidos devolver√°n `401 Unauthorized` o `403 Forbidden`.\n\n### 2.1 Esquemas de Error (payloads estandarizados)\n- Errores generales (validez de archivo, conflicto de job, argumentos inv√°lidos, tama√±o de archivo, fallos internos)\n  - Fuente: GlobalExceptionHandler (com.cambiaso.ioc.exception)\n  ```typescript\n  // Usado en: 400, 409, 413, 500\n  interface StandardError {\n    error: string;     // \"VALIDATION_ERROR\" | \"INVALID_ARGUMENT\" | \"CONFLICT\" | \"FILE_TOO_LARGE\" | \"INTERNAL_ERROR\"\n    message: string;   // detalle humano-legible\n    timestamp: string; // ISO-8601 con offset (OffsetDateTime)\n  }\n  ```\n- Errores de seguridad (autenticaci√≥n/autorizaci√≥n)\n  - Fuente: SecurityExceptionHandler (com.cambiaso.ioc.security)\n  ```typescript\n  // 401 Unauthorized\n  interface UnauthorizedError {\n    timestamp: string; // ISO LocalDateTime\n    status: 401;\n    error: \"Unauthorized\";\n    message: string;   // p.ej. \"Authentication failed: <detalle>\"\n    path: string;      // ruta solicitada\n  }\n\n  // 403 Forbidden\n  interface ForbiddenError {\n    timestamp: string; // ISO LocalDateTime\n    status: 403;\n    error: \"Forbidden\";\n    message: string;   // p.ej. \"You do not have permission to access this resource.\"\n    path: string;      // ruta solicitada\n  }\n  ```\n\n---\n\n## 3. API Endpoints Disponibles\n\n### Endpoint: [POST] /api/etl/start-process\n- Descripci√≥n: Inicia un proceso ETL para el archivo CSV subido. Valida, calcula hash para idempotencia, crea el job y dispara el"
    },
    {
      "path": ".gemini/sprints/sprint_1/SPRINT_1_RETROSPECTIVE_VALIDATION.md",
      "excerpt": "# üìã Validaci√≥n de Sprint Retrospective - Sprint 1\n\n**Documento Validado:** `SPRINT_1_RETROSPECTIVE.md`  \n**Fecha de Validaci√≥n:** 14 Octubre 2025  \n**Validador:** Agile Coach\n\n---\n\n## ‚úÖ Calificaci√≥n General\n\n| Criterio | Nota | Estado | Observaci√≥n |\n|----------|------|--------|-------------|\n| **Aciertos (espec√≠ficos y evidenciados)** | 9/10 | üü¢ | 7 aciertos con evidencia concreta y IDs |\n| **Errores (con causa ra√≠z real)** | 10/10 | üü¢ | 7 errores con causa ra√≠z profunda y consecuencias |\n| **Mejoras (accionables y medibles)** | 9/10 | üü¢ | 7 acciones con responsable, plazo y KPIs |\n| **Coherencia con artefactos** | 10/10 | üü¢ | Alineaci√≥n perfecta con Sprint Backlog y Impediment Log |\n| **TOTAL** | **9.5/10** | **üü¢** | **Excelente calidad - Listo para uso** |\n\n**Veredicto:** Esta retrospective es un ejemplo de clase mundial de an√°lisis introspectivo. Combina rigor t√©cnico, honestidad brutal sobre problemas, y un plan de acci√≥n ejecutable con m√©tricas de seguimiento.\n\n---\n\n## üèÜ Top 3 Fortalezas\n\n### 1. **Trazabilidad impecable con artefactos del sprint**\nCada acierto, error y mejora cita evidencia concreta: IDs de impedimentos (IMP-001 a IMP-016), historias (IOC-021, IOC-001, IOC-006), tareas t√©cnicas (BE-TASK-10, FE-TASK-07), y m√©tricas cuantificables (800% de mejora ETL, 1.2 d√≠as de resoluci√≥n promedio, 100% completion rate). Esto hace la retrospective **auditable y verificable**, no solo opiniones.\n\n**Por qu√© importa:** Permite a stakeholders y equipos futuros entender exactamente QU√â pas√≥ y POR QU√â, no solo percepciones subjetivas. Es un documento forense, no un desahogo emocional.\n\n### 2. **Causa ra√≠z genuina, no s√≠ntomas superficiales**\nLos errores no se quedan en \"los tests fallaron\" sino que profundizan: *\"El DoD no inclu√≠a tests pasando + ausencia de CI/CD\"* (2.2), *\"No existe documentaci√≥n estandarizada de setup\"* (2.3), *\"Ausencia de sesiones de Backlog Refinement previas\"* (2.7). Cada problema identifica el **fallo sist√©mico**, no culpa a personas.\n\n**Por"
    },
    {
      "path": ".gemini/sprints/sprint_1/DAILY_SCRUM_SUMMARY_SPRINT_1.md",
      "excerpt": "# üìÖ Resumen de Daily Scrum ‚Äî Sprint 1\n\n**Sprint 1:** Fundaci√≥n y Visualizaci√≥n  \n**Per√≠odo:** 8 Septiembre - 3 Octubre 2025 (4 semanas, excluyendo festivos 18-19 Sept)  \n**Equipo:** Boris (PO + Dev), Jaime (SM + Dev)\n\n---\n\n## üéØ Sprint Goal\n\n**\"Entregar un ciclo de valor de extremo a extremo: un usuario podr√° autenticarse, cargar datos de producci√≥n a trav√©s de un archivo CSV y visualizar inmediatamente un dashboard con KPIs y gr√°ficos que reflejen esa nueva informaci√≥n.\"**\n\n---\n\n## üìä Resultado Final del Sprint\n\n| M√©trica | Resultado |\n|---------|-----------|\n| **Historias Completadas** | 5/5 (100%) |\n| **Story Points** | 41/41 (100%) |\n| **Tareas T√©cnicas** | 40/40 (100%) |\n| **Impedimentos Resueltos** | 16/16 (100%) |\n| **Riesgos Mitigados** | 3 (R-002, R-004, R-008) |\n\n---\n\n## üìÖ SEMANA 1: 8-12 Septiembre (Kick-off y Autenticaci√≥n)\n\n### Daily - 8 Septiembre 2025 - Sprint 1 D√≠a 1 (Lunes)\n\n**üéØ Sprint Goal:** \"Entregar ciclo completo: Auth ‚Üí Ingesta ‚Üí Visualizaci√≥n\"\n\n**Progreso:** 0/5 historias | 0/41 pts\n\n---\n\n**Round Robin:**\n\nüîµ **Boris (PO/Dev):** Ayer: Planning del Sprint 1, Hoy: Inicio IOC-001 (definir entidades JPA), Blocker: Ninguno\n\nüîµ **Jaime (SM/Dev):** Ayer: Planning del Sprint 1, Hoy: Inicio IOC-021 (crear vistas de auth), Blocker: Ninguno\n\n---\n\n**Blockers:** Ninguno\n\n**Parking Lot:** No aplica\n\n**Siguiente Daily:** 9-Sept-2025 - 9:00 AM\n\n---\n\n### Daily - 9 Septiembre 2025 - Sprint 1 D√≠a 2 (Martes)\n\n**üéØ Sprint Goal:** \"Entregar ciclo completo: Auth ‚Üí Ingesta ‚Üí Visualizaci√≥n\"\n\n**Progreso:** 0/5 historias | 0/41 pts\n\n---\n\n**Round Robin:**\n\nüîµ **Boris (PO/Dev):** Ayer: Defin√≠ entidades JPA y repositorios (BE-TASK-04), Hoy: Crear EtlController con endpoints (BE-TASK-05), Blocker: Ninguno\n\nüîµ **Jaime (SM/Dev):** Ayer: Complet√© vistas de autenticaci√≥n (FE-TASK-01), Hoy: Integrar con Supabase Auth (FE-TASK-02), Blocker: Ninguno\n\n---\n\n**Blockers:** Ninguno\n\n**Parking Lot:** No aplica\n\n**Siguiente Daily:** 10-Sept-2025 - 9:00 AM\n\n---\n\n### Daily - 10 Septiembre 2025 - "
    },
    {
      "path": ".gemini/sprints/sprint_1/IMPEDIMENT_LOG_SPRINT_1_v2.md",
      "excerpt": "# Registro de Impedimentos del Sprint 1 (v2.0)\n\n**Proyecto:** IOC (Indicadores Operacionales Cambiaso)  \n**Sprint:** Sprint 1 - El Ciclo de Valor Completo  \n**Per√≠odo:** 8 Septiembre - 3 Octubre 2025 (19 d√≠as laborables, excluyendo festivos 18-19 Sept)  \n**Equipo:**  \n- Boris Rojas (Product Owner + Developer)  \n- Jaime Arancibia (Scrum Master + Developer)\n\n---\n\n## üìä Estado Actual\n\n| M√©trica | Valor |\n|---------|-------|\n| **Total de Impedimentos** | 16 |\n| **Resueltos** | 16 (100%) |\n| **Pendientes** | 0 |\n| **Tiempo Promedio de Resoluci√≥n** | 1.2 d√≠as |\n| **Impedimentos Cr√≠ticos** | 4 (IMP-007, IMP-009, IMP-013, IMP-016) |\n| **Impedimentos de Alto Impacto** | 6 |\n| **Impedimentos de Impacto Medio** | 6 |\n\n---\n\n## Proceso de Gesti√≥n de Impedimentos\n\n1.  **Identificaci√≥n:** Cualquier miembro del equipo reporta el impedimento en la Daily Scrum.\n2.  **Clasificaci√≥n:** Se asigna ID, impacto (üî¥ Cr√≠tico / üü° Alto / üü¢ Medio) y responsable.\n3.  **An√°lisis:** Se define plan de acci√≥n, causa ra√≠z y acci√≥n preventiva.\n4.  **Seguimiento:** El estado se actualiza diariamente hasta su resoluci√≥n.\n5.  **Cierre:** Se documenta la soluci√≥n y se calcula el tiempo de resoluci√≥n.\n\n---\n\n## üìã Registro de Impedimentos Resueltos\n\n| ID | Impacto | Impedimento | Responsable | Detectado | Resuelto | D√≠as | Soluci√≥n Aplicada | Causa Ra√≠z | Acci√≥n Preventiva | Responsable Acci√≥n | Deadline |\n| :--- | :---: | :--- | :--- | :---: | :---: | :-: | :--- | :--- | :--- | :--- | :--- |\n| **IMP-001** | üü° Alto | **Flujo de usuario incompleto (Error 404):** La p√°gina `/update-password` no exist√≠a, causando error 404 al resetear contrase√±a. **Justificaci√≥n:** Bloque√≥ la funcionalidad de reseteo de contrase√±a, afectando IOC-021. | Jaime | 11-Sep | 12-Sep | 1 | Implementar la vista UpdatePasswordPage.tsx y agregar la ruta en App.tsx seg√∫n el blueprint de autenticaci√≥n. | **Planificaci√≥n Incompleta:** El blueprint inicial no contempl√≥ la p√°gina de destino del enlace de reseteo. | **Mejora de Blueprints:** Actu"
    },
    {
      "path": ".gemini/sprints/sprint_1/sumario.md",
      "excerpt": "# Sumario t√©cnico ‚Äì ioc-backend\n\nEste documento resume el prop√≥sito del proyecto, componentes clave, pr√°cticas de calidad aplicadas y recomendaciones de mejora.\n\n## Resumen ejecutivo\nBackend Spring Boot para orquestar procesos ETL: recibe archivos, valida, calcula hash/idempotencia, ejecuta carga transaccional (delete+insert por ventana), publica m√©tricas y notificaciones en tiempo real, y protege endpoints con JWT y rate limiting est√°ndar.\n\n- P√∫blico objetivo: devs backend/frontend, SRE/ops, QA.\n- Objetivos: confiabilidad del ETL, trazabilidad (job/status), observabilidad y seguridad por defecto.\n\n## Stack y dependencias\n- Lenguaje/Runtime: Java 21\n- Framework: Spring Boot 3.5.5\n- Persistencia: Spring Data JPA / Hibernate, PostgreSQL\n- Seguridad: Spring Security (Resource Server, JWT)\n- Observabilidad: Spring Boot Actuator, Micrometer, Prometheus\n- Resiliencia: Resilience4j (Circuit Breaker, TimeLimiter)\n- Tiempo real: WebSocket (STOMP)\n- Rate limiting: Bucket4j (con Caffeine Cache)\n- Utilidades: Lombok\n\n## Arquitectura y componentes\n- Controller\n  - EtlController: expone endpoints para iniciar el proceso ETL y consultar estado.\n- Services\n  - EtlProcessingService: orquesta el pipeline ETL (validaci√≥n, parseo, ventana de fechas, sincronizaci√≥n, m√©tricas, notificaciones).\n  - EtlJobService: gesti√≥n de entidad de jobs ETL (crear, actualizar estado, ventanas, locking de rango).\n  - DataSyncService: operaci√≥n transaccional de borrado + inserci√≥n para sincronizar datos (delete+insert en rango) con manejo de excepciones.\n  - NotificationService: env√≠o de notificaciones a usuarios y sistema (integraci√≥n WebSocket).\n- Interceptors\n  - RateLimitInterceptor: control de tasa por usuario/IP en rutas /api/etl/**, devuelve headers est√°ndar de rate limit.\n- Configuraci√≥n\n  - SecurityConfig: CORS, autenticaci√≥n JWT como Resource Server, reglas de autorizaci√≥n.\n  - WebConfig: registro de interceptores.\n  - WebSocketConfig y WebSocketSecurityConfig: broker STOMP y autenticaci√≥n v√≠a "
    },
    {
      "path": ".gemini/sprints/sprint_1/SPRINT_1_DEMO.md",
      "excerpt": "# Sprint Demo - Sprint 1\n\n**Proyecto:** IOC (Inteligencia Operacional Cambiaso)  \n**Fecha:** 3 Octubre 2025  \n**Duraci√≥n:** 15 minutos  \n**Asistentes:** 2 personas (Boris - PO/Dev, Jaime - SM/Dev)\n\n---\n\n## Resumen R√°pido\n\n| M√©trica | Planeado | Completado | % |\n|---------|----------|------------|---|\n| Historias | 5 | 5 | 100% |\n| Story Points | 41 | 41 | 100% |\n| Sprint Goal | - | Alcanzado | - |\n\n**Sprint Goal:** Entregar un ciclo de valor de extremo a extremo: un usuario podr√° autenticarse, cargar datos de producci√≥n a trav√©s de un archivo CSV y visualizar inmediatamente un dashboard con KPIs y gr√°ficos que reflejen esa nueva informaci√≥n. COMPLETADO\n\n---\n\n## Funcionalidades Demostradas\n\n### M√≥dulo 1: Autenticaci√≥n y Navegaci√≥n\n\n| ID | Funcionalidad | Demo por | Estado |\n|----|---------------|----------|--------|\n| IOC-021 | Login de usuario con Supabase Auth - Inicio de sesi√≥n seguro con validaci√≥n de credenciales, redirecci√≥n al dashboard y manejo de errores | Jaime | OK |\n| IOC-022 | Logout seguro - Cierre de sesi√≥n con invalidaci√≥n de tokens, prevenci√≥n de acceso con bot√≥n \"atr√°s\" del navegador | Jaime | OK |\n| IOC-023 | Navegaci√≥n principal y rutas protegidas - Sidebar con acceso a m√≥dulos principales, protecci√≥n de rutas para usuarios autenticados | Jaime | OK |\n\nDemostraci√≥n realizada:\n1. Login exitoso: Usuario inicia sesi√≥n ‚Üí Redirige a Dashboard\n2. Login fallido: Credenciales incorrectas ‚Üí Muestra toast con error espec√≠fico\n3. Navegaci√≥n protegida: Acceso directo a m√≥dulos sin autenticaci√≥n ‚Üí Redirige a `/signin`\n4. Logout: Cierra sesi√≥n desde men√∫ de usuario ‚Üí Invalida token ‚Üí Redirige a login\n5. Sidebar: Acceso a las secciones principales (ej. Ingesta de Datos, Dashboard)\n\n---\n\n### M√≥dulo 2: Ingesta de Datos (ETL)\n\n| ID | Funcionalidad | Demo por | Estado |\n|----|---------------|----------|--------|\n| IOC-001 | Carga y validaci√≥n de archivos CSV de producci√≥n - Upload, validaci√≥n de formato, procesamiento ETL as√≠ncrono, tabla de historial con estados en"
    },
    {
      "path": ".gemini/sprints/feature-plans/FP-001-validacion-carga-archivos-etl.md",
      "excerpt": "- Scroll si excede espacio disponible\n\n**Mockup actualizado**:\n```\n‚îå‚îÄ Preview del Archivo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Mostrando primeras 14 l√≠neas de produccion_2024-01-15.txt ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ  1 | Fecha de contabilizaci√≥n|M√°quina|N√∫mero de Log|...   ‚îÇ\n‚îÇ  2 | 15/01/2024|MAQ001|1234567|...                         ‚îÇ\n‚îÇ  3 | 15/01/2024|MAQ002|1234568|...                         ‚îÇ\n‚îÇ  4 | [TOTALES SAP - L√≠nea ignorada en validaci√≥n] üîµ      ‚îÇ\n‚îÇ  5 | 15/01/2024|MAQ003|1234569|...                         ‚îÇ\n‚îÇ  ... (l√≠neas 6-14)                                         ‚îÇ\n‚îÇ 14 | 15/01/2024|MAQ012|1234578|...                         ‚îÇ\n‚îÇ                                                            ‚îÇ\n‚îÇ ‚ÑπÔ∏è La l√≠nea 4 contiene totales de SAP y no se valida     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n**Impacto en Estimaci√≥n**: \n- Fase 2 aumenta +2 horas (componente FilePreview ahora es requerido, no opcional)\n- Estimaci√≥n total se mantiene en 5-7 d√≠as (dentro del buffer)\n\n---\n\n#### ‚úÖ D3: Override de Validaci√≥n - RESUELTO (2025-10-19)\n\n**Decisi√≥n Tomada**: \n- **NO permitir override de validaci√≥n**\n- **Justificaci√≥n**: Priorizar seguridad y consistencia de datos sobre flexibilidad\n- **Excepci√≥n**: La l√≠nea 4 (totales SAP) se ignora autom√°ticamente, no requiere override manual\n\n**Implementaci√≥n**:\n- Eliminar el toggle \"Modo Permisivo\" del dise√±o inicial\n- Validaci√≥n es siempre estricta (con excepci√≥n de l√≠nea 4)\n- Si hay errores cr√≠ticos, el bot√≥n \"Confirmar y Subir\" permanece deshabilitado\n- Mensajes de error deben ser muy claros y accionables para que el usuario corrija el archivo\n\n**Cambios en Historias de Usuario**:\n- ~~Historia 4: Modo de Validaci√≥n (Strict vs Permissive)~~ ‚Üí **ELIMINADA**\n- Solo quedan 3 historias de usuario principales\n- Estimaci√≥n se reduce ligeramente (-1 hora en Fase 2 por no implementar toggle)\n\n**Impacto en UX**:\n- M√°s restrictivo, pero m√°s predecible\n- Usuarios deben "
    },
    {
      "path": ".gemini/sprints/feature-plans/FP-IOC-004-User-Role-Management.md",
      "excerpt": "# Feature Plan: Gesti√≥n de Usuarios, Roles y Permisos (IOC-004)\n\n## Metadata\n- ID: FP-IOC-004\n- Sprint: Sprint 3\n- Prioridad: Alta\n- Tipo: Nueva Feature\n- Estimaci√≥n: 8 Story Points (5-6 d√≠as)\n- Asignado a: Backend + Frontend\n- Estado:\n  - [x] Planificaci√≥n\n  - [ ] En Dise√±o\n  - [ ] Listo para Desarrollo\n  - [ ] En Desarrollo\n  - [ ] En Testing\n  - [ ] Completado\n- Fecha Creaci√≥n: 2025-10-22\n- √öltima Actualizaci√≥n: 2025-10-22\n\n---\n\n## 1. Contexto de Negocio\n\n### 1.1. Problema a Resolver\n\nContexto Actual:\n- El proyecto usa Supabase Auth (JWT) para autenticaci√≥n y Spring Security en el backend. Existen entidades JPA `Role` y `Permission`, pero no hay un modelo persistente de ‚Äúusuarios de aplicaci√≥n‚Äù ni endpoints para gestionar usuarios, roles y permisos.\n- La asignaci√≥n de accesos se requiere para proteger informaci√≥n en dashboards y en endpoints cr√≠ticos.\n\nProblema Espec√≠fico:\n- No existe CRUD de usuarios y su asignaci√≥n de roles.\n- No existe CRUD de roles/permiso ni asociaci√≥n rol-permiso formal en BD (solo entidades JPA base).\n- No hay RLS/funciones de verificaci√≥n de rol en Supabase para reforzar seguridad a nivel de fila.\n\nImpacto del Problema:\n- Usuarios afectados: Administradores y cualquier usuario que requiera acceso controlado.\n- Frecuencia: Diaria.\n- Severidad: Alta (riesgo de acceso indebido y bloqueo operativo).\n- Coste de NO resolverlo: Accesos inconsistentes, fallas de cumplimiento y riesgo de exposici√≥n de datos.\n\nEjemplo de Caso de Uso:\n- Usuario: Administrador\n- Situaci√≥n: Debe dar acceso a un nuevo Gerente y revocar acceso de un usuario saliente.\n- Problema: No puede crear/editar/eliminar usuarios ni asignar roles.\n- Impacto: Retrasos operativos y riesgo de accesos activos no autorizados.\n\n---\n\n### 1.2. Soluci√≥n Propuesta\n\nQu√© vamos a construir (alto nivel):\n- M√≥dulo integral de Gesti√≥n de Usuarios, Roles y Permisos compatible con Supabase.\n- Modelo de datos 3NF en Postgres (Supabase): `app_users`, `roles`, `permissions`, `role_permissions`, `user_r"
    },
    {
      "path": ".gemini/sprints/feature-plans/FP-IOC-003-KPI-Configuration.md",
      "excerpt": "# Feature Plan: Sistema de Configuraci√≥n de KPIs y Umbrales\n\n## Metadata\n- **ID**: FP-IOC-003\n- **Sprint**: Sprint 3\n- **Prioridad**: Alta\n- **Tipo**: Nueva Feature\n- **Estimaci√≥n**: 8 Story Points (5-6 d√≠as)\n- **Asignado a**: Equipo Backend + Frontend\n- **Estado**: \n  - [x] Planificaci√≥n\n  - [ ] En Dise√±o\n  - [ ] Listo para Desarrollo\n  - [ ] En Desarrollo\n  - [ ] En Testing\n  - [ ] Completado\n- **Fecha Creaci√≥n**: 2025-10-22\n- **√öltima Actualizaci√≥n**: 2025-10-22\n\n---\n\n## 1. Contexto de Negocio\n\n### 1.1. Problema a Resolver\n\n**Contexto Actual**:\nEl sistema IOC actualmente procesa datos de producci√≥n y los visualiza en dashboards de Metabase, pero no existe un mecanismo para que los administradores configuren din√°micamente qu√© m√©tricas (KPIs) monitorear ni establecer umbrales personalizados que generen alertas cuando se exceden valores cr√≠ticos.\n\n**Problema Espec√≠fico**:\n- Los KPIs est√°n hardcodeados en el sistema o solo existen en Metabase\n- No hay forma de activar/desactivar el monitoreo de KPIs espec√≠ficos\n- No existen alertas autom√°ticas cuando un KPI excede umbrales cr√≠ticos\n- Los umbrales de alerta no son configurables por el usuario\n\n**Impacto del Problema**:\n- **Usuarios afectados**: Administradores y Gerentes de operaciones\n- **Frecuencia**: Diaria - cada vez que necesitan monitorear m√©tricas cr√≠ticas\n- **Severidad**: Media-Alta - limita la capacidad de respuesta proactiva ante problemas operacionales\n- **Coste de NO resolverlo**: \n  - Detecci√≥n tard√≠a de problemas de producci√≥n\n  - Imposibilidad de personalizar el sistema a las m√©tricas espec√≠ficas del negocio\n  - Dependencia de revisi√≥n manual constante de dashboards\n\n**Ejemplo de Caso de Uso**:\n```\nUsuario: Gerente de Producci√≥n\nSituaci√≥n: La eficiencia de una l√≠nea de producci√≥n cae por debajo del 85%\nProblema: No recibe ninguna alerta autom√°tica, debe revisar manualmente los dashboards constantemente\nImpacto: Pierde horas de producci√≥n antes de detectar el problema\n```\n\n---\n\n### 1.2. Soluci√≥n Propuest"
    },
    {
      "path": "docs/frontend-role-permissions-agent.md",
      "excerpt": "# Agente frontend: c√≥mo cambiar permisos de un rol (sin tocar backend)\n\nProp√≥sito\n- Documentar un flujo seguro y reproducible para que un agente IA o el frontend actualicen los permisos asignados a un rol usando los endpoints existentes del backend, sin necesidad de modificar DTOs o servicios del servidor.\n\nDescripci√≥n del problema\n- Qu√© ocurre: desde el frontend a menudo se intenta actualizar la lista de permisos de un rol enviando un PUT al endpoint de roles (por ejemplo `PUT /api/v1/admin/roles/{id}`) con un campo `permissions` en el cuerpo JSON.\n- Por qu√© falla: el backend puede no procesar ese campo en el `RoleRequest` o no reconducir las relaciones role‚Üîpermission en el m√©todo `RoleService.update`. Como con usuarios y roles, el proyecto expone endpoints separados para asignar y remover permisos a roles.\n- Efecto pr√°ctico: el PUT de rol actualiza algunos campos del rol (nombre, descripci√≥n), pero NO modifica la colecci√≥n de permisos asociada; los cambios esperados en permisos no se aplican.\n- Ejemplo t√≠pico: enviar `PUT /api/v1/admin/roles/5` con `{\"name\":\"GERENTE\",\"permissions\":[1,9]}` y observar que la lista de permisos del rol no cambia.\n\nResumen r√°pido\n- No conf√≠es en que `PUT /api/v1/admin/roles/{id}` vaya a reemplazar permisos.\n- Usa los endpoints disponibles para gesti√≥n de relaciones:\n  - POST /api/v1/admin/assignments/roles/{roleId}/permissions/{permissionId}  ‚Üí asigna permiso al rol\n  - DELETE /api/v1/admin/assignments/roles/{roleId}/permissions/{permissionId} ‚Üí elimina permiso del rol\n- Flujo recomendado: leer permisos actuales del rol, calcular diferencias con los permisos deseados y ejecutar POST/DELETE seg√∫n corresponda.\n\nPrecondiciones y permisos\n- El token usado por el agente debe tener `ROLE_ADMIN`.\n- El agente debe poder listar permisos disponibles (por ejemplo, `GET /api/v1/admin/permissions` o similar) para resolver permissionId desde un nombre/c√≥digo, o mantener una cach√© local.\n\nContrato m√≠nimo (qu√© haremos)\n- Input: roleId (Integer), desi"
    },
    {
      "path": "docs/IOC-004-implementation-report.md",
      "excerpt": "# Informe de implementaci√≥n ‚Äî IOC-004 (User Role Management)\n\nFecha: 2025-10-22\n√öltima actualizaci√≥n: 2025-10-27\n\nResumen ejecutivo\n-----------------\nEste documento consolida todo lo que se implement√≥ en el sprint/iteraci√≥n relacionada con IOC-004 (gesti√≥n de usuarios, roles y permisos). Incluye: artefactos a√±adidos, resultados de compilaci√≥n y pruebas (unitarias e integraci√≥n), advertencias detectadas, el checklist actualizado y los pr√≥ximos pasos recomendados y priorizados.\n\nResumen r√°pido de estado (actualizado)\n--------------------------------------\n- Migraci√≥n SQL (`.gemini/sql/schema-user-role-management-unified.sql`) ejecutada en el entorno Supabase/DB: ‚úîÔ∏è (idempotente, RLS y funciones desplegadas).\n- Compilaci√≥n: BUILD SUCCESS (artifact generado).\n- Tests: TODOS los tests pasan localmente y en el entorno de pruebas configurado (unitarios, controllers MockMvc, integraci√≥n con Testcontainers). ‚úîÔ∏è\n\nPlan y checklist r√°pido (lo que se hizo en este cambio)\n-------------------------------------------------------\n- [x] Consolidar en el informe todos los cambios realizados en el repo desde el bloque A.\n- [x] Revisar y actualizar el checklist de IOC-004 seg√∫n el estado actual del c√≥digo.\n- [x] Marcar la migraci√≥n SQL como ejecutada en Supabase.\n- [x] Verificar estado de tests unitarios, de integraci√≥n y security y reflejarlo en el reporte.\n\nEstado resumido (qu√© se implement√≥)\n-----------------------------------\nSe implement√≥ y teste√≥ lo siguiente en el c√≥digo base (resumen ejecutable):\n\n1) DTOs, validadores y mappers\n- DTOs request: `UsuarioCreateRequest`, `UsuarioUpdateRequest`, `RoleRequest`, `PermissionRequest`.\n- DTOs response: `UsuarioResponse`, `RoleResponse`, `PermissionResponse`.\n- Validadores personalizados (Bean Validation): `@UniqueEmail` + `UniqueEmailValidator`, `@ValidSupabaseUUID` + `ValidSupabaseUUIDValidator` (tests unitarios existentes y ejecutados).\n- Mappers MapStruct: `UsuarioMapper`, `RoleMapper`, `PermissionMapper`.\n\n2) Repositorios / Entidades\n"
    },
    {
      "path": "docs/frontend-role-agent.md",
      "excerpt": "# Agente frontend: c√≥mo cambiar roles de un usuario (sin tocar backend)\n\nProp√≥sito\n- Documentar un flujo seguro y robusto para que un agente IA o el frontend actualicen los roles de un usuario usando los endpoints existentes en el backend (sin necesitar modificar DTOs ni servicios del servidor).\n\nDescripci√≥n del problema\n- Qu√© ocurre: desde el frontend muchos desarrolladores intentan actualizar los roles de un usuario enviando un campo `roles` dentro del cuerpo (JSON) de la petici√≥n PUT a `/api/v1/admin/users/{id}`.\n- Por qu√© falla: el backend no procesa ese campo porque el DTO `UsuarioUpdateRequest` no tiene ninguna propiedad `roles`, y la implementaci√≥n de `UserAdminService.update` tampoco reconcilia ni modifica las asignaciones de roles del usuario. En consecuencia, los cambios de roles enviados en el PUT son ignorados (y, en algunos entornos, podr√≠an provocar un error si el deserializador rechaza propiedades desconocidas).\n- Efecto pr√°ctico: el frontend muestra que la petici√≥n PUT fue exitosa para los datos del usuario (nombre, planta, etc.), pero las asignaciones de roles no se actualizan. La API ya proporciona endpoints separados para asignar/quitar roles (`/api/v1/admin/assignments/...`) y este documento describe c√≥mo usar esos endpoints desde el frontend/agent para lograr el resultado esperado sin tocar el backend.\n- Ejemplo t√≠pico: el desarrollador env√≠a un PUT con `roles: [\"ADMIN\",\"GERENTE\"]` esperando que el backend reemplace las asignaciones previas, pero tras la respuesta el usuario sigue teniendo sus roles anteriores.\n\nResumen r√°pido\n- El endpoint `PUT /api/v1/admin/users/{id}` no acepta `roles` en el request body.\n- Hay endpoints ya implementados para asignar y remover roles:\n  - POST /api/v1/admin/assignments/users/{userId}/roles/{roleId}\n  - DELETE /api/v1/admin/assignments/users/{userId}/roles/{roleId}\n- Flujo recomendado: leer roles actuales, calcular diferencias, y llamar a los endpoints de asignaci√≥n/remoci√≥n para sincronizar el estado.\n\nPrecond"
    },
    {
      "path": ".idea/copilot.data.migration.edit.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"EditMigrationStateService\">\n    <option name=\"migrationStatus\" value=\"COMPLETED\" />\n  </component>\n</project>"
    },
    {
      "path": ".idea/copilot.data.migration.ask2agent.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"Ask2AgentMigrationStateService\">\n    <option name=\"migrationStatus\" value=\"COMPLETED\" />\n  </component>\n</project>"
    },
    {
      "path": ".idea/misc.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"ExternalStorageConfigurationManager\" enabled=\"true\" />\n  <component name=\"MavenProjectsManager\">\n    <option name=\"originalFiles\">\n      <list>\n        <option value=\"$PROJECT_DIR$/pom.xml\" />\n      </list>\n    </option>\n  </component>\n  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_21\" default=\"true\" project-jdk-name=\"temurin-21 (3)\" project-jdk-type=\"JavaSDK\" />\n</project>"
    },
    {
      "path": ".idea/workspace.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"AutoImportSettings\">\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\n  </component>\n  <component name=\"ChangeListManager\">\n    <list default=\"true\" id=\"c72edc57-6d0d-4b03-8e84-46d340668237\" name=\"Changes\" comment=\"\">\n      <change afterPath=\"$PROJECT_DIR$/docs/frontend-role-agent.md\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/docs/frontend-role-permissions-agent.md\" afterDir=\"false\" />\n    </list>\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\n  </component>\n  <component name=\"Git.Settings\">\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\n  </component>\n  <component name=\"GitHubPullRequestSearchHistory\">{\n  &quot;lastFilter&quot;: {\n    &quot;state&quot;: &quot;OPEN&quot;,\n    &quot;assignee&quot;: &quot;qb4745&quot;\n  }\n}</component>\n  <component name=\"GithubPullRequestsUISettings\">{\n  &quot;selectedUrlAndAccountId&quot;: {\n    &quot;url&quot;: &quot;https://github.com/qb4745/ioc-backend.git&quot;,\n    &quot;accountId&quot;: &quot;54219fc9-ff46-4658-8286-8d6c985dd23f&quot;\n  }\n}</component>\n  <component name=\"MavenImportPreferences\">\n    <option name=\"generalSettings\">\n      <MavenGeneralSettings>\n        <option name=\"mavenHomeTypeForPersistence\" value=\"WRAPPER\" />\n      </MavenGeneralSettings>\n    </option>\n  </component>\n  <component name=\"ProjectColorInfo\">{\n  &quot;customColor&quot;: &quot;&quot;,\n  &quot;associatedIndex&quot;: 7\n}</component>\n  <component name=\"ProjectId\" id=\"34YNjfG4JeM0LUaBlnDyuED6BXc\" />\n  <component name=\"ProjectLevelVcsManager\">\n    <ConfirmationsSetting value=\"2\" id=\"Add\" />\n  </component>\n  <component name=\"ProjectViewState\">\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\n    <option name=\"showLibraryContents\" value=\"true\" />\n  </co"
    },
    {
      "path": ".idea/compiler.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"CompilerConfiguration\">\n    <annotationProcessing>\n      <profile default=\"true\" name=\"Default\" enabled=\"true\" />\n      <profile name=\"Annotation profile for iocbackend\" enabled=\"true\">\n        <sourceOutputDir name=\"target/generated-sources/annotations\" />\n        <sourceTestOutputDir name=\"target/generated-test-sources/test-annotations\" />\n        <outputRelativeToContentRoot value=\"true\" />\n        <processorPath useClasspath=\"false\">\n          <entry name=\"$MAVEN_REPOSITORY$/org/projectlombok/lombok/1.18.38/lombok-1.18.38.jar\" />\n          <entry name=\"$MAVEN_REPOSITORY$/org/mapstruct/mapstruct-processor/1.6.2/mapstruct-processor-1.6.2.jar\" />\n          <entry name=\"$MAVEN_REPOSITORY$/org/mapstruct/mapstruct/1.6.2/mapstruct-1.6.2.jar\" />\n        </processorPath>\n        <module name=\"iocbackend\" />\n      </profile>\n    </annotationProcessing>\n  </component>\n  <component name=\"JavacSettings\">\n    <option name=\"ADDITIONAL_OPTIONS_OVERRIDE\">\n      <module name=\"iocbackend\" options=\"-parameters\" />\n    </option>\n  </component>\n</project>"
    },
    {
      "path": ".idea/encodings.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"Encoding\">\n    <file url=\"file://$PROJECT_DIR$/src/main/java\" charset=\"UTF-8\" />\n  </component>\n</project>"
    },
    {
      "path": ".idea/jarRepositories.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"RemoteRepositoriesConfiguration\">\n    <remote-repository>\n      <option name=\"id\" value=\"central\" />\n      <option name=\"name\" value=\"Central Repository\" />\n      <option name=\"url\" value=\"https://repo.maven.apache.org/maven2\" />\n    </remote-repository>\n    <remote-repository>\n      <option name=\"id\" value=\"central\" />\n      <option name=\"name\" value=\"Maven Central repository\" />\n      <option name=\"url\" value=\"https://repo1.maven.org/maven2\" />\n    </remote-repository>\n    <remote-repository>\n      <option name=\"id\" value=\"jboss.community\" />\n      <option name=\"name\" value=\"JBoss Community repository\" />\n      <option name=\"url\" value=\"https://repository.jboss.org/nexus/content/repositories/public/\" />\n    </remote-repository>\n  </component>\n</project>"
    },
    {
      "path": ".idea/vcs.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"VcsDirectoryMappings\">\n    <mapping directory=\"$PROJECT_DIR$\" vcs=\"Git\" />\n  </component>\n</project>"
    },
    {
      "path": ".idea/copilot.data.migration.agent.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"AgentMigrationStateService\">\n    <option name=\"migrationStatus\" value=\"COMPLETED\" />\n  </component>\n</project>"
    },
    {
      "path": ".idea/copilot.data.migration.ask.xml",
      "excerpt": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"AskMigrationStateService\">\n    <option name=\"migrationStatus\" value=\"COMPLETED\" />\n  </component>\n</project>"
    },
    {
      "path": "src/test/resources/application-pgtest.properties",
      "excerpt": "# Configuraci√≥n para tests con PostgreSQL (Testcontainers)\nspring.jpa.hibernate.ddl-auto=update\n\n# Metabase (valores de prueba)\nmetabase.secret-key=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef\nmetabase.site-url=http://localhost:3000\nmetabase.dashboards[0].id=1\nmetabase.dashboards[0].name=Test Dashboard\nmetabase.dashboards[0].allowed-roles=ROLE_USER,ROLE_ADMIN\n\n# ETL\netl.lock.enabled=true\netl.retry.unique.enabled=false\n\n# Logging\nlogging.level.org.springframework=WARN\nlogging.level.org.hibernate=WARN\n\n# src/test/resources/application-pgtest.properties\n\n# Database (configurado dinÔøΩmicamente por Testcontainers)\n\n# Metabase (valores de prueba)\n\nmetabase.token-expiration-minutes=10\n\n\nmetabase.dashboards[0].filters[0].name=user_id\nmetabase.dashboards[0].filters[0].type=USER_ATTRIBUTE\nmetabase.dashboards[0].filters[0].source=userId\n\n# JWT Issuer\nspring.security.oauth2.resourceserver.jwt.issuer-uri=https://test.supabase.co/auth/v1\n\n# ETL Config\netl.duplicate.check.enabled=false\netl.duplicate.fail-on-detect=false\n\n# Circuit Breaker (permisivo para tests)\nresilience4j.circuitbreaker.configs.default.failureRateThreshold=100\nresilience4j.circuitbreaker.configs.default.waitDurationInOpenState=1000ms"
    },
    {
      "path": "src/test/resources/application-test.properties",
      "excerpt": "# ===================================================================\n# CONFIGURACI\\u00D3N DE BASE DE DATOS PARA TESTS (H2 EN MEMORIA)\n# ===================================================================\nspring.datasource.url=jdbc:h2:mem:testdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH;INIT=RUNSCRIPT FROM 'classpath:init-h2.sql'\nspring.datasource.driver-class-name=org.h2.Driver\nspring.datasource.username=sa\nspring.datasource.password=\n\n# ===================================================================\n# CONFIGURACI\\u00D3N DE JPA\n# ===================================================================\nspring.jpa.hibernate.ddl-auto=create-drop\nspring.sql.init.mode=never\nspring.jpa.show-sql=false\nspring.jpa.properties.hibernate.format_sql=false\nspring.jpa.properties.hibernate.jdbc.batch_size=20\nspring.jpa.properties.hibernate.order_inserts=true\nspring.jpa.properties.hibernate.order_updates=true\n\n# ===================================================================\n# CONFIGURACION DE SEGURIDAD (OAUTH2 JWT) - VALORES MOCK PARA TESTS\n# ===================================================================\nspring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:3000/auth/v1\n\n# ===================================================================\n# CONFIGURACION DE ETL (FEATURE FLAGS) - DISABLED FOR TESTS\n# ===================================================================\netl.lock.enabled=false\netl.retry.unique.enabled=true\netl.duplicate.check.enabled=false\netl.duplicate.fail-on-detect=false\netl.duplicate.check.sample-limit=10\netl.unique.enforced=false\netl.jobs.stuck.threshold-minutes=30\netl.jobs.watchdog.enabled=false\n\n# ===================================================================\n# CONFIGURACION DE CACHE (REQUERIDA POR METABASE SERVICE)\n# ===================================================================\nspring.cache.type=caffeine\nspring.cache.caffeine.spec=maximumSize=100,expireAfterWrite=5m\n\n# ================================="
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/SerializationSmokeTest.java",
      "excerpt": "package com.cambiaso.ioc;\n\nimport com.cambiaso.ioc.dto.response.RoleResponse;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport org.junit.jupiter.api.Test;\n\nimport java.util.ArrayList;\n\nimport static org.junit.jupiter.api.Assertions.fail;\n\npublic class SerializationSmokeTest {\n\n    @Test\n    void roleResponseSerializationDoesNotThrow() {\n        RoleResponse resp = new RoleResponse();\n        resp.setId(1);\n        resp.setName(\"ADMIN\");\n        resp.setDescription(\"desc\");\n        resp.setUsersCount(2);\n        resp.setPermissions(new ArrayList<>(java.util.List.of(\"READ\", \"WRITE\")));\n\n        ObjectMapper mapper = new ObjectMapper();\n        try {\n            String json = mapper.writeValueAsString(resp);\n            System.out.println(json);\n        } catch (Throwable t) {\n            t.printStackTrace();\n            fail(\"Serialization failed: \" + t);\n        }\n    }\n}\n\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/AbstractIntegrationTest.java",
      "excerpt": "package com.cambiaso.ioc;\n\nimport com.cambiaso.ioc.config.GlobalTestConfiguration;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.test.context.ActiveProfiles;\nimport org.springframework.transaction.annotation.Transactional;\n\n@SpringBootTest\n@ActiveProfiles(\"test\")\n@Import(GlobalTestConfiguration.class)\n@Transactional\npublic abstract class AbstractIntegrationTest {\n}\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/IocbackendApplicationTests.java",
      "excerpt": "package com.cambiaso.ioc;\n\nimport com.cambiaso.ioc.security.SecurityConfig;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.context.annotation.ComponentScan;\nimport org.springframework.context.annotation.FilterType;\nimport org.springframework.test.context.ActiveProfiles;\n\n@SpringBootTest\n@ActiveProfiles(\"test\")\n@ComponentScan(excludeFilters = @ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE, classes = SecurityConfig.class))\nclass IocbackendApplicationTests {\n\n\t@Test\n\tvoid contextLoads() {\n\t}\n\n}\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/MvcSerializationTest.java",
      "excerpt": "package com.cambiaso.ioc;\n\nimport com.cambiaso.ioc.dto.response.RoleResponse;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.converter.json.Jackson2ObjectMapperBuilder;\nimport org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;\nimport org.springframework.mock.http.MockHttpOutputMessage;\n\nimport java.util.List;\n\nimport static org.junit.jupiter.api.Assertions.fail;\n\npublic class MvcSerializationTest {\n\n    @Test\n    void mappingConverterSerializesPage() {\n        RoleResponse resp = new RoleResponse();\n        resp.setId(1);\n        resp.setName(\"ADMIN\");\n        resp.setDescription(\"desc\");\n        resp.setUsersCount(2);\n        resp.setPermissions(new java.util.ArrayList<>(List.of(\"READ\", \"WRITE\")));\n\n        PageImpl<RoleResponse> page = new PageImpl<>(List.of(resp), PageRequest.of(0, 1), 1);\n\n        MappingJackson2HttpMessageConverter conv = new MappingJackson2HttpMessageConverter(Jackson2ObjectMapperBuilder.json().build());\n        MockHttpOutputMessage out = new MockHttpOutputMessage();\n        try {\n            conv.write(page, MediaType.APPLICATION_JSON, out);\n            String body = out.getBodyAsString();\n            System.out.println(body);\n        } catch (Throwable t) {\n            t.printStackTrace();\n            fail(\"Serialization via converter failed: \" + t);\n        }\n    }\n}\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/mapper/PermissionMapperTest.java",
      "excerpt": "package com.cambiaso.ioc.mapper;\n\nimport com.cambiaso.ioc.dto.response.PermissionResponse;\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport org.junit.jupiter.api.Test;\nimport org.mapstruct.factory.Mappers;\n\nimport static org.junit.jupiter.api.Assertions.*;\n\nclass PermissionMapperTest {\n\n    private final PermissionMapper mapper = Mappers.getMapper(PermissionMapper.class);\n\n    @Test\n    void toResponse_mapsBasicFields() {\n        Permission p = new Permission();\n        p.setId(7);\n        p.setName(\"READ_REPORTS\");\n        p.setDescription(\"Puede leer reportes\");\n\n        PermissionResponse dto = mapper.toResponse(p);\n\n        assertNotNull(dto);\n        assertEquals(7, dto.getId());\n        assertEquals(\"READ_REPORTS\", dto.getName());\n        assertEquals(\"Puede leer reportes\", dto.getDescription());\n    }\n}\n\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/mapper/UsuarioMapperTest.java",
      "excerpt": "package com.cambiaso.ioc.mapper;\n\nimport com.cambiaso.ioc.dto.response.UsuarioResponse;\nimport com.cambiaso.ioc.persistence.entity.AppUser;\nimport com.cambiaso.ioc.persistence.entity.Planta;\nimport org.junit.jupiter.api.Test;\nimport org.mapstruct.factory.Mappers;\n\nimport java.time.LocalDate;\nimport java.time.OffsetDateTime;\nimport java.util.Arrays;\nimport java.util.List;\n\nimport static org.junit.jupiter.api.Assertions.*;\n\nclass UsuarioMapperTest {\n\n    private final UsuarioMapper mapper = Mappers.getMapper(UsuarioMapper.class);\n\n    @Test\n    void toResponse_buildsFullNameAndMapsFields() {\n        AppUser u = new AppUser();\n        u.setId(10L);\n        u.setEmail(\"ana@example.com\");\n        u.setPrimerNombre(\"Ana\");\n        u.setSegundoNombre(null); // should be omitted\n        u.setPrimerApellido(\"P√©rez\");\n        u.setSegundoApellido(\"\"); // should be omitted\n        Planta p = new Planta();\n        p.setId(5);\n        p.setCode(\"PL-01\");\n        p.setName(\"Planta Norte\");\n        u.setPlanta(p);\n        u.setCentroCosto(\"CC-99\");\n        u.setFechaContrato(LocalDate.of(2023, 6, 1));\n        u.setActive(true);\n        OffsetDateTime now = OffsetDateTime.now();\n        u.setCreatedAt(now);\n        u.setUpdatedAt(now);\n\n        List<String> roles = Arrays.asList(\"ADMIN\", \"GERENTE\");\n\n        UsuarioResponse dto = mapper.toResponse(u, roles);\n\n        assertNotNull(dto);\n        assertEquals(10L, dto.getId());\n        assertEquals(\"ana@example.com\", dto.getEmail());\n        assertEquals(\"Ana P√©rez\", dto.getFullName());\n        assertEquals(5, dto.getPlantaId());\n        assertEquals(\"PL-01\", dto.getPlantaCode());\n        assertEquals(\"Planta Norte\", dto.getPlantaName());\n        assertEquals(\"CC-99\", dto.getCentroCosto());\n        assertEquals(LocalDate.of(2023, 6, 1), dto.getFechaContrato());\n        assertTrue(dto.getIsActive());\n        assertEquals(now, dto.getCreatedAt());\n        assertEquals(now, dto.getUpdatedAt());\n        assertEquals(roles, dto.getRoles()"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/security/SecurityConfigTest.java",
      "excerpt": "package com.cambiaso.ioc.security;\n\nimport com.cambiaso.ioc.AbstractIntegrationTest;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\nimport org.springframework.security.test.context.support.WithAnonymousUser;\nimport org.springframework.security.test.context.support.WithMockUser;\nimport org.springframework.test.web.servlet.MockMvc;\n\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;\n\n/**\n * Tests de configuraci√≥n de seguridad.\n */\n@AutoConfigureMockMvc\nclass SecurityConfigTest extends AbstractIntegrationTest {\n\n    @Autowired\n    private MockMvc mockMvc;\n\n    @Test\n    void shouldRespondToHealthEndpoint() throws Exception {\n        mockMvc.perform(get(\"/actuator/health\"))\n                .andExpect(jsonPath(\"$.status\").exists());\n    }\n\n    @Test\n    @WithAnonymousUser\n    void shouldDenyAccessToProtectedEndpointsWithoutAuth() throws Exception {\n        mockMvc.perform(get(\"/api/v1/dashboards/1\"))\n                .andExpect(status().isUnauthorized());\n    }\n\n    @Test\n    @WithMockUser(username = \"testuser\", roles = \"USER\")\n    void shouldAllowAccessWithValidAuthentication() throws Exception {\n        mockMvc.perform(get(\"/api/v1/dashboards/1\"))\n                .andExpect(status().isOk())\n                .andExpect(content().contentType(\"application/json\"))\n                .andExpect(jsonPath(\"$.signedUrl\").exists())\n                .andExpect(jsonPath(\"$.dashboardId\").value(1));\n    }\n\n    @Test\n    @WithMockUser(username = \"admin\", roles = \"ADMIN\")\n    void shouldAllowAccessForAdminRole() throws Exception {\n        mockMvc.perform(get(\"/api/v1/dashboards/1\"))\n                .andExpect(status().isOk())\n                .andExpect(jsonPath(\"$.signedUrl\").exists());\n    }\n\n    @Test\n    @WithMockUser(username = \"testus"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/persistence/PersistenceLayerTest.java",
      "excerpt": "package com.cambiaso.ioc.persistence;\n\nimport com.cambiaso.ioc.persistence.entity.*;\nimport com.cambiaso.ioc.persistence.repository.*;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;\nimport org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;\nimport org.springframework.dao.DataIntegrityViolationException;\nimport org.springframework.test.context.ActiveProfiles;\nimport org.springframework.test.context.TestPropertySource;\n\nimport java.math.BigDecimal;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\nimport java.util.UUID;\n\nimport static org.assertj.core.api.Assertions.assertThat;\nimport static org.assertj.core.api.Assertions.assertThatThrownBy;\n\n@DataJpaTest\n@ActiveProfiles(\"test\")\n@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.ANY)\n@TestPropertySource(properties = {\n    \"spring.jpa.hibernate.ddl-auto=create-drop\",\n    \"spring.jpa.database-platform=org.hibernate.dialect.H2Dialect\"\n})\nclass PersistenceLayerTest {\n\n    @Autowired\n    private DimMaquinaRepository dimMaquinaRepository;\n    @Autowired\n    private DimMaquinistaRepository dimMaquinistaRepository;\n    @Autowired\n    private EtlJobRepository etlJobRepository;\n    @Autowired\n    private QuarantinedRecordRepository quarantinedRecordRepository;\n    @Autowired\n    private FactProductionRepository factProductionRepository;\n\n    // Helper method to create a valid EtlJob for tests\n    private EtlJob createAndSaveTestEtlJob() {\n        EtlJob job = new EtlJob();\n        job.setJobId(UUID.randomUUID());\n        job.setFileName(\"test.txt\");\n        job.setFileHash(\"hash-\" + job.getJobId()); // Ensure hash is unique for each test run\n        job.setUserId(\"test-user\");\n        job.setStatus(\"INICIADO\");\n        return etlJobRepository.saveAndFlush(job); // Use saveAndFlush\n    }\n\n    @Test\n    void whenSaveAndFindEtlJob_thenCorrect() {\n        EtlJo"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/validation/UniqueEmailValidatorTest.java",
      "excerpt": "package com.cambiaso.ioc.validation;\n\nimport com.cambiaso.ioc.persistence.repository.AppUserRepository;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.mockito.Mockito;\n\nimport static org.junit.jupiter.api.Assertions.*;\nimport static org.mockito.Mockito.*;\n\nclass UniqueEmailValidatorTest {\n\n    private AppUserRepository appUserRepository;\n    private UniqueEmailValidator validator;\n\n    @BeforeEach\n    void setUp() {\n        appUserRepository = Mockito.mock(AppUserRepository.class);\n        validator = new UniqueEmailValidator(appUserRepository);\n    }\n\n    @Test\n    void returnsTrueForNullOrBlank() {\n        assertTrue(validator.isValid(null, null));\n        assertTrue(validator.isValid(\"   \", null));\n    }\n\n    @Test\n    void returnsFalseWhenEmailExists() {\n        when(appUserRepository.existsByEmailIgnoreCase(\"ana@example.com\")).thenReturn(true);\n        assertFalse(validator.isValid(\"ana@example.com\", null));\n        verify(appUserRepository, times(1)).existsByEmailIgnoreCase(\"ana@example.com\");\n    }\n\n    @Test\n    void returnsTrueWhenEmailNotExists() {\n        when(appUserRepository.existsByEmailIgnoreCase(\"new@example.com\")).thenReturn(false);\n        assertTrue(validator.isValid(\"new@example.com\", null));\n        verify(appUserRepository, times(1)).existsByEmailIgnoreCase(\"new@example.com\");\n    }\n}\n\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/validation/ValidSupabaseUUIDValidatorTest.java",
      "excerpt": "package com.cambiaso.ioc.validation;\n\nimport org.junit.jupiter.api.Test;\n\nimport java.util.UUID;\n\nimport static org.junit.jupiter.api.Assertions.*;\n\nclass ValidSupabaseUUIDValidatorTest {\n\n    private final ValidSupabaseUUIDValidator validator = new ValidSupabaseUUIDValidator();\n\n    @Test\n    void returnsTrueForNull() {\n        assertTrue(validator.isValid(null, null));\n    }\n\n    @Test\n    void returnsTrueForValidUUID() {\n        UUID id = UUID.randomUUID();\n        assertTrue(validator.isValid(id, null));\n    }\n}\n\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/RoleServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.request.RoleRequest;\nimport com.cambiaso.ioc.dto.response.RoleResponse;\nimport com.cambiaso.ioc.exception.ResourceConflictException;\nimport com.cambiaso.ioc.exception.ResourceNotFoundException;\nimport com.cambiaso.ioc.mapper.RoleMapper;\nimport com.cambiaso.ioc.persistence.entity.Role;\nimport com.cambiaso.ioc.persistence.repository.RolePermissionRepository;\nimport com.cambiaso.ioc.persistence.repository.RoleRepository;\nimport com.cambiaso.ioc.persistence.repository.UserRoleRepository;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.PageRequest;\n\nimport java.util.List;\nimport java.util.Optional;\n\nimport static org.junit.jupiter.api.Assertions.*;\nimport static org.mockito.Mockito.*;\n\n@ExtendWith(MockitoExtension.class)\nclass RoleServiceTest {\n\n    @Mock\n    private RoleRepository roleRepository;\n    @Mock\n    private UserRoleRepository userRoleRepository;\n    @Mock\n    private RolePermissionRepository rolePermissionRepository;\n    @Mock\n    private RoleMapper roleMapper;\n\n    @InjectMocks\n    private RoleService roleService;\n\n    private Role existing;\n\n    @BeforeEach\n    void setup() {\n        existing = new Role();\n        existing.setId(1);\n        existing.setName(\"OPERATOR\");\n        existing.setDescription(\"Operator role\");\n    }\n\n    @Test\n    void create_success_whenNameUnique() {\n        RoleRequest req = new RoleRequest();\n        req.setName(\"  ADMIN  \");\n        req.setDescription(\"desc\");\n\n        when(roleRepository.existsByNameIgnoreCase(\"ADMIN\")).thenReturn(false);\n        when(roleRepository.save(any(Role.class))).thenAnswer(inv -> {\n            Role r = inv.getArgument(0);\n "
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/ParserServiceLeadingZerosDedupTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.ActiveProfiles;\n\nimport java.io.ByteArrayInputStream;\nimport java.io.InputStream;\nimport java.nio.charset.StandardCharsets;\nimport java.util.List;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\n/**\n * Verifica que dos l√≠neas que difieren solo por ceros a la izquierda en Numero Log\n * se deduplican correctamente tras la normalizaci√≥n can√≥nica.\n */\n@SpringBootTest\n@ActiveProfiles(\"test\")\nclass ParserServiceLeadingZerosDedupTest {\n\n    @Autowired\n    private ParserService parserService;\n\n    @Test\n    void givenLeadingZerosInNumeroLog_whenParse_thenSingleLogicalRecord() throws Exception {\n        String header = \"| Status|Fecha Cont. |Hora    |Fecha Notif |Numero Log.|Material |Maquina |Maquinista|Cantidad |Peso Neto|Turno  |\";\n        String lineA = \"| @08@  |30.08.2025  |08:00:00|31.08.2025  |    0000123|6000123456|M001    |9001      |10,000    |15,500   |A      |\";\n        String lineB = \"| @08@  |30.08.2025  |08:00:00|31.08.2025  |    123     |6000123456|M001    |9001      |10,000    |15,500   |A      |\";\n        String content = header + \"\\n\" + lineA + \"\\n\" + lineB + \"\\n\";\n        InputStream is = new ByteArrayInputStream(content.getBytes(StandardCharsets.ISO_8859_1));\n\n        List<FactProduction> records = parserService.parse(is);\n\n        assertThat(records)\n                .as(\"Las dos lineas representan el mismo Numero Log l√≥gico tras normalizaci√≥n\")\n                .hasSize(1);\n        assertThat(records.getFirst().getNumeroLog()).isEqualTo(123L);\n    }\n}\n\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/PermissionServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.request.PermissionRequest;\nimport com.cambiaso.ioc.exception.ResourceConflictException;\nimport com.cambiaso.ioc.exception.ResourceNotFoundException;\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport com.cambiaso.ioc.persistence.repository.PermissionRepository;\nimport com.cambiaso.ioc.persistence.repository.RolePermissionRepository;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.PageRequest;\n\nimport java.util.List;\nimport java.util.Optional;\n\nimport static org.junit.jupiter.api.Assertions.*;\nimport static org.mockito.Mockito.*;\n\n@ExtendWith(MockitoExtension.class)\nclass PermissionServiceTest {\n\n    @Mock\n    private PermissionRepository permissionRepository;\n    @Mock\n    private RolePermissionRepository rolePermissionRepository;\n\n    @InjectMocks\n    private PermissionService permissionService;\n\n    private Permission existing;\n\n    @BeforeEach\n    void setup() {\n        existing = new Permission();\n        existing.setId(1);\n        existing.setName(\"READ_DATA\");\n        existing.setDescription(\"Read permission\");\n    }\n\n    @Test\n    void create_success_whenNameUnique() {\n        PermissionRequest req = new PermissionRequest();\n        req.setName(\"  NEW_PERM  \");\n        req.setDescription(\"desc\");\n\n        when(permissionRepository.existsByNameIgnoreCase(\"NEW_PERM\")).thenReturn(false);\n        when(permissionRepository.save(any(Permission.class))).thenAnswer(inv -> {\n            Permission p = inv.getArgument(0);\n            p.setId(10);\n            return p;\n        });\n\n        Permission created = permissionService.create(req);\n        assertEquals(10, created.getId());\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/NotificationServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.NotificationPayload;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Nested;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport org.springframework.messaging.simp.SimpMessagingTemplate;\n\nimport java.util.UUID;\n\nimport static org.assertj.core.api.Assertions.assertThat;\nimport static org.assertj.core.api.Assertions.assertThatThrownBy;\nimport static org.mockito.Mockito.*;\n\n@ExtendWith(MockitoExtension.class)\n@DisplayName(\"NotificationService Tests\")\nclass NotificationServiceTest {\n\n    @Mock\n    private SimpMessagingTemplate messagingTemplate;\n\n    @InjectMocks\n    private NotificationService notificationService;\n\n    @BeforeEach\n    void setUp() {\n        // Reset the active users set for each test\n        notificationService.removeActiveUser(\"test-user\");\n        notificationService.removeActiveUser(\"user1\");\n        notificationService.removeActiveUser(\"user2\");\n    }\n\n    @Nested\n    @DisplayName(\"User Notifications\")\n    class UserNotificationTests {\n\n        @Test\n        @DisplayName(\"Should send notification to specific user with correct destination\")\n        void whenNotifyUser_thenSendsMessageToCorrectDestination() {\n            // Arrange\n            String userId = \"test-user\";\n            UUID jobId = UUID.randomUUID();\n            NotificationPayload payload = new NotificationPayload(\"PROCESANDO\", \"El archivo se est√° procesando.\");\n            String expectedDestination = String.format(\"/topic/etl-jobs/%s\", jobId);\n\n            // Act\n            notificationService.notifyUser(userId, jobId, payload);\n\n            // Assert\n            verify(messagingTemplate).convertAndSendToUser(eq(userId), eq(expectedDestination), eq(payload));\n            assertThat(notificationService.getActive"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/DataSyncConcurrencyTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.DimMaquina;\nimport com.cambiaso.ioc.persistence.entity.DimMaquinista;\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinaRepository;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinistaRepository;\nimport com.cambiaso.ioc.persistence.repository.FactProductionRepository;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport org.junit.jupiter.api.*;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.test.annotation.DirtiesContext;\nimport org.springframework.test.context.ActiveProfiles;\nimport org.springframework.test.context.DynamicPropertyRegistry;\nimport org.springframework.test.context.DynamicPropertySource;\nimport org.testcontainers.junit.jupiter.Container;\nimport org.testcontainers.junit.jupiter.Testcontainers;\nimport org.testcontainers.containers.PostgreSQLContainer;\n\nimport jakarta.persistence.EntityManager;\nimport jakarta.persistence.PersistenceContext;\nimport java.math.BigDecimal;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\nimport java.util.*;\nimport java.util.concurrent.CountDownLatch;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.Future;\nimport java.util.concurrent.TimeUnit;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\n/**\n * Integration tests (PostgreSQL via Testcontainers) for verifying:\n * 1. Advisory lock serializes overlapping date range syncs.\n * 2. Retry logic on UNIQUE constraint collisions (with lock disabled) succeeds.\n */\n@Testcontainers\n@SpringBootTest\n@ActiveProfiles(\"pgtest\")\n@TestInstance(TestInstance.Lifecycle.PER_METHOD)\nclass DataSyncConcurrencyTest {\n\n    @Container\n    static final PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>(\"post"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/AdvisoryLockSerializationTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\n\nimport com.cambiaso.ioc.persistence.entity.DimMaquina;\nimport com.cambiaso.ioc.persistence.entity.DimMaquinista;\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinaRepository;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinistaRepository;\nimport com.cambiaso.ioc.persistence.repository.FactProductionRepository;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.test.context.ActiveProfiles;\nimport org.springframework.test.context.DynamicPropertyRegistry;\nimport org.springframework.test.context.DynamicPropertySource;\nimport org.testcontainers.containers.PostgreSQLContainer;\nimport org.testcontainers.junit.jupiter.Container;\nimport org.testcontainers.junit.jupiter.Testcontainers;\n\nimport java.math.BigDecimal;\nimport java.time.Duration;\nimport java.time.Instant;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.concurrent.CountDownLatch;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.Future;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\n/**\n * Deterministic advisory lock serialization test using artificial delay (etl.lock.test.sleep-ms).\n * Validates that the second concurrent sync blocks until the first releases the advisory lock.\n */\n@Testcontainers\n@SpringBootTest\n@ActiveProfiles(\"pgtest\")\nclass AdvisoryLockSerializationTest {\n\n    @Container\n    static final PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>(\"postgres:16-alpine\")\n            .withDatabaseName(\"testdb\")\n            .withUsername(\"test\")\n            .withPassword(\"test\")\n      "
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/MetabaseEmbeddingServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.config.MetabaseProperties;\nimport com.cambiaso.ioc.exception.DashboardAccessDeniedException;\nimport com.cambiaso.ioc.exception.DashboardNotFoundException;\nimport io.micrometer.core.instrument.simple.SimpleMeterRegistry;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport org.springframework.security.core.Authentication;\n\nimport java.util.List;\nimport java.util.Set;\n\nimport static org.assertj.core.api.Assertions.*;\nimport static org.mockito.Mockito.*;\n\n@ExtendWith(MockitoExtension.class)\n@DisplayName(\"MetabaseEmbeddingService Unit Tests\")\nclass MetabaseEmbeddingServiceTest {\n\n    @Mock\n    private DashboardAuditService auditService;\n\n    @Mock\n    private Authentication authentication;\n\n    private MetabaseEmbeddingService service;\n    private MetabaseProperties properties;\n\n    @BeforeEach\n    void setUp() {\n        properties = new MetabaseProperties();\n        properties.setSiteUrl(\"http://localhost:3000\");\n        // Usar una clave hexadecimal v√°lida de 64 caracteres\n        properties.setSecretKey(\"1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef\");\n        properties.setTokenExpirationMinutes(10);\n        \n        MetabaseProperties.DashboardConfig dashboard = new MetabaseProperties.DashboardConfig();\n        dashboard.setId(5);\n        dashboard.setName(\"Test Dashboard\");\n        // Aunque la l√≥gica de roles est√° desactivada, la configuraci√≥n debe estar presente\n        dashboard.setAllowedRoles(Set.of(\"ROLE_ADMIN\", \"ROLE_USER\"));\n        \n        properties.setDashboards(List.of(dashboard));\n        \n        service = new MetabaseEmbeddingService(\n            properties, \n            auditService, \n            new SimpleMeterRegistry()\n        );\n    }\n\n    @Test\n    @DisplayName(\"Should g"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/EtlProcessingIntegrationTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.EtlJob;\nimport com.cambiaso.ioc.persistence.repository.EtlJobRepository;\nimport com.cambiaso.ioc.persistence.repository.FactProductionRepository;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.mock.web.MockMultipartFile;\nimport org.springframework.test.context.ActiveProfiles;\nimport org.springframework.test.context.DynamicPropertyRegistry;\nimport org.springframework.test.context.DynamicPropertySource;\nimport org.testcontainers.junit.jupiter.Container;\nimport org.testcontainers.junit.jupiter.Testcontainers;\nimport org.testcontainers.containers.PostgreSQLContainer;\n\nimport java.nio.charset.Charset;\nimport java.time.Duration;\nimport java.time.LocalDate;\nimport java.util.Optional;\nimport java.util.UUID;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\n/**\n * Punto 4 del checklist (validaciones post-cambio) a nivel end-to-end ETL:\n *  - 4.1 Idempotencia: dos jobs secuenciales con el mismo archivo no generan duplicados y mantienen el mismo conteo.\n *  - 4.2 Conflicto de ventana: dos jobs concurrentes sobre mismo rango -> segundo falla con conflicto.\n *  - 4.3 Deduplicaci√≥n intra-archivo: archivo con duplicados l√≥gicos produce inserci√≥n √∫nica de cada clave.\n */\n@Testcontainers\n@SpringBootTest\n@ActiveProfiles(\"pgtest\")\nclass EtlProcessingIntegrationTest {\n\n    @Container\n    static final PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>(\"postgres:16-alpine\")\n            .withDatabaseName(\"testdb\")\n            .withUsername(\"test\")\n            .withPassword(\"test\");\n\n    @DynamicPropertySource\n    static void registerProps(DynamicPropertyRegistry registry) {\n        registry.add(\"spring.datasource.url\", postgr"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/ParserServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport org.junit.jupiter.api.Disabled;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.core.io.ClassPathResource;\nimport org.springframework.test.context.ActiveProfiles;\n\nimport java.io.ByteArrayInputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.math.BigDecimal;\nimport java.nio.charset.StandardCharsets;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\nimport java.util.List;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\n@SpringBootTest\n@ActiveProfiles(\"test\")\nclass ParserServiceTest {\n\n    @Autowired\n    private ParserService parserService;\n\n    @Test\n    void whenParseValidFile_thenReturnsCorrectRecords() throws IOException {\n        // Arrange\n        //InputStream inputStream = new ClassPathResource(\"sample-data.txt\").getInputStream();\n        InputStream inputStream = new ClassPathResource(\"real-acortado.txt\").getInputStream();\n        // Act\n        List<FactProduction> records = parserService.parse(inputStream);\n\n        // Assert\n        assertThat(records).hasSize(8);\n\n        // --- Imprimir los registros en la consola ---\n        System.out.println(\"--- Registros Parseados ---\");\n        records.forEach(System.out::println);\n        System.out.println(\"---------------------------\");\n\n        // Verify first record in detail\n        FactProduction firstRecord = records.getFirst();\n        assertThat(firstRecord.getFechaContabilizacion()).isEqualTo(LocalDate.of(2025, 8, 30));\n        assertThat(firstRecord.getHoraContabilizacion()).isEqualTo(LocalTime.of(8, 29, 15));\n        assertThat(firstRecord.getNumeroLog()).isEqualTo(2922290L);\n        assertThat(firstRecord.getMaterialSku()).isEqualTo(6760161400L);\n        assertThat(firstRecord.getCantidad()).isEqualByComparingTo(new BigDec"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/AssignmentServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.exception.ResourceNotFoundException;\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport com.cambiaso.ioc.persistence.entity.Role;\nimport com.cambiaso.ioc.persistence.entity.RolePermission;\nimport com.cambiaso.ioc.persistence.entity.RolePermissionKey;\nimport com.cambiaso.ioc.persistence.entity.UserRole;\nimport com.cambiaso.ioc.persistence.entity.UserRoleKey;\nimport com.cambiaso.ioc.persistence.repository.AppUserRepository;\nimport com.cambiaso.ioc.persistence.repository.PermissionRepository;\nimport com.cambiaso.ioc.persistence.repository.RolePermissionRepository;\nimport com.cambiaso.ioc.persistence.repository.RoleRepository;\nimport com.cambiaso.ioc.persistence.repository.UserRoleRepository;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\n\nimport java.util.Optional;\n\nimport static org.junit.jupiter.api.Assertions.assertThrows;\nimport static org.mockito.ArgumentMatchers.any;\nimport static org.mockito.Mockito.*;\n\n@ExtendWith(MockitoExtension.class)\nclass AssignmentServiceTest {\n\n    @Mock\n    private AppUserRepository appUserRepository;\n    @Mock\n    private RoleRepository roleRepository;\n    @Mock\n    private PermissionRepository permissionRepository;\n    @Mock\n    private UserRoleRepository userRoleRepository;\n    @Mock\n    private RolePermissionRepository rolePermissionRepository;\n\n    @InjectMocks\n    private AssignmentService assignmentService;\n\n    @BeforeEach\n    void setup() {\n    }\n\n    @Test\n    void assignRoleToUser_creates_when_not_exists() {\n        when(appUserRepository.findById(1L)).thenReturn(Optional.ofNullable(new com.cambiaso.ioc.persistence.entity.AppUser()));\n        Role role = new Role(); role.setId(2); role.setName(\"R\");\n        when(roleRepository.findById(2)).thenReturn(Optional.of(role));\n  "
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/UserAdminServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.request.UsuarioCreateRequest;\nimport com.cambiaso.ioc.dto.request.UsuarioUpdateRequest;\nimport com.cambiaso.ioc.dto.response.UsuarioResponse;\nimport com.cambiaso.ioc.exception.ResourceConflictException;\nimport com.cambiaso.ioc.exception.ResourceNotFoundException;\nimport com.cambiaso.ioc.mapper.UsuarioMapper;\nimport com.cambiaso.ioc.persistence.entity.AppUser;\nimport com.cambiaso.ioc.persistence.entity.Planta;\nimport com.cambiaso.ioc.persistence.repository.AppUserRepository;\nimport com.cambiaso.ioc.persistence.repository.AppUserSearchRepository;\nimport com.cambiaso.ioc.persistence.repository.PlantaRepository;\nimport com.cambiaso.ioc.persistence.repository.UserRoleRepository;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.ArgumentCaptor;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.PageRequest;\n\nimport java.util.List;\nimport java.util.Optional;\nimport java.util.UUID;\n\nimport static org.junit.jupiter.api.Assertions.*;\nimport static org.mockito.Mockito.*;\n\n@ExtendWith(MockitoExtension.class)\nclass UserAdminServiceTest {\n\n    @Mock\n    private AppUserRepository appUserRepository;\n    @Mock\n    private AppUserSearchRepository appUserSearchRepository;\n    @Mock\n    private PlantaRepository plantaRepository;\n    @Mock\n    private UserRoleRepository userRoleRepository;\n    @Mock\n    private UsuarioMapper usuarioMapper;\n    @Mock\n    private SupabaseAuthService supabaseAuthService;  // ‚Üê ADDED: Mock del nuevo servicio\n\n    @InjectMocks\n    private UserAdminService userAdminService;\n\n    @BeforeEach\n    void setup() {\n    }\n\n    @Test\n    void create_success_withPassword() {\n        // ‚úÖ NUEVO FLUJO: Con password (crea usuario en Supabase autom√°ticamente)\n        Usuari"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/DataSyncConcurrencyIT.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.DimMaquina;\nimport com.cambiaso.ioc.persistence.entity.DimMaquinista;\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinaRepository;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinistaRepository;\nimport com.cambiaso.ioc.persistence.repository.FactProductionRepository;\nimport org.junit.jupiter.api.*;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.test.context.ActiveProfiles;\nimport org.springframework.test.context.DynamicPropertyRegistry;\nimport org.springframework.test.context.DynamicPropertySource;\nimport org.testcontainers.junit.jupiter.Container;\nimport org.testcontainers.junit.jupiter.Testcontainers;\nimport org.testcontainers.containers.PostgreSQLContainer;\n\nimport java.math.BigDecimal;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\nimport java.util.*;\nimport java.util.concurrent.CountDownLatch;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.Future;\nimport java.util.concurrent.TimeUnit;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\n/**\n * Integration tests (PostgreSQL via Testcontainers) for verifying:\n * 1. Advisory lock serializes overlapping date range syncs.\n * 2. Retry logic on UNIQUE constraint collisions (with lock disabled) succeeds.\n */\n@Testcontainers\n@SpringBootTest\n@ActiveProfiles(\"pgtest\")\nclass DataSyncConcurrencyIT {\n\n    @Container\n    static final PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>(\"postgres:16-alpine\")\n            .withDatabaseName(\"testdb\")\n            .withUsername(\"test\")\n            .withPassword(\"test\");\n\n    @DynamicPropertySource\n    static void registerProps(DynamicPropertyRegistry registry) {\n        registry.add(\"spring.da"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/EtlProcessingServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.NotificationPayload;\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Nested;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport org.springframework.mock.web.MockMultipartFile;\n\nimport java.io.InputStream;\nimport java.math.BigDecimal;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\nimport java.util.List;\nimport java.util.UUID;\nimport java.io.IOException;\n\nimport static org.assertj.core.api.Assertions.assertThat;\nimport static org.mockito.ArgumentMatchers.*;\nimport static org.mockito.Mockito.*;\n\n@ExtendWith(MockitoExtension.class)\n@DisplayName(\"EtlProcessingService Unit Tests\")\nclass EtlProcessingServiceTest {\n\n    @Mock\n    private EtlJobService etlJobService;\n\n    @Mock\n    private NotificationService notificationService;\n\n    @Mock\n    private DataSyncService dataSyncService;\n\n    @Mock\n    private ParserService parserService;\n\n    @InjectMocks\n    private EtlProcessingService etlProcessingService;\n\n    private UUID testJobId;\n    private String testUserId;\n    private MockMultipartFile testFile;\n    private List<FactProduction> mockRecords;\n\n    @BeforeEach\n    void setUp() {\n        testJobId = UUID.randomUUID();\n        testUserId = \"test-user\";\n        testFile = new MockMultipartFile(\"test.txt\", \"test.txt\", \"text/plain\",\n                \"| @08@  |30.08.2025  |08:29:15|01.09.2025  |2922290|6760161400|48,000|105,6|\".getBytes());\n\n        // Create mock FactProduction records for tests\n        FactProduction mockRecord = new FactProduction();\n        mockRecord.setFechaContabilizacion(LocalDate.of(2025, 8, 30));\n        mockRecord.setNumeroLog(2922290L);\n        mockRecord.setHoraContabilizacion(LocalTime.of(8, 29, 15));\n    "
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/EtlJobWatchdogTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.DimMaquina;\nimport com.cambiaso.ioc.persistence.entity.EtlJob;\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinaRepository;\nimport com.cambiaso.ioc.persistence.repository.EtlJobRepository;\nimport com.cambiaso.ioc.persistence.repository.FactProductionRepository;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport io.micrometer.core.instrument.simple.SimpleMeterRegistry;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Disabled;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.test.context.TestPropertySource;\nimport org.springframework.transaction.PlatformTransactionManager;\nimport org.springframework.transaction.annotation.Transactional;\nimport org.springframework.transaction.support.TransactionTemplate;\n\nimport jakarta.persistence.EntityManager;\nimport java.math.BigDecimal;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\nimport java.time.OffsetDateTime;\nimport java.util.List;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\n@DataJpaTest\n@TestPropertySource(properties = {\n        \"etl.jobs.watchdog.enabled=true\",\n        \"etl.jobs.watchdog.interval-ms=999999\",\n        \"etl.jobs.stuck.threshold-minutes=1\", // Cambio de 0 a 1 para detectar job backdateado a -5 min\n        \"etl.retry.unique.enabled=false\",\n        \"spring.jpa.hibernate.ddl-auto=create-drop\"\n})\n@Import({EtlJobService.class, DataSyncService.class, EtlJobWatchdog.class, EtlJobWatchdogTest.TestConfig.class})\nclass EtlJobWatchdogTest {\n\n    static class TestConfig {\n        @Bean"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/DataSyncServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.DimMaquina;\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinaRepository;\nimport com.cambiaso.ioc.persistence.repository.FactProductionRepository;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.ActiveProfiles;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.math.BigDecimal;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\nimport java.util.List;\n\nimport static org.assertj.core.api.Assertions.assertThat;\nimport static org.assertj.core.api.Assertions.assertThatThrownBy;\n\n@SpringBootTest\n@ActiveProfiles(\"test\")\n@Transactional\n@DisplayName(\"DataSyncService Tests\")\nclass DataSyncServiceTest {\n\n    @Autowired\n    private DataSyncService dataSyncService;\n\n    @Autowired\n    private FactProductionRepository factProductionRepository;\n\n    @Autowired\n    private DimMaquinaRepository dimMaquinaRepository;\n\n    private DimMaquina maquina;\n\n    @BeforeEach\n    void setUp() {\n        // The @Transactional on the class will handle rollback for each test\n        factProductionRepository.deleteAll();\n        dimMaquinaRepository.deleteAll();\n\n        maquina = new DimMaquina();\n        maquina.setCodigoMaquina(\"M-TEST\");\n        maquina.setNombreMaquina(\"Maquina de Test\");\n        maquina = dimMaquinaRepository.saveAndFlush(maquina);\n    }\n\n    private FactProduction createFactProduction(LocalDate date) {\n        // Create FactProduction with simple ID auto-generation\n        FactProduction fact = new FactProduction();\n        fact.setFechaContabilizacion(date);\n        fact.setMaquina(maquina);\n        fact.setNumeroLog(1L);\n        fact.setHoraContabilizacion(LocalTime.NOON"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/EtlJobServiceTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.EtlJob;\nimport com.cambiaso.ioc.persistence.repository.EtlJobRepository;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Nested;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.test.context.ActiveProfiles;\n\nimport java.time.LocalDate;\nimport java.time.OffsetDateTime;\nimport java.util.Optional;\nimport java.util.UUID;\n\nimport static org.assertj.core.api.Assertions.assertThat;\nimport static org.assertj.core.api.Assertions.assertThatThrownBy;\n\n@DataJpaTest\n@Import(EtlJobService.class)\n@ActiveProfiles(\"test\")\n@DisplayName(\"EtlJobService Tests\")\nclass EtlJobServiceTest {\n\n    @Autowired\n    private EtlJobService etlJobService;\n\n    @Autowired\n    private EtlJobRepository etlJobRepository;\n\n    @BeforeEach\n    void setUp() {\n        etlJobRepository.deleteAll();\n    }\n\n    @Nested\n    @DisplayName(\"Job Creation\")\n    class JobCreationTests {\n\n        @Test\n        @DisplayName(\"Should create job with initial status\")\n        void createJob_shouldCreateJobWithInitialStatus() {\n            EtlJob job = etlJobService.createJob(\"test.txt\", \"hash123\", \"user1\");\n\n            assertThat(job).isNotNull();\n            assertThat(job.getJobId()).isNotNull();\n            assertThat(job.getStatus()).isEqualTo(\"INICIADO\");\n            assertThat(job.getFileName()).isEqualTo(\"test.txt\");\n            assertThat(job.getFileHash()).isEqualTo(\"hash123\");\n            assertThat(job.getUserId()).isEqualTo(\"user1\");\n            assertThat(job.getCreatedAt()).isNotNull();\n            assertThat(etlJobRepository.findById(job.getJobId())).isPresent();\n        }\n\n        @Test\n        @DisplayName(\"Should find job by file hash\")\n        void findByFileHash_sh"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/service/ParserServiceDedupTest.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.ActiveProfiles;\n\nimport java.io.ByteArrayInputStream;\nimport java.io.InputStream;\nimport java.nio.charset.StandardCharsets;\nimport java.util.List;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\n/**\n * Verifica que el parser elimine duplicados l√≥gicos (misma clave natural) usando la deduplicaci√≥n temprana.\n */\n@SpringBootTest\n@ActiveProfiles(\"test\")\nclass ParserServiceDedupTest {\n\n    @Autowired\n    private ParserService parserService;\n\n    @Test\n    void givenTwoIdenticalLines_whenParse_thenOnlyOneRecordRemains() throws Exception {\n        // Header minimal que el parser reconoce (contiene las columnas clave)\n        String header = \"| Status|Fecha Cont. |Hora    |Fecha Notif |Numero Log.|Material |Maquina |Maquinista|Cantidad |Peso Neto|Turno  |\";\n        // Dos l√≠neas id√©nticas (misma fecha, maquina, maquinista, numero log) deben producir un √∫nico registro\n        String line = \"| @08@  |30.08.2025  |08:00:00|31.08.2025  |    1234567|6000123456|M001    |9001      |10,000    |15,500   |A      |\";\n        String duplicated = header + \"\\n\" + line + \"\\n\" + line + \"\\n\"; // duplicado\n        InputStream is = new ByteArrayInputStream(duplicated.getBytes(StandardCharsets.ISO_8859_1));\n\n        List<FactProduction> records = parserService.parse(is);\n\n        assertThat(records)\n                .as(\"Debe existir solo un registro tras deduplicaci√≥n\")\n                .hasSize(1);\n\n        FactProduction fp = records.getFirst();\n        assertThat(fp.getNumeroLog()).isEqualTo(1234567L);\n        assertThat(fp.getMaquina()).isNotNull();\n    }\n}\n\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/controller/PermissionControllerTest.java",
      "excerpt": "package com.cambiaso.ioc.controller;\n\nimport com.cambiaso.ioc.controller.admin.PermissionController;\nimport com.cambiaso.ioc.dto.response.PermissionResponse;\nimport com.cambiaso.ioc.mapper.PermissionMapper;\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport com.cambiaso.ioc.service.PermissionService;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.Mockito;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.data.web.PageableHandlerMethodArgumentResolver;\nimport org.springframework.test.web.servlet.MockMvc;\nimport org.springframework.test.web.servlet.setup.MockMvcBuilders;\n\nimport java.util.List;\n\nimport static org.mockito.ArgumentMatchers.*;\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n\n@ExtendWith(MockitoExtension.class)\nclass PermissionControllerTest {\n\n    private MockMvc mockMvc;\n\n    @Mock\n    private PermissionService permissionService;\n\n    @Mock\n    private PermissionMapper permissionMapper;\n\n    @InjectMocks\n    private PermissionController permissionController;\n\n    @BeforeEach\n    void setUp() {\n        mockMvc = MockMvcBuilders.standaloneSetup(permissionController)\n                .setCustomArgumentResolvers(new PageableHandlerMethodArgumentResolver())\n                .build();\n    }\n\n    @Test\n    void search_ok_returns200() throws Exception {\n        Permission p = new Permission();\n        p.setId(1);\n        p.setName(\"READ\");\n        Page<Permission> page = new PageImpl<>(List.of(p));\n        Mockito.when(permissionService.search(eq(\"read\"), any(PageRequest.class))).thenReturn(page);\n      "
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/controller/AssignmentControllerTest.java",
      "excerpt": "package com.cambiaso.ioc.controller;\n\nimport com.cambiaso.ioc.controller.admin.AssignmentController;\nimport com.cambiaso.ioc.service.AssignmentService;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport org.springframework.test.web.servlet.MockMvc;\nimport org.springframework.test.web.servlet.setup.MockMvcBuilders;\n\nimport static org.mockito.Mockito.doNothing;\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.delete;\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n\n@ExtendWith(MockitoExtension.class)\nclass AssignmentControllerTest {\n\n    private MockMvc mockMvc;\n\n    @Mock\n    private AssignmentService assignmentService;\n\n    @BeforeEach\n    void setup() {\n        AssignmentController controller = new AssignmentController(assignmentService);\n        this.mockMvc = MockMvcBuilders.standaloneSetup(controller).build();\n    }\n\n    @Test\n    void assignRoleToUser_returns200() throws Exception {\n        doNothing().when(assignmentService).assignRoleToUser(1L, 2, null);\n        mockMvc.perform(post(\"/api/admin/assignments/users/1/roles/2\"))\n                .andExpect(status().isOk());\n    }\n\n    @Test\n    void removeRoleFromUser_returns204() throws Exception {\n        doNothing().when(assignmentService).removeRoleFromUser(1L, 2);\n        mockMvc.perform(delete(\"/api/admin/assignments/users/1/roles/2\"))\n                .andExpect(status().isNoContent());\n    }\n\n    @Test\n    void assignPermissionToRole_returns200() throws Exception {\n        doNothing().when(assignmentService).assignPermissionToRole(3, 5);\n        mockMvc.perform(post(\"/api/admin/assignments/roles/3/permissions/5\"))\n                .andExpect(status().isOk());\n    }\n\n    @Test\n    void removePer"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/controller/RoleControllerTest.java",
      "excerpt": "package com.cambiaso.ioc.controller;\n\nimport com.cambiaso.ioc.controller.admin.RoleController;\nimport com.cambiaso.ioc.dto.response.RoleResponse;\nimport com.cambiaso.ioc.mapper.RoleMapper;\nimport com.cambiaso.ioc.service.RoleService;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.Mockito;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.data.web.PageableHandlerMethodArgumentResolver;\nimport org.springframework.test.web.servlet.MockMvc;\nimport org.springframework.test.web.servlet.setup.MockMvcBuilders;\n\nimport java.util.List;\n\nimport static org.mockito.ArgumentMatchers.*;\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;\nimport static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n\n@ExtendWith(MockitoExtension.class)\nclass RoleControllerTest {\n\n    private MockMvc mockMvc;\n\n    @Mock\n    private RoleService roleService;\n\n    @Mock\n    private RoleMapper roleMapper;\n\n    @InjectMocks\n    private RoleController roleController;\n\n    @BeforeEach\n    void setUp() {\n        mockMvc = MockMvcBuilders.standaloneSetup(roleController)\n                .setCustomArgumentResolvers(new PageableHandlerMethodArgumentResolver())\n                .build();\n    }\n\n    @Test\n    void search_ok_returns200WithEnrichedData() throws Exception {\n        RoleResponse resp = new RoleResponse();\n        resp.setId(1);\n        resp.setName(\"ADMIN\");\n        resp.setUsersCount(10);\n        resp.setPermissions(new java.util.ArrayList<>(List.of(\"READ\", \"WRITE\")));\n\n        Page<RoleResponse> page = new PageImpl<>(List.of(resp), Pag"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/controller/AdminUserControllerTest.java",
      "excerpt": "package com.cambiaso.ioc.controller;\n\nimport com.cambiaso.ioc.AbstractIntegrationTest;\nimport com.cambiaso.ioc.dto.request.UsuarioCreateRequest;\nimport com.cambiaso.ioc.dto.request.UsuarioUpdateRequest;\nimport com.cambiaso.ioc.dto.response.UsuarioResponse;\nimport com.cambiaso.ioc.service.SupabaseAuthService;\nimport com.cambiaso.ioc.service.UserAdminService;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\nimport org.springframework.boot.test.mock.mockito.MockBean;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.security.test.context.support.WithMockUser;\nimport org.springframework.test.web.servlet.MockMvc;\n\nimport java.util.List;\nimport java.util.UUID;\n\nimport static org.mockito.ArgumentMatchers.any;\nimport static org.mockito.ArgumentMatchers.eq;\nimport static org.mockito.Mockito.doNothing;\nimport static org.mockito.Mockito.when;\nimport static org.springframework.http.MediaType.APPLICATION_JSON;\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n\n@AutoConfigureMockMvc\nclass AdminUserControllerTest extends AbstractIntegrationTest {\n\n    @Autowired\n    private MockMvc mockMvc;\n\n    @Autowired\n    private ObjectMapper objectMapper;\n\n    @MockBean\n    private UserAdminService userAdminService;\n\n    @MockBean\n    private SupabaseAuthService supabaseAuthService;\n\n    @Test\n    @WithMockUser(roles = \"ADMIN\")\n    void search_returns200() throws Exception {\n        UsuarioResponse u = new UsuarioResponse();\n        u.setId(1);\n        when(userAdminService.search(any(), any(), any(), any()))\n            .thenReturn(new PageImpl<>(List.of(u), PageRequest.of(0, 20), 1));\n\n        mockMvc.perform("
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/controller/EtlControllerTest.java",
      "excerpt": "package com.cambiaso.ioc.controller;\n\nimport com.cambiaso.ioc.service.EtlJobService;\nimport com.cambiaso.ioc.service.EtlProcessingService;\nimport com.fasterxml.jackson.databind.ObjectMapper;\n\n\n\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/controller/EtlControllerIntegrationTest.java",
      "excerpt": "\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/controller/DashboardControllerIntegrationTest.java",
      "excerpt": "package com.cambiaso.ioc.controller;\n\nimport com.cambiaso.ioc.AbstractIntegrationTest;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\nimport org.springframework.security.test.context.support.WithMockUser;\nimport org.springframework.test.web.servlet.MockMvc;\n\nimport static org.hamcrest.Matchers.containsString;\nimport static org.hamcrest.Matchers.startsWith;\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n\n/**\n * Tests de integraci√≥n para DashboardController.\n * Prueba el controller con el servicio real de Metabase.\n */\n@AutoConfigureMockMvc\n@DisplayName(\"DashboardController Integration Tests\")\nclass DashboardControllerIntegrationTest extends AbstractIntegrationTest {\n\n    @Autowired\n    private MockMvc mockMvc;\n\n    @Test\n    @WithMockUser\n    @DisplayName(\"GET /api/v1/dashboards/{id} - 200 OK con URL firmada\")\n    void shouldReturn200WithSignedUrlForAuthenticatedUser() throws Exception {\n        // Dashboard ID 1 est√° configurado en application-test.properties\n        mockMvc.perform(get(\"/api/v1/dashboards/1\"))\n            .andExpect(status().isOk())\n            .andExpect(jsonPath(\"$.signedUrl\").exists())\n            .andExpect(jsonPath(\"$.signedUrl\", startsWith(\"http://localhost:3000/embed/dashboard/\")))\n            .andExpect(jsonPath(\"$.signedUrl\", containsString(\"bordered=true\")))\n            .andExpect(jsonPath(\"$.dashboardId\").value(1))\n            .andExpect(jsonPath(\"$.expiresInMinutes\").value(10));\n    }\n\n    @Test\n    @DisplayName(\"GET /api/v1/dashboards/{id} - 401 Unauthorized sin autenticaci√≥n\")\n    void shouldReturn401ForUnauthenticatedUser() throws Exception {\n  "
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/config/GlobalTestConfiguration.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport com.cambiaso.ioc.service.NotificationService;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport io.micrometer.core.instrument.simple.SimpleMeterRegistry;\nimport org.springframework.boot.test.context.TestConfiguration;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Primary;\nimport org.springframework.messaging.simp.SimpMessagingTemplate;\nimport org.springframework.security.oauth2.jwt.JwtDecoder;\n\nimport static org.mockito.Mockito.mock;\n\n/**\n * Configuraci√≥n global de mocks para todos los tests.\n * \n * Provee:\n * - Mock de SimpMessagingTemplate (WebSocket)\n * - Mock de NotificationService\n * - MeterRegistry funcional para m√©tricas en tests\n * - Mock JwtDecoder para evitar llamadas a JWKS en tests\n */\n@TestConfiguration\npublic class GlobalTestConfiguration {\n\n    @Bean\n    @Primary\n    public SimpMessagingTemplate simpMessagingTemplate() {\n        return mock(SimpMessagingTemplate.class);\n    }\n\n    @Bean\n    @Primary\n    public NotificationService notificationService() {\n        return mock(NotificationService.class);\n    }\n\n    /**\n     * MeterRegistry para tests.\n     * Usa SimpleMeterRegistry para que las m√©tricas funcionen sin necesitar backend.\n     */\n    @Bean\n    @Primary\n    public MeterRegistry meterRegistry() {\n        return new SimpleMeterRegistry();\n    }\n\n}\n\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/config/TestSecurityConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport org.springframework.boot.test.context.TestConfiguration;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Primary;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@TestConfiguration\n@EnableWebSecurity\npublic class TestSecurityConfig {\n\n    @Bean\n    @Primary\n    public SecurityFilterChain testSecurityFilterChain(HttpSecurity http) throws Exception {\n        http\n            .csrf(csrf -> csrf.disable())\n            .authorizeHttpRequests(auth -> auth\n                .anyRequest().permitAll()\n            );\n        return http.build();\n    }\n}\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/config/WebSocketIntegrationTest.java",
      "excerpt": "\n"
    },
    {
      "path": "src/test/java/com/cambiaso/ioc/integration/RoleManagementIntegrationTest.java",
      "excerpt": "package com.cambiaso.ioc.integration;\nimport com.cambiaso.ioc.AbstractIntegrationTest;\nimport com.cambiaso.ioc.dto.request.PermissionRequest;\nimport com.cambiaso.ioc.dto.request.RoleRequest;\nimport com.cambiaso.ioc.dto.request.UsuarioCreateRequest;\nimport com.cambiaso.ioc.dto.response.UsuarioResponse;\nimport com.cambiaso.ioc.exception.ResourceConflictException;\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport com.cambiaso.ioc.persistence.entity.Role;\nimport com.cambiaso.ioc.service.AssignmentService;\nimport com.cambiaso.ioc.service.PermissionService;\nimport com.cambiaso.ioc.service.RoleService;\nimport com.cambiaso.ioc.service.UserAdminService;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\n\nimport java.util.UUID;\nimport static org.assertj.core.api.Assertions.assertThat;\nimport static org.assertj.core.api.Assertions.assertThatThrownBy;\n\n/**\n * Integration test for role management using H2 in-memory database.\n * Spring JPA creates schema automatically from entities.\n */\n\nclass RoleManagementIntegrationTest extends AbstractIntegrationTest {\n\n    @Autowired\n    private RoleService roleService;\n\n    @Autowired\n    private PermissionService permissionService;\n\n    @Autowired\n    private UserAdminService userAdminService;\n\n    @Autowired\n    private AssignmentService assignmentService;\n\n    // Mock external services not needed for this test\n\n\n    @Test\n    void shouldCreateRoleAndPermission() {\n        RoleRequest roleRequest = new RoleRequest();\n        roleRequest.setName(\"INTEGRATION_ROLE\");\n        roleRequest.setDescription(\"Role created in integration test\");\n        PermissionRequest permRequest = new PermissionRequest();\n        permRequest.setName(\"READ_DATA\");\n        permRequest.setDescription(\"Permission to read data\");\n        Role role = roleService.create(roleRequest);\n        Permission permission = permissionService.create(permRequest);\n        assertThat(role).isNotNull();\n        assertThat("
    },
    {
      "path": "src/main/resources/application-prod.properties",
      "excerpt": "# ===================================================================\n# PRODUCCI√ìN - RENDER DEPLOYMENT\n# ===================================================================\n\n# Database Connection\nspring.datasource.url=jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require\nspring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# HikariCP Pool - Production Optimized\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout=240000\nspring.datasource.hikari.max-lifetime=300000\nspring.datasource.hikari.keepalive-time=120000\nspring.datasource.hikari.validation-timeout=3000\nspring.datasource.hikari.connection-test-query=SELECT 1\nspring.datasource.hikari.leak-detection-threshold=60000\nspring.datasource.hikari.pool-name=SupabaseHikariPool-Prod\nspring.datasource.hikari.data-source-properties.applicationName=iocbackend-prod\n\n# JPA/Hibernate - PRODUCTION (DO NOT MODIFY SCHEMA)\nspring.jpa.hibernate.ddl-auto=none\nspring.jpa.show-sql=false\nspring.jpa.open-in-view=false\n\n# Security\nspring.security.oauth2.resourceserver.jwt.issuer-uri=${SUPABASE_JWT_ISSUER_URI:https://bdyvzjpkycnekjrlqlfp.supabase.co/auth/v1}\n\n# ===================================================================\n# SUPABASE AUTH API - For automatic user creation\n# ===================================================================\nsupabase.url=${SUPABASE_URL:https://bdyvzjpkycnekjrlqlfp.supabase.co}\nsupabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\n\n# Metabase\nmetabase.site-url=${METABASE_URL:https://treated-paste-eos-memo.trycloudflare.com}\nmetabase.secret-key=${METABASE_SECRET_KEY:dummy-key-for-local-prod-testing}\n\n# ETL\netl.lock.enabled=false\netl.duplicate.check.enabled=false\netl.duplicate.fail-on-detect=false\n\n# Logging (Production)\nlogging.level."
    },
    {
      "path": "src/main/resources/application-dev-5432.properties",
      "excerpt": "# Direct DB connection (port 5432) for local development\n# Use this profile only locally when you want to connect directly to the database (not the pooler).\n# Prefer Direct Connection when your environment supports IPv6 or you need stable, long-lived connections\n# (VMs, long-running containers). For IPv4-only networks you can use the Session Pooler (pooler.supabase.com:5432).\n#\n# IMPORTANT: Put real secrets in environment variables (do NOT commit passwords)\n# Usage (example):\n#   export SUPABASE_DIRECT_HOST=db.bdyvzjpkycnekjrlqlfp.supabase.co\n#   export SUPABASE_DB_NAME=postgres\n#   export SUPABASE_DB_USER=postgres\n#   export SUPABASE_DB_PASSWORD=YOUR_PASSWORD\n#   ./mvnw spring-boot:run -Dspring-boot.run.profiles=dev-5432\n\n# -------------------------------------------------------------------\n# JDBC URL - direct connection (port 5432) - default points to the project direct host\n# -------------------------------------------------------------------\n# Use the direct host (db.<project-ref>.supabase.co). If your machine has no IPv6\n# route and DNS returns AAAA records, libpq/JDBC may prefer IPv6 and fail.\n# To force an IPv4 connection while still keeping the hostname for TLS/SNI/cert\n# verification, resolve the host to an IPv4 address and set SUPABASE_DIRECT_HOSTADDR\n# (example: export SUPABASE_DIRECT_HOSTADDR=3.122.45.67). The driver will connect\n# to hostaddr but still use the hostname for TLS checks.\n# The hostaddr parameter is optional and safe when empty.\nspring.datasource.url=jdbc:postgresql://${SUPABASE_DIRECT_HOST:db.bdyvzjpkycnekjrlqlfp.supabase.co}:5432/${SUPABASE_DB_NAME:postgres}?sslmode=require&hostaddr=${SUPABASE_DIRECT_HOSTADDR:}\nspring.datasource.username=${SUPABASE_DB_USER:postgres}\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# Keep pool small for safety in shared environments\nspring.datasource.hikari.maximum-pool-size=1\nspring.datasource.hikari.minimum-idle=0\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout="
    },
    {
      "path": "src/main/resources/application.properties",
      "excerpt": "# ===================================================================\n# BASE CONFIGURATION - SHARED BY ALL PROFILES\n# ===================================================================\n# This file contains ONLY common settings shared across all environments.\n# Environment-specific values go in application-{profile}.properties\n\n# Application Info\nspring.application.name=ioc-backend\n\n# ===================================================================\n# SUPABASE AUTH - Common Settings\n# ===================================================================\n# These values are environment-specific and must be set via environment variables\n# supabase.url=${SUPABASE_URL}\n# supabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\n\n# ===================================================================\n# DATABASE - Common Settings\n# ===================================================================\n# Explicit PostgreSQL driver (prevents H2 auto-detection)\nspring.datasource.driver-class-name=org.postgresql.Driver\n\n# ===================================================================\n# JPA/Hibernate - Common Settings\n# ===================================================================\nspring.jpa.open-in-view=false\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\nspring.jpa.properties.hibernate.jdbc.batch_size=20\nspring.jpa.properties.hibernate.order_inserts=true\nspring.jpa.properties.hibernate.order_updates=true\nspring.jpa.properties.hibernate.jdbc.batch_versioned_data=true\nspring.jpa.properties.hibernate.generate_statistics=false\n\n# Physical naming strategy (keep camelCase)\nspring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl\n\n# ===================================================================\n# ACTUATOR - Common Settings\n# ===================================================================\nmanagement.endpoints.web.exposure.include=health,metrics,prometheus,info\nmanagement.endpoint.heal"
    },
    {
      "path": "src/main/resources/application-local.properties",
      "excerpt": "# ===================================================================\n# LOCAL PROFILE - For local development\n# ===================================================================\n\n# Database Connection\nspring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require}\nspring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# HikariCP Pool Configuration\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=20000\nspring.datasource.hikari.idle-timeout=180000\nspring.datasource.hikari.max-lifetime=300000\nspring.datasource.hikari.keepalive-time=0\nspring.datasource.hikari.validation-timeout=3000\nspring.datasource.hikari.leak-detection-threshold=60000\nspring.datasource.hikari.pool-name=SupabaseHikariPool-Local\nspring.datasource.hikari.data-source-properties.applicationName=iocbackend-local\n\n# JPA/Hibernate\nspring.jpa.hibernate.ddl-auto=validate\nspring.jpa.show-sql=true\nspring.jpa.properties.hibernate.format_sql=true\n\n# Security (Supabase Auth)\nspring.security.oauth2.resourceserver.jwt.issuer-uri=https://bdyvzjpkycnekjrlqlfp.supabase.co/auth/v1\n\n# ===================================================================\n# SUPABASE AUTH API - For automatic user creation\n# ===================================================================\nsupabase.url=${SUPABASE_URL:https://bdyvzjpkycnekjrlqlfp.supabase.co}\nsupabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY}\n\n# Metabase\nmetabase.site-url=https://treated-paste-eos-memo.trycloudflare.com\nmetabase.secret-key=${METABASE_SECRET_KEY}\n\n# Server\nserver.port=8080\n\n# Logging\nlogging.level.com.cambiaso.ioc=DEBUG"
    },
    {
      "path": "src/main/resources/application-dev.properties",
      "excerpt": "# Development-specific properties\n# This file is ignored by .gitignore and should NOT be committed.\n# It overrides properties from application.properties for the 'dev' profile.\n\n# ===================================================================\n# CONFIGURACION LOCAL DE LA BASE DE DATOS (SUPABASE) - CORREGIDA\n# ===================================================================\n# CRITICO: Usar puerto 6543 (Transaction Mode) para evitar conexiones idle\n#spring.datasource.url=jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:6543/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require\nspring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:5432/postgres?reWriteBatchedInserts=true&prepareThreshold=0&preferQueryMode=simple&sslmode=require}\nspring.datasource.username=postgres.bdyvzjpkycnekjrlqlfp\n# Use an environment variable for the password (do NOT commit secrets)\nspring.datasource.password=${SUPABASE_DB_PASSWORD}\n\n# Disable DevTools restart for shared DBs to avoid multiple connections from restarts\nspring.devtools.restart.enabled=false\n\n# ===================================================================\n# CONFIGURACION DE HIKARICP POOL - OPTIMIZADO PARA SUPABASE FREE TIER\n# ===================================================================\n# Limite de conexiones recomendado para desarrollo local contra DB compartida\nspring.datasource.hikari.maximum-pool-size=3\nspring.datasource.hikari.minimum-idle=1\nspring.datasource.hikari.connection-timeout=30000\nspring.datasource.hikari.idle-timeout=300000\nspring.datasource.hikari.max-lifetime=300000\nspring.datasource.hikari.keepalive-time=0\nspring.datasource.hikari.validation-timeout=5000\nspring.datasource.hikari.leak-detection-threshold=60000\n# Identificar tus conexiones en pg_stat_activity\nspring.datasource.hikari.data-source-properties.applicationName=iocbackend-dev\n\n# ===================================================================\n# "
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/IocbackendApplication.java",
      "excerpt": "package com.cambiaso.ioc;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.boot.autoconfigure.domain.EntityScan;\nimport org.springframework.data.jpa.repository.config.EnableJpaRepositories;\nimport org.springframework.scheduling.annotation.EnableScheduling;\n\n@SpringBootApplication\n@EntityScan(\"com.cambiaso.ioc.persistence.entity\")\n@EnableJpaRepositories(\"com.cambiaso.ioc.persistence.repository\")\n@EnableScheduling\npublic class IocbackendApplication {\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(IocbackendApplication.class, args);\n\t}\n\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/role/entity/Permission.java",
      "excerpt": "package com.cambiaso.ioc.role.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport lombok.AllArgsConstructor;\n\n@Data // AN√ÅLISIS: Genera autom√°ticamente getters, setters, equals, hashCode y toString.\n@NoArgsConstructor // AN√ÅLISIS: Genera un constructor sin argumentos, requerido por JPA.\n@AllArgsConstructor // AN√ÅLISIS: Genera un constructor con todos los argumentos, √∫til para tests.\n@Entity // AN√ÅLISIS: Marca esta clase como una entidad JPA, lo que significa que se mapear√° a una tabla.\n@Table(name = \"permission\") // AN√ÅLISIS: Especifica que el nombre de la tabla en la BD es \"permission\".\npublic class Permission {\n\n    @Id // AN√ÅLISIS: Marca este campo como la clave primaria de la tabla.\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    // AN√ÅLISIS: Le dice a Hibernate que la BD se encargar√° de generar el ID (usando SERIAL de Postgres).\n    private Integer id;\n\n    @Column(unique = true, nullable = false)\n    // AN√ÅLISIS: Mapea este campo a una columna. 'unique=true' crea una restricci√≥n de unicidad\n    // y 'nullable=false' la hace obligatoria (NOT NULL).\n    private String name; // Ejemplos: \"CREATE_USER\", \"VIEW_DASHBOARD\"\n}"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/role/entity/Role.java",
      "excerpt": "package com.cambiaso.ioc.role.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport lombok.AllArgsConstructor;\n\nimport java.util.HashSet;\nimport java.util.Set;\n\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\n@Entity\n@Table(name = \"role\")\npublic class Role {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Integer id;\n\n    @Column(unique = true, nullable = false)\n    private String name; // Ejemplos: \"Administrador\", \"Gerente\"\n\n    @ManyToMany(fetch = FetchType.LAZY)\n    // AN√ÅLISIS: Define una relaci√≥n Muchos-a-Muchos. 'FetchType.LAZY' es una optimizaci√≥n\n    // crucial: los permisos de un rol solo se cargar√°n de la BD cuando se acceda a ellos expl√≠citamente,\n    // evitando consultas innecesarias.\n    @JoinTable(\n            name = \"role_permission\", // tabla de uni√≥n ahora en singular\n            joinColumns = @JoinColumn(name = \"role_id\"),\n            inverseJoinColumns = @JoinColumn(name = \"permission_id\")\n    )\n    private Set<Permission> permissions = new HashSet<>();\n    // AN√ÅLISIS: Usamos un 'Set' en lugar de 'List' porque un rol no puede tener el mismo permiso dos veces.\n}"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/mapper/RoleMapper.java",
      "excerpt": "package com.cambiaso.ioc.mapper;\n\nimport com.cambiaso.ioc.dto.response.RoleResponse;\nimport com.cambiaso.ioc.persistence.entity.Role;\nimport org.mapstruct.Mapper;\n\nimport java.util.List;\n\n@Mapper(componentModel = \"spring\")\npublic interface RoleMapper {\n    RoleResponse toResponse(Role entity);\n\n    default RoleResponse toResponse(Role entity, long usersCount, List<String> permissions) {\n        RoleResponse response = toResponse(entity);\n        response.setUsersCount((int) usersCount);\n        response.setPermissions(permissions);\n        return response;\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/mapper/UsuarioMapper.java",
      "excerpt": "package com.cambiaso.ioc.mapper;\n\nimport com.cambiaso.ioc.dto.response.UsuarioResponse;\nimport com.cambiaso.ioc.persistence.entity.AppUser;\nimport org.mapstruct.Mapper;\nimport org.mapstruct.Mapping;\n\nimport java.util.List;\nimport java.util.Objects;\nimport java.util.stream.Collectors;\nimport java.util.stream.Stream;\n\n@Mapper(componentModel = \"spring\")\npublic interface UsuarioMapper {\n\n    @Mapping(target = \"id\", source = \"entity.id\")\n    @Mapping(target = \"email\", source = \"entity.email\")\n    @Mapping(target = \"fullName\", expression = \"java(getFullName(entity))\")\n    @Mapping(target = \"plantaId\", source = \"entity.planta.id\")\n    @Mapping(target = \"plantaCode\", source = \"entity.planta.code\")\n    @Mapping(target = \"plantaName\", source = \"entity.planta.name\")\n    @Mapping(target = \"centroCosto\", source = \"entity.centroCosto\")\n    @Mapping(target = \"fechaContrato\", source = \"entity.fechaContrato\")\n    @Mapping(target = \"isActive\", source = \"entity.active\")\n    @Mapping(target = \"createdAt\", source = \"entity.createdAt\")\n    @Mapping(target = \"updatedAt\", source = \"entity.updatedAt\")\n    @Mapping(target = \"roles\", source = \"roles\")\n    UsuarioResponse toResponse(AppUser entity, List<String> roles);\n\n    default String getFullName(AppUser u) {\n        return Stream.of(u.getPrimerNombre(), u.getSegundoNombre(), u.getPrimerApellido(), u.getSegundoApellido())\n                .filter(Objects::nonNull)\n                .map(String::trim)\n                .filter(s -> !s.isEmpty())\n                .collect(Collectors.joining(\" \"));\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/mapper/PermissionMapper.java",
      "excerpt": "package com.cambiaso.ioc.mapper;\n\nimport com.cambiaso.ioc.dto.response.PermissionResponse;\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport org.mapstruct.Mapper;\n\n@Mapper(componentModel = \"spring\")\npublic interface PermissionMapper {\n    PermissionResponse toResponse(Permission entity);\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/security/SecurityConfig.java",
      "excerpt": "package com.cambiaso.ioc.security;\n\nimport com.cambiaso.ioc.persistence.repository.AppUserRepository;\nimport com.cambiaso.ioc.persistence.repository.UserRoleRepository;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.core.convert.converter.Converter;\nimport org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.annotation.web.configurers.HeadersConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.oauth2.jose.jws.SignatureAlgorithm;\nimport org.springframework.security.oauth2.jwt.Jwt;\nimport org.springframework.security.oauth2.jwt.JwtDecoder;\nimport org.springframework.security.oauth2.jwt.NimbusJwtDecoder;\nimport org.springframework.security.oauth2.server.resource.authentication.JwtAuthenticationConverter;\nimport org.springframework.security.oauth2.server.resource.authentication.JwtGrantedAuthoritiesConverter;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.stream.Collectors;\n\n@Configuration\n@EnableWebSecurity\n@E"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/security/CustomUserDetails.java",
      "excerpt": "package com.cambiaso.ioc.security;\n\nimport lombok.Getter;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.userdetails.User;\n\nimport java.util.Collection;\n\n@Getter\npublic class CustomUserDetails extends User {\n    \n    private final Long userId;\n    private final String email;\n    private final String department;\n    private final String region;\n    private final String fullName;\n\n    public CustomUserDetails(\n            String username,\n            String password,\n            Collection<? extends GrantedAuthority> authorities,\n            Long userId,\n            String email,\n            String department,\n            String region,\n            String fullName\n    ) {\n        super(username, password, authorities);\n        this.userId = userId;\n        this.email = email;\n        this.department = department;\n        this.region = region;\n        this.fullName = fullName;\n    }\n\n    // Constructor adicional para compatibilidad\n    public CustomUserDetails(\n            String username,\n            String password,\n            boolean enabled,\n            boolean accountNonExpired,\n            boolean credentialsNonExpired,\n            boolean accountNonLocked,\n            Collection<? extends GrantedAuthority> authorities,\n            Long userId,\n            String email,\n            String department,\n            String region,\n            String fullName\n    ) {\n        super(username, password, enabled, accountNonExpired, \n              credentialsNonExpired, accountNonLocked, authorities);\n        this.userId = userId;\n        this.email = email;\n        this.department = department;\n        this.region = region;\n        this.fullName = fullName;\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/exception/JobConflictException.java",
      "excerpt": "package com.cambiaso.ioc.exception;\n\nimport org.springframework.http.HttpStatus;\nimport org.springframework.web.bind.annotation.ResponseStatus;\n\n@ResponseStatus(HttpStatus.CONFLICT)\npublic class JobConflictException extends RuntimeException {\n    public JobConflictException(String message) {\n        super(message);\n    }\n\n    public JobConflictException(String message, Throwable cause) {\n        super(message, cause);\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/exception/FileValidationException.java",
      "excerpt": "package com.cambiaso.ioc.exception;\n\npublic class FileValidationException extends RuntimeException {\n    public FileValidationException(String message) {\n        super(message);\n    }\n\n    public FileValidationException(String message, Throwable cause) {\n        super(message, cause);\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/exception/GlobalExceptionHandler.java",
      "excerpt": "package com.cambiaso.ioc.exception;\n\nimport jakarta.validation.ConstraintViolationException;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.MethodArgumentNotValidException;\nimport org.springframework.web.bind.annotation.ExceptionHandler;\nimport org.springframework.web.bind.annotation.RestControllerAdvice;\nimport org.springframework.web.multipart.MaxUploadSizeExceededException;\n\nimport java.time.OffsetDateTime;\nimport java.util.Map;\n\n@Slf4j\n@RestControllerAdvice\npublic class GlobalExceptionHandler {\n\n    @ExceptionHandler(JobConflictException.class)\n    public ResponseEntity<Map<String, Object>> handleJobConflict(JobConflictException ex) {\n        log.warn(\"Job conflict: {}\", ex.getMessage());\n        return ResponseEntity.status(HttpStatus.CONFLICT)\n                .body(createErrorResponse(\"CONFLICT\", ex.getMessage()));\n    }\n\n    @ExceptionHandler(FileValidationException.class)\n    public ResponseEntity<Map<String, Object>> handleFileValidation(FileValidationException ex) {\n        log.error(\"File validation error: {}\", ex.getMessage());\n        return ResponseEntity.badRequest()\n                .body(createErrorResponse(\"VALIDATION_ERROR\", ex.getMessage()));\n    }\n\n    @ExceptionHandler(ResourceNotFoundException.class)\n    public ResponseEntity<Map<String, Object>> handleResourceNotFound(ResourceNotFoundException ex) {\n        log.warn(\"Resource not found: {}\", ex.getMessage());\n        return ResponseEntity.status(HttpStatus.NOT_FOUND)\n                .body(createErrorResponse(\"NOT_FOUND\", ex.getMessage()));\n    }\n\n    @ExceptionHandler(ResourceConflictException.class)\n    public ResponseEntity<Map<String, Object>> handleResourceConflict(ResourceConflictException ex) {\n        log.warn(\"Resource conflict: {}\", ex.getMessage());\n        return ResponseEntity.status(HttpStatus.CONFLICT)\n                .body(createErrorResponse(\"CONFLICT\", ex.getMessa"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/exception/ResourceConflictException.java",
      "excerpt": "package com.cambiaso.ioc.exception;\n\npublic class ResourceConflictException extends RuntimeException {\n    public ResourceConflictException(String message) {\n        super(message);\n    }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/exception/DashboardAccessDeniedException.java",
      "excerpt": "package com.cambiaso.ioc.exception;\n\n/**\n * Excepci√≥n lanzada cuando un usuario autenticado intenta acceder a un dashboard\n * para el cual no tiene los roles requeridos.\n * Ser√° manejada por el GlobalExceptionHandler para devolver un 403 Forbidden.\n */\npublic class DashboardAccessDeniedException extends RuntimeException {\n    public DashboardAccessDeniedException(String message) {\n        super(message);\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/exception/DashboardNotFoundException.java",
      "excerpt": "package com.cambiaso.ioc.exception;\n\n/**\n * Excepci√≥n lanzada cuando se solicita un dashboard que no est√° configurado\n * o no existe.\n * Ser√° manejada por el GlobalExceptionHandler para devolver un 404 Not Found.\n */\npublic class DashboardNotFoundException extends RuntimeException {\n    public DashboardNotFoundException(String message) {\n        super(message);\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/exception/ResourceNotFoundException.java",
      "excerpt": "package com.cambiaso.ioc.exception;\n\npublic class ResourceNotFoundException extends RuntimeException {\n    public ResourceNotFoundException(String message) {\n        super(message);\n    }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/startup/EtlUniqueConstraintVerifier.java",
      "excerpt": "package com.cambiaso.ioc.startup;\n\nimport io.micrometer.core.instrument.MeterRegistry;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.stereotype.Component;\n\nimport javax.sql.DataSource;\nimport java.sql.Connection;\nimport java.sql.DatabaseMetaData;\nimport java.util.concurrent.atomic.AtomicInteger;\n\n/**\n * Verifica en el arranque la existencia del √≠ndice UNIQUE natural para fact_production.\n * Nombre esperado: uq_fact_prod_natural\n *\n * Comportamiento:\n *  - Si ni retryUnique ni unique.enforced est√°n activos -> no hace nada.\n *  - Si retryUnique.enabled = true y el √≠ndice NO existe -> log ERROR (para visibilidad) pero no aborta.\n *  - Si etl.unique.enforced = true y el √≠ndice NO existe -> aborta el arranque (IllegalStateException).\n *  - Si falla la introspecci√≥n (BD distinta de PostgreSQL, falta vista pg_indexes, etc.) y unique.enforced=true -> aborta.\n */\n@Slf4j\n@Component\n@RequiredArgsConstructor\npublic class EtlUniqueConstraintVerifier {\n\n    private final JdbcTemplate jdbcTemplate;\n    private final DataSource dataSource;\n    private final MeterRegistry meterRegistry; // puede ser null si no hay m√©tricas\n    private final AtomicInteger uniqueIndexGauge = new AtomicInteger(-1);\n    private volatile boolean gaugeRegistered = false;\n\n    @Value(\"${etl.retry.unique.enabled:false}\")\n    private boolean retryUniqueEnabled;\n\n    @Value(\"${etl.unique.enforced:false}\")\n    private boolean uniqueEnforced;\n\n    // Nombre del √≠ndice esperado (debe alinearse con los scripts SQL de hardening)\n    private static final String UNIQUE_INDEX_NAME = \"uq_fact_prod_natural\";\n    private static final String EXISTS_SQL = \"SELECT indexname FROM pg_indexes WHERE tablename = 'fact_production' AND indexname = '\" + UNIQUE_INDEX_NAME + \"'\";\n\n    private void registerGaugeIfNeeded() {\n        "
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/startup/EtlStartupDuplicateChecker.java",
      "excerpt": "package com.cambiaso.ioc.startup;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.stereotype.Component;\n\nimport jakarta.annotation.PostConstruct;\nimport java.util.List;\n\n/**\n * Verifica en el arranque si existen duplicados l√≥gicos en fact_production\n * seg√∫n la clave natural candidata (fecha_contabilizacion, maquina_fk, COALESCE(maquinista_fk,0), numero_log).\n * Solo realiza logging (WARN) a menos que etl.duplicate.fail-on-detect=true, en cuyo caso aborta el arranque.\n */\n@Slf4j\n@Component\n@RequiredArgsConstructor\npublic class EtlStartupDuplicateChecker {\n\n    private final JdbcTemplate jdbcTemplate;\n\n    @Value(\"${etl.duplicate.check.enabled:true}\")\n    private boolean duplicateCheckEnabled;\n    @Value(\"${etl.duplicate.fail-on-detect:false}\")\n    private boolean failOnDetect;\n    @Value(\"${etl.duplicate.check.sample-limit:10}\")\n    private int sampleLimit;\n\n    private static final String COUNT_SQL = \"SELECT COUNT(*) FROM (\" +\n            \"SELECT 1 FROM fact_production \" +\n            \"GROUP BY fecha_contabilizacion, maquina_fk, COALESCE(maquinista_fk,0), numero_log HAVING COUNT(*) > 1\" +\n            \") dup\";\n\n    private static final String SAMPLE_SQL = \"SELECT fecha_contabilizacion, maquina_fk, COALESCE(maquinista_fk,0) AS maquinista_key, numero_log, COUNT(*) AS c \" +\n            \"FROM fact_production GROUP BY 1,2,3,4 HAVING COUNT(*) > 1 ORDER BY c DESC LIMIT ?\";\n\n    @PostConstruct\n    public void checkDuplicatesOnStartup() {\n        if (!duplicateCheckEnabled) {\n            log.debug(\"[ETL Duplicate Check] Disabled by configuration.\");\n            return;\n        }\n        try {\n            Integer groups = jdbcTemplate.queryForObject(COUNT_SQL, Integer.class);\n            if (groups == null) groups = 0;\n            if (groups == 0) {\n                log.info(\"[ETL Duplicate Check] No logical duplicat"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/dto/EtlJobStatusDto.java",
      "excerpt": "package com.cambiaso.ioc.dto;\n\nimport com.cambiaso.ioc.persistence.entity.EtlJob;\nimport lombok.Builder;\nimport lombok.Data;\n\nimport java.time.LocalDate;\nimport java.time.OffsetDateTime;\nimport java.util.UUID;\n\n@Data\n@Builder\npublic class EtlJobStatusDto {\n    private UUID jobId;\n    private String fileName;\n    private String status;\n    private String details;\n    private LocalDate minDate;\n    private LocalDate maxDate;\n    private OffsetDateTime createdAt;\n    private OffsetDateTime finishedAt;\n\n    public static EtlJobStatusDto fromEntity(EtlJob job) {\n        return EtlJobStatusDto.builder()\n                .jobId(job.getJobId())\n                .fileName(job.getFileName())\n                .status(job.getStatus())\n                .details(job.getDetails())\n                .minDate(job.getMinDate())\n                .maxDate(job.getMaxDate())\n                .createdAt(job.getCreatedAt())\n                .finishedAt(job.getFinishedAt())\n                .build();\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/dto/NotificationPayload.java",
      "excerpt": "package com.cambiaso.ioc.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\n@Builder\npublic class NotificationPayload {\n    private String status;\n    private String message;\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/dto/request/PermissionRequest.java",
      "excerpt": "package com.cambiaso.ioc.dto.request;\n\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.Size;\n\npublic class PermissionRequest {\n\n    @NotBlank\n    @Size(max = 150)\n    private String name;\n\n    @Size(max = 255)\n    private String description;\n\n    public String getName() { return name; }\n    public void setName(String name) { this.name = name; }\n\n    public String getDescription() { return description; }\n    public void setDescription(String description) { this.description = description; }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/dto/request/UsuarioUpdateRequest.java",
      "excerpt": "package com.cambiaso.ioc.dto.request;\n\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.Size;\n\nimport java.time.LocalDate;\n\npublic class UsuarioUpdateRequest {\n\n    @NotBlank\n    private String primerNombre;\n\n    private String segundoNombre;\n\n    @NotBlank\n    private String primerApellido;\n\n    private String segundoApellido;\n\n    private Integer plantaId; // nullable to unset\n\n    @Size(max = 50)\n    private String centroCosto;\n\n    private LocalDate fechaContrato;\n\n    private Boolean isActive;\n\n    public String getPrimerNombre() { return primerNombre; }\n    public void setPrimerNombre(String primerNombre) { this.primerNombre = primerNombre; }\n\n    public String getSegundoNombre() { return segundoNombre; }\n    public void setSegundoNombre(String segundoNombre) { this.segundoNombre = segundoNombre; }\n\n    public String getPrimerApellido() { return primerApellido; }\n    public void setPrimerApellido(String primerApellido) { this.primerApellido = primerApellido; }\n\n    public String getSegundoApellido() { return segundoApellido; }\n    public void setSegundoApellido(String segundoApellido) { this.segundoApellido = segundoApellido; }\n\n    public Integer getPlantaId() { return plantaId; }\n    public void setPlantaId(Integer plantaId) { this.plantaId = plantaId; }\n\n    public String getCentroCosto() { return centroCosto; }\n    public void setCentroCosto(String centroCosto) { this.centroCosto = centroCosto; }\n\n    public LocalDate getFechaContrato() { return fechaContrato; }\n    public void setFechaContrato(LocalDate fechaContrato) { this.fechaContrato = fechaContrato; }\n\n    public Boolean getIsActive() { return isActive; }\n    public void setIsActive(Boolean isActive) { this.isActive = isActive; }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/dto/request/UsuarioCreateRequest.java",
      "excerpt": "package com.cambiaso.ioc.dto.request;\n\nimport com.cambiaso.ioc.validation.UniqueEmail;\nimport com.cambiaso.ioc.validation.ValidSupabaseUUID;\nimport jakarta.validation.constraints.Email;\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.NotNull;\nimport jakarta.validation.constraints.Size;\n\nimport java.time.LocalDate;\nimport java.util.List;\nimport java.util.UUID;\n\npublic class UsuarioCreateRequest {\n\n    @NotBlank\n    @Email\n    @UniqueEmail\n    private String email;\n\n    // NEW: Password field for automatic Supabase user creation\n    @Size(min = 6, message = \"Password must be at least 6 characters\")\n    private String password;\n\n    // DEPRECATED: Kept for backward compatibility during migration\n    @Deprecated\n    @ValidSupabaseUUID\n    private UUID supabaseUserId;\n\n    @NotBlank\n    private String primerNombre;\n\n    private String segundoNombre;\n\n    @NotBlank\n    private String primerApellido;\n\n    private String segundoApellido;\n\n    private Integer plantaId;\n\n    @Size(max = 50)\n    private String centroCosto;\n\n    private LocalDate fechaContrato;\n\n    private List<String> roles;\n\n    public String getEmail() { return email; }\n    public void setEmail(String email) { this.email = email; }\n\n    public String getPassword() { return password; }\n    public void setPassword(String password) { this.password = password; }\n\n    public UUID getSupabaseUserId() { return supabaseUserId; }\n    public void setSupabaseUserId(UUID supabaseUserId) { this.supabaseUserId = supabaseUserId; }\n\n    public String getPrimerNombre() { return primerNombre; }\n    public void setPrimerNombre(String primerNombre) { this.primerNombre = primerNombre; }\n\n    public String getSegundoNombre() { return segundoNombre; }\n    public void setSegundoNombre(String segundoNombre) { this.segundoNombre = segundoNombre; }\n\n    public String getPrimerApellido() { return primerApellido; }\n    public void setPrimerApellido(String primerApellido) { this.primerApellido = pri"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/dto/request/RoleRequest.java",
      "excerpt": "package com.cambiaso.ioc.dto.request;\n\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.Size;\n\npublic class RoleRequest {\n\n    @NotBlank\n    @Size(max = 100)\n    private String name;\n\n    @Size(max = 255)\n    private String description;\n\n    public String getName() { return name; }\n    public void setName(String name) { this.name = name; }\n\n    public String getDescription() { return description; }\n    public void setDescription(String description) { this.description = description; }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/dto/response/RoleResponse.java",
      "excerpt": "package com.cambiaso.ioc.dto.response;\n\nimport java.util.List;\n\npublic class RoleResponse {\n    private int id;\n    private String name;\n    private String description;\n    private int usersCount; // optional; default 0\n    private List<String> permissions; // optional\n\n    public int getId() { return id; }\n    public void setId(int id) { this.id = id; }\n\n    public String getName() { return name; }\n    public void setName(String name) { this.name = name; }\n\n    public String getDescription() { return description; }\n    public void setDescription(String description) { this.description = description; }\n\n    public int getUsersCount() { return usersCount; }\n    public void setUsersCount(int usersCount) { this.usersCount = usersCount; }\n\n    public List<String> getPermissions() { return permissions; }\n    public void setPermissions(List<String> permissions) { this.permissions = permissions; }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/dto/response/UsuarioResponse.java",
      "excerpt": "package com.cambiaso.ioc.dto.response;\n\nimport java.time.LocalDate;\nimport java.time.OffsetDateTime;\nimport java.util.List;\n\npublic class UsuarioResponse {\n    private long id;\n    private String email;\n    private String fullName;\n    private Integer plantaId;\n    private String plantaCode;\n    private String plantaName;\n    private String centroCosto;\n    private LocalDate fechaContrato;\n    private boolean isActive;\n    private OffsetDateTime createdAt;\n    private OffsetDateTime updatedAt;\n    private List<String> roles;\n\n    public long getId() { return id; }\n    public void setId(long id) { this.id = id; }\n\n    public String getEmail() { return email; }\n    public void setEmail(String email) { this.email = email; }\n\n    public String getFullName() { return fullName; }\n    public void setFullName(String fullName) { this.fullName = fullName; }\n\n    public Integer getPlantaId() { return plantaId; }\n    public void setPlantaId(Integer plantaId) { this.plantaId = plantaId; }\n\n    public String getPlantaCode() { return plantaCode; }\n    public void setPlantaCode(String plantaCode) { this.plantaCode = plantaCode; }\n\n    public String getPlantaName() { return plantaName; }\n    public void setPlantaName(String plantaName) { this.plantaName = plantaName; }\n\n    public String getCentroCosto() { return centroCosto; }\n    public void setCentroCosto(String centroCosto) { this.centroCosto = centroCosto; }\n\n    public LocalDate getFechaContrato() { return fechaContrato; }\n    public void setFechaContrato(LocalDate fechaContrato) { this.fechaContrato = fechaContrato; }\n\n    public boolean getIsActive() { return isActive; }\n    public void setIsActive(boolean isActive) { this.isActive = isActive; }\n\n    public OffsetDateTime getCreatedAt() { return createdAt; }\n    public void setCreatedAt(OffsetDateTime createdAt) { this.createdAt = createdAt; }\n\n    public OffsetDateTime getUpdatedAt() { return updatedAt; }\n    public void setUpdatedAt(OffsetDateTime updatedAt) { this.updated"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/dto/response/PermissionResponse.java",
      "excerpt": "package com.cambiaso.ioc.dto.response;\n\npublic class PermissionResponse {\n    private int id;\n    private String name;\n    private String description;\n\n    public int getId() { return id; }\n    public void setId(int id) { this.id = id; }\n\n    public String getName() { return name; }\n    public void setName(String name) { this.name = name; }\n\n    public String getDescription() { return description; }\n    public void setDescription(String description) { this.description = description; }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/RolePermissionRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.RolePermission;\nimport com.cambiaso.ioc.persistence.entity.RolePermissionKey;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.data.jpa.repository.Query;\nimport org.springframework.data.repository.query.Param;\n\nimport java.util.List;\n\npublic interface RolePermissionRepository extends JpaRepository<RolePermission, RolePermissionKey> {\n    boolean existsByRole_Id(Integer roleId);\n    boolean existsByPermission_Id(Integer permissionId);\n\n    @Query(\"SELECT p.name FROM RolePermission rp JOIN rp.permission p WHERE rp.role.id = :roleId ORDER BY p.name\")\n    List<String> findPermissionNamesByRoleId(@Param(\"roleId\") Integer roleId);\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/AppUserSearchRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.AppUser;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.Pageable;\n\npublic interface AppUserSearchRepository {\n    Page<AppUser> search(String search, Integer plantaId, Boolean isActive, Pageable pageable);\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/EtlJobRepositoryImpl.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.EtlJob;\nimport jakarta.persistence.EntityManager;\nimport jakarta.persistence.PersistenceContext;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.time.OffsetDateTime;\nimport java.util.List;\n\n/**\n * Custom implementation to avoid JPQL UPDATE type issues with OffsetDateTime in some dialects.\n * Performs a select then per-row update ensuring finishedAt and details are set consistently.\n */\npublic class EtlJobRepositoryImpl implements EtlJobRepositoryCustom {\n\n    @PersistenceContext\n    private EntityManager em;\n\n    @Override\n    @Transactional\n    public int markStuckAsFailed(OffsetDateTime cutoff) {\n        // Selecciona jobs creados estrictamente antes del cutoff\n        List<EtlJob> stuck = em.createQuery(\"SELECT j FROM EtlJob j WHERE j.status IN ('INICIADO','PROCESANDO','SINCRONIZANDO') AND j.finishedAt IS NULL AND j.createdAt < :cutoff\", EtlJob.class)\n                .setParameter(\"cutoff\", cutoff)\n                .getResultList();\n\n        if (stuck.isEmpty()) return 0;\n        OffsetDateTime now = OffsetDateTime.now();\n        for (EtlJob j : stuck) {\n            j.setStatus(\"FALLO\");\n            String details = j.getDetails();\n            if (details == null || details.isBlank()) {\n                j.setDetails(\"Watchdog timeout\");\n            } else if (!details.contains(\"Watchdog timeout\")) {\n                j.setDetails(details + \"|Watchdog timeout\");\n            }\n            j.setFinishedAt(now);\n        }\n        return stuck.size();\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/AppUserRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.AppUser;\nimport org.springframework.data.jpa.repository.JpaRepository;\n\nimport java.util.Optional;\nimport java.util.UUID;\n\npublic interface AppUserRepository extends JpaRepository<AppUser, Long> {\n    Optional<AppUser> findByEmailIgnoreCase(String email);\n    boolean existsByEmailIgnoreCase(String email);\n    Optional<AppUser> findBySupabaseUserId(UUID supabaseUserId);\n    boolean existsBySupabaseUserId(UUID supabaseUserId);\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/UserRoleRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.UserRole;\nimport com.cambiaso.ioc.persistence.entity.UserRoleKey;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.data.jpa.repository.Modifying;\nimport org.springframework.data.jpa.repository.Query;\nimport org.springframework.data.repository.query.Param;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.util.List;\n\npublic interface UserRoleRepository extends JpaRepository<UserRole, UserRoleKey> {\n\n    boolean existsByIdUserIdAndIdRoleId(Long userId, Integer roleId);\n\n    boolean existsByIdRoleId(Integer roleId);\n\n    long countByIdRoleId(Integer roleId);\n\n    @Modifying\n    @Transactional\n    void deleteByIdUserIdAndIdRoleId(Long userId, Integer roleId);\n\n    @Query(\"SELECT r.name FROM UserRole ur JOIN ur.role r WHERE ur.id.userId = :userId ORDER BY r.name\")\n    List<String> findRoleNamesByUserId(@Param(\"userId\") long userId);\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/EtlJobRepositoryCustom.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport java.time.OffsetDateTime;\n\npublic interface EtlJobRepositoryCustom {\n    int markStuckAsFailed(OffsetDateTime cutoff);\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/QuarantinedRecordRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.QuarantinedRecord;\nimport org.springframework.data.jpa.repository.JpaRepository;\n\npublic interface QuarantinedRecordRepository extends JpaRepository<QuarantinedRecord, Long> {\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/DimMaquinistaRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.DimMaquinista;\nimport org.springframework.data.jpa.repository.JpaRepository;\n\nimport java.util.Optional;\n\npublic interface DimMaquinistaRepository extends JpaRepository<DimMaquinista, Long> {\n    Optional<DimMaquinista> findByCodigoMaquinista(Long codigoMaquinista);\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/AppUserSearchRepositoryImpl.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.AppUser;\nimport jakarta.persistence.EntityManager;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.stereotype.Repository;\n\n@Repository\n@RequiredArgsConstructor\npublic class AppUserSearchRepositoryImpl implements AppUserSearchRepository {\n\n    private final EntityManager em;\n\n    @Override\n    public Page<AppUser> search(String search, Integer plantaId, Boolean isActive, Pageable pageable) {\n        StringBuilder jpql = new StringBuilder(\"SELECT u FROM AppUser u WHERE u.deletedAt IS NULL\");\n        StringBuilder countJpql = new StringBuilder(\"SELECT COUNT(u) FROM AppUser u WHERE u.deletedAt IS NULL\");\n\n        if (search != null && !search.isBlank()) {\n            jpql.append(\" AND (LOWER(u.email) LIKE :q OR LOWER(u.primerNombre) LIKE :q OR LOWER(u.primerApellido) LIKE :q)\");\n            countJpql.append(\" AND (LOWER(u.email) LIKE :q OR LOWER(u.primerNombre) LIKE :q OR LOWER(u.primerApellido) LIKE :q)\");\n        }\n        if (plantaId != null) {\n            jpql.append(\" AND u.planta.id = :plantaId\");\n            countJpql.append(\" AND u.planta.id = :plantaId\");\n        }\n        if (isActive != null) {\n            // entity field is 'active' (boolean)\n            jpql.append(\" AND u.active = :active\");\n            countJpql.append(\" AND u.active = :active\");\n        }\n\n        var query = em.createQuery(jpql.toString(), AppUser.class);\n        var countQuery = em.createQuery(countJpql.toString(), Long.class);\n\n        if (search != null && !search.isBlank()) {\n            String q = \"%\" + search.toLowerCase() + \"%\";\n            query.setParameter(\"q\", q);\n            countQuery.setParameter(\"q\", q);\n        }\n        if (plantaId != null) {\n            query.setParameter(\"plantaId\", plantaId);\n            countQuery."
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/PermissionRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.data.jpa.repository.Query;\nimport org.springframework.data.repository.query.Param;\n\nimport java.util.Optional;\n\n@SuppressWarnings(\"SqlNoDataSourceInspection\")\npublic interface PermissionRepository extends JpaRepository<Permission, Integer> {\n    Optional<Permission> findByNameIgnoreCase(String name);\n    boolean existsByNameIgnoreCase(String name);\n\n    //noinspection SqlNoDataSourceInspection\n    @SuppressWarnings(\"SqlNoDataSourceInspection\")\n    @Query(value = \"SELECT * FROM permissions p WHERE CAST(:search AS TEXT) IS NULL OR :search = '' OR LOWER(p.name) LIKE LOWER(CONCAT('%', CAST(:search AS TEXT), '%'))\",\n           countQuery = \"SELECT COUNT(*) FROM permissions p WHERE CAST(:search AS TEXT) IS NULL OR :search = '' OR LOWER(p.name) LIKE LOWER(CONCAT('%', CAST(:search AS TEXT), '%'))\",\n           nativeQuery = true)\n    Page<Permission> search(@Param(\"search\") String search, Pageable pageable);\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/FactProductionRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.data.jpa.repository.Modifying;\nimport org.springframework.data.jpa.repository.Query;\nimport org.springframework.data.repository.query.Param;\nimport org.springframework.stereotype.Repository;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.time.LocalDate;\n\n@Repository\npublic interface FactProductionRepository extends JpaRepository<FactProduction, Long> {\n\n    @Transactional\n    @Modifying\n    @Query(\"DELETE FROM FactProduction fp WHERE fp.fechaContabilizacion BETWEEN :minDate AND :maxDate\")\n    int deleteByFechaContabilizacionBetween(@Param(\"minDate\") LocalDate minDate, @Param(\"maxDate\") LocalDate maxDate);\n}"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/PlantaRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.Planta;\nimport org.springframework.data.jpa.repository.JpaRepository;\n\nimport java.util.Optional;\n\npublic interface PlantaRepository extends JpaRepository<Planta, Integer> {\n    Optional<Planta> findByCodeIgnoreCase(String code);\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/EtlJobRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.EtlJob;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.data.jpa.repository.Query;\nimport org.springframework.data.repository.query.Param;\nimport org.springframework.stereotype.Repository;\n\nimport java.time.LocalDate;\nimport java.time.OffsetDateTime;\nimport java.util.List;\nimport java.util.Optional;\nimport java.util.UUID;\n\n@Repository\npublic interface EtlJobRepository extends JpaRepository<EtlJob, UUID>, EtlJobRepositoryCustom {\n    Optional<EtlJob> findByFileHash(String fileHash);\n\n    boolean existsByStatusInAndMaxDateGreaterThanEqualAndMinDateLessThanEqual(\n            List<String> statuses,\n            LocalDate minDate,\n            LocalDate maxDate\n    );\n\n    @Query(\"SELECT CASE WHEN COUNT(j) > 0 THEN true ELSE false END \" +\n           \"FROM EtlJob j \" +\n           \"WHERE j.status IN ('INICIADO', 'PROCESANDO', 'SINCRONIZANDO') \" +\n           \"AND j.jobId <> :jobId \" + // Exclude the current job from the check\n           \"AND j.minDate IS NOT NULL AND j.maxDate IS NOT NULL \" +\n           \"AND NOT (j.maxDate < :minDate OR j.minDate > :maxDate)\")\n    boolean existsActiveJobInDateRange(\n            @Param(\"jobId\") UUID jobId,\n            @Param(\"minDate\") LocalDate minDate,\n            @Param(\"maxDate\") LocalDate maxDate\n    );\n\n    long countByStatusIn(List<String> statuses);\n\n    @Query(\"SELECT COUNT(j) FROM EtlJob j WHERE j.status IN :statuses AND j.finishedAt IS NULL AND j.createdAt < :cutoff\")\n    long countStuck(@Param(\"statuses\") List<String> statuses, @Param(\"cutoff\") OffsetDateTime cutoff);\n\n    // markStuckAsFailed ahora se implementa v√≠a repositorio custom para evitar incompatibilidad JPQL con OffsetDateTime\n    int markStuckAsFailed(OffsetDateTime cutoff);\n}"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/RoleRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.Role;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.data.jpa.repository.Query;\nimport org.springframework.data.repository.query.Param;\n\nimport java.util.Optional;\n\n@SuppressWarnings(\"SqlNoDataSourceInspection\")\npublic interface RoleRepository extends JpaRepository<Role, Integer> {\n    Optional<Role> findByNameIgnoreCase(String name);\n    boolean existsByNameIgnoreCase(String name);\n\n    // IntelliJ sometimes warns \"No data sources are configured to run this SQL\" for\n    // native queries. Add both inline inspection suppression and @SuppressWarnings to silence the inspection.\n    //noinspection SqlNoDataSourceInspection\n    @SuppressWarnings(\"SqlNoDataSourceInspection\")\n    @Query(value = \"SELECT * FROM roles r WHERE CAST(:search AS TEXT) IS NULL OR :search = '' OR LOWER(r.name) LIKE LOWER(CONCAT('%', CAST(:search AS TEXT), '%'))\",\n           countQuery = \"SELECT COUNT(*) FROM roles r WHERE CAST(:search AS TEXT) IS NULL OR :search = '' OR LOWER(r.name) LIKE LOWER(CONCAT('%', CAST(:search AS TEXT), '%'))\",\n           nativeQuery = true)\n    Page<Role> search(@Param(\"search\") String search, Pageable pageable);\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/repository/DimMaquinaRepository.java",
      "excerpt": "package com.cambiaso.ioc.persistence.repository;\n\nimport com.cambiaso.ioc.persistence.entity.DimMaquina;\nimport org.springframework.data.jpa.repository.JpaRepository;\n\nimport java.util.Optional;\n\npublic interface DimMaquinaRepository extends JpaRepository<DimMaquina, Long> {\n    Optional<DimMaquina> findByCodigoMaquina(String codigoMaquina);\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/Planta.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport org.hibernate.annotations.CreationTimestamp;\nimport org.hibernate.annotations.UpdateTimestamp;\n\nimport java.time.OffsetDateTime;\n\n@Data\n@Entity\n@Table(name = \"plantas\", indexes = {\n        @Index(name = \"idx_plantas_code\", columnList = \"code\", unique = true)\n})\npublic class Planta {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Integer id;\n\n    @Column(nullable = false, length = 50, unique = true)\n    private String code;\n\n    @Column(nullable = false, length = 120)\n    private String name;\n\n    @Column(columnDefinition = \"text\")\n    private String address;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", nullable = false, updatable = false)\n    private OffsetDateTime createdAt;\n\n    @UpdateTimestamp\n    @Column(name = \"updated_at\", nullable = false)\n    private OffsetDateTime updatedAt;\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/EtlJob.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport org.hibernate.annotations.CreationTimestamp;\nimport java.time.OffsetDateTime;\nimport java.util.UUID;\n\n@Data\n@Entity\n@Table(name = \"etl_jobs\")\n@NoArgsConstructor\n@AllArgsConstructor\n@Builder\npublic class EtlJob {\n\n    @Id\n    @Column(name = \"job_id\")\n    private UUID jobId;\n\n    @Column(name = \"file_name\", nullable = false)\n    private String fileName;\n\n    @Column(name = \"file_hash\", nullable = false, unique = true)\n    private String fileHash;\n\n    @Column(name = \"user_id\", nullable = false)\n    private String userId;\n\n    @Column(name = \"min_date\")\n    private java.time.LocalDate minDate;\n\n    @Column(name = \"max_date\")\n    private java.time.LocalDate maxDate;\n\n    @Column(nullable = false)\n    private String status;\n\n    @Column\n    private String details;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", nullable = false, updatable = false)\n    private OffsetDateTime createdAt;\n\n    @Column(name = \"finished_at\")\n    private OffsetDateTime finishedAt;\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/DimMaquina.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport java.time.OffsetDateTime;\nimport org.hibernate.annotations.CreationTimestamp;\nimport org.hibernate.annotations.UpdateTimestamp;\n\n@Data\n@Entity\n@Table(name = \"dim_maquina\")\npublic class DimMaquina {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(name = \"codigo_maquina\", nullable = false, unique = true)\n    private String codigoMaquina;\n\n    @Column(name = \"nombre_maquina\")\n    private String nombreMaquina;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", nullable = false, updatable = false)\n    private OffsetDateTime createdAt;\n\n    @UpdateTimestamp\n    @Column(name = \"updated_at\", nullable = false)\n    private OffsetDateTime updatedAt;\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/QuarantinedRecord.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport java.time.OffsetDateTime;\nimport org.hibernate.annotations.CreationTimestamp;\n\n@Data\n@Entity\n@Table(name = \"quarantined_records\")\npublic class QuarantinedRecord {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"job_id\", nullable = false)\n    private EtlJob etlJob;\n\n    @Column(name = \"file_name\", nullable = false)\n    private String fileName;\n\n    @Column(name = \"line_number\")\n    private Integer lineNumber;\n\n    @Column(name = \"raw_line\", nullable = false)\n    private String rawLine;\n\n    @Column(name = \"error_details\", nullable = false)\n    private String errorDetails;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", nullable = false, updatable = false)\n    private OffsetDateTime createdAt;\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/RolePermission.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport org.hibernate.annotations.CreationTimestamp;\n\nimport java.time.OffsetDateTime;\n\n@Data\n@Entity\n@Table(name = \"role_permissions\")\npublic class RolePermission {\n\n    @EmbeddedId\n    private RolePermissionKey id;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @MapsId(\"roleId\")\n    @JoinColumn(name = \"role_id\")\n    private Role role;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @MapsId(\"permissionId\")\n    @JoinColumn(name = \"permission_id\")\n    private Permission permission;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", nullable = false, updatable = false)\n    private OffsetDateTime createdAt;\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/Permission.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\n\n@Data\n@Entity\n@Table(name = \"permissions\")\npublic class Permission {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Integer id;\n\n    @Column(nullable = false, unique = true, length = 150)\n    private String name;\n\n    private String description;\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/FactProduction.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport org.hibernate.Hibernate;\n\nimport java.math.BigDecimal;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\n\n@Data\n@Entity\n@Table(name = \"fact_production\")\npublic class FactProduction {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = \"fact_production_seq\")\n    @SequenceGenerator(\n        name = \"fact_production_seq\",\n        sequenceName = \"fact_production_id_seq\", // This should match the sequence name in your DB\n        allocationSize = 100\n    )\n    @Column(name = \"id\")\n    private Long id;\n\n    @Column(name = \"fecha_contabilizacion\", nullable = false)\n    private LocalDate fechaContabilizacion;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"maquina_fk\", nullable = false)\n    private DimMaquina maquina;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"maquinista_fk\")\n    private DimMaquinista maquinista;\n\n    @Column(name = \"numero_log\", nullable = false)\n    private Long numeroLog;\n\n    @Column(name = \"hora_contabilizacion\", nullable = false)\n    private LocalTime horaContabilizacion;\n\n    @Column(name = \"fecha_notificacion\", nullable = false)\n    private LocalDate fechaNotificacion;\n\n    @Column\n    private Long documento;\n\n    @Column(name = \"material_sku\", nullable = false)\n    private Long materialSku;\n\n    @Column(name = \"material_descripcion\")\n    private String materialDescripcion;\n\n    @Column(name = \"numero_pallet\")\n    private Integer numeroPallet;\n\n    @Column(nullable = false, precision = 18, scale = 4)\n    private BigDecimal cantidad;\n\n    @Column(name = \"peso_neto\", nullable = false, precision = 18, scale = 4)\n    private BigDecimal pesoNeto;\n\n    @Column(length = 10)\n    private String lista;\n\n    @Column(name = \"version_produccion\", length = 50)\n    private String versionProduccion;\n\n    @Column(name = \"centro_costos\")\n    private Long centroCostos;\n\n    @Column(nullable = false, le"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/DimMaquinista.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport java.time.OffsetDateTime;\nimport org.hibernate.annotations.CreationTimestamp;\nimport org.hibernate.annotations.UpdateTimestamp;\n\n@Data\n@Entity\n@Table(name = \"dim_maquinista\")\npublic class DimMaquinista {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(name = \"codigo_maquinista\", nullable = false, unique = true)\n    private Long codigoMaquinista;\n\n    @Column(name = \"nombre_completo\")\n    private String nombreCompleto;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", nullable = false, updatable = false)\n    private OffsetDateTime createdAt;\n\n    @UpdateTimestamp\n    @Column(name = \"updated_at\", nullable = false)\n    private OffsetDateTime updatedAt;\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/AppUser.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\n\nimport java.time.LocalDate;\nimport java.time.OffsetDateTime;\nimport java.util.Locale;\nimport java.util.UUID;\n\n@Data\n@Entity\n@Table(name = \"app_users\", indexes = {\n        @Index(name = \"idx_app_users_active\", columnList = \"is_active\"),\n        @Index(name = \"idx_app_users_supabase_uid\", columnList = \"supabase_user_id\"),\n        @Index(name = \"idx_app_users_planta\", columnList = \"planta_id\"),\n        @Index(name = \"idx_app_users_nombre\", columnList = \"primer_nombre, primer_apellido\")\n})\npublic class AppUser {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(name = \"supabase_user_id\", nullable = false, unique = true)\n    private UUID supabaseUserId;\n\n    @Column(name = \"email\", nullable = false, unique = true, columnDefinition = \"citext\")\n    private String email;\n\n    @Column(name = \"primer_nombre\", nullable = false)\n    private String primerNombre;\n\n    @Column(name = \"segundo_nombre\")\n    private String segundoNombre;\n\n    @Column(name = \"primer_apellido\", nullable = false)\n    private String primerApellido;\n\n    @Column(name = \"segundo_apellido\")\n    private String segundoApellido;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"planta_id\")\n    private Planta planta;\n\n    @Column(name = \"centro_costo\", length = 50)\n    private String centroCosto;\n\n    @Column(name = \"fecha_contrato\")\n    private LocalDate fechaContrato;\n\n    @Column(name = \"is_active\", nullable = false)\n    private boolean active = true;\n\n    @Column(name = \"last_login_at\")\n    private OffsetDateTime lastLoginAt;\n\n    @Column(name = \"created_at\", nullable = false)\n    private OffsetDateTime createdAt;\n\n    @Column(name = \"updated_at\", nullable = false)\n    private OffsetDateTime updatedAt;\n\n    @Column(name = \"deleted_at\")\n    private OffsetDateTime deletedAt;\n\n    @PrePersist\n    @PreUpdate\n    private void normalizeEmail() {\n        if"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/FactProductionId.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\n// Legacy composite FactProductionId removed after migration to simple PK.\n// This file is intentionally empty and can be deleted in a cleanup step.\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/Role.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport org.hibernate.annotations.CreationTimestamp;\nimport org.hibernate.annotations.UpdateTimestamp;\n\nimport java.time.OffsetDateTime;\n\n@Data\n@Entity\n@Table(name = \"roles\")\npublic class Role {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Integer id;\n\n    @Column(nullable = false, unique = true, length = 100)\n    private String name;\n\n    private String description;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", nullable = false, updatable = false)\n    private OffsetDateTime createdAt;\n\n    @UpdateTimestamp\n    @Column(name = \"updated_at\", nullable = false)\n    private OffsetDateTime updatedAt;\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/UserRoleKey.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.Column;\nimport jakarta.persistence.Embeddable;\nimport lombok.EqualsAndHashCode;\nimport lombok.Getter;\nimport lombok.Setter;\n\nimport java.io.Serializable;\n\n@Getter\n@Setter\n@EqualsAndHashCode\n@Embeddable\npublic class UserRoleKey implements Serializable {\n\n    @Column(name = \"user_id\")\n    private Long userId;\n\n    @Column(name = \"role_id\")\n    private Integer roleId;\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/RolePermissionKey.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.Column;\nimport jakarta.persistence.Embeddable;\nimport lombok.EqualsAndHashCode;\nimport lombok.Getter;\nimport lombok.Setter;\n\nimport java.io.Serializable;\n\n@Getter\n@Setter\n@EqualsAndHashCode\n@Embeddable\npublic class RolePermissionKey implements Serializable {\n\n    @Column(name = \"role_id\")\n    private Integer roleId;\n\n    @Column(name = \"permission_id\")\n    private Integer permissionId;\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/persistence/entity/UserRole.java",
      "excerpt": "package com.cambiaso.ioc.persistence.entity;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\n\nimport java.time.OffsetDateTime;\n\n@Data\n@Entity\n@Table(name = \"user_roles\", indexes = {\n        @Index(name = \"idx_user_roles_user\", columnList = \"user_id\"),\n        @Index(name = \"idx_user_roles_role\", columnList = \"role_id\")\n})\npublic class UserRole {\n\n    @EmbeddedId\n    private UserRoleKey id;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @MapsId(\"userId\")\n    @JoinColumn(name = \"user_id\")\n    private AppUser user;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @MapsId(\"roleId\")\n    @JoinColumn(name = \"role_id\")\n    private Role role;\n\n    @Column(name = \"assigned_at\", nullable = false)\n    private OffsetDateTime assignedAt;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"assigned_by_user_id\")\n    private AppUser assignedBy;\n\n    public UserRole() { }\n\n    public UserRole(Long userId, Integer roleId) {\n        this.id = new UserRoleKey();\n        this.id.setUserId(userId);\n        this.id.setRoleId(roleId);\n    }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/metrics/EtlJobMetricsRegistrar.java",
      "excerpt": "package com.cambiaso.ioc.metrics;\n\nimport com.cambiaso.ioc.persistence.repository.EtlJobRepository;\nimport io.micrometer.core.instrument.Gauge;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.stereotype.Component;\n\nimport javax.sql.DataSource;\nimport java.sql.Connection;\nimport java.sql.DatabaseMetaData;\nimport java.time.OffsetDateTime;\nimport java.util.List;\n\n/**\n * Registers Micrometer gauges for tracking active and stuck ETL jobs, plus UNIQUE index presence.\n */\n@Slf4j\n@Component\n@RequiredArgsConstructor\npublic class EtlJobMetricsRegistrar {\n\n    private final EtlJobRepository etlJobRepository;\n    private final MeterRegistry meterRegistry;\n    private final JdbcTemplate jdbcTemplate;\n    private final DataSource dataSource;\n\n    @Value(\"${etl.jobs.stuck.threshold-minutes:30}\")\n    private long stuckThresholdMinutes;\n\n    private static final List<String> ACTIVE_STATUSES = List.of(\"INICIADO\",\"PROCESANDO\",\"SINCRONIZANDO\");\n    private static final String UNIQUE_INDEX_SQL = \"SELECT 1 FROM pg_indexes WHERE tablename='fact_production' AND indexname='uq_fact_prod_natural'\";\n\n    private volatile Boolean postgres; // cache\n\n    private boolean isPostgres() {\n        if (postgres != null) return postgres;\n        try (Connection c = dataSource.getConnection()) {\n            DatabaseMetaData md = c.getMetaData();\n            postgres = md.getDatabaseProductName().toLowerCase().contains(\"postgres\");\n        } catch (Exception e) {\n            postgres = false;\n        }\n        return postgres;\n    }\n\n    @PostConstruct\n    void registerGauges() {\n        try {\n            // Gauges de jobs existentes\n            Gauge.builder(\"etl.jobs.active\", () -> etlJobRepository.countByStatusIn(ACTIVE_STATUSES))\n                    "
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/health/EtlHealthIndicator.java",
      "excerpt": "package com.cambiaso.ioc.health;\n\nimport org.springframework.boot.actuate.health.Health;\nimport org.springframework.boot.actuate.health.HealthIndicator;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Map;\n\n/**\n * HealthIndicator para exponer estado de integridad ETL\n */\n@Component\npublic class EtlHealthIndicator implements HealthIndicator {\n\n    private final JdbcTemplate jdbcTemplate;\n\n    private static final String UNIQUE_SQL = \"SELECT 1 FROM pg_indexes WHERE tablename='fact_production' AND indexname='uq_fact_prod_natural'\";\n    private static final String DUP_COUNT_SQL = \"SELECT COUNT(*) FROM (SELECT 1 FROM fact_production GROUP BY fecha_contabilizacion, maquina_fk, COALESCE(maquinista_fk,0), numero_log HAVING COUNT(*)>1) t\";\n    private static final String MAX_ID_SQL = \"SELECT COALESCE(MAX(id),0) FROM fact_production\";\n    private static final String SEQ_SQL = \"SELECT last_value FROM fact_production_id_seq\";\n    private static final String ROWCOUNT_SQL = \"SELECT reltuples::bigint FROM pg_class WHERE relname='fact_production'\";\n\n    public EtlHealthIndicator(JdbcTemplate jdbcTemplate) {\n        this.jdbcTemplate = jdbcTemplate;\n    }\n\n    @Override\n    public Health health() {\n        try {\n            boolean uniquePresent = !jdbcTemplate.queryForList(UNIQUE_SQL).isEmpty();\n            int duplicateGroups = jdbcTemplate.queryForObject(DUP_COUNT_SQL, Integer.class);\n            long maxId = jdbcTemplate.queryForObject(MAX_ID_SQL, Long.class);\n            long lastVal = jdbcTemplate.queryForObject(SEQ_SQL, Long.class);\n            boolean sequenceBehind = maxId >= lastVal;\n            long approxRows = jdbcTemplate.queryForObject(ROWCOUNT_SQL, Long.class);\n\n            Health.Builder builder = (uniquePresent && duplicateGroups == 0) ? Health.up() : Health.down();\n            builder.withDetails(Map.of(\n                    \"uniqueIndexPresent\", uniquePresent,\n                    \"duplicateGroup"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/validation/UniqueEmailValidator.java",
      "excerpt": "package com.cambiaso.ioc.validation;\n\nimport com.cambiaso.ioc.persistence.repository.AppUserRepository;\nimport jakarta.validation.ConstraintValidator;\nimport jakarta.validation.ConstraintValidatorContext;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Component;\n\n@Component\n@RequiredArgsConstructor\npublic class UniqueEmailValidator implements ConstraintValidator<UniqueEmail, String> {\n\n    private final AppUserRepository appUserRepository;\n\n    @Override\n    public boolean isValid(String value, ConstraintValidatorContext context) {\n        if (value == null || value.isBlank()) {\n            return true; // @NotBlank se valida aparte\n        }\n        return !appUserRepository.existsByEmailIgnoreCase(value);\n        }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/validation/ValidSupabaseUUIDValidator.java",
      "excerpt": "package com.cambiaso.ioc.validation;\n\nimport jakarta.validation.ConstraintValidator;\nimport jakarta.validation.ConstraintValidatorContext;\n\nimport java.util.UUID;\n\npublic class ValidSupabaseUUIDValidator implements ConstraintValidator<ValidSupabaseUUID, UUID> {\n    @Override\n    public boolean isValid(UUID value, ConstraintValidatorContext context) {\n        // Allow null; @NotNull should handle requiredness\n        if (value == null) return true;\n        return value.toString().matches(\"^[0-9a-fA-F-]{36}$\");\n    }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/validation/ValidSupabaseUUID.java",
      "excerpt": "package com.cambiaso.ioc.validation;\n\nimport jakarta.validation.Constraint;\nimport jakarta.validation.Payload;\n\nimport java.lang.annotation.Documented;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.Target;\n\nimport static java.lang.annotation.ElementType.FIELD;\nimport static java.lang.annotation.RetentionPolicy.RUNTIME;\n\n@Target({ FIELD })\n@Retention(RUNTIME)\n@Documented\n@Constraint(validatedBy = ValidSupabaseUUIDValidator.class)\npublic @interface ValidSupabaseUUID {\n    String message() default \"UUID inv√°lido\";\n    Class<?>[] groups() default {};\n    Class<? extends Payload>[] payload() default {};\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/validation/UniqueEmail.java",
      "excerpt": "package com.cambiaso.ioc.validation;\n\nimport jakarta.validation.Constraint;\nimport jakarta.validation.Payload;\n\nimport java.lang.annotation.Documented;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.Target;\n\nimport static java.lang.annotation.ElementType.FIELD;\nimport static java.lang.annotation.RetentionPolicy.RUNTIME;\n\n@Target({ FIELD })\n@Retention(RUNTIME)\n@Documented\n@Constraint(validatedBy = UniqueEmailValidator.class)\npublic @interface UniqueEmail {\n    String message() default \"Email ya est√° en uso\";\n    Class<?>[] groups() default {};\n    Class<? extends Payload>[] payload() default {};\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/DataSyncService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport com.cambiaso.ioc.persistence.repository.FactProductionRepository;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport io.micrometer.core.instrument.Counter;\nimport io.micrometer.core.instrument.Timer;\nimport io.micrometer.core.instrument.DistributionSummary;\nimport jakarta.persistence.EntityManager;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.dao.DataIntegrityViolationException;\nimport org.springframework.lang.NonNull;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport org.springframework.transaction.support.TransactionTemplate;\n\nimport java.time.Duration;\nimport java.time.LocalDate;\nimport java.util.List;\n\n@Slf4j\n@Service\n@RequiredArgsConstructor\npublic class DataSyncService {\n\n    private final FactProductionRepository factProductionRepository;\n    private final EntityManager entityManager; // Para advisory lock\n    private final MeterRegistry meterRegistry;\n    private final TransactionTemplate transactionTemplate; // Ejecuta bloques transaccionales expl√≠citos\n\n    @Value(\"${etl.lock.enabled:true}\")\n    private boolean etlLockEnabled;\n    @Value(\"${etl.retry.unique.enabled:false}\")\n    private boolean retryUniqueEnabled;\n    @Value(\"${etl.retry.unique.max-attempts:3}\")\n    private int retryMaxAttempts;\n    @Value(\"${etl.lock.test.sleep-ms:0}\")\n    private long lockTestSleepMs; // SOLO para pruebas: delay artificial tras tomar el lock\n    @Value(\"${etl.sync.test.sleep-ms:0}\")\n    private long syncTestSleepMs; // SOLO tests: pausa tras delete antes de inserts\n\n    // M√©tricas (lazily inicializadas)\n    private Counter rowsDeletedCounter() { return meterRegistry.counter(\"etl.rows.deleted\"); }\n    private Counter rowsIn"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/DimensionSyncService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.DimMaquina;\nimport com.cambiaso.ioc.persistence.entity.DimMaquinista;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinaRepository;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinistaRepository;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Propagation;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.util.List;\n\n@Slf4j\n@Service\n@RequiredArgsConstructor\npublic class DimensionSyncService {\n\n    private final DimMaquinaRepository maquinaRepository;\n    private final DimMaquinistaRepository maquinistaRepository;\n\n    @Transactional(propagation = Propagation.REQUIRES_NEW)\n    public List<DimMaquina> saveNewMaquinas(List<DimMaquina> newMaquinas) {\n        if (newMaquinas == null || newMaquinas.isEmpty()) {\n            return List.of();\n        }\n        List<DimMaquina> savedMaquinas = maquinaRepository.saveAll(newMaquinas);\n        log.info(\"Saved {} new DimMaquina entities in a new transaction.\", savedMaquinas.size());\n        return savedMaquinas;\n    }\n\n    @Transactional(propagation = Propagation.REQUIRES_NEW)\n    public List<DimMaquinista> saveNewMaquinistas(List<DimMaquinista> newMaquinistas) {\n        if (newMaquinistas == null || newMaquinistas.isEmpty()) {\n            return List.of();\n        }\n        List<DimMaquinista> savedMaquinistas = maquinistaRepository.saveAll(newMaquinistas);\n        log.info(\"Saved {} new DimMaquinista entities in a new transaction.\", savedMaquinistas.size());\n        return savedMaquinistas;\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/EtlProcessingService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.NotificationPayload;\nimport com.cambiaso.ioc.exception.FileValidationException;\nimport com.cambiaso.ioc.exception.JobConflictException;\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker;\nimport io.micrometer.core.annotation.Timed;\nimport io.micrometer.core.instrument.Counter;\nimport io.micrometer.core.instrument.DistributionSummary;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport io.micrometer.core.instrument.Timer;\nimport lombok.extern.slf4j.Slf4j;\nimport org.slf4j.MDC;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.scheduling.annotation.Async;\nimport org.springframework.stereotype.Service;\nimport org.springframework.web.multipart.MultipartFile;\n\nimport java.io.IOException;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.time.LocalDate;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.UUID;\n\n@Slf4j\n@Service\npublic class EtlProcessingService {\n\n    private final EtlJobService etlJobService;\n    private final NotificationService notificationService;\n    private final DataSyncService dataSyncService;\n    private final ParserService parserService;\n    private final MeterRegistry meterRegistry;\n\n    // Single constructor for autowiring with optional MeterRegistry\n    public EtlProcessingService(EtlJobService etlJobService,\n                               NotificationService notificationService,\n                               DataSyncService dataSyncService,\n                               ParserService parserService,\n                               @Autowired(required = false) MeterRegistry meterRegistry) {\n        this.etlJobService = etlJobService;\n        this.notificationService = notificationService;\n        this.dataSyncService = dataSyncService;\n        this.parserService = parserService;\n        this.meterR"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/EtlJobService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.EtlJob;\nimport com.cambiaso.ioc.persistence.repository.EtlJobRepository;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport io.micrometer.core.instrument.Timer;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.time.LocalDate;\nimport java.time.OffsetDateTime;\nimport java.util.Optional;\nimport java.util.UUID;\n\n@Slf4j\n@Service\n@RequiredArgsConstructor\n@Transactional\npublic class EtlJobService {\n\n    private final EtlJobRepository etlJobRepository;\n    @Autowired(required = false)\n    private MeterRegistry meterRegistry;\n\n    public EtlJob createJob(String fileName, String fileHash, String userId) {\n        EtlJob job = new EtlJob();\n        job.setJobId(UUID.randomUUID());\n        job.setFileName(fileName);\n        job.setFileHash(fileHash);\n        job.setUserId(userId);\n        job.setStatus(\"INICIADO\");\n        job.setCreatedAt(OffsetDateTime.now());\n\n        return etlJobRepository.save(job);\n    }\n\n    @Transactional(readOnly = true)\n    public Optional<EtlJob> findByFileHash(String fileHash) {\n        return etlJobRepository.findByFileHash(fileHash);\n    }\n\n    @Transactional(readOnly = true)\n    public Optional<EtlJob> findById(UUID jobId) {\n        return etlJobRepository.findById(jobId);\n    }\n\n    public void updateJobStatus(UUID jobId, String status, String details) {\n        EtlJob job = etlJobRepository.findById(jobId)\n                .orElseThrow(() -> new IllegalArgumentException(\"Job not found with ID: \" + jobId));\n\n        job.setStatus(status);\n        job.setDetails(details);\n\n        boolean terminal = \"EXITO\".equals(status) || \"FALLO\".equals(status);\n        if (terminal) {\n            job.setFinishedAt(OffsetDateTime.now());\n            if (meterRegistry "
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/NotificationService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.NotificationPayload;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.messaging.simp.SimpMessagingTemplate;\nimport org.springframework.stereotype.Service;\n\nimport java.util.Set;\nimport java.util.UUID;\nimport java.util.concurrent.ConcurrentHashMap;\n\n@Slf4j\n@Service\n@RequiredArgsConstructor\npublic class NotificationService {\n\n    private final SimpMessagingTemplate messagingTemplate;\n\n    // Track active user sessions for monitoring\n    private final Set<String> activeUsers = ConcurrentHashMap.newKeySet();\n\n    /**\n     * Sends a notification to a specific user about an ETL job status change\n     */\n    public void notifyUser(String userId, UUID jobId, NotificationPayload payload) {\n        if (!isValidInput(userId, jobId, payload)) {\n            log.warn(\"Invalid notification parameters: userId={}, jobId={}, payload={}\", userId, jobId, payload);\n            return;\n        }\n\n        String destination = String.format(\"/topic/etl-jobs/%s\", jobId);\n        try {\n            messagingTemplate.convertAndSendToUser(userId, destination, payload);\n            activeUsers.add(userId);\n            log.debug(\"Notification sent to user {} for job {}: {}\", userId, jobId, payload.getStatus());\n        } catch (Exception e) {\n            log.error(\"Failed to send notification to user {} for job {}: {}\", userId, jobId, e.getMessage(), e);\n            throw new NotificationException(\"Failed to send notification\", e);\n        }\n    }\n\n    /**\n     * Broadcasts a notification to all users subscribed to a specific job\n     */\n    public void broadcastJobUpdate(UUID jobId, NotificationPayload payload) {\n        if (jobId == null || payload == null) {\n            log.warn(\"Invalid broadcast parameters: jobId={}, payload={}\", jobId, payload);\n            return;\n        }\n\n        String destination = String.format(\"/topic/etl-jobs/%s\", jobId);\n        try {\n            messa"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/RoleService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.request.RoleRequest;\nimport com.cambiaso.ioc.dto.response.RoleResponse;\nimport com.cambiaso.ioc.exception.ResourceConflictException;\nimport com.cambiaso.ioc.exception.ResourceNotFoundException;\nimport com.cambiaso.ioc.mapper.RoleMapper;\nimport com.cambiaso.ioc.persistence.entity.Role;\nimport com.cambiaso.ioc.persistence.repository.RolePermissionRepository;\nimport com.cambiaso.ioc.persistence.repository.RoleRepository;\nimport com.cambiaso.ioc.persistence.repository.UserRoleRepository;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.util.List;\n\n@Service\n@RequiredArgsConstructor\n@Transactional\npublic class RoleService {\n\n    private final RoleRepository roleRepository;\n    private final UserRoleRepository userRoleRepository;\n    private final RolePermissionRepository rolePermissionRepository;\n    private final RoleMapper roleMapper;\n\n    @Transactional(readOnly = true)\n    public Page<Role> search(String search, Pageable pageable) {\n        return roleRepository.search((search == null || search.isBlank()) ? null : search.trim(), pageable);\n    }\n\n    @Transactional(readOnly = true)\n    public Role getById(Integer id) {\n        return roleRepository.findById(id)\n                .orElseThrow(() -> new ResourceNotFoundException(\"Role not found: \" + id));\n    }\n\n    @Transactional(readOnly = true)\n    public RoleResponse getByIdWithDetails(Integer id) {\n        Role role = getById(id);\n        return enrichResponse(role);\n    }\n\n    @Transactional(readOnly = true)\n    public Page<RoleResponse> searchWithDetails(String search, Pageable pageable) {\n        Page<Role> roles = search(search, pageable);\n        return roles.map(this::enrichResponse);\n    }\n\n    private RoleResponse enrichResponse(Role role) {\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/EtlJobWatchdog.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.repository.EtlJobRepository;\nimport io.micrometer.core.instrument.Counter;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\nimport org.springframework.scheduling.annotation.Scheduled;\nimport org.springframework.stereotype.Component;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.time.OffsetDateTime;\n\n@Slf4j\n@Component\n@RequiredArgsConstructor\n@ConditionalOnProperty(name = \"etl.jobs.watchdog.enabled\", havingValue = \"true\", matchIfMissing = true)\npublic class EtlJobWatchdog {\n\n    private final EtlJobRepository etlJobRepository;\n    private final MeterRegistry meterRegistry;\n\n    @Value(\"${etl.jobs.stuck.threshold-minutes:30}\")\n    private long stuckThresholdMinutes;\n\n    // Interval configurable in ms (fixed delay between executions end->start)\n    @Value(\"${etl.jobs.watchdog.interval-ms:60000}\")\n    private long intervalMs;\n\n    private Counter terminationsCounter() {\n        return Counter.builder(\"etl.jobs.watchdog.terminations\")\n                .description(\"Count of ETL jobs force-failed by watchdog due to timeout\")\n                .register(meterRegistry);\n    }\n\n    @Scheduled(fixedDelayString = \"${etl.jobs.watchdog.interval-ms:60000}\")\n    @Transactional\n    public void scheduledRun() {\n        runOnceInternal();\n    }\n\n    @Transactional\n    public int runOnce() { // For tests\n        return runOnceInternal();\n    }\n\n    private int runOnceInternal() {\n        OffsetDateTime cutoff = OffsetDateTime.now().minusMinutes(stuckThresholdMinutes);\n        int updated = etlJobRepository.markStuckAsFailed(cutoff);\n        if (updated > 0) {\n            terminationsCounter().increment(updated);\n            log.warn(\"Watchdog terminated {} stuck ETL job(s) ol"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/ParserService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.persistence.entity.DimMaquina;\nimport com.cambiaso.ioc.persistence.entity.DimMaquinista;\nimport com.cambiaso.ioc.persistence.entity.FactProduction;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinaRepository;\nimport com.cambiaso.ioc.persistence.repository.DimMaquinistaRepository;\nimport io.micrometer.core.instrument.Counter;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport io.micrometer.core.instrument.Timer;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Service;\n\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.math.BigDecimal;\nimport java.time.Duration;\nimport java.time.LocalDate;\nimport java.time.LocalTime;\nimport java.time.format.DateTimeFormatter;\nimport java.util.*;\nimport java.util.concurrent.atomic.AtomicReference;\nimport java.util.function.BiConsumer;\nimport java.util.stream.Collectors;\n\n@Slf4j\n@Service\npublic class ParserService {\n\n    private static final DateTimeFormatter DATE_FORMATTER = DateTimeFormatter.ofPattern(\"dd.MM.yyyy\");\n    private static final DateTimeFormatter TIME_FORMATTER = DateTimeFormatter.ofPattern(\"HH:mm:ss\");\n\n    private final DimMaquinaRepository maquinaRepository;\n    private final DimMaquinistaRepository maquinistaRepository;\n    private final MeterRegistry meterRegistry;\n\n    public ParserService(DimMaquinaRepository maquinaRepository,\n                         DimMaquinistaRepository maquinistaRepository,\n                         MeterRegistry meterRegistry) {\n        this.maquinaRepository = maquinaRepository;\n        this.maquinistaRepository = maquinistaRepository;\n        this.meterRegistry = meterRegistry;\n    }\n\n    // Metrics helpers\n    private Counter rowsParsedCounter() { return meterRegistry.counter(\"etl.rows.parsed\"); }\n    private Counter rowsDuplicateSkippedCounter() { return meterRegistry.counter(\"etl.rows.duplicate.skipped\"); }\n "
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/PermissionService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.request.PermissionRequest;\nimport com.cambiaso.ioc.exception.ResourceConflictException;\nimport com.cambiaso.ioc.exception.ResourceNotFoundException;\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport com.cambiaso.ioc.persistence.repository.PermissionRepository;\nimport com.cambiaso.ioc.persistence.repository.RolePermissionRepository;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\n@Service\n@RequiredArgsConstructor\n@Transactional\npublic class PermissionService {\n\n    private final PermissionRepository permissionRepository;\n    private final RolePermissionRepository rolePermissionRepository;\n\n    @Transactional(readOnly = true)\n    public Page<Permission> search(String search, Pageable pageable) {\n        return permissionRepository.search((search == null || search.isBlank()) ? null : search.trim(), pageable);\n    }\n\n    @Transactional(readOnly = true)\n    public Permission getById(Integer id) {\n        return permissionRepository.findById(id)\n                .orElseThrow(() -> new ResourceNotFoundException(\"Permission not found: \" + id));\n    }\n\n    public Permission create(PermissionRequest request) {\n        String name = request.getName().trim();\n        if (permissionRepository.existsByNameIgnoreCase(name)) {\n            throw new ResourceConflictException(\"Permission name already exists: \" + name);\n        }\n        Permission permission = new Permission();\n        permission.setName(name);\n        permission.setDescription(request.getDescription());\n        return permissionRepository.save(permission);\n    }\n\n    public Permission update(Integer id, PermissionRequest request) {\n        Permission existing = getById(id);\n        String newName = request.getName().trim();\n        existing.setDescr"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/MetabaseEmbeddingService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.config.MetabaseProperties;\nimport com.cambiaso.ioc.exception.DashboardAccessDeniedException;\nimport com.cambiaso.ioc.exception.DashboardNotFoundException;\nimport com.cambiaso.ioc.security.CustomUserDetails;\nimport io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker;\nimport io.jsonwebtoken.Jwts;\nimport io.jsonwebtoken.security.Keys;\nimport io.micrometer.core.instrument.MeterRegistry;\nimport io.micrometer.core.instrument.Timer;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.cache.annotation.Cacheable;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.stereotype.Service;\n\nimport javax.crypto.SecretKey;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Date;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeUnit;\n\n@Service\n@Slf4j\npublic class MetabaseEmbeddingService {\n\n    private final MetabaseProperties properties;\n    private final SecretKey key;\n    private final DashboardAuditService auditService;\n    private final MeterRegistry meterRegistry;\n\n    public MetabaseEmbeddingService(\n            MetabaseProperties properties,\n            DashboardAuditService auditService,\n            MeterRegistry meterRegistry\n    ) {\n        this.properties = properties;\n        this.auditService = auditService;\n        this.meterRegistry = meterRegistry;\n        \n        validateSecretKey(properties.getSecretKey());\n        \n        this.key = Keys.hmacShaKeyFor(\n            properties.getSecretKey().getBytes(StandardCharsets.UTF_8)\n        );\n        \n        log.info(\"MetabaseEmbeddingService initialized successfully with {} configured dashboards\", \n            properties.getDashboards().size());\n    }\n\n    private void validateSecretKey(String secretKey) {\n        if (secretKey == null || secretKey.isBlank()) {\n            throw new IllegalStateException(\n                \"Metabase secret key is required. Set METABASE_SECR"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/DashboardAuditService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Service;\n\nimport java.time.LocalDateTime;\n\n@Service\n@Slf4j\n@RequiredArgsConstructor\npublic class DashboardAuditService {\n    \n    // TODO: Inyectar un futuro AuditLogRepository cuando est√© disponible para persistir los logs.\n    // private final AuditLogRepository auditLogRepository;\n    \n    /**\n     * Registra un evento de acceso a un dashboard.\n     * @param username El nombre del usuario que intenta acceder.\n     * @param dashboardId El ID del dashboard solicitado.\n     * @param dashboardName El nombre del dashboard (si se conoce).\n     * @param granted Si el acceso fue concedido o denegado.\n     */\n    public void logDashboardAccess(\n            String username, \n            int dashboardId, \n            String dashboardName, \n            boolean granted\n    ) {\n        LocalDateTime timestamp = LocalDateTime.now();\n        \n        if (granted) {\n            log.info(\"AUDIT: Dashboard access GRANTED - User: [{}], Dashboard ID: [{}], Dashboard Name: [{}], Timestamp: [{}]\", \n                username, dashboardId, dashboardName, timestamp);\n        } else {\n            log.warn(\"AUDIT: Dashboard access DENIED - User: [{}], Dashboard ID: [{}], Timestamp: [{}]\", \n                username, dashboardId, timestamp);\n        }\n        \n        // TODO: Descomentar y adaptar cuando el repositorio de auditor√≠a est√© disponible.\n        // AuditLog auditLog = new AuditLog(username, dashboardId, dashboardName, granted, timestamp);\n        // auditLogRepository.save(auditLog);\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/UserAdminService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.dto.request.UsuarioCreateRequest;\nimport com.cambiaso.ioc.dto.request.UsuarioUpdateRequest;\nimport com.cambiaso.ioc.exception.ResourceConflictException;\nimport com.cambiaso.ioc.exception.ResourceNotFoundException;\nimport com.cambiaso.ioc.mapper.UsuarioMapper;\nimport com.cambiaso.ioc.persistence.entity.AppUser;\nimport com.cambiaso.ioc.persistence.entity.Planta;\nimport com.cambiaso.ioc.persistence.entity.Role;\nimport com.cambiaso.ioc.persistence.entity.UserRole;\nimport com.cambiaso.ioc.persistence.entity.UserRoleKey;\nimport com.cambiaso.ioc.persistence.repository.AppUserRepository;\nimport com.cambiaso.ioc.persistence.repository.AppUserSearchRepository;\nimport com.cambiaso.ioc.persistence.repository.PlantaRepository;\nimport com.cambiaso.ioc.persistence.repository.RoleRepository;\nimport com.cambiaso.ioc.persistence.repository.UserRoleRepository;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.time.OffsetDateTime;\nimport java.util.List;\nimport java.util.UUID;\n\n@Service\n@RequiredArgsConstructor\n@Transactional\n@Slf4j\npublic class UserAdminService {\n\n    private final AppUserRepository appUserRepository;\n    private final AppUserSearchRepository appUserSearchRepository;\n    private final PlantaRepository plantaRepository;\n    private final UserRoleRepository userRoleRepository;\n    private final RoleRepository roleRepository;\n    private final UsuarioMapper usuarioMapper;\n    private final SupabaseAuthService supabaseAuthService;\n\n    @Transactional(readOnly = true)\n    public Page<com.cambiaso.ioc.dto.response.UsuarioResponse> search(String search, Integer plantaId, Boolean isActive, Pageable pageable) {\n        Page<AppUser> page = appUserSearchRepository.search((search == n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/SupabaseAuthService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Service;\nimport org.springframework.web.reactive.function.client.WebClient;\nimport org.springframework.web.reactive.function.client.WebClientResponseException;\n\nimport java.util.Map;\nimport java.util.UUID;\n\n/**\n * Service for interacting with Supabase Auth Admin API\n * This allows the backend to create users automatically without requiring\n * the admin to manually create accounts in Supabase dashboard\n */\n@Service\n@Slf4j\npublic class SupabaseAuthService {\n\n    @Value(\"${supabase.url}\")\n    private String supabaseUrl;\n\n    @Value(\"${supabase.service-role-key}\")\n    private String serviceRoleKey;\n\n    private final WebClient.Builder webClientBuilder;\n\n    // Explicit constructor to ensure Spring-based injection is recognized by IDE and runtime\n    public SupabaseAuthService(WebClient.Builder webClientBuilder) {\n        this.webClientBuilder = webClientBuilder;\n    }\n\n    /**\n     * Creates a user in Supabase Auth using the Admin API\n     *\n     * @param email Email of the user\n     * @param password Temporary password for the user\n     * @return UUID of the created user in Supabase Auth\n     * @throws RuntimeException if user creation fails\n     */\n    public UUID createSupabaseUser(String email, String password) {\n        log.info(\"Creating Supabase user for email: {}\", email);\n\n        WebClient webClient = webClientBuilder\n            .baseUrl(supabaseUrl)\n            .defaultHeader(\"apikey\", serviceRoleKey)\n            .defaultHeader(\"Authorization\", \"Bearer \" + serviceRoleKey)\n            .defaultHeader(\"Content-Type\", \"application/json\")\n            .build();\n\n        Map<String, Object> requestBody = Map.of(\n            \"email\", email,\n            \"password\", password,\n            \"email_confirm\", true,  // Auto-confirm email\n            \"app_metadata\", Map.of(\"role\", \"user\")\n        );\n\n        tr"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/service/AssignmentService.java",
      "excerpt": "package com.cambiaso.ioc.service;\n\nimport com.cambiaso.ioc.exception.ResourceNotFoundException;\nimport com.cambiaso.ioc.persistence.entity.AppUser;\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport com.cambiaso.ioc.persistence.entity.Role;\nimport com.cambiaso.ioc.persistence.entity.RolePermission;\nimport com.cambiaso.ioc.persistence.entity.RolePermissionKey;\nimport com.cambiaso.ioc.persistence.entity.UserRole;\nimport com.cambiaso.ioc.persistence.entity.UserRoleKey;\nimport com.cambiaso.ioc.persistence.repository.AppUserRepository;\nimport com.cambiaso.ioc.persistence.repository.PermissionRepository;\nimport com.cambiaso.ioc.persistence.repository.RolePermissionRepository;\nimport com.cambiaso.ioc.persistence.repository.RoleRepository;\nimport com.cambiaso.ioc.persistence.repository.UserRoleRepository;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.time.OffsetDateTime;\nimport java.util.Optional;\n\n@Service\n@RequiredArgsConstructor\n@Transactional\npublic class AssignmentService {\n\n    private final AppUserRepository appUserRepository;\n    private final RoleRepository roleRepository;\n    private final PermissionRepository permissionRepository;\n    private final UserRoleRepository userRoleRepository;\n    private final RolePermissionRepository rolePermissionRepository;\n\n    public void assignRoleToUser(Long userId, Integer roleId, Long assignedByUserId) {\n        AppUser user = appUserRepository.findById(userId)\n                .orElseThrow(() -> new ResourceNotFoundException(\"User not found: \" + userId));\n        Role role = roleRepository.findById(roleId)\n                .orElseThrow(() -> new ResourceNotFoundException(\"Role not found: \" + roleId));\n\n        boolean exists = userRoleRepository.existsByIdUserIdAndIdRoleId(userId, roleId);\n        if (exists) return; // idempotent\n\n        UserRole ur = new UserRole();\n        UserRoleKey key = new Us"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/controller/DashboardController.java",
      "excerpt": "package com.cambiaso.ioc.controller;\n\nimport com.cambiaso.ioc.service.MetabaseEmbeddingService;\nimport io.github.resilience4j.ratelimiter.annotation.RateLimiter;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.validation.annotation.Validated;\nimport org.springframework.web.bind.annotation.*;\n\nimport jakarta.validation.constraints.Min;\nimport jakarta.validation.constraints.Max;\nimport java.util.Map;\n\n@RestController\n@RequestMapping(\"/api/v1/dashboards\")\n@RequiredArgsConstructor\n@Slf4j\n@Validated\npublic class DashboardController {\n\n    private final MetabaseEmbeddingService embeddingService;\n\n    /**\n     * Obtiene una URL firmada para incrustar un dashboard de Metabase.\n     * \n     * @param dashboardId ID del dashboard (1-999999)\n     * @param authentication Informaci√≥n del usuario autenticado (inyectada por Spring Security)\n     * @return Objeto JSON con la URL firmada y tiempo de expiraci√≥n\n     */\n    @GetMapping(\"/{dashboardId}\")\n    @RateLimiter(name = \"dashboardAccess\")\n    public ResponseEntity<Map<String, Object>> getDashboardUrl(\n            @PathVariable \n            @Min(value = 1, message = \"Dashboard ID must be at least 1\") \n            @Max(value = 999999, message = \"Dashboard ID must be at most 999999\") \n            int dashboardId,\n            Authentication authentication\n    ) {\n        log.info(\"Dashboard URL requested - User: {}, Dashboard ID: {}\", \n            authentication.getName(), dashboardId);\n        \n        String signedUrl = embeddingService.getSignedDashboardUrl(dashboardId, authentication);\n        \n        return ResponseEntity.ok(Map.of(\n            \"signedUrl\", signedUrl,\n            \"expiresInMinutes\", 10, // Deber√≠a coincidir con la config\n            \"dashboardId\", dashboardId\n        ));\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/controller/EtlController.java",
      "excerpt": "package com.cambiaso.ioc.controller;\n\nimport com.cambiaso.ioc.dto.EtlJobStatusDto;\nimport com.cambiaso.ioc.exception.JobConflictException;\nimport com.cambiaso.ioc.persistence.entity.EtlJob;\nimport com.cambiaso.ioc.service.EtlJobService;\nimport com.cambiaso.ioc.service.EtlProcessingService;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.security.core.annotation.AuthenticationPrincipal;\nimport org.springframework.security.oauth2.jwt.Jwt;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\n\nimport jakarta.validation.constraints.NotNull;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.UUID;\nimport java.util.Objects;\n\n@Slf4j\n@RestController\n@RequestMapping(\"/api/etl\")\n@RequiredArgsConstructor\npublic class EtlController {\n\n    private final EtlProcessingService etlProcessingService;\n    private final EtlJobService etlJobService;\n\n    // Maximum file size: 50MB\n    private static final long MAX_FILE_SIZE = 50 * 1024 * 1024;\n\n    @PostMapping(\"/start-process\")\n    @PreAuthorize(\"isAuthenticated()\")\n    public ResponseEntity<Map<String, Object>> startEtlProcess(\n            @RequestParam(\"file\") @NotNull MultipartFile file,\n            @AuthenticationPrincipal Jwt jwt) {\n\n        // Enhanced file validation (includes null/empty checks)\n        validateFile(file);\n\n        // Ensure non-null filename for downstream usage\n        final String originalFilename = Objects.requireNonNull(file.getOriginalFilename(), \"File name cannot be null\");\n\n        log.info(\"Starting ETL process for file: {} by user: {}\",\n                originalFilename, jwt.getSubject());\n\n        String userId = jwt.getSubject();\n        String fileHash = etlProcessingService.calculateFileHash(file);\n\n        // Idempotency check\n        Optional<EtlJob> existingJob = etlJo"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/controller/admin/RoleController.java",
      "excerpt": "package com.cambiaso.ioc.controller.admin;\n\nimport com.cambiaso.ioc.dto.request.RoleRequest;\nimport com.cambiaso.ioc.dto.response.RoleResponse;\nimport com.cambiaso.ioc.mapper.RoleMapper;\nimport com.cambiaso.ioc.persistence.entity.Role;\nimport com.cambiaso.ioc.service.RoleService;\nimport jakarta.validation.Valid;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.data.domain.Sort;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.net.URI;\n\n@RestController\n@RequestMapping(\"/api/v1/admin/roles\")\n@RequiredArgsConstructor\npublic class RoleController {\n\n    private final RoleService roleService;\n    private final RoleMapper roleMapper;\n\n    @GetMapping\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n    public ResponseEntity<Page<RoleResponse>> search(\n            @RequestParam(value = \"search\", required = false) String search,\n            Pageable pageable) {\n        // Ensure we have a safe pageable with proper boundaries\n        Pageable effective = clamp(pageable);\n\n        // If no explicit sort was provided, use unsorted to avoid potential issues\n        if (effective.getSort().isUnsorted() || effective.getSort().isEmpty()) {\n            effective = PageRequest.of(effective.getPageNumber(), effective.getPageSize(), Sort.unsorted());\n        }\n\n        Page<RoleResponse> page = roleService.searchWithDetails(search, effective);\n        return ResponseEntity.ok(page);\n    }\n\n    @GetMapping(\"/{id}\")\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n    public ResponseEntity<RoleResponse> getById(@PathVariable Integer id) {\n        RoleResponse response = roleService.getByIdWithDetails(id);\n        return ResponseEntity.ok(response);\n    }\n\n    @PostMapping\n    @PreAuthorize(\"hasAuthority('"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/controller/admin/AdminUserController.java",
      "excerpt": "package com.cambiaso.ioc.controller.admin;\n\nimport com.cambiaso.ioc.dto.request.UsuarioCreateRequest;\nimport com.cambiaso.ioc.dto.request.UsuarioUpdateRequest;\nimport com.cambiaso.ioc.dto.response.UsuarioResponse;\nimport com.cambiaso.ioc.service.UserAdminService;\nimport io.swagger.v3.oas.annotations.Parameter;\nimport jakarta.validation.Valid;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.net.URI;\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/admin/users\")\n@RequiredArgsConstructor\npublic class AdminUserController {\n\n    private final UserAdminService userAdminService;\n\n    @GetMapping\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n    public ResponseEntity<Page<UsuarioResponse>> search(\n            @RequestParam(value = \"search\", required = false) String search,\n            @RequestParam(value = \"plantaId\", required = false) Integer plantaId,\n            @RequestParam(value = \"isActive\", required = false) Boolean isActive,\n            @Parameter(\n                    description = \"Paginaci√≥n y ordenamiento. Ejemplos: sort=email,asc o sort=createdAt,desc\",\n                    example = \"email,asc\"\n            )\n            Pageable pageable) {\n        Pageable effective = clamp(pageable);\n        Page<com.cambiaso.ioc.dto.response.UsuarioResponse> page = userAdminService.search(search, plantaId, isActive, effective);\n        List<UsuarioResponse> content = page.getContent();\n        Page<UsuarioResponse> mapped = new PageImpl<>(content, effective, page.getTotalElements());\n        return ResponseEntity.ok(mapped);\n    }\n\n    @GetMapping(\"/{id}\")\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\""
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/controller/admin/PermissionController.java",
      "excerpt": "package com.cambiaso.ioc.controller.admin;\n\nimport com.cambiaso.ioc.dto.request.PermissionRequest;\nimport com.cambiaso.ioc.dto.response.PermissionResponse;\nimport com.cambiaso.ioc.mapper.PermissionMapper;\nimport com.cambiaso.ioc.persistence.entity.Permission;\nimport com.cambiaso.ioc.service.PermissionService;\nimport jakarta.validation.Valid;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageImpl;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.net.URI;\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/admin/permissions\")\n@RequiredArgsConstructor\npublic class PermissionController {\n\n    private final PermissionService permissionService;\n    private final PermissionMapper permissionMapper;\n\n    @GetMapping\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n    public ResponseEntity<Page<PermissionResponse>> search(\n            @RequestParam(value = \"search\", required = false) String search,\n            Pageable pageable) {\n        Pageable effective = clamp(pageable);\n        Page<Permission> page = permissionService.search(search, effective);\n        List<PermissionResponse> content = page.getContent().stream()\n                .map(permissionMapper::toResponse)\n                .toList();\n        Page<PermissionResponse> mapped = new PageImpl<>(content, effective, page.getTotalElements());\n        return ResponseEntity.ok(mapped);\n    }\n\n    @GetMapping(\"/{id}\")\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n    public ResponseEntity<PermissionResponse> getById(@PathVariable Integer id) {\n        Permission permission = permissionService.getById(id);\n        return ResponseEntity.ok(permissionMapper.toResponse(permission));\n    }\n\n    @PostMapping\n    @Pr"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/controller/admin/AssignmentController.java",
      "excerpt": "package com.cambiaso.ioc.controller.admin;\n\nimport com.cambiaso.ioc.service.AssignmentService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.web.bind.annotation.*;\n\n@RestController\n@RequestMapping(\"/api/v1/admin/assignments\")\n@RequiredArgsConstructor\npublic class AssignmentController {\n\n    private final AssignmentService assignmentService;\n\n    @PostMapping(\"/users/{userId}/roles/{roleId}\")\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n    public ResponseEntity<Void> assignRoleToUser(\n            @PathVariable Long userId,\n            @PathVariable Integer roleId,\n            @RequestParam(value = \"assignedBy\", required = false) Long assignedBy) {\n        assignmentService.assignRoleToUser(userId, roleId, assignedBy);\n        return ResponseEntity.ok().build();\n    }\n\n    @DeleteMapping(\"/users/{userId}/roles/{roleId}\")\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n    public ResponseEntity<Void> removeRoleFromUser(@PathVariable Long userId, @PathVariable Integer roleId) {\n        assignmentService.removeRoleFromUser(userId, roleId);\n        return ResponseEntity.noContent().build();\n    }\n\n    @PostMapping(\"/roles/{roleId}/permissions/{permissionId}\")\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n    public ResponseEntity<Void> assignPermissionToRole(@PathVariable Integer roleId, @PathVariable Integer permissionId) {\n        assignmentService.assignPermissionToRole(roleId, permissionId);\n        return ResponseEntity.ok().build();\n    }\n\n    @DeleteMapping(\"/roles/{roleId}/permissions/{permissionId}\")\n    @PreAuthorize(\"hasAuthority('ROLE_ADMIN')\")\n    public ResponseEntity<Void> removePermissionFromRole(@PathVariable Integer roleId, @PathVariable Integer permissionId) {\n        assignmentService.removePermissionFromRole(roleId, permissionId);\n        return ResponseEntity.noContent().build();\n    }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/interceptor/RateLimitInterceptor.java",
      "excerpt": "package com.cambiaso.ioc.interceptor;\n\nimport com.cambiaso.ioc.config.RateLimitingConfig;\nimport io.github.bucket4j.Bucket;\nimport io.github.bucket4j.ConsumptionProbe;\nimport jakarta.servlet.http.HttpServletRequest;\nimport jakarta.servlet.http.HttpServletResponse;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.ObjectProvider;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.lang.NonNull;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.servlet.HandlerInterceptor;\n\n@Slf4j\n@Component\n@RequiredArgsConstructor\npublic class RateLimitInterceptor implements HandlerInterceptor {\n\n    // make the config optional for test slices by using ObjectProvider\n    private final ObjectProvider<RateLimitingConfig> rateLimitingConfigProvider;\n\n    @Override\n    public boolean preHandle(@NonNull HttpServletRequest request, @NonNull HttpServletResponse response, @NonNull Object handler) throws Exception {\n        // Only apply rate limiting to ETL endpoints\n        if (!request.getRequestURI().startsWith(\"/api/etl/\")) {\n            return true;\n        }\n\n        // obtain the actual config bean if present\n        RateLimitingConfig rateLimitingConfig = rateLimitingConfigProvider.getIfAvailable();\n        if (rateLimitingConfig == null) {\n            // No rate limiting configured in this context (e.g. lightweight test slice) - allow through\n            log.debug(\"RateLimitingConfig bean not present; skipping rate limit checks\");\n            return true;\n        }\n\n        String userId = getUserId();\n        if (userId == null) {\n            userId = request.getRemoteAddr(); // Fallback to IP address\n        }\n\n        Bucket bucket = rateLimitingConfig.resolveBucket(userId);\n        ConsumptionProbe probe = bucket.tryConsumeAndReturnRemaining"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/OpenApiConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport io.swagger.v3.oas.annotations.OpenAPIDefinition;\nimport io.swagger.v3.oas.annotations.enums.SecuritySchemeType;\nimport io.swagger.v3.oas.annotations.info.Contact;\nimport io.swagger.v3.oas.annotations.info.Info;\nimport io.swagger.v3.oas.annotations.info.License;\nimport io.swagger.v3.oas.annotations.security.SecurityRequirement;\nimport io.swagger.v3.oas.annotations.security.SecurityScheme;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\n@OpenAPIDefinition(\n        info = @Info(\n                title = \"IOC Backend API\",\n                version = \"1.0.0\",\n                description = \"API para la plataforma de Inteligencia Operacional Cambiaso. \\n\\n\" +\n                        \"**Autenticaci√≥n:** Usa JWT Bearer Token. Obt√©n tu token de Supabase Auth y p√©galo en el bot√≥n 'Authorize' abajo. \\n\" +\n                        \"**Roles:** Los endpoints administrativos (`/api/admin/**`) requieren el rol `ADMIN`.\",\n                contact = @Contact(\n                        name = \"Equipo de Desarrollo IOC\",\n                        email = \"dev@cambiaso.com\"\n                ),\n                license = @License(\n                        name = \"Apache 2.0\",\n                        url = \"http://www.apache.org/licenses/LICENSE-2.0.html\"\n                )\n        ),\n        security = {@SecurityRequirement(name = \"bearerAuth\")}\n)\n@SecurityScheme(\n        name = \"bearerAuth\",\n        type = SecuritySchemeType.HTTP,\n        bearerFormat = \"JWT\",\n        scheme = \"bearer\",\n        description = \"JWT Bearer Token (ej: eyJhbGci...)\"\n)\npublic class OpenApiConfig {\n    // Esta clase no necesita m√©todos, las anotaciones hacen la configuraci√≥n.\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/JpaAuditingConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.jpa.repository.config.EnableJpaAuditing;\n\n@Configuration\n@EnableJpaAuditing\npublic class JpaAuditingConfig {\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/WebSocketConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.messaging.simp.config.MessageBrokerRegistry;\nimport org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;\nimport org.springframework.web.socket.config.annotation.StompEndpointRegistry;\nimport org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;\n\n@Configuration\n@EnableWebSocketMessageBroker\npublic class WebSocketConfig implements WebSocketMessageBrokerConfigurer {\n\n    @Override\n    public void configureMessageBroker(MessageBrokerRegistry config) {\n        // Prefijo para los destinos de los mensajes que vienen del cliente al servidor.\n        // Ejemplo: El cliente env√≠a a /app/hello\n        config.setApplicationDestinationPrefixes(\"/app\");\n        \n        // Prefijo para los destinos de los mensajes que van del servidor al cliente (broadcast).\n        // Habilita un message broker en memoria simple.\n        // Ejemplo: El servidor env√≠a a /topic/greetings\n        config.enableSimpleBroker(\"/topic\");\n    }\n\n    @Override\n    public void registerStompEndpoints(StompEndpointRegistry registry) {\n        // El endpoint que los clientes usar√°n para conectarse al servidor WebSocket.\n        // withSockJS() es para navegadores que no soportan WebSockets nativos.\n        registry.addEndpoint(\"/ws-connect\").withSockJS();\n    }\n}"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/WebSocketSecurityConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.core.Ordered;\nimport org.springframework.core.annotation.Order;\nimport org.springframework.lang.NonNull;\nimport org.springframework.messaging.Message;\nimport org.springframework.messaging.MessageChannel;\nimport org.springframework.messaging.simp.config.ChannelRegistration;\nimport org.springframework.messaging.simp.stomp.StompCommand;\nimport org.springframework.messaging.simp.stomp.StompHeaderAccessor;\nimport org.springframework.messaging.support.ChannelInterceptor;\nimport org.springframework.messaging.support.MessageHeaderAccessor;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.oauth2.jwt.Jwt;\nimport org.springframework.security.oauth2.jwt.JwtDecoder;\nimport org.springframework.security.oauth2.server.resource.authentication.JwtAuthenticationConverter;\nimport org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;\n\n@Configuration\n@Order(Ordered.HIGHEST_PRECEDENCE + 99)\npublic class WebSocketSecurityConfig implements WebSocketMessageBrokerConfigurer {\n\n    private final JwtDecoder jwtDecoder;\n\n    public WebSocketSecurityConfig(JwtDecoder jwtDecoder) {\n        this.jwtDecoder = jwtDecoder;\n    }\n\n    @Override\n    public void configureClientInboundChannel(ChannelRegistration registration) {\n        registration.interceptors(new ChannelInterceptor() {\n            @Override\n            public @NonNull Message<?> preSend(@NonNull Message<?> message, @NonNull MessageChannel channel) {\n                StompHeaderAccessor accessor =\n                        MessageHeaderAccessor.getAccessor(message, StompHeaderAccessor.class);\n\n                if (accessor != null && StompCommand.CONNECT.equals(accessor.getCommand())) {\n                    String authHeader = accessor.getFirstNativeHeader(\"Authorization\");\n                    if (authHeader != null && authHeader.startsWith(\"Bearer \")"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/RateLimitingConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport io.github.bucket4j.Bandwidth;\nimport io.github.bucket4j.Bucket;\nimport io.github.bucket4j.Refill;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.cache.annotation.EnableCaching;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.time.Duration;\nimport java.util.Map;\nimport java.util.concurrent.ConcurrentHashMap;\n\n@Configuration\n@EnableCaching\npublic class RateLimitingConfig {\n\n    private final Map<String, Bucket> buckets = new ConcurrentHashMap<>();\n\n    @Value(\"${rate-limit.requests-per-minute:60}\")\n    private int requestsPerMinute;\n\n    @Bean\n    public Map<String, Bucket> rateLimitBuckets() {\n        return buckets;\n    }\n\n    // ‚úÖ CORRECCI√ìN: Solo crear el bucket, NO hacer put() - evita recursi√≥n\n    private Bucket createNewBucket() {\n        Bandwidth limit = Bandwidth.classic(\n            requestsPerMinute,\n            Refill.intervally(requestsPerMinute, Duration.ofMinutes(1))\n        );\n\n        return Bucket.builder()\n                .addLimit(limit)\n                .build();\n    }\n\n    // ‚úÖ CORRECCI√ìN: Usar lambda en lugar de method reference para evitar recursi√≥n\n    public Bucket resolveBucket(String key) {\n        return buckets.computeIfAbsent(key, k -> createNewBucket());\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/AsyncConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.scheduling.annotation.EnableAsync;\nimport org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;\n\nimport java.util.concurrent.Executor;\nimport java.util.concurrent.ThreadPoolExecutor;\n\n@Configuration\n@EnableAsync\npublic class AsyncConfig {\n\n    @Bean(\"etlExecutor\")\n    public Executor etlExecutor() {\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n        executor.setCorePoolSize(2);\n        executor.setMaxPoolSize(5);\n        executor.setQueueCapacity(100);\n        executor.setThreadNamePrefix(\"ETL-\");\n        executor.setWaitForTasksToCompleteOnShutdown(true);\n        executor.setAwaitTerminationSeconds(60);\n\n        // Add rejection policy for when queue is full\n        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());\n\n        // Enhanced thread pool settings for better resource management\n        executor.setKeepAliveSeconds(60);\n        executor.setAllowCoreThreadTimeOut(true);\n\n        executor.initialize();\n        return executor;\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/StartupLogger.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport jakarta.annotation.PostConstruct;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.core.env.Environment;\nimport org.springframework.stereotype.Component;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n@Component\npublic class StartupLogger {\n    private static final Logger log = LoggerFactory.getLogger(StartupLogger.class);\n\n    @Autowired\n    private Environment env;\n\n    @PostConstruct\n    public void logStartupInfo() {\n        String[] profiles = env.getActiveProfiles();\n        if (profiles == null || profiles.length == 0) {\n            log.info(\"No active Spring profiles detected\");\n        } else {\n            log.info(\"Active Spring profiles: {}\", (Object) profiles);\n        }\n\n        // Mask the password in the JDBC URL if present\n        String url = env.getProperty(\"spring.datasource.url\");\n        if (url != null) {\n            String masked = maskJdbcUrl(url);\n            log.info(\"JDBC URL (masked): {}\", masked);\n        } else {\n            log.info(\"spring.datasource.url is not set\");\n        }\n    }\n\n    private String maskJdbcUrl(String url) {\n        // Common pattern: jdbc:postgresql://host:port/db?params\n        // We'll mask any password query param if present, otherwise return url unchanged.\n        try {\n            if (url.contains(\"password=\")) {\n                return url.replaceAll(\"(password=)([^&]+)\", \"$1****\");\n            }\n        } catch (Exception e) {\n            // ignore masking failures\n        }\n        return url;\n    }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/CacheConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport org.springframework.cache.annotation.EnableCaching;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\n@EnableCaching\npublic class CacheConfig {\n    // La configuraci√≥n espec√≠fica de Caffeine se gestiona en application.properties.\n    // Esta clase solo sirve para activar el framework de cach√© de Spring.\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/PageableConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.core.MethodParameter;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.data.domain.Sort;\nimport org.springframework.data.web.PageableHandlerMethodArgumentResolver;\nimport org.springframework.web.bind.support.WebDataBinderFactory;\nimport org.springframework.web.context.request.NativeWebRequest;\nimport org.springframework.web.method.support.HandlerMethodArgumentResolver;\nimport org.springframework.web.method.support.ModelAndViewContainer;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n@Slf4j\n@Configuration\npublic class PageableConfig implements WebMvcConfigurer {\n\n    @Override\n    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {\n        resolvers.add(new CustomPageableHandlerMethodArgumentResolver());\n    }\n\n    static class CustomPageableHandlerMethodArgumentResolver extends PageableHandlerMethodArgumentResolver {\n\n        private final ObjectMapper objectMapper = new ObjectMapper();\n\n        public CustomPageableHandlerMethodArgumentResolver() {\n            setOneIndexedParameters(false);\n            setMaxPageSize(100);\n            setFallbackPageable(PageRequest.of(0, 20, Sort.unsorted()));\n        }\n\n        @Override\n        public Pageable resolveArgument(MethodParameter methodParameter,\n                                       ModelAndViewContainer mavContainer,\n                                       NativeWebRequest webRequest,\n                                       WebDataBinderFactory binderFactory) {\n\n            String sortParam = webRequest.getParameter(\"sort\");\n\n            // Handle JSON array format: [\"name,asc\"] or [\"name\",\"asc\"]\n            if (sortParam !="
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/WebConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport com.cambiaso.ioc.interceptor.RateLimitInterceptor;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n@Configuration\n@RequiredArgsConstructor\npublic class WebConfig implements WebMvcConfigurer {\n\n    private final RateLimitInterceptor rateLimitInterceptor;\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(rateLimitInterceptor)\n                .addPathPatterns(\"/api/etl/**\")\n                .order(1); // Execute rate limiting first\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/ResilienceConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\npublic class ResilienceConfig {\n    // Circuit breaker configuration will be handled by application.properties\n    // and @CircuitBreaker annotations on methods\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/MetricsConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport io.micrometer.core.instrument.MeterRegistry;\nimport io.micrometer.core.instrument.config.MeterFilter;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.boot.actuate.autoconfigure.metrics.MeterRegistryCustomizer;\n\n@Configuration\npublic class MetricsConfig {\n\n    @Bean\n    public MeterRegistryCustomizer<MeterRegistry> metricsCommonTags() {\n        return registry -> registry.config()\n                .commonTags(\"application\", \"ioc-backend\")\n                .meterFilter(MeterFilter.deny(id -> {\n                    String uri = id.getTag(\"uri\");\n                    return uri != null && uri.startsWith(\"/actuator\");\n                }));\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/CorsConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.CorsRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n@Configuration\npublic class CorsConfig implements WebMvcConfigurer {\n\n    @Value(\"${metabase.site-url}\")\n    private String metabaseUrl;\n\n    // Puedes inyectar la URL de tu frontend desde application.properties tambi√©n\n    @Value(\"${app.frontend.url:http://localhost:5173}\")\n    private String frontendUrl;\n\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n        registry.addMapping(\"/api/**\") // Aplicar a toda la API para consistencia\n            .allowedOrigins(frontendUrl, metabaseUrl) // Permitir peticiones del frontend y Metabase\n            .allowedMethods(\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\")\n            .allowedHeaders(\"*\")\n            .allowCredentials(true)\n            .maxAge(3600);\n    }\n}\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/WebClientConfig.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.reactive.function.client.WebClient;\n\n/**\n * Configuration for WebClient used to make HTTP calls to external APIs\n * (e.g., Supabase Auth API)\n */\n@Configuration\npublic class WebClientConfig {\n\n    @Bean\n    public WebClient.Builder webClientBuilder() {\n        return WebClient.builder();\n    }\n}\n\n"
    },
    {
      "path": "src/main/java/com/cambiaso/ioc/config/MetabaseProperties.java",
      "excerpt": "package com.cambiaso.ioc.config;\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.validation.annotation.Validated;\n\nimport jakarta.validation.Valid;\nimport jakarta.validation.constraints.Min;\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.NotEmpty;\nimport jakarta.validation.constraints.Pattern;\nimport java.util.List;\nimport java.util.Set;\n\n@Data\n@Configuration\n@ConfigurationProperties(prefix = \"metabase\")\n@Validated\npublic class MetabaseProperties {\n    \n    @NotBlank(message = \"Metabase site URL is required\")\n    private String siteUrl;\n    \n    @NotBlank(message = \"Metabase secret key is required\")\n    @Pattern(regexp = \"^[A-Fa-f0-9]{64,}$\", \n             message = \"Secret key must be hexadecimal with at least 64 characters\")\n    private String secretKey;\n    \n    @Min(value = 1, message = \"Token expiration must be at least 1 minute\")\n    private int tokenExpirationMinutes = 10;\n    \n    @NotEmpty(message = \"At least one dashboard must be configured\")\n    @Valid\n    private List<DashboardConfig> dashboards;\n\n    @Data\n    public static class DashboardConfig {\n        @Min(value = 1, message = \"Dashboard ID must be positive\")\n        private int id;\n        \n        @NotBlank(message = \"Dashboard name is required\")\n        private String name;\n        \n        private String description;\n        \n        @NotEmpty(message = \"At least one role must be configured\")\n        private Set<String> allowedRoles;\n        \n        private List<FilterConfig> filters;\n    }\n\n    @Data\n    public static class FilterConfig {\n        @NotBlank(message = \"Filter name is required\")\n        private String name;\n        \n        @NotBlank(message = \"Filter type is required\")\n        private String type;\n        \n        @NotBlank(message = \"Filter source is required\")\n        private String source;\n    }\n}\n"
    },
    {
      "path": ".mvn/wrapper/maven-wrapper.properties",
      "excerpt": "distributionType=only-script\ndistributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.11/apache-maven-3.9.11-bin.zip\n"
    }
  ],
  "env": "local",
  "focus": ""
}